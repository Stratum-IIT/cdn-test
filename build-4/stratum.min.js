"use strict";(()=>{var $s=Object.defineProperty,Ba=Object.defineProperties;var Va=Object.getOwnPropertyDescriptors;var yt=Object.getOwnPropertySymbols;var xs=Object.prototype.hasOwnProperty,Os=Object.prototype.propertyIsEnumerable;var br=(u,r,e)=>r in u?$s(u,r,{enumerable:!0,configurable:!0,writable:!0,value:e}):u[r]=e,G=(u,r)=>{for(var e in r||(r={}))xs.call(r,e)&&br(u,e,r[e]);if(yt)for(var e of yt(r))Os.call(r,e)&&br(u,e,r[e]);return u},k=(u,r)=>Ba(u,Va(r));var oe=(u,r)=>{var e={};for(var t in u)xs.call(u,t)&&r.indexOf(t)<0&&(e[t]=u[t]);if(u!=null&&yt)for(var t of yt(u))r.indexOf(t)<0&&Os.call(u,t)&&(e[t]=u[t]);return e};var Ua=(u,r)=>{for(var e in r)$s(u,e,{get:r[e],enumerable:!0})};var a=(u,r,e)=>(br(u,typeof r!="symbol"?r+"":r,e),e);var nt=(u,r,e)=>new Promise((t,s)=>{var i=h=>{try{l(e.next(h))}catch(p){s(p)}},o=h=>{try{l(e.throw(h))}catch(p){s(p)}},l=h=>h.done?t(h.value):Promise.resolve(h.value).then(i,o);l((e=e.apply(u,r)).next())});var ve=["A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","0","1","2","3","4","5","6","7","8","9","+","/"],Ds=[255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,62,255,255,255,63,52,53,54,55,56,57,58,59,60,61,255,255,255,0,255,255,255,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,255,255,255,255,255,255,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51];function St(u){if(u>=Ds.length)throw new Error("Unable to parse base64 string.");let r=Ds[u];if(r===255)throw new Error("Unable to parse base64 string.");return r}function _s(u){let r="",e,t=u.length;for(e=2;e<t;e+=3)r+=ve[u[e-2]>>2],r+=ve[(u[e-2]&3)<<4|u[e-1]>>4],r+=ve[(u[e-1]&15)<<2|u[e]>>6],r+=ve[u[e]&63];return e===t+1&&(r+=ve[u[e-2]>>2],r+=ve[(u[e-2]&3)<<4],r+="=="),e===t&&(r+=ve[u[e-2]>>2],r+=ve[(u[e-2]&3)<<4|u[e-1]>>4],r+=ve[(u[e-1]&15)<<2],r+="="),r}function vs(u){if(u.length%4!==0)throw new Error("Unable to parse base64 string.");let r=u.indexOf("=");if(r!==-1&&r<u.length-2)throw new Error("Unable to parse base64 string.");let e=u.endsWith("==")?2:u.endsWith("=")?1:0,t=u.length,s=new Uint8Array(3*(t/4)),i;for(let o=0,l=0;o<t;o+=4,l+=3)i=St(u.charCodeAt(o))<<18|St(u.charCodeAt(o+1))<<12|St(u.charCodeAt(o+2))<<6|St(u.charCodeAt(o+3)),s[l]=i>>16,s[l+1]=i>>8&255,s[l+2]=i&255;return s.subarray(0,s.length-e)}var ae={};Ua(ae,{decode:()=>Ps,encode:()=>Ha,table:()=>yr});var yr=[...Array.from({length:128},(u,r)=>String.fromCharCode(r)),"\u0402","\u0403","\u201A","\u0453","\u201E","\u2026","\u2020","\u2021","\u20AC","\u2030","\u0409","\u2039","\u040A","\u040C","\u040B","\u040F","\u0452","\u2018","\u2019","\u201C","\u201D","\u2022","\u2013","\u2014","","\u2122","\u0459","\u203A","\u045A","\u045C","\u045B","\u045F"," ","\u040E","\u045E","\u040B","\xA4","\u0490","\xA6","\xA7","\u0401","\xA9","\u0404","\xAB","\xAC","","\xAE","\u0407","\xB0","\xB1","\u0406","\u0456","\u0491","\xB5","\xB6","\xB7","\u0451","\u2116","\u0454","\xBB","\u0458","\u0405","\u0455","\u0457","\u0410","\u0411","\u0412","\u0413","\u0414","\u0415","\u0416","\u0417","\u0418","\u0419","\u041A","\u041B","\u041C","\u041D","\u041E","\u041F","\u0420","\u0421","\u0422","\u0423","\u0424","\u0425","\u0426","\u0427","\u0428","\u0429","\u042A","\u042B","\u042C","\u042D","\u042E","\u042F","\u0430","\u0431","\u0432","\u0433","\u0434","\u0435","\u0436","\u0437","\u0438","\u0439","\u043A","\u043B","\u043C","\u043D","\u043E","\u043F","\u0440","\u0441","\u0442","\u0443","\u0444","\u0445","\u0446","\u0447","\u0448","\u0449","\u044A","\u044B","\u044C","\u044D","\u044E","\u044F"];function Ps(u){return Array.from(u).map(r=>yr[r]).join("")}var ja=" ".charCodeAt(0);function Ha(u){return new Uint8Array([...u].map(r=>{let e=yr.indexOf(r);return e>-1?e:ja}))}var Fa=["gray","blue","navy","gray","#b5b5b5","white","black","black","black","white","gray","gray","gray","navy","white","#b5b5b5","gray","gray","black","gray","white"];function Is(u){let r=parseInt(u);if(!isNaN(r))return r;let e=u.toLowerCase().trim();if(e.startsWith("rgb")){let t=e.split("(")[1].split(")")[0].split(",").map(s=>parseInt(s));return t[0]|t[1]<<8|t[2]<<16}return e.startsWith("transparent")?16777216:e.startsWith("syscolor")?33554432|parseInt(e.split("(")[1].split(")")[0]):(console.warn(`\u041D\u0435\u0438\u0437\u0432\u0435\u0441\u0442\u043D\u044B\u0439 \u043A\u043E\u0434 \u0446\u0432\u0435\u0442\u0430: "${u}"`),0)}function Fe(u){if(u&16777216)return null;let r=u&255;if(u&33554432)return Fa[r]||"black";let e=u>>8&255,t=u>>16&255;return u&67108864?`rgba(${r},${e},${t}, 0.5)`:`rgb(${r},${e},${t})`}function Sr(u,r,e,t){let s=t==="transparent"?16777216:t==="syscolor"?33554432:t==="editor"?67108864:0;return u&255|(r&255)<<8|(e&255)<<16|s}function As(u){return u&255}function Ns(u){return u>>8&255}function Rs(u){return u>>16&255}function Gs(u){if(u&16777216)return"Transparent";let r=u&255;if(u&33554432)return`SysColor(${r})`;let e=u>>8&255,t=u>>16&255;return`rgb(${r},${e},${t})`}var Le=class{constructor(){a(this,"frameId",0)}get running(){return this.frameId!==0}run(r){if(this.running)return;let e=()=>{this.frameId=r()?requestAnimationFrame(e):0};this.frameId=requestAnimationFrame(e)}stop(){this.running&&(cancelAnimationFrame(this.frameId),this.frameId=0)}},wt=class{constructor(r=1){this.cycles=r;a(this,"frameId",0)}get running(){return this.frameId!==0}run(r){if(this.running)return;let e=()=>{for(let t=0;t<this.cycles;++t)if(!r()){this.frameId=0;return}this.frameId=setTimeout(e,0)};this.frameId=setTimeout(e)}stop(){this.running&&(clearTimeout(this.frameId),this.frameId=0)}};var jl=new Intl.Collator(void 0,{numeric:!0,sensitivity:"base"}).compare;function Ce(u){return new Array().concat(...u)}var ot=class{constructor(r,e){this.data=new Array(r.length);for(var t=0,s=r[0].length;t<r.length;t++){this.data[t]=new Array(s);for(var i=0;i<s;i++)this.data[t][i]=r[t][i]}if(e){if(typeof e[0]!="object")for(var t=0;t<e.length;t++)e[t]=[e[t]];this.mirror=new ot(e)}}swap(r,e){this.mirror&&this.mirror.swap(r,e);var t=this.data[r];this.data[r]=this.data[e],this.data[e]=t}multline(r,e){this.mirror&&this.mirror.multline(r,e);for(var t=this.data[r],s=t.length-1;s>=0;s--)t[s]*=e}addmul(r,e,t){this.mirror&&this.mirror.addmul(r,e,t);for(var s=this.data[r],i=this.data[e],o=s.length-1;o>=0;o--)s[o]=s[o]+t*i[o]}hasNullLine(r){for(var e=0;e<this.data[r].length;e++)if(this.data[r][e]!==0)return!1;return!0}gauss(){for(var r=0,e=this.data.length,t=this.data[0].length,s=[],i=0;i<t;i++){for(var o=0,l=0,h=r;h<e;h++){var p=this.data[h][i];Math.abs(p)>Math.abs(o)&&(l=h,o=p)}if(o===0)s.push(r);else{this.multline(l,1/o),this.swap(l,r);for(var b=0;b<e;b++)b!==r&&this.addmul(b,r,-this.data[b][i])}r++}for(var b=0;b<s.length;b++)if(!this.mirror.hasNullLine(s[b]))throw new Error("singular matrix");return this.mirror.data}};function ks({a:u,b:r}){var e=new ot(u,r).gauss();if(e.length>0&&e[0].length===1)for(var t=0;t<e.length;t++)e[t]=e[t][0];return e}function Ms(u,r,e,t){let s=e-u,i=t-r;return Math.sqrt(s*s+i*i)}function Ls(u,r,e,t,s){for(let i=r?0:2,o=r?u.length-2:0;i<u.length;o=i,i+=2){let l=u[i],h=u[i+1],p=u[o],b=u[o+1],y=l-p,T=h-b,v=y*y+T*T;if(v===0&&Ms(t,s,p,b)<=e)return!0;let _=((t-p)*y+(s-b)*T)/v;if(_=Math.max(0,Math.min(1,_)),Ms(t,s,p+_*y,b+_*T)<=e)return!0}return!1}function Bs(u,r,e){let t=!1;for(let s=0,i=u.length-2;s<u.length;i=s,s+=2){let o=u[s],l=u[s+1],h=u[i],p=u[i+1];(l<=e&&e<p||p<=e&&e<l)&&p-l!==0&&r>(h-o)*(e-l)/(p-l)+o&&(t=!t)}return t}function Vs(u){let r=u[0]*(u[4]*u[8]-u[7]*u[5])-u[1]*(u[3]*u[8]-u[5]*u[6])+u[2]*(u[3]*u[7]-u[4]*u[6]);return[(u[4]*u[8]-u[7]*u[5])/r,(u[2]*u[7]-u[1]*u[8])/r,(u[1]*u[5]-u[2]*u[4])/r,(u[5]*u[6]-u[3]*u[8])/r,(u[0]*u[8]-u[2]*u[6])/r,(u[3]*u[2]-u[0]*u[5])/r,(u[3]*u[7]-u[6]*u[4])/r,(u[6]*u[1]-u[0]*u[7])/r,(u[0]*u[4]-u[3]*u[1])/r]}var ye=class{constructor(r){a(this,"m",new Map);r==null||r.forEach(([e,t])=>this.set(e,t))}set(r,e){let t=this.m.get(r);return t?t.add(e):this.m.set(r,new Set([e])),this}get(r){var e;return(e=this.m.get(r))!=null?e:null}delete(r){return this.m.delete(r)}forEach(r){return this.m.forEach(r)}[Symbol.iterator](){return this.m.entries()}values(){return this.m.values()}};function wr(u){u.preventDefault()}var re=class extends Map{static freeKey(r,e){let t=e||0;for(;r.has(++t););return t}static freeNegativeKey(r){let e=0;for(;r.has(--e););return e}};var ue=class{constructor(r,e,{key:t,data:s}){this.scene=r;this.m=e;a(this,"subs",new Set);a(this,"key");a(this,"data");this.key=t||re.freeKey(e),this.key>0&&this.m.set(this.key,this),this.data=s!=null?s:null}get refCount(){return this.subs.size}delete(){return this.key===0?!0:this.refCount?!1:(this.m.delete(this.key),this.key=0,!0)}toJSON(){let{key:r,data:e}=this;return{key:r,data:e}}};var me=class extends ue{constructor(e,t){super(e,e.objects,t);a(this,"parent",null);a(this,"x");a(this,"y");a(this,"width");a(this,"height");a(this,"attrib");let{x:s,y:i,width:o,height:l,attrib:h}=t;this.x=s!=null?s:0,this.y=i!=null?i:0,this.width=o!=null?o:0,this.height=l!=null?l:0,this.attrib=h!=null?h:0}delete(e){var s;if(super.delete(),e)return!0;(s=this.parent)==null||s.set({children:this.parent.children.filter(i=>i!==this)});let t=this.scene.order.filter(i=>i.key);return this.scene.set({order:t}),!0}set(e){var p;let{attrib:t,x:s,y:i,width:o,height:l}=e;this.attrib=t!=null?t:this.attrib;let h=!1;{let b=(s!=null?s:this.x)-this.x,y=(i!=null?i:this.y)-this.y;(b!==0||y!==0)&&(this._virtualMoved(b,y),h=!0)}if(o||l){let b=this.width||1,y=this.height||1,T=o&&o>0?o:b,v=l&&l>0?l:y,_=T/b,I=v/y;(_!==1||I!==1)&&(this._virtualResized(this.x,this.y,_,I),h=!0)}return h&&((p=this.parent)==null||p._childChanged()),this.scene._dirty=!0,this}rotate(e,{x:t,y:s}={x:this.x,y:this.y}){var i;return e===0?this:(this._virtualRotated(t,s,e),(i=this.parent)==null||i._childChanged(),this)}_virtualUpdateBBox(e,t,s,i){this.x=e,this.y=t,this.width=s,this.height=i}_virtualMoved(e,t){this._virtualUpdateBBox(this.x+e,this.y+t,this.width,this.height)}_virtualResized(e,t,s,i){let o=e+(this.x-e)*s,l=t+(this.y-t)*i,h=(this.width||1)*s,p=(this.height||1)*i;this._virtualUpdateBBox(o,l,h,p)}_virtualRotated(e,t,s){let i=Math.sin(s),o=Math.cos(s),l=this.x-e,h=this.y-t,p=l*o-h*i+e,b=l*i+h*o+t;this._virtualUpdateBBox(p,b,this.width,this.height)}toJSON(){let{attrib:e,height:t,width:s,x:i,y:o}=this;return k(G({},super.toJSON()),{attrib:e,height:t,width:s,x:i,y:o})}};var Tt=class extends me{constructor(e,t,s){super(e,s);a(this,"type","group");a(this,"children",[]);this.set(k(G({},s),{children:t}))}delete(e){return this.children.forEach(t=>t.delete(!0)),super.delete(e)}set(e){var s;typeof e.children!="undefined"&&(this.children.forEach(i=>i.parent=null),this.children=e.children,this.children.forEach(i=>i.parent=this),this.children.length>0?this._childChanged():(this._virtualUpdateBBox(this.x,this.y,0,0),(s=this.parent)==null||s._childChanged()));let{attrib:t}=e;return typeof t!="undefined"&&this.children.forEach(i=>i.set({attrib:t})),super.set(e)}_childChanged(){var o;let e=1/0,t=-1/0,s=1/0,i=-1/0;this.children.forEach(l=>{e=Math.min(e,l.x),s=Math.min(s,l.y),t=Math.max(t,l.x+l.width),i=Math.max(i,l.y+l.height)}),this._virtualUpdateBBox(e,s,t-e,i-s),(o=this.parent)==null||o._childChanged()}_virtualMoved(e,t){if(this.children.length===0){super._virtualMoved(e,t);return}this.children.forEach(s=>s._virtualMoved(e,t)),this._virtualUpdateBBox(this.x+e,this.y+t,this.width,this.height)}_virtualResized(e,t,s,i){if(this.children.length===0){super._virtualResized(e,t,s,i);return}let o=1/0,l=-1/0,h=1/0,p=-1/0;this.children.forEach(b=>{b._virtualResized(e,t,s,i),o=Math.min(o,b.x),h=Math.min(h,b.y),l=Math.max(l,b.x+b.width),p=Math.max(p,b.y+b.height)}),this._virtualUpdateBBox(o,h,l-o,p-h)}_virtualRotated(e,t,s){if(this.children.length===0){super._virtualRotated(e,t,s);return}let i=1/0,o=-1/0,l=1/0,h=-1/0;this.children.forEach(p=>{p._virtualRotated(e,t,s),i=Math.min(i,p.x),l=Math.min(l,p.y),o=Math.max(o,p.x+p.width),h=Math.max(h,p.y+p.height)}),this._virtualUpdateBBox(i,l,o-i,h-l)}*descendants(){for(let e of this.children)e.type==="group"&&(yield*e.descendants()),yield e}toJSON(){let{type:e}=this,p=super.toJSON(),{x:t,y:s,width:i,height:o}=p,l=oe(p,["x","y","width","height"]),h=this.children.filter(b=>b.key>0).map(b=>b.key);return k(G({},l),{type:e,children:h})}};var Wt=class{constructor(r){a(this,"_dirty",!0);a(this,"x",0);a(this,"y",0);a(this,"scale",1);a(this,"order",[]);a(this,"background",null);a(this,"hiddenLayers",0);a(this,"grid",null);a(this,"cursor",null);a(this,"selectUnselectable",!1);a(this,"disableInputs",!1);a(this,"objects",new Map);a(this,"pens",new Map);a(this,"brushes",new Map);a(this,"images",new Map);a(this,"imagesOpaque",new Map);a(this,"strings",new Map);a(this,"fonts",new Map);a(this,"texts",new Map);a(this,"onpointermove",null);a(this,"onpointerdown",null);a(this,"onpointerup",null);a(this,"oninputchanged",null);if(r){let e=r,{background:t,order:s}=e,i=oe(e,["background","order"]);this.set(i)}}set({x:r=this.x,y:e=this.y,order:t=this.order,scale:s=this.scale,hiddenLayers:i=this.hiddenLayers,selectUnselectable:o=this.selectUnselectable,disableInputs:l=this.disableInputs,grid:h=this.grid,background:p=this.background,cursor:b=this.cursor}){var y,T;if(this.background!==p&&((y=this.background)==null||y.subs.delete(this),this.background=p,(T=this.background)==null||T.subs.add(this)),this.disableInputs!==l){let v=l?"none":"auto";this.objects.forEach(_=>{_.type==="input"&&(_._html.style.pointerEvents=v)})}return this.x=r,this.y=e,this.order=t,this.scale=s,this.hiddenLayers=i,this.selectUnselectable=o,this.disableInputs=l,this.grid=h,this.cursor=b,this}pick(r,e){let{order:t,hiddenLayers:s,selectUnselectable:i}=this;for(let o=t.length-1;o>=0;--o){let l=t[o],h=l.attrib,p=h&1,b=h&2,y=h&4,T=h&8,v=h>>8&31;if(p||T&&!i||!b&&1<<v&s||y)continue;let _=r-l.x,I=e-l.y,R=0;if(l.type==="line"){if(l.pen)R=l.pen.width/2||.5;else if(!l.brush)continue;R=Math.max(R,4)}else if(l.type==="textView"){let W=Math.sin(-l.angle),N=Math.cos(-l.angle),j=_*N-I*W,q=_*W+I*N;_=j,I=q}if(!(_<-R||_>l.width+R||I<-R||I>l.height+R)&&!(l.type==="line"&&!l.inside(_,I,R)))return l}return null}toJSON(){let{background:r,x:e,y:t,scale:s,hiddenLayers:i,selectUnselectable:o,grid:l,pens:h,brushes:p,images:b,imagesOpaque:y,fonts:T,strings:v,texts:_,objects:I,order:R}=this;return{background:r==null?void 0:r.key,x:e,y:t,scale:s,hiddenLayers:i,selectUnselectable:o,grid:l,pens:[...h.values()].map(W=>W.toJSON()),brushes:[...p.values()].map(W=>W.toJSON()),images:[...b.values()].map(W=>W.toJSON()),imagesOpaque:[...y.values()].map(W=>W.toJSON()),fonts:[...T.values()].map(W=>W.toJSON()),strings:[...v.values()].map(W=>W.toJSON()),texts:[..._.values()].map(W=>W.toJSON()),objects:[...I.values()].map(W=>W.toJSON()),order:R.filter(W=>W.key>0).map(W=>W.key)}}group(r,e={}){return new Tt(this,r,e)}};var Et=class extends me{constructor(e,t,s){var o,l,h;let i=k(G({},s),{width:(o=s.width)!=null?o:t.width,height:(l=s.height)!=null?l:t.height,image:t});super(e,i);this.image=t;a(this,"type","imageView");a(this,"opaque");a(this,"area",null);this.opaque=(h=s.opaque)!=null?h:!1,t.subs.add(this),this.set(i)}set(i){var o=i,{area:e=this.area,image:t=this.image}=o,s=oe(o,["area","image"]);return this.image!==t&&(this.image.subs.delete(this),this.image=t,this.image.subs.add(this)),this.area=e,super.set(s)}toJSON(){let{image:e,area:t,opaque:s,type:i}=this;return k(G({},super.toJSON()),{type:i,image:e.key,area:t,opaque:s})}delete(e){return this.image.subs.delete(this),super.delete(e)}};var $t=class extends Et{constructor(e,t,s){super(e,t,s);a(this,"_svg",document.createElementNS("http://www.w3.org/2000/svg","svg"));a(this,"img");a(this,"_visible",!0);a(this,"_src",null);a(this,"_area",null);a(this,"_x",0);a(this,"_y",0);a(this,"_w",0);a(this,"_h",0);this._svg.setAttribute("preserveAspectRatio","none"),this._svg.appendChild(this.img=document.createElementNS("http://www.w3.org/2000/svg","image"))}_render(){let e=this.attrib,t=e&1,s=e>>8&31,i=!(t||1<<s&this.scene.hiddenLayers);if(this._visible!==i&&(this._visible=i,i?this._svg.removeAttribute("display"):this._svg.setAttribute("display","none")),!i)return;let o=this.image,l=this._src!==o.realSrc;l&&this.img.setAttribute("href",this._src=o.realSrc);let h=this.area;if(this._area!==h||l){this._area=h;let v=o.width,_=o.height;if(h){let I=Math.min(Math.max(h.x,0),v),R=Math.min(Math.max(h.y,0),_),W=Math.min(Math.max(h.w,0),v-I),N=Math.min(Math.max(h.h,0),_-R);this._svg.setAttribute("viewBox",`${I} ${R} ${W} ${N}`)}else this._svg.setAttribute("viewBox",`0 0 ${v} ${_}`)}let p=this.x-this.scene.x,b=this.y-this.scene.y,y=this.width,T=this.height;this._x!==p&&this._svg.setAttribute("x",(this._x=p).toString()),this._y!==b&&this._svg.setAttribute("y",(this._y=b).toString()),this._w!==y&&this._svg.setAttribute("width",(this._w=y).toString()),this._h!==T&&this._svg.setAttribute("height",(this._h=T).toString())}};var xt=class extends me{constructor(e,t,s){super(e,s);this.inputType=t;a(this,"type","input");a(this,"value","");a(this,"style",0);a(this,"font",null);this.set(s)}set(o){var l=o,{value:e=this.value,style:t=this.style,font:s=this.font}=l,i=oe(l,["value","style","font"]);var h,p;return this.value=e,this.style=t,this.font!==s&&((h=this.font)==null||h.subs.delete(this),this.font=s,(p=this.font)==null||p.subs.add(this)),super.set(i)}toJSON(){let{inputType:e,style:t,font:s,type:i,value:o}=this;return k(G({},super.toJSON()),{type:i,inputType:e,exStyle:0,font:s==null?void 0:s.key,style:t,value:o})}delete(e){var t;return(t=this.font)==null||t.subs.delete(this),super.delete(e)}};var Ot=class extends xt{constructor(e,t,s){super(e,t,s);a(this,"_svg",!1);a(this,"_html",document.createElement("input"));a(this,"st",this._html.style);a(this,"_visible",!0);a(this,"_css",null);a(this,"_value","");a(this,"_x",0);a(this,"_y",0);a(this,"_w",0);a(this,"_h",0);let i=this._html;t==="Button"?(i.setAttribute("type","button"),i.setAttribute("class","swg-input swg-button"),i.addEventListener("click",this)):(i.setAttribute("type","text"),i.setAttribute("class","swg-input swg-textbox"),i.setAttribute("spellcheck","false"),i.addEventListener("input",this)),this.st.setProperty("position","absolute"),this.st.pointerEvents=e.disableInputs?"none":"auto",i.addEventListener("focus",this),i.addEventListener("blur",this)}handleEvent(e){var o;let t=this,{scene:s,_html:i}=this;this.value=this._value=i.value,(o=s.oninputchanged)==null||o.call(s,{type:e.type,scene:s,target:t})}_render(){var y;let e=this.attrib,t=e&1,s=e>>8&31,i=!(t||1<<s&this.scene.hiddenLayers);if(this._visible!==i&&(this._visible=i,i?this.st.removeProperty("display"):this.st.setProperty("display","none")),!i)return;let o=((y=this.font)==null?void 0:y.css())||null;if(this._css!==o)if(this._css=o,o){let T=.566726660156244,v=`${o.fontWeight} ${o.fontStyle} ${o.fontSize*T}px ${o.fontFamily}`;this.st.setProperty("font",v)}else this.st.removeProperty("font");this._value!==this.value&&(this._html.value=this._value=this.value);let l=this.x-this.scene.x,h=this.y-this.scene.y,p=this.width,b=this.height;this._x!==l&&this.st.setProperty("left",(this._x=l).toString()+"px"),this._y!==h&&this.st.setProperty("top",(this._y=h).toString()+"px"),this._w!==p&&this.st.setProperty("width",(this._w=p).toString()+"px"),this._h!==b&&this.st.setProperty("height",(this._h=b).toString()+"px")}};var Dt=class extends me{constructor(e,t,s){super(e,s);a(this,"type","line");a(this,"_coordsDirty",!0);a(this,"coords");a(this,"pen",null);a(this,"brush",null);a(this,"start",null);a(this,"end",null);this.setCoords(t).set(s)}get length(){return this.coords.length/2}set(l){var h=l,{pen:e=this.pen,brush:t=this.brush,start:s=this.start,end:i=this.end}=h,o=oe(h,["pen","brush","start","end"]);var p,b,y,T;return this.pen!==e&&((p=this.pen)==null||p.subs.delete(this),this.pen=e,(b=this.pen)==null||b.subs.add(this)),this.brush!==t&&((y=this.brush)==null||y.subs.delete(this),this.brush=t,(T=this.brush)==null||T.subs.add(this)),this.start=s,this.end=i,super.set(o)}addPoint({x:e,y:t},s=0){let i=s*2,o=this.coords,l=e-this.x,h=t-this.y;return i<0||i>=o.length?o.push(l,h):o.splice(i,0,l,h),this._pointCountChanged(),!0}point(e){let t=e*2,s=this.coords;return t>=0&&t<s.length?{x:s[t]+this.x,y:s[t+1]+this.y}:null}setPoint(e,{x:t,y:s}){let i=e*2,o=this.coords;return i<0||i>=o.length?!1:(o[i+0]=t-this.x,o[i+1]=s-this.y,this._pointCountChanged(),!0)}delPoint(e){let t=e*2,s=this.coords;return s.length<=2||t<0||t>=s.length?!1:(s.splice(t,2),this._pointCountChanged(),!0)}setCoords(e){if(!e.length||e.length%2)throw Error("\u041A\u043E\u043B\u0438\u0447\u0435\u0441\u0442\u0432\u043E \u043A\u043E\u043E\u0440\u0434\u0438\u043D\u0430\u0442 \u0434\u043E\u043B\u0436\u043D\u043E \u0431\u044B\u0442\u044C \u0447\u0435\u0442\u043D\u044B\u043C.");return this.x=0,this.y=0,this.coords=e.slice(),this._pointCountChanged(),this}inside(e,t,s){let{coords:i,brush:o}=this;return o&&Bs(i,e,t)||Ls(i,!!o,s,e,t)}_pointCountChanged(){var l;let e=this.coords,t=e[0],s=e[1],i=t,o=s;for(let h=2;h<e.length;h+=2){let p=e[h+0],b=e[h+1];p<t&&(t=p),p>i&&(i=p),b<s&&(s=b),b>o&&(o=b)}if(t!==0||s!==0)for(let h=0;h<e.length;h+=2)e[h+0]-=t,e[h+1]-=s;this._virtualUpdateBBox(this.x+t,this.y+s,i-t,o-s),(l=this.parent)==null||l._childChanged(),this._coordsDirty=this.scene._dirty=!0}_virtualResized(e,t,s,i){let o=this.coords;for(let p=0;p<o.length;p+=2)o[p+0]*=s,o[p+1]*=i;let l=e+(this.x-e)*s,h=t+(this.y-t)*i;this._virtualUpdateBBox(l,h,this.width*s,this.height*i),this._coordsDirty=!0}_virtualRotated(e,t,s){let i=this.coords,o=e-this.x,l=t-this.y,h=Math.sin(s),p=Math.cos(s),b=1/0,y=-1/0,T=1/0,v=-1/0;for(let _=0;_<i.length;_+=2){let I=i[_+0]-o,R=i[_+1]-l,W=I*p-R*h+o,N=I*h+R*p+l;i[_+0]=W,i[_+1]=N,W<b&&(b=W),W>y&&(y=W),N<T&&(T=N),N>v&&(v=N)}if(b!==0||T!==0)for(let _=0;_<i.length;_+=2)i[_+0]-=b,i[_+1]-=T;this._virtualUpdateBBox(this.x+b,this.y+T,y-b,v-T),this._coordsDirty=!0}toJSON(){let{coords:e,brush:t,end:s,pen:i,start:o,type:l}=this;return k(G({},super.toJSON()),{type:l,coords:e.slice(),brush:t==null?void 0:t.key,end:s,pen:i==null?void 0:i.key,start:o})}delete(e){var t,s;return(t=this.pen)==null||t.subs.delete(this),(s=this.brush)==null||s.subs.delete(this),super.delete(e)}};var Ca=0;function Us(){let u=`mark_${++Ca}`,r=document.createElementNS("http://www.w3.org/2000/svg","marker");r.setAttribute("id",u),r.setAttribute("orient","auto"),r.setAttribute("refX","0");let e=document.createElementNS("http://www.w3.org/2000/svg","polyline");return r.appendChild(e),{shape:e,marker:r,id:u}}function Tr(u,r,e,t){let s=e.width||1,i=e.stroke(),o=r.fill?i:null,l=r.fill?null:i;u.marker.setAttribute("markerWidth",(r.width+s).toString()),u.marker.setAttribute("markerHeight",(r.oy*2+s).toString()),t&&u.marker.setAttribute("refX",r.width.toString()),u.marker.setAttribute("refY",r.oy.toString()),u.marker.setAttribute("markerUnits","userSpaceOnUse"),u.shape.setAttribute("points",r.coords),u.shape.setAttribute("stroke-width",s.toString()),l?u.shape.setAttribute("stroke",l):u.shape.removeAttribute("stroke"),u.shape.setAttribute("fill",o||"none")}function Wr(u,r){var i;if(u.angle===0||u.length===0)return null;let e=Math.abs(u.length*Math.sin(u.angle)),t=Math.abs(u.length*Math.cos(u.angle)),s=r?[0,0,t,e,0,e*2]:[t,0,0,e,t,e*2];return{coords:Er(s),fill:(i=u.fill)!=null?i:!1,width:t,oy:e}}function Er(u){let r="";for(let e=0;e<u.length;e+=2)r+=u[e]+","+u[e+1]+" ";return r}var _t=class extends Dt{constructor(e,t,s){super(e,t,s);a(this,"_svg");a(this,"_visible",!0);a(this,"_width",0);a(this,"_stroke",null);a(this,"_dash",null);a(this,"_fill",null);a(this,"_blend",null);a(this,"_start",null);a(this,"_startMark",null);a(this,"_end",null);a(this,"_endMark",null);a(this,"_x",0);a(this,"_y",0);this._svg=document.createElementNS("http://www.w3.org/2000/svg",s.brush?"polygon":"polyline"),this._svg.setAttribute("fill-rule","evenodd"),this._svg.setAttribute("stroke-linecap","round"),this._svg.setAttribute("stroke-linejoin","round")}createMarker(e){let t=Us();return this.scene.defs.appendChild(t.marker),this._svg.setAttribute(e?"marker-end":"marker-start",`url(#${t.id})`),t}_render(){var N,j;let e=this.attrib,t=e&1,s=!!(e&2),i=e>>8&31,o=this.pen,l=this.brush,h=s||!(t||1<<i&this.scene.hiddenLayers)&&!!(o||l);if(this._visible!==h&&(this._visible=h,h?this._svg.removeAttribute("display"):this._svg.setAttribute("display","none")),!h)return;this._coordsDirty&&(this._coordsDirty=!1,this._svg.setAttribute("points",Er(this.coords)));let p=(o==null?void 0:o.width)||1,b=(o==null?void 0:o.stroke())||null,y=(o==null?void 0:o.dash())||null;this._width!==p&&(this._width=p,this._svg.setAttribute("stroke-width",p.toString())),this._stroke!==b&&(this._stroke=b,b?this._svg.setAttribute("stroke",b):this._svg.removeAttribute("stroke")),this._dash!==y&&(this._dash=y,y?this._svg.setAttribute("stroke-dasharray",y):this._svg.removeAttribute("stroke-dasharray"));let T=this.length>2&&(l==null?void 0:l.fill())||"none";this._fill!==T&&(this._fill=T,this._svg.setAttribute("fill",T));let v=(l==null?void 0:l.blend())||(o==null?void 0:o.blend())||null;this._blend!==v&&(this._blend=v,v?this._svg.style.setProperty("mix-blend-mode",v):this._svg.style.removeProperty("mix-blend-mode"));let _=o&&this.start,I=o&&this.end;if(this._start!==_){this._start=_;let q=_&&Wr(_,!0);q?Tr(this._startMark||(this._startMark=this.createMarker(!0)),q,o,!0):((N=this._startMark)==null||N.marker.remove(),this._startMark=null)}if(this._end!==I){this._end=I;let q=I&&Wr(I,!1);q?Tr(this._endMark||(this._endMark=this.createMarker(!1)),q,o,!1):((j=this._endMark)==null||j.marker.remove(),this._endMark=null)}let R=this.x-this.scene.x,W=this.y-this.scene.y;(R!==this._x||W!==this._y)&&(this._x=R,this._y=W,this._svg.setAttribute("transform",`translate(${R}, ${W})`))}};var vt=class extends me{constructor(e,t,s){var o,l,h;let i=k(G({},s),{width:(o=s.width)!=null?o:t.width,height:(l=s.height)!=null?l:t.height,text:t});super(e,i);this.text=t;a(this,"type","textView");a(this,"angle");t.subs.add(this),this.angle=(h=s.angle)!=null?h:0,this.set(k(G({},s),{text:t}))}set(s){var i=s,{text:e=this.text}=i,t=oe(i,["text"]);return this.text!==e&&(this.text.subs.delete(this),this.text=e,this.text.subs.add(this)),super.set(t)}_virtualRotated(e,t,s){super._virtualRotated(e,t,s),this.angle+=s}toJSON(){let{text:e,angle:t,type:s}=this;return k(G({},super.toJSON()),{type:s,text:e.key,angle:t})}delete(e){return this.text.subs.delete(this),super.delete(e)}};function js(u){let r=document.createElementNS("http://www.w3.org/2000/svg","tspan");return u&&(r.setAttribute("x","0px"),r.setAttribute("dy","1.15em")),r}var Pt=class{constructor(r,e){this.owner=r;this.part=e;a(this,"_strs",[]);a(this,"_css",null);a(this,"_fgcolor",NaN);a(this,"spans");this.spans=e.string.split().map((t,s)=>js(s>0))}update(){var o,l;let r=!1,{part:e,spans:t}=this,s=e.string.split(),i=e.font.css();if(this._strs!==s){this._strs=s,r=!0,t.length!==s.length&&(this._fgcolor=NaN);let h;for(let p=0;p<s.length;++p){if(p<t.length)h=t[p];else{let y=js(!0);t.push(y),h.after(y),h=y,this._css=null}let b=s[p];i.fontFamily==="Symbol"&&(b=[...ae.encode(b)].map(y=>String.fromCharCode(y===142?163:y)).join("")),h.textContent=b||"\u200B"}for(;t.length>s.length;)(o=t.pop())==null||o.remove()}if(this._css!==i&&(this._css=i,r=!0,t.forEach(h=>{h.setAttribute("font-family",i.fontFamily),h.setAttribute("font-size",i.fontSize.toString()),h.setAttribute("font-style",i.fontStyle),h.setAttribute("text-decoration",i.textDecoration),h.setAttribute("font-weight",i.fontWeight)})),this._fgcolor!==e.fgcolor){this._fgcolor=e.fgcolor;let h=(l=Fe(e.fgcolor))!=null?l:"transparent";t.forEach(p=>p.setAttribute("fill",h))}return r}};var It=class extends vt{constructor(e,t,s){var i,o;super(e,t,s);a(this,"_svg",document.createElementNS("http://www.w3.org/2000/svg","text"));a(this,"_visible",!0);a(this,"_parts",[]);a(this,"_partsSVG",[]);a(this,"_sizes",{w:0,h:0});a(this,"_angle",0);a(this,"_x",0);a(this,"_y",0);if(this._svg.setAttribute("dominant-baseline","text-before-edge"),this._svg.setAttribute("alignment-baseline","text-before-edge"),this._svg.setAttribute("letter-spacing","-0.07"),this._svg.style.setProperty("white-space","pre"),this._svg.style.setProperty("user-select","none"),this._svg.style.setProperty("pointer-events","none"),t._textCalc=this._calcSizes.bind(this),!s.width||!s.height){let l=(i=s.width)!=null?i:t.width,h=(o=s.height)!=null?o:t.height;this._virtualUpdateBBox(this.x,this.y,l,h)}}_calcSizes(){var o;let e=(o=this.text)==null?void 0:o.parts;if(!e||!this.updateParts(e))return this._sizes;let t=this._svg.parentElement;t||this.scene.root.appendChild(this._svg);let{width:s,height:i}=this._svg.getBoundingClientRect();return t||this._svg.remove(),this._sizes={w:s,h:i}}updateParts(e){if(this._parts!==e){this._parts=e;let t=[];this._partsSVG=e.map(s=>{let i=new Pt(this,s);return t.push(...i.spans),i}),this._svg.replaceChildren(...t)}return this._partsSVG.reduce((t,s)=>s.update()||t,!1)}_render(){var b;let e=this.attrib,t=e&1,s=e>>8&31,i=(b=this.text)==null?void 0:b.parts,o=!(t||1<<s&this.scene.hiddenLayers)&&!!i;if(this._visible!==o&&(this._visible=o,o?this._svg.removeAttribute("display"):this._svg.setAttribute("display","none")),!o)return;this.updateParts(i);let l=this.x-this.scene.x,h=this.y-this.scene.y,p=this.angle;(l!==this._x||h!==this._y||this._angle!==p)&&(this._x=l,this._y=h,this._angle=p,this._svg.setAttribute("transform",`translate(${l}, ${h}), rotate(${p*180/Math.PI})`))}};var Ke={};function qe(u){return Ke.baseURL?`${Ke.baseURL}/${u}`:u}var At=class extends me{constructor(e,t){super(e,t);a(this,"type","videoView");a(this,"fixed",!1);this.set(t)}set(e){var t,s,i;return this.position=(t=e.position)!=null?t:this.position,this.state=(s=e.state)!=null?s:this.state,this.fixed=(i=e.fixed)!=null?i:this.fixed,super.set(e)}toJSON(){throw new Error("Method not implemented.")}};var $r=class{constructor(r){this.e=r}get width(){return this.e.videoWidth}get height(){return this.e.videoHeight}},Nt=class extends At{constructor(e,t,s){super(e,s);a(this,"_svg",!1);a(this,"_html",document.createElement("video"));a(this,"st",this._html.style);a(this,"_visible",!0);a(this,"_x",0);a(this,"_y",0);a(this,"_w",0);a(this,"_h",0);a(this,"video");let i=this._html;i.src=t,this.video=new $r(i),this.st.setProperty("position","absolute"),this.st.setProperty("background","black"),Ke.hideVideoControls?this.st.setProperty("pointer-events","none"):i.setAttribute("controls","true")}get state(){let e=this._html;return e.paused?e.currentTime?"pause":"stop":"play"}set state(e){let t=this._html;switch(e){case"play":t.play();break;case"pause":t.pause();break;case"stop":t.pause(),t.currentTime=0;break}}get position(){return this._html.currentTime}set position(e){this._html.currentTime=e}_render(){let e=this.attrib,t=e&1,s=e>>8&31,i=!(t||1<<s&this.scene.hiddenLayers);if(this._visible!==i&&(this._visible=i,i?this.st.removeProperty("display"):this.st.setProperty("display","none")),!i)return;let o=this.x-this.scene.x,l=this.y-this.scene.y;if(this._x!==o&&this.st.setProperty("left",(this._x=o).toString()+"px"),this._y!==l&&this.st.setProperty("top",(this._y=l).toString()+"px"),this.fixed){let h=this.width,p=this.height;this._w!==h&&this.st.setProperty("width",(this._w=h).toString()+"px"),this._h!==p&&this.st.setProperty("height",(this._h=p).toString()+"px")}}};var Rt=class extends ue{constructor(e,t){super(e,e.brushes,t);a(this,"color",0);a(this,"style",0);a(this,"rop",0);a(this,"hatch",0);a(this,"image",null);this.set(t)}set({color:e=this.color,hatch:t=this.hatch,image:s=this.image,rop:i=this.rop,style:o=this.style}){var l,h;return this.image!==s&&((l=this.image)==null||l.subs.delete(this),this.image=s,(h=this.image)==null||h.subs.add(this)),this.color=e,this.style=o,this.rop=i,this.hatch=t,this}toJSON(){let{color:e,hatch:t,image:s,rop:i,style:o}=this;return k(G({},super.toJSON()),{color:e,hatch:t,image:s==null?void 0:s.key,rop:i,style:o})}delete(){var e;return super.delete()?((e=this.image)==null||e.subs.delete(this),!0):!1}};var Ka=9,qa=10,Xa=0,Ya=1,za=3,Gt=class extends Rt{constructor(){super(...arguments);a(this,"_color",NaN);a(this,"_cssColor",null)}cssColor(){return this._color!==this.color?this._cssColor=Fe(this._color=this.color):this._cssColor}blend(){switch(this.rop){case Ka:return"multiply";case qa:return"multiply";default:return null}}fill(){var e,t;switch(this.style){case Xa:return this.cssColor();case Ya:return null;case za:return(t=(e=this.image)==null?void 0:e.pattern())!=null?t:"black";default:return"white"}}};var kt=class extends ue{constructor(e,t){super(e,e.fonts,t);a(this,"name","");a(this,"size",0);a(this,"style",0);this.set(t)}set({name:e,size:t,style:s}){return this.name=e!=null?e:this.name,this.size=t!=null?t:this.size,this.style=s!=null?s:this.style,this}toJSON(){let{name:e,size:t,style:s}=this;return k(G({},super.toJSON()),{name:e,size:t,style:s})}};var Mt=class extends kt{constructor(){super(...arguments);a(this,"_name","");a(this,"_size",NaN);a(this,"_style",NaN);a(this,"_family","");a(this,"_decoration","");a(this,"_fstyle","");a(this,"_weight","");a(this,"_css",this.css())}css(){let{name:e,size:t,style:s}=this,i=!1;if(this._style!==s){this._style=s,i=!0;let o=s&1,l=s&2,h=s&4,p=s&8;this._decoration=`${l?"underline":""} ${h?"line-through":""}`,this._fstyle=o?"italic":"normal",this._weight=p?"bold":"normal"}return this._name!==e&&(this._name=e,i=!0,this._family=(e.toUpperCase().endsWith(" CYR")?e.slice(0,e.length-4):e)||"Arial"),this._size!==t&&(this._size=t,i=!0),i?this._css={fontFamily:this._family,textDecoration:this._decoration,fontSize:t||15.940224159402327,fontStyle:this._fstyle,fontWeight:this._weight}:this._css}};var Lt=class extends ue{constructor(e,{width:t,height:s,src:i},o){super(e,o.opaque?e.imagesOpaque:e.images,o);a(this,"realSrc");a(this,"width");a(this,"height");a(this,"src");this.width=t,this.height=s,this.src=i,this.realSrc=qe(i)}toJSON(){let{height:e,src:t,width:s}=this;return k(G({},super.toJSON()),{height:e,src:t,width:s})}};var xr=class extends Lt{constructor(){super(...arguments);a(this,"_pattern",null)}pixel(){return 0}setPixel(){return!0}pattern(){if(this._pattern)return this._pattern.url;let e=document.createElementNS("http://www.w3.org/2000/svg","pattern"),t=`patt_${++xr.id}`;e.setAttribute("id",t),e.setAttribute("patternUnits","userSpaceOnUse"),e.setAttribute("width",this.width.toString()),e.setAttribute("height",this.height.toString());let s=document.createElementNS("http://www.w3.org/2000/svg","image");s.setAttribute("href",this.realSrc),e.appendChild(s),this.scene.defs.appendChild(e);let i=`url(#${t})`;return this._pattern={e,url:i},i}},at=xr;a(at,"id",0);var Bt=class extends ue{constructor(e,t){super(e,e.pens,t);a(this,"color",0);a(this,"style",0);a(this,"rop",0);a(this,"width",0);this.set(t)}set({color:e,rop:t,style:s,width:i}){return this.color=e!=null?e:this.color,this.style=s!=null?s:this.style,this.rop=t!=null?t:this.rop,this.width=i!=null?i:this.width,this}toJSON(){let{color:e,rop:t,style:s,width:i}=this;return k(G({},super.toJSON()),{color:e,rop:t,style:s,width:i})}};var Ja=0,Za=1,Qa=2,el=3,tl=4,rl=5,sl=9,il=10,Vt=class extends Bt{constructor(){super(...arguments);a(this,"_color",NaN);a(this,"_cssColor",null)}cssColor(){return this._color!==this.color?this._cssColor=Fe(this._color=this.color):this._cssColor}blend(){switch(this.rop){case sl:return"multiply";case il:return"multiply";default:return null}}stroke(){return this.style===rl?null:this.cssColor()}dash(){switch(this.style){case Ja:return null;case Za:return"16 4";case Qa:return"2 4";case el:return"16 4 2 4";case tl:return"16 4 2 4 2 4";default:return null}}};var Ut=class extends ue{constructor(e,t,s){super(e,e.strings,s);this.text=t;this.set(k(G({},s),{text:t}))}set({text:e}){return this.text=e!=null?e:this.text,this}toJSON(){let{text:e}=this;return k(G({},super.toJSON()),{text:e})}};var jt=class extends Ut{constructor(){super(...arguments);a(this,"_text","");a(this,"_parts",[""])}split(){return this._text!==this.text?this._parts=(this._text=this.text).split(`\r
`).join(`
`).split(`
`):this._parts}};var Ht=class extends ue{constructor(e,t,s){super(e,e.texts,s);a(this,"parts",[]);this.set(k(G({},s),{parts:t}))}set({parts:e=this.parts}){return this.parts!==e&&(this.parts.forEach(t=>{t.string.subs.delete(this),t.font.subs.delete(this)}),this.parts=e,this.parts.forEach(t=>{t.string.subs.add(this),t.font.subs.add(this)})),this}toJSON(){let e=this.parts.map(({bgcolor:t,fgcolor:s,font:i,string:o})=>({bgcolor:t,fgcolor:s,font:i.key,string:o.key}));return k(G({},super.toJSON()),{parts:e})}delete(){return super.delete()?(this.parts.forEach(e=>{e.string.subs.delete(this),e.font.subs.delete(this)}),!0):!1}};var Ft=class extends Ht{constructor(){super(...arguments);a(this,"_textCalc",null)}get width(){var e,t;return(t=(e=this._textCalc)==null?void 0:e.call(this).w)!=null?t:0}get height(){var e,t;return(t=(e=this._textCalc)==null?void 0:e.call(this).h)!=null?t:0}};function Or(u,r,e){let t=new Set(e),s=0,i=null;r.forEach(o=>{if(t.delete(o),s<e.length&&o===e[s])++s;else{let l=i?i.nextElementSibling:u.firstElementChild;u.insertBefore(o._svg||o._html,l)}i=o._svg||o._html}),t.forEach(o=>(o._svg||o._html).remove())}var Re=class extends Wt{constructor(e){super(e);a(this,"_cursor",null);a(this,"currentPointerId",null);a(this,"canCaptureMouseEvents",!1);a(this,"prevOrder",[]);a(this,"svgOrder",[]);a(this,"htmlOrder",[]);a(this,"bgRect",null);a(this,"_mouse",{x:0,y:0});a(this,"_bg",null);a(this,"view");a(this,"root");a(this,"htmlRoot");a(this,"defs");let t=this.view=document.createElement("div");t.style.setProperty("overflow","hidden"),t.style.setProperty("position","relative"),t.style.setProperty("width","100%"),t.style.setProperty("height","100%"),t.style.setProperty("background-color","white");let s=this.root=document.createElementNS("http://www.w3.org/2000/svg","svg");s.style.setProperty("width","100%"),s.style.setProperty("height","100%"),s.style.setProperty("transform-origin","top left"),s.style.setProperty("touch-action","none"),s.style.setProperty("outline","none"),s.tabIndex=0;let i=this.defs=document.createElementNS("http://www.w3.org/2000/svg","defs"),o=this.htmlRoot=document.createElement("div");o.style.setProperty("width","100%"),o.style.setProperty("height","100%"),o.style.setProperty("transform-origin","top left"),s.appendChild(i),t.appendChild(s),t.appendChild(o);let l=this._handlePointer.bind(this);s.addEventListener("pointerdown",l),s.addEventListener("pointermove",l),s.addEventListener("pointerup",l),s.addEventListener("selectstart",wr),s.addEventListener("contextmenu",wr),Re.scenes.add(this),Re.updater.run(Re.redrawAll)}static redrawAll(){return Re.scenes.forEach(e=>e._render()),Re.scenes.size>0}dispose(){Re.scenes.delete(this)}_render(e=!1){var v,_;if(!e&&!this.view.parentElement)return;let{background:t,prevOrder:s,svgOrder:i,root:o,htmlOrder:l,htmlRoot:h,cursor:p}=this;this._cursor!==p&&(this._cursor=p,o.style.cursor=p||"auto");let b=(v=t==null?void 0:t.fill())!=null?v:null,y=!1;if(y=this._bg!==b)if(this._bg=b,b){if(!this.bgRect){let I=document.createElementNS("http://www.w3.org/2000/svg","rect");I.setAttribute("width","100%"),I.setAttribute("height","100%"),this.bgRect={_svg:I,_render:()=>{}}}this.bgRect._svg.setAttribute("fill",b)}else(_=this.bgRect)==null||_._svg.remove(),this.bgRect=null;let T=this.order;if(s!==T||y){let I=this.bgRect?[this.bgRect]:[],R=[];T.forEach(W=>{W._svg?I.push(W):R.push(W)}),i.length>0?Or(o,I,i):o.append(...I.map(W=>W._svg)),l.length>0?Or(h,R,l):R.length>0&&h.append(...R.map(W=>W._html)),this.svgOrder=I,this.htmlOrder=R,this.prevOrder=T}T.forEach(I=>I._render())}mouse(){return this._mouse}toDataURL(e){let{x:t,y:s}=this;e&&(this.x=e.x,this.y=e.y,this.root.style.setProperty("width",e.w+"px"),this.root.style.setProperty("height",e.h+"px")),this._render(!0);let i=new XMLSerializer().serializeToString(this.root);i.match(/^<svg[^>]+xmlns="http\:\/\/www\.w3\.org\/2000\/svg"/)||(i=i.replace(/^<svg/,'<svg xmlns="http://www.w3.org/2000/svg"')),i.match(/^<svg[^>]+"http\:\/\/www\.w3\.org\/1999\/xlink"/)||(i=i.replace(/^<svg/,'<svg xmlns:xlink="http://www.w3.org/1999/xlink"')),i=`<?xml version="1.0" standalone="no"?>\r
`+i;let o="data:image/svg+xml;charset=utf-8,"+encodeURIComponent(i);return e&&(this.x=t,this.y=s,this.root.style.setProperty("width","100%"),this.root.style.setProperty("height","100%"),this._render(!0)),{ext:"svg",url:o}}_handlePointer(e){if(!e.isPrimary)return;let t=e.type;this.canCaptureMouseEvents&&(this.currentPointerId===null||t==="pointerdown")&&(this.root.setPointerCapture(e.pointerId),this.currentPointerId=e.pointerId),t==="pointerup"&&this.currentPointerId!==null&&(this.root.releasePointerCapture(this.currentPointerId),this.currentPointerId=null);let s=e.offsetX+this.x,i=e.offsetY+this.y;this._mouse={x:s,y:i};let o=e.button===0?"left":e.button===1?"middle":e.button===2?"right":"unknown",l={left:!!(e.buttons&1),right:!!(e.buttons&2),middle:!!(e.buttons&4)},h=t==="pointerdown"?this.onpointerdown:t==="pointerup"?this.onpointerup:this.onpointermove;h==null||h({e,type:t,scene:this,x:s,y:i,button:o,buttons:l})}startCapturingMouseEvents(){this.canCaptureMouseEvents=!0}stopCapturingMouseEvents(){this.canCaptureMouseEvents=!1,this.currentPointerId!==null&&(this.root.releasePointerCapture(this.currentPointerId),this.currentPointerId=null)}line(e,t={}){return new _t(this,e,t)}imageView(e,t={}){return new $t(this,e,t)}textView(e,t={}){return new It(this,e,t)}input(e,t={}){return new Ot(this,e,t)}video(e,t={}){return new Nt(this,e,t)}pen(e={}){return new Vt(this,e)}brush(e={}){return new Gt(this,e)}image(e,t={}){return new at(this,e,t)}string(e,t={}){return new jt(this,e,t)}font(e={}){return new Mt(this,e)}text(e,t={}){return new Ft(this,e,t)}},Xe=Re;a(Xe,"scenes",new Set),a(Xe,"updater",new Le);function Hs(u,r,e="random"){var v,_,I,R;let t=r.pens?new Map(r.pens.map(W=>{let N=e==="exact"?W.key:e==="random"?0:-1;return[W.key,u.pen(k(G({},W),{key:N}))]})):u.pens,s=r.imagesOpaque?new Map(r.imagesOpaque.map(W=>{let N=e==="exact"?W.key:e==="random"?0:-1;return[W.key,u.image(W,k(G({},W),{key:N,opaque:!0}))]})):u.imagesOpaque,i=r.brushes?new Map(r.brushes.map(W=>{let N=e==="exact"?W.key:e==="random"?0:-1,j=W.image&&(s.get(W.image)||u.imagesOpaque.get(W.image))||null;return[W.key,u.brush(k(G({},W),{key:N,image:j}))]})):u.brushes,o=r.images?new Map(r.images.map(W=>{let N=e==="exact"?W.key:e==="random"?0:-1;return[W.key,u.image(W,k(G({},W),{key:N}))]})):u.images,l=r.strings?new Map(r.strings.map(W=>{let N=e==="exact"?W.key:e==="random"?0:-1;return[W.key,u.string(W.text||"",k(G({},W),{key:N}))]})):u.strings,h=r.fonts?new Map((v=r.fonts)==null?void 0:v.map(W=>{let N=e==="exact"?W.key:e==="random"?0:-1;return[W.key,u.font(k(G({},W),{key:N}))]})):u.fonts,p=r.texts?new Map(r.texts.map(W=>{let N=e==="exact"?W.key:e==="random"?0:-1,j=W.parts.map((q,te)=>{let we=l.get(q.string)||u.strings.get(q.string);if(!we)throw Error(`\u0422\u0435\u043A\u0441\u0442 #${W.key}[${te}]: \u0421\u0442\u0440\u043E\u043A\u0430 #${q.string} \u043D\u0435 \u0441\u0443\u0449\u0435\u0441\u0442\u0432\u0443\u0435\u0442`);let _e=h.get(q.font)||u.fonts.get(q.font);if(!_e)throw Error(`\u0422\u0435\u043A\u0441\u0442 #${W.key}[${te}]: \u0428\u0440\u0438\u0444\u0442 #${q.string} \u043D\u0435 \u0441\u0443\u0449\u0435\u0441\u0442\u0432\u0443\u0435\u0442`);return k(G({},q),{string:we,font:_e})});return[W.key,u.text(j,k(G({},W),{key:N}))]})):u.texts,b=new Set,y=new Map((_=r.objects)==null?void 0:_.map(W=>{switch(W.type){case"line":{let N=e==="exact"?W.key:e==="random"?0:-1,j=W.pen&&(t.get(W.pen)||u.pens.get(W.pen))||null,q=W.brush&&(i.get(W.brush)||u.brushes.get(W.brush))||null;return[W.key,u.line(W.coords,k(G({},W),{key:N,pen:j,brush:q}))]}case"imageView":{let N=e==="exact"?W.key:e==="random"?0:-1,j=(W.opaque?s:o).get(W.image)||(W.opaque?u.imagesOpaque:u.images).get(W.image);if(!j)throw Error(`${W.opaque?"\u0411":"\u0414\u0432\u043E\u0439\u043D\u0430\u044F \u0431"}\u0438\u0442\u043E\u0432\u0430\u044F \u043A\u0430\u0440\u0442\u0430 #${W.key}: \u0418\u0437\u043E\u0431\u0440\u0430\u0436\u0435\u043D\u0438\u0435 #${W.image} \u043D\u0435 \u0441\u0443\u0449\u0435\u0441\u0442\u0432\u0443\u0435\u0442`);return[W.key,u.imageView(j,k(G({},W),{key:N}))]}case"textView":{let N=e==="exact"?W.key:e==="random"?0:-1,j=p.get(W.text)||u.texts.get(W.text);if(!j)throw Error(`TextView #${W.key}: \u0422\u0435\u043A\u0441\u0442 #${W.text} \u043D\u0435 \u0441\u0443\u0449\u0435\u0441\u0442\u0432\u0443\u0435\u0442`);return[W.key,u.textView(j,k(G({},W),{key:N}))]}case"input":{let N=e==="exact"?W.key:e==="random"?0:-1,j=W.font&&(h.get(W.font)||u.fonts.get(W.font))||null;return[W.key,u.input(W.inputType,k(G({},W),{key:N,font:j}))]}case"videoView":{let N=e==="exact"?W.key:e==="random"?0:-1;return[W.key,u.video(W.res,k(G({},W),{key:N}))]}case"group":{let N=e==="exact"?W.key:e==="random"?0:-1,j=u.group([],k(G({},W),{key:N}));return b.add([j,W.children]),[W.key,j]}case"3dView":throw Error(`\u041E\u0431\u044A\u0435\u043A\u0442 #${W.key} \u044F\u0432\u043B\u044F\u0435\u0442\u0441\u044F 3D \u043F\u0440\u043E\u0435\u043A\u0446\u0438\u0435\u0439. \u041E\u043D\u0438 \u0435\u0449\u0435 \u043D\u0435 \u0440\u0435\u0430\u043B\u0438\u0437\u043E\u0432\u0430\u043D\u044B.`)}}));b.forEach(([W,N])=>{let j=N.map(q=>{let te=y.get(q);if(!te)throw Error(`\u0413\u0440\u0443\u043F\u043F\u0430 ${W.key}: \u0414\u043E\u0447\u0435\u0440\u043D\u0438\u0439 \u043E\u0431\u044A\u0435\u043A\u0442 #${q} \u043D\u0435 \u0441\u0443\u0449\u0435\u0441\u0442\u0432\u0443\u0435\u0442.`);return te});W.set({children:j})});let T=(R=(I=r.order)==null?void 0:I.map(W=>{let N=y.get(W);if(!N)throw Error(`\u041E\u0431\u044A\u0435\u043A\u0442 #${W} \u043D\u0435 \u0441\u0443\u0449\u0435\u0441\u0442\u0432\u0443\u0435\u0442 \u0438 \u043D\u0435 \u043C\u043E\u0436\u0435\u0442 \u0431\u044B\u0442\u044C \u043E\u0442\u043E\u0431\u0440\u0430\u0436\u0435\u043D.`);if(N.type==="group")throw Error(`\u041E\u0431\u044A\u0435\u043A\u0442 #${W} \u044F\u0432\u043B\u044F\u0435\u0442\u0441\u044F \u0433\u0440\u0443\u043F\u043F\u043E\u0439 \u0438 \u043D\u0435 \u043C\u043E\u0436\u0435\u0442 \u0431\u044B\u0442\u044C \u043E\u0442\u043E\u0431\u0440\u0430\u0436\u0435\u043D.`);return N}))!=null?R:[];return u.set({order:u.order.concat(T)}),{objects:y,brushes:i,fonts:h,images:o,imagesOpaque:s,pens:t,strings:l,texts:p,order:T}}function Ct(u,r){if(!r)return new u;let e=new u(r);Hs(e,r,"exact");let t=r.background&&e.brushes.get(r.background)||null;return e.set({background:t})}function nl(u){return Array.from(u.values()).filter(r=>!r.parent)}function Kt(u,r,e="random"){let{objects:t}=Hs(u,r,e),s=nl(t);return s.length>1?u.group(s,{key:e==="unused"?-1:0}):s[0]}function Fs(u){let r=Ce(u.map(y=>y.type==="group"?[...y.descendants(),y]:[y])).filter(y=>y.key>0);if(!r.length)return{};let{scene:e}=r[0],t=new Set,s=new Set,i=new Set,o=new Set,l=new Set,h=new Set,p=new Set;r.forEach(y=>{var T;switch(y.type){case"line":y.pen&&t.add(y.pen),y.brush&&s.add(y.brush),(T=y.brush)!=null&&T.image&&o.add(y.brush.image);break;case"imageView":(y.opaque?o:i).add(y.image);break;case"textView":y.text.parts.forEach(v=>{l.add(v.string),h.add(v.font)}),p.add(y.text);break;case"input":y.font&&h.add(y.font);break}});let b=new WeakSet(r);return{pens:[...t].map(y=>y.toJSON()),brushes:[...s].map(y=>y.toJSON()),images:[...i].map(y=>y.toJSON()),imagesOpaque:[...o].map(y=>y.toJSON()),strings:[...l].map(y=>y.toJSON()),fonts:[...h].map(y=>y.toJSON()),texts:[...p].map(y=>y.toJSON()),objects:r.map(y=>y.toJSON()),order:e.order.filter(y=>b.has(y)).map(y=>y.key)}}function qt(u){let r=1/0,e=1/0,t=-1/0,s=-1/0;return u.forEach(i=>{i.x<r&&(r=i.x),i.y<e&&(e=i.y),i.x+i.width>t&&(t=i.x+i.width),i.y+i.height>s&&(s=i.y+i.height)}),{x:r,y:e,w:t-r,h:s-e}}var Cs=Xe;var Z=Ke;Z.libraryURL="library";var de=new URLSearchParams(location.search).get("debug");Z.logMessage=de==null?void 0:de.includes("log");Z.debugExecution=de==null?void 0:de.includes("execution");Z.debugCompiler=de==null?void 0:de.includes("compiler");Z.debugProject=de==null?void 0:de.includes("project");Z.debugFile=de==null?void 0:de.includes("file");var z=(s=>(s[s.FLOAT=1]="FLOAT",s[s.STRING=2]="STRING",s[s.HANDLE=3]="HANDLE",s[s.COLORREF=4]="COLORREF",s))(z||{});var Te=(n=>(n[n.PI=Math.PI]="PI",n[n.WORD8=0]="WORD8",n[n.INT8=1]="INT8",n[n.WORD16=2]="WORD16",n[n.INT16=3]="INT16",n[n.WORD32=4]="WORD32",n[n.INT32=5]="INT32",n[n.FLOAT32=6]="FLOAT32",n[n.FLOAT40=7]="FLOAT40",n[n.FLOAT64=8]="FLOAT64",n[n.FLOAT80=9]="FLOAT80",n[n.PEN2D=1]="PEN2D",n[n.BRUSH2D=2]="BRUSH2D",n[n.DIB2D=3]="DIB2D",n[n.DOUBLEDIB2D=4]="DOUBLEDIB2D",n[n.FONT2D=5]="FONT2D",n[n.STRING2D=6]="STRING2D",n[n.TEXT2D=7]="TEXT2D",n[n.SPACE3D=8]="SPACE3D",n[n.TEXTURE3D=9]="TEXTURE3D",n[n.SIZE_RESTORED=0]="SIZE_RESTORED",n[n.SIZE_MINIMIZED=1]="SIZE_MINIMIZED",n[n.SIZE_MAXIMIZED=2]="SIZE_MAXIMIZED",n[n.SIZE_MAXSHOW=3]="SIZE_MAXSHOW",n[n.SIZE_MAXHIDE=4]="SIZE_MAXHIDE",n[n.OTGROUP2D=3]="OTGROUP2D",n[n.OTRGROUP2D=4]="OTRGROUP2D",n[n.OTGROUP3D=5]="OTGROUP3D",n[n.OTOBJECT3D=10]="OTOBJECT3D",n[n.OTLINE_2D=20]="OTLINE_2D",n[n.OTBITMAP_2D=21]="OTBITMAP_2D",n[n.OTDOUBLEBITMAP_2D=22]="OTDOUBLEBITMAP_2D",n[n.OTTEXT_2D=23]="OTTEXT_2D",n[n.OTVIEW3D_2D=24]="OTVIEW3D_2D",n[n.OTEDITFRAME=50]="OTEDITFRAME",n[n.OTROTATECENTER=51]="OTROTATECENTER",n[n.OTFRAME3D=52]="OTFRAME3D",n[n.OTAXIS3D=53]="OTAXIS3D",n[n.OTPEN2D=101]="OTPEN2D",n[n.OTBRUSH2D=102]="OTBRUSH2D",n[n.OTDIB2D=103]="OTDIB2D",n[n.OTDOUBLEDIB2D=104]="OTDOUBLEDIB2D",n[n.OTFONT2D=105]="OTFONT2D",n[n.OTSTRING2D=106]="OTSTRING2D",n[n.OTTEXT2D=107]="OTTEXT2D",n[n.OTREFTODIB2D=110]="OTREFTODIB2D",n[n.OTREFTODOUBLEDIB2D=111]="OTREFTODOUBLEDIB2D",n[n.ATTRSET=1]="ATTRSET",n[n.ATTRRESET=2]="ATTRRESET",n[n.ATTRPUT=3]="ATTRPUT",n[n.PFC_MOVEOBJECT=32768]="PFC_MOVEOBJECT",n[n.PFC_SETCURRENT=16384]="PFC_SETCURRENT",n[n.PFC_SETFRAME=8192]="PFC_SETFRAME",n[n.PFC_PENS=1]="PFC_PENS",n[n.PFC_BRUHS=2]="PFC_BRUHS",n[n.PFC_DIBS=4]="PFC_DIBS",n[n.PFC_DDIBS=8]="PFC_DDIBS",n[n.PFC_STRINGS=16]="PFC_STRINGS",n[n.PFC_FONTS=32]="PFC_FONTS",n[n.PFC_TEXTS=64]="PFC_TEXTS",n[n.PFC_3D=128]="PFC_3D",n[n.PFC_ALL=255]="PFC_ALL",n[n.OID_RESERVED=32e3]="OID_RESERVED",n[n.OID_RCENTER=32001]="OID_RCENTER",n[n.OID_FRAME2D1=32002]="OID_FRAME2D1",n[n.OID_FRAME2D2=32003]="OID_FRAME2D2",n[n.OID_FRAME2D3=32004]="OID_FRAME2D3",n[n.OID_FRAME2D4=32005]="OID_FRAME2D4",n[n.OID_FRAME2D5=32006]="OID_FRAME2D5",n[n.OID_FRAME2D6=32007]="OID_FRAME2D6",n[n.OID_FRAME2D7=32008]="OID_FRAME2D7",n[n.OID_FRAME2D8=32009]="OID_FRAME2D8",n[n.OID_FRAME2D=32010]="OID_FRAME2D",n[n.OID_AXIS3D=32100]="OID_AXIS3D",n[n.OID_FRAME3D1=32102]="OID_FRAME3D1",n[n.OID_FRAME3D2=32103]="OID_FRAME3D2",n[n.OID_FRAME3D3=32104]="OID_FRAME3D3",n[n.OID_FRAME3D4=32105]="OID_FRAME3D4",n[n.OID_FRAME3D5=32106]="OID_FRAME3D5",n[n.OID_FRAME3D6=32107]="OID_FRAME3D6",n[n.OID_FRAME3D7=32108]="OID_FRAME3D7",n[n.OID_FRAME3D8=32109]="OID_FRAME3D8",n[n.OID_FRAME3D=32110]="OID_FRAME3D",n[n.MB_OK=0]="MB_OK",n[n.MB_OKCANCEL=1]="MB_OKCANCEL",n[n.MB_ABORTRETRYIGNORE=2]="MB_ABORTRETRYIGNORE",n[n.MB_YESNOCANCEL=3]="MB_YESNOCANCEL",n[n.MB_YESNO=4]="MB_YESNO",n[n.MB_RETRYCANCEL=5]="MB_RETRYCANCEL",n[n.MB_TYPEMASK=15]="MB_TYPEMASK",n[n.MB_ICONHAND=16]="MB_ICONHAND",n[n.MB_ICONQUESTION=32]="MB_ICONQUESTION",n[n.MB_ICONEXCLAMATION=48]="MB_ICONEXCLAMATION",n[n.MB_ICONASTERISK=64]="MB_ICONASTERISK",n[n.MB_ICONMASK=240]="MB_ICONMASK",n[n.MB_ICONINFORMATION=64]="MB_ICONINFORMATION",n[n.MB_ICONSTOP=16]="MB_ICONSTOP",n[n.MB_DEFBUTTON1=0]="MB_DEFBUTTON1",n[n.MB_DEFBUTTON2=256]="MB_DEFBUTTON2",n[n.MB_DEFBUTTON3=512]="MB_DEFBUTTON3",n[n.MB_DEFMASK=3840]="MB_DEFMASK",n[n.MB_APPLMODAL=0]="MB_APPLMODAL",n[n.MB_SYSTEMMODAL=4096]="MB_SYSTEMMODAL",n[n.MB_TASKMODAL=8192]="MB_TASKMODAL",n[n.MB_NOFOCUS=32768]="MB_NOFOCUS",n[n.SW_HIDE=0]="SW_HIDE",n[n.SW_SHOWNORMAL=1]="SW_SHOWNORMAL",n[n.SW_NORMAL=1]="SW_NORMAL",n[n.SW_SHOWMINIMIZED=2]="SW_SHOWMINIMIZED",n[n.SW_SHOWMAXIMIZED=3]="SW_SHOWMAXIMIZED",n[n.SW_MAXIMIZE=3]="SW_MAXIMIZE",n[n.SW_SHOWNOACTIVATE=4]="SW_SHOWNOACTIVATE",n[n.SW_SHOW=5]="SW_SHOW",n[n.SW_MINIMIZE=6]="SW_MINIMIZE",n[n.SW_SHOWMINNOACTIVE=7]="SW_SHOWMINNOACTIVE",n[n.SW_SHOWNA=8]="SW_SHOWNA",n[n.SW_RESTORE=9]="SW_RESTORE",n[n.MCIERR_INVALID_DEVICE_ID=257]="MCIERR_INVALID_DEVICE_ID",n[n.MCIERR_UNRECOGNIZED_KEYWORD=259]="MCIERR_UNRECOGNIZED_KEYWORD",n[n.MCIERR_UNRECOGNIZED_COMMAND=261]="MCIERR_UNRECOGNIZED_COMMAND",n[n.MCIERR_HARDWARE=262]="MCIERR_HARDWARE",n[n.MCIERR_INVALID_DEVICE_NAME=263]="MCIERR_INVALID_DEVICE_NAME",n[n.MCIERR_OUT_OF_MEMORY=264]="MCIERR_OUT_OF_MEMORY",n[n.MCIERR_DEVICE_OPEN=265]="MCIERR_DEVICE_OPEN",n[n.MCIERR_CANNOT_LOAD_DRIVER=266]="MCIERR_CANNOT_LOAD_DRIVER",n[n.MCIERR_MISSING_COMMAND_STRING=267]="MCIERR_MISSING_COMMAND_STRING",n[n.MCIERR_PARAM_OVERFLOW=268]="MCIERR_PARAM_OVERFLOW",n[n.MCIERR_MISSING_STRING_ARGUMENT=269]="MCIERR_MISSING_STRING_ARGUMENT",n[n.MCIERR_BAD_INTEGER=270]="MCIERR_BAD_INTEGER",n[n.MCIERR_PARSER_INTERNAL=271]="MCIERR_PARSER_INTERNAL",n[n.MCIERR_DRIVER_INTERNAL=272]="MCIERR_DRIVER_INTERNAL",n[n.MCIERR_MISSING_PARAMETER=273]="MCIERR_MISSING_PARAMETER",n[n.MCIERR_UNSUPPORTED_FUNCTION=274]="MCIERR_UNSUPPORTED_FUNCTION",n[n.MCIERR_FILE_NOT_FOUND=275]="MCIERR_FILE_NOT_FOUND",n[n.MCIERR_DEVICE_NOT_READY=276]="MCIERR_DEVICE_NOT_READY",n[n.MCIERR_INTERNAL=277]="MCIERR_INTERNAL",n[n.MCIERR_DRIVER=278]="MCIERR_DRIVER",n[n.MCIERR_CANNOT_USE_ALL=279]="MCIERR_CANNOT_USE_ALL",n[n.MCIERR_MULTIPLE=280]="MCIERR_MULTIPLE",n[n.MCIERR_EXTENSION_NOT_FOUND=281]="MCIERR_EXTENSION_NOT_FOUND",n[n.MCIERR_OUTOFRANGE=282]="MCIERR_OUTOFRANGE",n[n.MCIERR_FLAGS_NOT_COMPATIBLE=284]="MCIERR_FLAGS_NOT_COMPATIBLE",n[n.MCIERR_FILE_NOT_SAVED=286]="MCIERR_FILE_NOT_SAVED",n[n.MCIERR_DEVICE_TYPE_REQUIRED=287]="MCIERR_DEVICE_TYPE_REQUIRED",n[n.MCIERR_DEVICE_LOCKED=288]="MCIERR_DEVICE_LOCKED",n[n.MCIERR_DUPLICATE_ALIAS=289]="MCIERR_DUPLICATE_ALIAS",n[n.MCIERR_BAD_CONSTANT=290]="MCIERR_BAD_CONSTANT",n[n.MCIERR_MUST_USE_SHAREABLE=291]="MCIERR_MUST_USE_SHAREABLE",n[n.MCIERR_MISSING_DEVICE_NAME=292]="MCIERR_MISSING_DEVICE_NAME",n[n.MCIERR_BAD_TIME_FORMAT=293]="MCIERR_BAD_TIME_FORMAT",n[n.MCIERR_NO_CLOSING_QUOTE=294]="MCIERR_NO_CLOSING_QUOTE",n[n.MCIERR_DUPLICATE_FLAGS=295]="MCIERR_DUPLICATE_FLAGS",n[n.MCIERR_INVALID_FILE=296]="MCIERR_INVALID_FILE",n[n.MCIERR_NULL_PARAMETER_BLOCK=297]="MCIERR_NULL_PARAMETER_BLOCK",n[n.MCIERR_UNNAMED_RESOURCE=298]="MCIERR_UNNAMED_RESOURCE",n[n.MCIERR_NEW_REQUIRES_ALIAS=299]="MCIERR_NEW_REQUIRES_ALIAS",n[n.MCIERR_NOTIFY_ON_AUTO_OPEN=300]="MCIERR_NOTIFY_ON_AUTO_OPEN",n[n.MCIERR_NO_ELEMENT_ALLOWED=301]="MCIERR_NO_ELEMENT_ALLOWED",n[n.MCIERR_NONAPPLICABLE_FUNCTION=302]="MCIERR_NONAPPLICABLE_FUNCTION",n[n.MCIERR_ILLEGAL_FOR_AUTO_OPEN=303]="MCIERR_ILLEGAL_FOR_AUTO_OPEN",n[n.MCIERR_FILENAME_REQUIRED=304]="MCIERR_FILENAME_REQUIRED",n[n.MCIERR_EXTRA_CHARACTERS=305]="MCIERR_EXTRA_CHARACTERS",n[n.MCIERR_DEVICE_NOT_INSTALLED=306]="MCIERR_DEVICE_NOT_INSTALLED",n[n.MCIERR_GET_CD=307]="MCIERR_GET_CD",n[n.MCIERR_SET_CD=308]="MCIERR_SET_CD",n[n.MCIERR_SET_DRIVE=309]="MCIERR_SET_DRIVE",n[n.MCIERR_DEVICE_LENGTH=310]="MCIERR_DEVICE_LENGTH",n[n.MCIERR_DEVICE_ORD_LENGTH=311]="MCIERR_DEVICE_ORD_LENGTH",n[n.MCIERR_NO_INTEGER=312]="MCIERR_NO_INTEGER",n[n.MCIERR_WAVE_OUTPUTSINUSE=320]="MCIERR_WAVE_OUTPUTSINUSE",n[n.MCIERR_WAVE_SETOUTPUTINUSE=321]="MCIERR_WAVE_SETOUTPUTINUSE",n[n.MCIERR_WAVE_INPUTSINUSE=322]="MCIERR_WAVE_INPUTSINUSE",n[n.MCIERR_WAVE_SETINPUTINUSE=323]="MCIERR_WAVE_SETINPUTINUSE",n[n.MCIERR_WAVE_OUTPUTUNSPECIFIED=324]="MCIERR_WAVE_OUTPUTUNSPECIFIED",n[n.MCIERR_WAVE_INPUTUNSPECIFIED=325]="MCIERR_WAVE_INPUTUNSPECIFIED",n[n.MCIERR_WAVE_OUTPUTSUNSUITABLE=326]="MCIERR_WAVE_OUTPUTSUNSUITABLE",n[n.MCIERR_WAVE_SETOUTPUTUNSUITABLE=327]="MCIERR_WAVE_SETOUTPUTUNSUITABLE",n[n.MCIERR_WAVE_INPUTSUNSUITABLE=328]="MCIERR_WAVE_INPUTSUNSUITABLE",n[n.MCIERR_WAVE_SETINPUTUNSUITABLE=329]="MCIERR_WAVE_SETINPUTUNSUITABLE",n[n.MCIERR_SEQ_DIV_INCOMPATIBLE=336]="MCIERR_SEQ_DIV_INCOMPATIBLE",n[n.MCIERR_SEQ_PORT_INUSE=337]="MCIERR_SEQ_PORT_INUSE",n[n.MCIERR_SEQ_PORT_NONEXISTENT=338]="MCIERR_SEQ_PORT_NONEXISTENT",n[n.MCIERR_SEQ_PORT_MAPNODEVICE=339]="MCIERR_SEQ_PORT_MAPNODEVICE",n[n.MCIERR_SEQ_PORT_MISCERROR=340]="MCIERR_SEQ_PORT_MISCERROR",n[n.MCIERR_SEQ_TIMER=341]="MCIERR_SEQ_TIMER",n[n.MCIERR_SEQ_PORTUNSPECIFIED=342]="MCIERR_SEQ_PORTUNSPECIFIED",n[n.MCIERR_SEQ_NOMIDIPRESENT=343]="MCIERR_SEQ_NOMIDIPRESENT",n[n.MCIERR_NO_WINDOW=346]="MCIERR_NO_WINDOW",n[n.MCIERR_CREATEWINDOW=347]="MCIERR_CREATEWINDOW",n[n.MCIERR_FILE_READ=348]="MCIERR_FILE_READ",n[n.MCIERR_FILE_WRITE=349]="MCIERR_FILE_WRITE",n[n.WS_VISIBLE=268435456]="WS_VISIBLE",n[n.WS_DISABLED=134217728]="WS_DISABLED",n[n.WS_CAPTION=12582912]="WS_CAPTION",n[n.WS_BORDER=8388608]="WS_BORDER",n[n.WS_DLGFRAME=4194304]="WS_DLGFRAME",n[n.WS_VSCROLL=2097152]="WS_VSCROLL",n[n.WS_HSCROLL=1048576]="WS_HSCROLL",n[n.WS_SYSMENU=524288]="WS_SYSMENU",n[n.WS_THICKFRAME=262144]="WS_THICKFRAME",n[n.WS_MINIMIZEBOX=131072]="WS_MINIMIZEBOX",n[n.WS_MAXIMIZEBOX=65536]="WS_MAXIMIZEBOX",n[n.WS_GROUP=131072]="WS_GROUP",n[n.WS_TABSTOP=65536]="WS_TABSTOP",n[n.WS_OVERLAPPED=0]="WS_OVERLAPPED",n[n.WS_POPUP=2147483648]="WS_POPUP",n[n.WS_CHILD=1073741824]="WS_CHILD",n[n.IDX_PRIMARY=1]="IDX_PRIMARY",n[n.IDX_UNIQUE=2]="IDX_UNIQUE",n[n.IDX_DESCENDING=4]="IDX_DESCENDING",n[n.IDX_MAINTAINED=8]="IDX_MAINTAINED",n[n.IDX_SUBSET=16]="IDX_SUBSET",n[n.IDX_EXPR=32]="IDX_EXPR",n[n.IDX_IDXOOD=64]="IDX_IDXOOD",n[n.IDX_CASEINSENS=128]="IDX_CASEINSENS",n[n.FLDDBCHAR=513]="FLDDBCHAR",n[n.FLDDBNUM=514]="FLDDBNUM",n[n.FLDDBMEMO=515]="FLDDBMEMO",n[n.FLDDBBOOL=516]="FLDDBBOOL",n[n.FLDDBDATE=517]="FLDDBDATE",n[n.FLDDBFLOAT=518]="FLDDBFLOAT",n[n.FLDDBLOCK=519]="FLDDBLOCK",n[n.FLDDBOLEBLOB=520]="FLDDBOLEBLOB",n[n.FLDDBBINARY=521]="FLDDBBINARY",n[n.FLDDBBYTES=522]="FLDDBBYTES",n[n.BS_PUSHBUTTON=0]="BS_PUSHBUTTON",n[n.BS_DEFPUSHBUTTON=1]="BS_DEFPUSHBUTTON",n[n.BS_CHECKBOX=2]="BS_CHECKBOX",n[n.BS_AUTOCHECKBOX=3]="BS_AUTOCHECKBOX",n[n.BS_RADIOBUTTON=4]="BS_RADIOBUTTON",n[n.BS_3STATE=5]="BS_3STATE",n[n.BS_AUTO3STATE=6]="BS_AUTO3STATE",n[n.BS_GROUPBOX=7]="BS_GROUPBOX",n[n.BS_USERBUTTON=8]="BS_USERBUTTON",n[n.BS_AUTORADIOBUTTON=9]="BS_AUTORADIOBUTTON",n[n.BS_OWNERDRAW=11]="BS_OWNERDRAW",n[n.BS_LEFTTEXT=32]="BS_LEFTTEXT",n[n.ES_LEFT=0]="ES_LEFT",n[n.ES_CENTER=1]="ES_CENTER",n[n.ES_RIGHT=2]="ES_RIGHT",n[n.ES_MULTILINE=4]="ES_MULTILINE",n[n.ES_UPPERCASE=8]="ES_UPPERCASE",n[n.ES_LOWERCASE=16]="ES_LOWERCASE",n[n.ES_PASSWORD=32]="ES_PASSWORD",n[n.ES_AUTOVSCROLL=64]="ES_AUTOVSCROLL",n[n.ES_AUTOHSCROLL=128]="ES_AUTOHSCROLL",n[n.ES_NOHIDESEL=256]="ES_NOHIDESEL",n[n.SBS_HORZ=0]="SBS_HORZ",n[n.SBS_VERT=1]="SBS_VERT",n[n.SBS_TOPALIGN=2]="SBS_TOPALIGN",n[n.SBS_LEFTALIGN=2]="SBS_LEFTALIGN",n[n.SBS_BOTTOMALIGN=4]="SBS_BOTTOMALIGN",n[n.SBS_RIGHTALIGN=4]="SBS_RIGHTALIGN",n[n.SBS_SIZEBOXTOPLEFTALIGN=2]="SBS_SIZEBOXTOPLEFTALIGN",n[n.SBS_SIZEBOXBOTTOMRIGHTALIGN=4]="SBS_SIZEBOXBOTTOMRIGHTALIGN",n[n.SBS_SIZEBOX=8]="SBS_SIZEBOX",n[n.LBS_NOTIFY=1]="LBS_NOTIFY",n[n.LBS_SORT=2]="LBS_SORT",n[n.LBS_NOREDRAW=4]="LBS_NOREDRAW",n[n.LBS_MULTIPLESEL=8]="LBS_MULTIPLESEL",n[n.LBS_OWNERDRAWFIXED=16]="LBS_OWNERDRAWFIXED",n[n.LBS_OWNERDRAWVARIABLE=32]="LBS_OWNERDRAWVARIABLE",n[n.LBS_HASSTRINGS=64]="LBS_HASSTRINGS",n[n.LBS_USETABSTOPS=128]="LBS_USETABSTOPS",n[n.LBS_NOINTEGRALHEIGHT=256]="LBS_NOINTEGRALHEIGHT",n[n.LBS_MULTICOLUMN=512]="LBS_MULTICOLUMN",n[n.LBS_WANTKEYBOARDINPUT=1024]="LBS_WANTKEYBOARDINPUT",n[n.LBS_EXTENDEDSEL=2048]="LBS_EXTENDEDSEL",n[n.CBS_SIMPLE=1]="CBS_SIMPLE",n[n.CBS_DROPDOWN=2]="CBS_DROPDOWN",n[n.CBS_DROPDOWNLIST=3]="CBS_DROPDOWNLIST",n[n.CBS_OWNERDRAWFIXED=16]="CBS_OWNERDRAWFIXED",n[n.CBS_OWNERDRAWVARIABLE=32]="CBS_OWNERDRAWVARIABLE",n[n.CBS_AUTOHSCROLL=64]="CBS_AUTOHSCROLL",n[n.CBS_OEMCONVERT=128]="CBS_OEMCONVERT",n[n.CBS_SORT=256]="CBS_SORT",n[n.CBS_HASSTRINGS=512]="CBS_HASSTRINGS",n[n.CBS_NOINTEGRALHEIGHT=1024]="CBS_NOINTEGRALHEIGHT",n[n.BS_SOLID=0]="BS_SOLID",n[n.BS_NULL=1]="BS_NULL",n[n.BS_HATCHED=2]="BS_HATCHED",n[n.BS_PATTERN=3]="BS_PATTERN",n[n.BS_GRADIENT_LINEAR=10]="BS_GRADIENT_LINEAR",n[n.HS_HORIZONTAL=0]="HS_HORIZONTAL",n[n.HS_VERTICAL=1]="HS_VERTICAL",n[n.HS_FDIAGONAL=2]="HS_FDIAGONAL",n[n.HS_BDIAGONAL=3]="HS_BDIAGONAL",n[n.HS_CROSS=4]="HS_CROSS",n[n.HS_DIAGCROSS=5]="HS_DIAGCROSS",n[n.PS_SOLID=0]="PS_SOLID",n[n.PS_DASH=1]="PS_DASH",n[n.PS_DOT=2]="PS_DOT",n[n.PS_DASHDOT=3]="PS_DASHDOT",n[n.PS_DASHDOTDOT=4]="PS_DASHDOTDOT",n[n.PS_NULL=5]="PS_NULL",n[n.PS_INSIDEFRAME=6]="PS_INSIDEFRAME",n[n.R2_BLACK=1]="R2_BLACK",n[n.R2_NOTMERGEPEN=2]="R2_NOTMERGEPEN",n[n.R2_MASKNOTPEN=3]="R2_MASKNOTPEN",n[n.R2_NOTCOPYPEN=4]="R2_NOTCOPYPEN",n[n.R2_MASKPENNOT=5]="R2_MASKPENNOT",n[n.R2_NOT=6]="R2_NOT",n[n.R2_XORPEN=7]="R2_XORPEN",n[n.R2_NOTMASKPEN=8]="R2_NOTMASKPEN",n[n.R2_MASKPEN=9]="R2_MASKPEN",n[n.R2_NOTXORPEN=10]="R2_NOTXORPEN",n[n.R2_NOP=11]="R2_NOP",n[n.R2_MERGENOTPEN=12]="R2_MERGENOTPEN",n[n.R2_COPYPEN=13]="R2_COPYPEN",n[n.R2_MERGEPENNOT=14]="R2_MERGEPENNOT",n[n.R2_MERGEPEN=15]="R2_MERGEPEN",n[n.R2_WHITE=16]="R2_WHITE",n[n.FILE_ATTRIBUTE_ARCHIVE=32]="FILE_ATTRIBUTE_ARCHIVE",n[n.FILE_ATTRIBUTE_COMPRESSED=2048]="FILE_ATTRIBUTE_COMPRESSED",n[n.FILE_ATTRIBUTE_DIRECTORY=16]="FILE_ATTRIBUTE_DIRECTORY",n[n.FILE_ATTRIBUTE_HIDDEN=2]="FILE_ATTRIBUTE_HIDDEN",n[n.FILE_ATTRIBUTE_NORMAL=128]="FILE_ATTRIBUTE_NORMAL",n[n.FILE_ATTRIBUTE_OFFLINE=4096]="FILE_ATTRIBUTE_OFFLINE",n[n.FILE_ATTRIBUTE_READONLY=1]="FILE_ATTRIBUTE_READONLY",n[n.FILE_ATTRIBUTE_SYSTEM=4]="FILE_ATTRIBUTE_SYSTEM",n[n.FILE_ATTRIBUTE_TEMPORARY=256]="FILE_ATTRIBUTE_TEMPORARY",n[n.VF_LOCAL=2]="VF_LOCAL",n[n.VF_EQVAR=256]="VF_EQVAR",n[n.VF_ARGUMENT=512]="VF_ARGUMENT",n[n.VF_RETURN=1024]="VF_RETURN",n[n.CUR_ARROW=0]="CUR_ARROW",n[n.CUR_CROSS=1]="CUR_CROSS",n[n.CUR_TEXT=2]="CUR_TEXT",n[n.CUR_NO=3]="CUR_NO",n[n.CUR_SIZE=4]="CUR_SIZE",n[n.CUR_SIZENESW=5]="CUR_SIZENESW",n[n.CUR_SIZENS=6]="CUR_SIZENS",n[n.CUR_SIZENWSE=7]="CUR_SIZENWSE",n[n.CUR_SIZEWE=8]="CUR_SIZEWE",n[n.CUR_UPARROW=9]="CUR_UPARROW",n[n.CUR_WAIT=10]="CUR_WAIT",n[n.CUR_LINK=11]="CUR_LINK",n[n.CUR_HELP=12]="CUR_HELP",n[n.SHADOWTYPE_STENCIL_MODULATIVE=18]="SHADOWTYPE_STENCIL_MODULATIVE",n[n.SHADOWTYPE_STENCIL_ADDITIVE=17]="SHADOWTYPE_STENCIL_ADDITIVE",n[n.SHADOWTYPE_TEXTURE_MODULATIVE=34]="SHADOWTYPE_TEXTURE_MODULATIVE",n[n.SHADOWTYPE_TEXTURE_ADDITIVE=33]="SHADOWTYPE_TEXTURE_ADDITIVE",n[n.FOG_NONE=0]="FOG_NONE",n[n.FOG_EXP=1]="FOG_EXP",n[n.FOG_EXP2=2]="FOG_EXP2",n[n.FOG_LINEAR=3]="FOG_LINEAR",n[n.TEX_TYPE_1D=1]="TEX_TYPE_1D",n[n.TEX_TYPE_2D=2]="TEX_TYPE_2D",n[n.TEX_TYPE_3D=3]="TEX_TYPE_3D",n[n.TEX_TYPE_CUBE_MAP=4]="TEX_TYPE_CUBE_MAP",n[n.SBF_ONE=0]="SBF_ONE",n[n.SBF_ZERO=1]="SBF_ZERO",n[n.SBF_DEST_COLOUR=2]="SBF_DEST_COLOUR",n[n.SBF_SOURCE_COLOUR=3]="SBF_SOURCE_COLOUR",n[n.SBF_ONE_MINUS_DEST_COLOUR=4]="SBF_ONE_MINUS_DEST_COLOUR",n[n.SBF_ONE_MINUS_SOURCE_COLOUR=5]="SBF_ONE_MINUS_SOURCE_COLOUR",n[n.SBF_DEST_ALPHA=6]="SBF_DEST_ALPHA",n[n.SBF_SOURCE_ALPHA=7]="SBF_SOURCE_ALPHA",n[n.SBF_ONE_MINUS_DEST_ALPHA=8]="SBF_ONE_MINUS_DEST_ALPHA",n[n.SBF_ONE_MINUS_SOURCE_ALPHA=9]="SBF_ONE_MINUS_SOURCE_ALPHA",n[n.CMPF_ALWAYS_FAIL=0]="CMPF_ALWAYS_FAIL",n[n.CMPF_ALWAYS_PASS=1]="CMPF_ALWAYS_PASS",n[n.CMPF_LESS=2]="CMPF_LESS",n[n.CMPF_LESS_EQUAL=3]="CMPF_LESS_EQUAL",n[n.CMPF_EQUAL=4]="CMPF_EQUAL",n[n.CMPF_NOT_EQUAL=5]="CMPF_NOT_EQUAL",n[n.CMPF_GREATER_EQUAL=6]="CMPF_GREATER_EQUAL",n[n.CMPF_GREATER=7]="CMPF_GREATER",n[n.CULL_NONE=1]="CULL_NONE",n[n.CULL_CLOCKWISE=2]="CULL_CLOCKWISE",n[n.CULL_ANTICLOCKWISE=3]="CULL_ANTICLOCKWISE",n[n.SO_FLAT=0]="SO_FLAT",n[n.SO_GOURAUD=1]="SO_GOURAUD",n[n.SO_PHONG=2]="SO_PHONG",n[n.PM_POINTS=1]="PM_POINTS",n[n.PM_WIREFRAME=2]="PM_WIREFRAME",n[n.PM_SOLID=3]="PM_SOLID",n[n.LT_POINT=0]="LT_POINT",n[n.LT_DIRECTIONAL=1]="LT_DIRECTIONAL",n[n.LT_SPOTLIGHT=2]="LT_SPOTLIGHT",n[n.PT_ORTHOGRAPHIC=0]="PT_ORTHOGRAPHIC",n[n.PT_PERSPECTIVE=1]="PT_PERSPECTIVE",n[n.OT_POINT_LIST=1]="OT_POINT_LIST",n[n.OT_LINE_LIST=2]="OT_LINE_LIST",n[n.OT_LINE_STRIP=3]="OT_LINE_STRIP",n[n.OT_TRIANGLE_LIST=4]="OT_TRIANGLE_LIST",n[n.OT_TRIANGLE_STRIP=5]="OT_TRIANGLE_STRIP",n[n.OT_TRIANGLE_FAN=6]="OT_TRIANGLE_FAN",n[n.BBT_POINT=0]="BBT_POINT",n[n.BBT_ORIENTED_COMMON=1]="BBT_ORIENTED_COMMON",n[n.BBT_ORIENTED_SELF=2]="BBT_ORIENTED_SELF",n[n.BBT_PERPENDICULAR_COMMON=3]="BBT_PERPENDICULAR_COMMON",n[n.BBT_PERPENDICULAR_SELF=4]="BBT_PERPENDICULAR_SELF",n[n.GMM_RELATIVE=0]="GMM_RELATIVE",n[n.GMM_PIXELS=1]="GMM_PIXELS",n[n.GMM_RELATIVE_ASPECT_ADJUSTED=2]="GMM_RELATIVE_ASPECT_ADJUSTED",n[n.GHA_LEFT=0]="GHA_LEFT",n[n.GHA_CENTER=1]="GHA_CENTER",n[n.GHA_RIGHT=2]="GHA_RIGHT",n[n.GVA_TOP=0]="GVA_TOP",n[n.GVA_CENTER=1]="GVA_CENTER",n[n.GVA_BOTTOM=2]="GVA_BOTTOM",n[n.MTHA_LEFT=0]="MTHA_LEFT",n[n.MTHA_CENTER=1]="MTHA_CENTER",n[n.MTVA_BELOW=0]="MTVA_BELOW",n[n.MTVA_ABOVE=1]="MTVA_ABOVE",n[n.MTVA_CENTER=2]="MTVA_CENTER",n[n.PT_BOOL=0]="PT_BOOL",n[n.PT_REAL=1]="PT_REAL",n[n.PT_INT=2]="PT_INT",n[n.PT_UNSIGNED_INT=3]="PT_UNSIGNED_INT",n[n.PT_SHORT=4]="PT_SHORT",n[n.PT_UNSIGNED_SHORT=5]="PT_UNSIGNED_SHORT",n[n.PT_LONG=6]="PT_LONG",n[n.PT_UNSIGNED_LONG=7]="PT_UNSIGNED_LONG",n[n.PT_STRING=8]="PT_STRING",n[n.PT_VECTOR3=9]="PT_VECTOR3",n[n.PT_MATRIX3=10]="PT_MATRIX3",n[n.PT_MATRIX4=11]="PT_MATRIX4",n[n.PT_QUATERNION=12]="PT_QUATERNION",n[n.PT_COLOURVALUE=13]="PT_COLOURVALUE",n[n.NUI_SP_HIP_CENTER=0]="NUI_SP_HIP_CENTER",n[n.NUI_SP_SPINE=1]="NUI_SP_SPINE",n[n.NUI_SP_SHOULDER_CENTER=2]="NUI_SP_SHOULDER_CENTER",n[n.NUI_SP_HEAD=3]="NUI_SP_HEAD",n[n.NUI_SP_SHOULDER_LEFT=4]="NUI_SP_SHOULDER_LEFT",n[n.NUI_SP_ELBOW_LEFT=5]="NUI_SP_ELBOW_LEFT",n[n.NUI_SP_WRIST_LEFT=6]="NUI_SP_WRIST_LEFT",n[n.NUI_SP_HAND_LEFT=7]="NUI_SP_HAND_LEFT",n[n.NUI_SP_SHOULDER_RIGHT=8]="NUI_SP_SHOULDER_RIGHT",n[n.NUI_SP_ELBOW_RIGHT=9]="NUI_SP_ELBOW_RIGHT",n[n.NUI_SP_WRIST_RIGHT=10]="NUI_SP_WRIST_RIGHT",n[n.NUI_SP_HAND_RIGHT=11]="NUI_SP_HAND_RIGHT",n[n.NUI_SP_HIP_LEFT=12]="NUI_SP_HIP_LEFT",n[n.NUI_SP_KNEE_LEFT=13]="NUI_SP_KNEE_LEFT",n[n.NUI_SP_ANKLE_LEFT=14]="NUI_SP_ANKLE_LEFT",n[n.NUI_SP_FOOT_LEFT=15]="NUI_SP_FOOT_LEFT",n[n.NUI_SP_HIP_RIGHT=16]="NUI_SP_HIP_RIGHT",n[n.NUI_SP_KNEE_RIGHT=17]="NUI_SP_KNEE_RIGHT",n[n.NUI_SP_ANKLE_RIGHT=18]="NUI_SP_ANKLE_RIGHT",n[n.NUI_SP_FOOT_RIGHT=19]="NUI_SP_FOOT_RIGHT",n[n.NUI_SP_COUNT=20]="NUI_SP_COUNT",n[n.WM_DESTROY=2]="WM_DESTROY",n[n.WM_MOVE=3]="WM_MOVE",n[n.WM_SIZE=5]="WM_SIZE",n[n.WM_CLOSE=16]="WM_CLOSE",n[n.WM_GETMINMAXINFO=36]="WM_GETMINMAXINFO",n[n.WM_COMMAND=273]="WM_COMMAND",n[n.WM_MOUSEMOVE=512]="WM_MOUSEMOVE",n[n.WM_LBUTTONDOWN=513]="WM_LBUTTONDOWN",n[n.WM_LBUTTONUP=514]="WM_LBUTTONUP",n[n.WM_LBUTTONDBLCLK=515]="WM_LBUTTONDBLCLK",n[n.WM_RBUTTONDOWN=516]="WM_RBUTTONDOWN",n[n.WM_RBUTTONUP=517]="WM_RBUTTONUP",n[n.WM_RBUTTONDBLCLK=518]="WM_RBUTTONDBLCLK",n[n.WM_MBUTTONDOWN=519]="WM_MBUTTONDOWN",n[n.WM_MBUTTONUP=520]="WM_MBUTTONUP",n[n.WM_MBUTTONDBLCLK=521]="WM_MBUTTONDBLCLK",n[n.WM_ALLMOUSEMESSAGE=1536]="WM_ALLMOUSEMESSAGE",n[n.WM_ALLKEYMESSAGE=1537]="WM_ALLKEYMESSAGE",n[n.WM_KEYDOWN=256]="WM_KEYDOWN",n[n.WM_KEYUP=257]="WM_KEYUP",n[n.WM_CANCLOSE=1538]="WM_CANCLOSE",n[n.WM_SPACEDONE=1539]="WM_SPACEDONE",n[n.WM_SPACEINIT=1540]="WM_SPACEINIT",n[n.WM_CONTROLNOTIFY=1544]="WM_CONTROLNOTIFY",n[n.WM_HYPERJUMP=1546]="WM_HYPERJUMP",n))(Te||{});function Ks(u,r,e,t="random"){let{children:s}=u,i=s.length?s[0]:null,o=Kt(u.scene,r,t).set({x:u.x,y:u.y,attrib:u.attrib});if(i){let l=u.attrib|1;e?(i.set({attrib:l}),o.set({width:i.width,height:i.height})):i.set({attrib:l,width:1,height:1})}return u.set({children:s.concat(o)}),o}function ol(u){return(u.startsWith("#")?parseInt(u.slice(1)):parseInt(u))||0}function Xt(u,r){switch(u){case 1:return parseFloat(r)||0;case 3:return ol(r);case 2:return r;case 4:return Is(r)}}function qs(u,r){switch(u){case 1:case 2:return r.toString();case 3:return"#"+r;case 4:return Gs(r)}}var Ye=class{constructor(r){a(this,"fields");this.fields=r!=null?r:[]}insert(r){if(r==="FLOAT")return this.fields.push({type:r,value:0}),1;if(r==="HANDLE")return this.fields.push({type:r,value:0}),1;if(r==="STRING")return this.fields.push({type:r,value:""}),1;throw Error(`\u041D\u0435\u0438\u0437\u0432\u0435\u0441\u0442\u043D\u044B\u0439 \u0442\u0438\u043F \u044D\u043B\u0435\u043C\u0435\u043D\u0442\u0430: ${r}`)}insertClass(r,e){let t=e.map(s=>{let i=s[0].toUpperCase();switch(s[1]){case 1:return[i,{type:"FLOAT",value:0}];case 2:return[i,{type:"STRING",value:""}];default:return[i,{type:"HANDLE",value:0}]}});return this.fields.push({type:"STRUCT",realType:r,value:new Map(t)}),1}set(r,e,t){if(r<0||r>this.fields.length-1)return;let s=this.fields[r];if(s.type==="STRUCT"){let i=s.value.get(e.toUpperCase());if(!i)return;s=i}if(typeof t=="string"){if(s.type!=="STRING")return;s.value=t}else{if(s.type==="STRING")return;s.value=t}}remove(r){return this.fields.splice(r,1).length?1:0}count(){return this.fields.length}type(r){if(r<0||r>this.fields.length-1)return"";let e=this.fields[r];return e.type==="STRUCT"?e.realType:e.type}getFloat(r,e){if(r<0||r>this.fields.length-1)return 0;let t=this.fields[r];if(t.type==="STRUCT"){let s=t.value.get(e.toUpperCase());if(!s)return 0;t=s}return t.type==="FLOAT"?t.value:0}getHandle(r,e){if(r<0||r>this.fields.length-1)return 0;let t=this.fields[r];if(t.type==="STRUCT"){let s=t.value.get(e.toUpperCase());if(!s)return 0;t=s}return t.type==="HANDLE"?t.value:0}getString(r,e){if(r<0||r>this.fields.length-1)return"";let t=this.fields[r];if(t.type==="STRUCT"){let s=t.value.get(e.toUpperCase());if(!s)return"";t=s}return t.type==="STRING"?t.value:""}sort(r){if(!r||r.length===0)return this.fields.sort((e,t)=>e.value-t.value),1;if(r.length===1)return r[0].desc?this.fields.sort((e,t)=>t.value-e.value):this.fields.sort((e,t)=>e.value-t.value),1;throw console.log(r),Error("\u0421\u043E\u0440\u0442\u0438\u0440\u043E\u0432\u043A\u0430 \u043F\u043E \u043F\u043E\u043B\u044F\u043C \u043D\u0435 \u0440\u0435\u0430\u043B\u0438\u0437\u043E\u0432\u0430\u043D\u0430")}};function lt(u,r,e){r.forEach(({key:t,klass:s})=>{var l,h,p,b;let i=(l=e.get(s))==null?void 0:l.image;if(!i||i.prior==="icon"||!((b=(p=(h=i.scene)==null?void 0:h.data)==null?void 0:p.objects)!=null&&b.length))return;let o=u.objects.get(t);(o==null?void 0:o.type)==="group"&&Ks(o,i.scene.data,i.resizable)})}var ze=new Uint8Array(256);function Xs(u){return u>=0&&u<256?ze[u]:0}var ge=class{constructor(r){a(this,"minV");a(this,"minH");a(this,"cols");a(this,"rows");a(this,"m");this.minV=Math.floor(r.minV),this.minH=Math.floor(r.minH),this.rows=r.rows,this.cols=r.cols,this.m=r.data?new Float64Array(r.data):new Float64Array(this.rows*this.cols)}isSquare(){return this.cols===this.rows}get(r,e){let t=Math.floor(r)-this.minV,s=Math.floor(e)-this.minH;return t<0||s<0||t>=this.rows||s>=this.cols?0:this.m[t*this.cols+s]}set(r,e,t){let s=Math.floor(r)-this.minV,i=Math.floor(e)-this.minH;return s<0||i<0||s>=this.rows||i>=this.cols?0:(this.m[s*this.cols+i]=t,t)}sum(){return this.m.reduce((r,e)=>r+e,0)}static glue(r,e,t,s){let i=Math.min(r.minH,e.minH+s),o=Math.min(r.minV,e.minV+t),l=Math.max(r.cols+r.minH,e.cols+e.minH+s),h=Math.max(r.rows+r.minV,e.rows+e.minV+t),p=new ge({cols:l-i,rows:h-o,minH:i,minV:o});for(let b=e.minV;b<e.rows+e.minV;b++)for(let y=e.minH;y<e.cols+e.minH;y++)p.set(b+t,y+s,e.get(b,y));for(let b=r.minV;b<r.rows+r.minV;b++)for(let y=r.minH;y<r.cols+r.minH;y++)p.set(b,y,r.get(b,y));return p}static mul(r,e){if(r.cols!==e.rows)return null;let t=e.cols,s=r.rows,i=new ge({cols:t,rows:s,minH:r.minH,minV:r.minV});for(let o=0;o<r.rows;o++)for(let l=0;l<e.cols;l++){let h=0;for(let p=0;p<r.rows;p++)h+=r.m[o*r.cols+p]*e.m[p*e.cols+l];i.m[o*r.rows+l]=h}return i}det(){if(!this.isSquare())throw Error("Not a square matrix");if(this.rows===1)return this.m[0];if(this.rows===2)return this.m[0]*this.m[3]-this.m[1]*this.m[2];let r=Array.from(this.m),e=this.rows,t=1;for(let s=0;s<e;s++){let i=0,o=0;for(let l=s;l<e;l++){let h=r[l*e+s];h>i&&(i=h,o=l)}if(i===0)return 0;if(o!==s){t=-t;for(let l=s;l<e;l++){let h=r[o*e+l];r[o*e+l]=r[s*e+l],r[s*e+l]=h}}for(let l=s+1;l<e;l++){let h=r[l*e+s]/i;for(let p=s+1;p<e;p++)r[l*e+p]=r[l*e+p]-h*r[s*e+p]}t=t*r[s*e+s]}return t}obr(){if(!this.isSquare()||this.det()===0)return null;let r=this.rows,e=new ge({cols:this.cols,rows:this.rows,minH:0,minV:0,data:Array.from(this.m)}),t=new ge({cols:this.cols,rows:this.rows,minH:0,minV:0});for(let s=0;s<r;s++)for(let i=0;i<r;i++)t.set(s,i,0),s===i&&t.set(s,i,1);for(let s=0;s<r;s++){let i=e.get(s,s);for(let o=0;o<r;o++)e.set(s,o,e.get(s,o)/i),t.set(s,o,t.get(s,o)/i);for(let o=s+1;o<r;o++){i=e.get(o,s);for(let l=0;l<r;l++)e.set(o,l,e.get(o,l)-e.get(s,l)*i),t.set(o,l,t.get(o,l)-t.get(s,l)*i)}}for(let s=r-1;s>0;s--)for(let i=s-1;i>=0;i--){let o=e.get(i,s);for(let l=0;l<r;l++)e.set(i,l,e.get(i,l)-e.get(s,l)*o),t.set(i,l,t.get(i,l)-t.get(s,l)*o)}return t.minH=this.minH,t.minV=this.minV,t}diag(r){this.fill(0);let e=Math.min(this.rows,this.cols);for(let t=0;t<e;t++)this.set(t,t,r);return 1}fill(r){return this.m.fill(r),1}sortByRow(r,e){let t=r-this.minV;if(t<0||t>=this.rows)return 0;let s=Array.from({length:this.cols},(o,l)=>Array.from({length:this.rows},(h,p)=>this.m[p*this.cols+l])),i=e?(o,l)=>l[t]-o[t]:(o,l)=>o[t]-l[t];return s.sort(i),s.forEach((o,l)=>{o.forEach((h,p)=>{this.m[p*this.cols+l]=h})}),1}sortByColumn(r,e){let t=r-this.minH;if(t<0||t>=this.cols)return 0;let s=Array.from({length:this.rows},(o,l)=>{let h=l*this.cols,p=h+this.cols;return Array.from(this.m.subarray(h,p))}),i=e?(o,l)=>l[t]-o[t]:(o,l)=>o[t]-l[t];return s.sort(i),this.m=new Float64Array(Ce(s)),1}data(){let{minH:r,minV:e,cols:t,rows:s,m:i}=this;return{minV:e,minH:r,cols:t,rows:s,data:[...i]}}};function Ys({map:u,memory:r},e){let{newFloats:t,newInts:s}=r,i=u[e.id];switch(e.type){case 1:return t[i];case 3:case 4:return s[i];default:return null}}function zs({map:u,memory:r},e){return e.type===2?r.newStrings[u[e.id]]:null}function Be({map:u,memory:r},e){let{newFloats:t,newInts:s,newStrings:i}=r,o=u[e.id];switch(e.type){case 1:return t[o];case 3:case 4:return s[o];case 2:return i[o]}}function J({map:u,memory:r},e,t){let{newFloats:s,oldFloats:i,newInts:o,oldInts:l,newStrings:h,oldStrings:p}=r,b=u[e.id];switch(e.type){case 1:if(typeof t!="number")return!1;s[b]=i[b]=t;break;case 3:case 4:if(typeof t!="number")return!1;o[b]=l[b]=t;break;case 2:if(typeof t!="string")return!1;h[b]=p[b]=t;break}return!0}function Js({map:u,memory:r},e,t){let{newFloats:s,newInts:i,newStrings:o}=r,l=u[e.id];switch(e.type){case 1:if(typeof t!="number")return!1;s[l]=t;break;case 3:case 4:if(typeof t!="number")return!1;i[l]=t;break;case 2:if(typeof t!="string")return!1;o[l]=t;break}return!0}var Zs=new Map([["Backspace",8],["Tab",9],["Enter",13],["ShiftLeft",16],["ControlLeft",17],["AltLeft",18],["Pause",19],["CapsLock",20],["Escape",27],["Space",32],["PageUp",33],["PageDown",34],["End",35],["Home",36],["ArrowLeft",37],["ArrowUp",38],["ArrowRight",39],["ArrowDown",40],["PrintScreen",44],["Insert",45],["Delete",46],["Digit0",48],["Digit1",49],["Digit2",50],["Digit3",51],["Digit4",52],["Digit5",53],["Digit6",54],["Digit7",55],["Digit8",56],["Digit9",57],["KeyA",65],["KeyB",66],["KeyC",67],["KeyD",68],["KeyE",69],["KeyF",70],["KeyG",71],["KeyH",72],["KeyI",73],["KeyJ",74],["KeyK",75],["KeyL",76],["KeyM",77],["KeyN",78],["KeyO",79],["KeyP",80],["KeyQ",81],["KeyR",82],["KeyS",83],["KeyT",84],["KeyU",85],["KeyV",86],["KeyW",87],["KeyX",88],["KeyY",89],["KeyZ",90],["Comma",188],["Period",190],["Slash",191]]),Qs=[37,38,39,40,45,46];var Yt=class{constructor(r,e,t){this.parent=r;this.view=e;a(this,"realX",0);a(this,"realY",0);a(this,"x",0);a(this,"y",0);a(this,"width",0);a(this,"height",0);a(this,"clientWidth",0);a(this,"clientHeight",0);a(this,"title","");a(this,"visible",!0);e.setAttribute("class","stratum-subwindow"),e.style.setProperty("position","absolute"),this.set(t),r.scene.view.appendChild(e)}set({x:r=this.x,y:e=this.y,width:t=this.width,height:s=this.height,clientWidth:i=this.clientWidth,clientHeight:o=this.clientHeight,title:l=this.title,visible:h=this.visible}){let{parent:p,view:b}=this,{style:y}=b,T=(r-p.scene.x)*p.scene.scale,v=(e-p.scene.y)*p.scene.scale;return this.realX!==T&&y.setProperty("left",T+"px"),this.realY!==v&&y.setProperty("top",v+"px"),this.width!==t?y.setProperty("width",t+"px"):this.clientWidth!==i&&y.setProperty("width",i+"px"),this.height!==s?y.setProperty("height",s+"px"):this.clientHeight!==o&&y.setProperty("height",o+"px"),this.visible!==h&&y.setProperty("display",h?"block":"none"),this.realX=T,this.realY=v,this.x=r,this.y=e,this.width=t,this.height=s,this.clientWidth=i,this.clientHeight=o,this.title=l,this.visible=h,this}close(){this.view.remove()}};var Je=class{constructor(r,{key:e,matrix:t,name:s,prj:i,scene:o,window:l,parent:h,source:p}){this.k=r;a(this,"currentCursor","default");a(this,"cursorOverHyp",!1);a(this,"all",new Set([this]));a(this,"parent");a(this,"mouseMoveSubs",new ye);a(this,"leftButtonUpSubs",new ye);a(this,"leftButtonDownSubs",new ye);a(this,"rightButtonUpSubs",new ye);a(this,"rightButtonDownSubs",new ye);a(this,"middleButtonUpSubs",new ye);a(this,"middleButtonDownSubs",new ye);a(this,"keyDownSubs",new Set);a(this,"keyUpSubs",new Set);a(this,"keyCharSubs",new Set);a(this,"controlNotifySubs",new ye);a(this,"windowMoveSubs",new Set);a(this,"spaceDoneSubs",new Set);a(this,"sizeSubs",new Set);a(this,"scene");a(this,"window");a(this,"key");a(this,"name");a(this,"prj");a(this,"matrix");a(this,"invmatrix");a(this,"source");a(this,"hiddenBy",null);this.scene=o,this.window=l,this.key=e,this.name=s,this.prj=i,this.matrix=t!=null?t:null,this.invmatrix=t?Vs(t):null,this.parent=h!=null?h:null,this.source=p!=null?p:null,o.onpointerdown=o.onpointerup=o.onpointermove=this.handlePointer.bind(this);let b=this.handleKeyboard.bind(this);o.root.addEventListener("keydown",b),o.root.addEventListener("keyup",b),o.oninputchanged=this.handleInput.bind(this)}handlePointer(r){var R;ze[1]=+r.buttons.left,ze[2]=+r.buttons.right,ze[4]=+r.buttons.middle;let e=r.buttons.left?1:0,t=r.buttons.right?2:0,s=r.buttons.middle?16:0,i=e|t|s,{x:o,y:l}=r,h=this.scene.pick(o,l);for(;h;){let W=h.parent;if(!W)break;h=W}let p,b,y=(R=h==null?void 0:h.data)==null?void 0:R.hyper;switch(r.type){case"pointerdown":{switch(this.k.closePopups(this),r.button){case"left":y&&!y.disabled&&this.hyperClick(y,{x:o,y:l}),p=this.leftButtonDownSubs,b=513;break;case"middle":p=this.middleButtonDownSubs,b=519;break;case"right":p=this.rightButtonDownSubs,b=516;break;default:return}break}case"pointerup":{switch(r.button){case"left":p=this.leftButtonUpSubs,b=514;break;case"middle":p=this.middleButtonUpSubs,b=520;break;case"right":p=this.rightButtonUpSubs,b=517;break;default:return}break}case"pointermove":this.cursorOverHyp=!!y&&!y.disabled,this.updateCursor(),p=this.mouseMoveSubs,b=512;break}let T=o,v=l,_=this.invmatrix;if(_){let W=o*_[2]+l*_[5]+_[8];T=(o*_[0]+l*_[3]+_[6])/W,v=(o*_[1]+l*_[4]+_[7])/W}let{captureTarget:I}=this.k;p.forEach((W,N)=>{if(!((I==null?void 0:I.w.scene)===r.scene&&I.s===N||W.has(h)||W.has(null)))return;let{msg:q,xpos:te,ypos:we,fwkeys:_e}=N.klass.vars;J(N.vars,q,b),te&&J(N.vars,te,T),we&&J(N.vars,we,v),_e&&J(N.vars,_e,i),N.compute(this.k.ctx,!0)})}updateCursor(){this.scene.set({cursor:this.k.cursorVisible?this.cursorOverHyp?"pointer":this.currentCursor:"none"})}handleKeyboard(r){var h;let e=r.type,t=(h=Zs.get(r.code))!=null?h:0;!t&&r.code&&console.warn(`\u041D\u0435\u0438\u0437\u0432\u0435\u0441\u0442\u043D\u0430\u044F \u043A\u043B\u0430\u0432\u0438\u0448\u0430: ${r.code}`),ze[t]=+(e==="keydown");let s=1,i=0,o,l;switch(e){case"keydown":o=this.keyDownSubs,l=256;break;case"keyup":o=this.keyUpSubs,l=257;break}if(o.forEach(p=>{let{msg:b,wvkey:y,repeat:T,scancode:v}=p.klass.vars;J(p.vars,b,l),y&&J(p.vars,y,t),T&&J(p.vars,T,s),v&&J(p.vars,v,i),p.compute(this.k.ctx,!0)}),e==="keydown"&&!Qs.includes(t)){let p=ae.table.indexOf(r.key),b=p<0?t:p;this.keyCharSubs.forEach(y=>{let{msg:T,wvkey:v,repeat:_,scancode:I}=y.klass.vars;J(y.vars,T,258),v&&J(y.vars,v,b),_&&J(y.vars,_,s),I&&J(y.vars,I,i),y.compute(this.k.ctx,!0)})}}handleInput(r){let e=this.controlNotifySubs,t=1544,s;switch(r.type){case"input":s=768;break;case"focus":s=256;break;case"blur":s=512;break;case"click":s=0;break;default:return}e.forEach((i,o)=>{if(!(i.has(r.target)||i.has(null)))return;let{msg:h,_hobject:p,iditem:b,wnotifycode:y}=o.klass.vars;J(o.vars,h,t),p&&J(o.vars,p,r.target.key),b&&J(o.vars,b,0),y&&J(o.vars,y,s),o.compute(this.k.ctx,!0)})}setCapture(r){var e;(e=this.k.captureTarget)==null||e.w.scene.stopCapturingMouseEvents(),this.k.captureTarget={w:this,s:r},this.scene.startCapturingMouseEvents()}subscribe(r,e,t,s){var l;let i=s&1,o=(l=this.scene.objects.get(t))!=null?l:null;switch(e){case 3:this.windowMoveSubs.add(r);break;case 1539:this.spaceDoneSubs.add(r);break;case 5:this.sizeSubs.add(r);break;case 1544:(o||t===0)&&this.controlNotifySubs.set(r,o);break;case 512:(o||!i)&&this.mouseMoveSubs.set(r,i?o:null);break;case 513:(o||!i)&&this.leftButtonDownSubs.set(r,i?o:null);break;case 514:(o||!i)&&this.leftButtonUpSubs.set(r,i?o:null);break;case 516:(o||!i)&&this.rightButtonDownSubs.set(r,i?o:null);break;case 517:(o||!i)&&this.rightButtonUpSubs.set(r,i?o:null);break;case 519:(o||!i)&&this.middleButtonDownSubs.set(r,i?o:null);break;case 520:(o||!i)&&this.middleButtonUpSubs.set(r,i?o:null);break;case 1536:if(!o&&i)break;let h=i?o:null;this.mouseMoveSubs.set(r,h),this.leftButtonDownSubs.set(r,h),this.leftButtonUpSubs.set(r,h),this.rightButtonDownSubs.set(r,h),this.rightButtonUpSubs.set(r,h),this.middleButtonDownSubs.set(r,h),this.middleButtonUpSubs.set(r,h);break;case 256:this.keyDownSubs.add(r);break;case 257:this.keyUpSubs.add(r);break;case 258:this.keyCharSubs.add(r);break;case 1537:this.keyDownSubs.add(r),this.keyUpSubs.add(r),this.keyCharSubs.add(r);break;default:this.k._functionNotImplemented(`\u041F\u043E\u0434\u043F\u0438\u0441\u043A\u0430 \u043D\u0430 ${Te[e]}`,r);break}}unsubscribe(r,e){switch(e){case 3:this.windowMoveSubs.delete(r);break;case 1539:this.spaceDoneSubs.delete(r);break;case 5:this.sizeSubs.delete(r);break;case 1544:this.controlNotifySubs.delete(r);break;case 512:this.mouseMoveSubs.delete(r);break;case 513:this.leftButtonDownSubs.delete(r);break;case 514:this.leftButtonUpSubs.delete(r);break;case 516:this.rightButtonDownSubs.delete(r);break;case 517:this.rightButtonUpSubs.delete(r);break;case 519:this.middleButtonDownSubs.delete(r);break;case 520:this.middleButtonUpSubs.delete(r);break;case 1536:this.mouseMoveSubs.delete(r),this.leftButtonDownSubs.delete(r),this.leftButtonUpSubs.delete(r),this.rightButtonDownSubs.delete(r),this.rightButtonUpSubs.delete(r),this.middleButtonDownSubs.delete(r),this.middleButtonUpSubs.delete(r);break;case 256:this.keyDownSubs.delete(r);break;case 257:this.keyUpSubs.delete(r);break;case 258:this.keyCharSubs.delete(r);break;case 1537:this.keyDownSubs.delete(r),this.keyUpSubs.delete(r),this.keyCharSubs.delete(r);break}}setCursor(r){this.currentCursor=r,this.updateCursor()}subwindow({data:{data:r,matrix:e,options:t},prj:s,wname:i,coords:o,source:l}){let h=Ct(this.k.swgBackend,r),p=k(G({},o),{title:i}),b=t==null?void 0:t.size;if((b==null?void 0:b.type)==="fixed")p.width=b.width,p.height=b.height;else if(h.objects.size){let _=qt(h.objects);t!=null&&t.autoorg&&h.set({x:_.x,y:_.y}),p.width=_.w,p.height=_.h}let y=new Yt(this,h.view,p),T=re.freeKey(this.k.scenes),v=new Je(this.k,{key:T,name:i,prj:s,scene:h,window:y,matrix:e,source:l,parent:this});return this.k.scenes.set(T,v),this.k.windows.set(i,v),this.all.add(v),v}pick(r,e,t){var h;let s=r,i=e,o=this.matrix;if(o){let p=r*o[2]+e*o[5]+o[8];s=(r*o[0]+e*o[3]+o[6])/p,i=(r*o[1]+e*o[4]+o[7])/p}let l=this.scene.pick(s,i);if(t&&(this.k.lastPickedPrimaryKey=(h=l==null?void 0:l.key)!=null?h:0),!l)return null;for(;l.parent;)l=l.parent;return l}paste(r,e,t,s){var b;if(!((b=r.objects)!=null&&b.length))return null;let i=r;if(s&255){let y=G({},r);s&1&&delete y.pens,s&2&&delete y.brushes,s&8&&delete y.images,s&4&&delete y.imagesOpaque,s&16&&delete y.strings,s&32&&delete y.fonts,s&64&&delete y.texts,i=y}let o=Kt(this.scene,i);if(!(s&32768))return o;let l=e,h=t,p=this.matrix;if(p){let y=e*p[2]+t*p[5]+p[8];l=(e*p[0]+t*p[3]+p[6])/y,h=(e*p[1]+t*p[4]+p[7])/y}return o.set({x:l,y:h})}hyperClick(r,e){var s,i,o;let{prj:t}=this;switch(r.mode){case 0:{let l=r.target;if(!l)break;let h=this.k.classes.get(l);if(!h)break;let{scene:p}=h,b=r.window||((s=p==null?void 0:p.options)!=null&&s.popup?"PopupWindow":"MainWindow");if(this.k.windows.has(b))return;let y={x:e.x-this.scene.x+this.window.view.offsetLeft,y:e.y-this.scene.y+this.window.view.offsetTop},T=this.k.window({wname:b,data:p!=null?p:{},prj:t,source:{type:"classname",data:h.name},coords:y});p&&lt(T.scene,h.children,this.k.classes);break}case 1:{let l=r.target;if(!l)break;this.k.handleExe(l);break}case 2:{let l=r.target;if(!l)break;let h=(i=r.params)==null?void 0:i.toUpperCase().includes("/HIDEWINDOWS"),p=t.dir.resolve(l);this.k.projectLoader.open(p).then(b=>{if(!b){console.warn(`${p} \u043D\u0435 \u0441\u0443\u0449\u0435\u0441\u0442\u0432\u0443\u0435\u0442`);return}let y=this.k.project(b);h&&this.k.hideProjectWindows(t,y)}).catch(b=>{if(!(b instanceof Error))throw b;console.warn(`\u041D\u0435 \u0443\u0434\u0430\u043B\u043E\u0441\u044C \u043E\u0442\u043A\u0440\u044B\u0442\u044C ${p}: ${b.message}`)});break}case 3:break;case 4:{let l=(o=r.target)==null?void 0:o.toUpperCase();if(!l)break;l==="CM_CLEARALL"?this.k.set({projects:[]}):l==="CM_PREVPAGE"?this.k.set({projects:this.k.projects.filter(h=>h!==t)}):console.warn(`\u041A\u043E\u043C\u0430\u043D\u0434\u0430 ${l} \u043D\u0435 \u0440\u0435\u0430\u043B\u0438\u0437\u043E\u0432\u0430\u043D\u0430.`);break}default:console.warn("\u041D\u0435\u0438\u0437\u0432\u0435\u0441\u0442\u043D\u044B\u0439 \u0442\u0438\u043F \u0433\u0438\u043F\u0435\u0440\u043F\u0435\u0440\u0435\u0445\u043E\u0434\u0430"),console.log(r)}}remove(){this.k.closeWindows(this.all)}};function _r(u){let r=["s","m","c"];return new Function(...r,u)}function ei(u){return _r(u)}function ti(u){return u.map(r=>_r(r))}function ri(u){return u.map(r=>_r(r))}var Pe=8,al=(s=>(s[s.FLOAT_REF=1|Pe]="FLOAT_REF",s[s.STRING_REF=2|Pe]="STRING_REF",s[s.HANDLE_REF=3|Pe]="HANDLE_REF",s[s.COLORREF_REF=4|Pe]="COLORREF_REF",s))(al||{});var zt=class{constructor(){a(this,"blocks",[])}pushBlock(r){return this.blocks.push(r),r}popBlock(r){let e=this.blocks.pop();if((e==null?void 0:e.expect)!==r)throw Error(`\u041E\u0436\u0438\u0434\u0430\u043B\u043E\u0441\u044C ${r}`);return e}lastBlock(){return this.blocks.length>0?this.blocks[this.blocks.length-1]:null}haveABreakHaveAKitKat(){for(let r=this.blocks.length-1;r>=0;--r)if(this.blocks[r].canBreak)return"break;";return"return;"}};var ll=`function arccos(a) {
    if (a > 1) return 0;
    if (a < -1) return Math.PI;
    return Math.acos(a) || 0;
}`,cl=`function arcsin(a) {
    if (a > 1) return Math.PI / 2;
    if (a < -1) return -Math.PI / 2;
    return Math.asin(a) || 0;
}`,ul=`function change(s1, s2, s3) {
    return s1.split(s2).join(s3);
}`,hl=`function compareI(s1, s2, n) {
    return s1.substring(0, n) === s2.substring(0, n) ? 1 : 0;
}`,pl=`function getAngleByXY(x, y) {
    if (y === 0) return x >= 0 ? 0 : Math.PI;
    if (y > 0) return -Math.atan(x / y) + Math.PI / 2;
    return -Math.atan(x / y) + Math.PI * 1.5;
}`,dl=`function lg(a) {
    return a > 0 ? (Math.log(a) || 0) / Math.LN10 : -(10 ** 100);
}`,fl=`function ln(a) {
    return a > 0 ? Math.log(a) || 0 : -(10 ** 100);
}`,ml=`function log(a, b) {
    return a > 0 && b > 0 ? Math.log(b) / Math.log(a) || 0 : -(10 ** 100);
}`,gl=`function pos(s1, s2, n) {
    if (s2 === "") return -1;
    var idx = -1;
    var search = 0;
    for (var i = 0; i < n; ++i) {
        idx = s1.indexOf(s2, search);
        if (idx < 0) return -1;
        search = idx + s2.length;
    }
    return idx;
}`,bl=`function right(a, n) {
    return a.substring(a.length - n);
}`,yl=`function round(a, b) {
    var pw = Math.ceil(10 ** b);
    return Math.round(a * pw - Number.EPSILON) / pw || 0;
}`,Sl=`function substr(src, from, length) {
    return src.substring(from, from + length);
}`,wl=`function string(value) {
    return (Math.round(value * 100000) / 100000).toString();
}`,{FLOAT:A,STRING:X,HANDLE:Jt,COLORREF:Tl}=z,vr={argTypes:[A],retType:X,type:"header",path:"string",body:wl},Wl=[["ABS",{argTypes:[A],retType:A,type:"template",template:"Math.abs(#0) || 0"}],["ALLTRIM",{argTypes:[X],retType:X,type:"template",template:"(#0).trim()"}],["AND",{argTypes:[A,A],retType:A,type:"template",template:"(#0) && (#1) ? 1 : 0"}],["ARCCOS",{argTypes:[A],retType:A,type:"header",path:"arccos",body:ll}],["ARCSIN",{argTypes:[A],retType:A,type:"header",path:"arcsin",body:cl}],["ARCTAN",{argTypes:[A],retType:A,type:"template",template:"Math.atan(#0)||0"}],["AVERAGE",{argTypes:[A,A],retType:A,type:"template",template:"(#0) / 2 + (#1) / 2"}],["CHANGE",{argTypes:[X,X,X],retType:X,type:"header",path:"change",body:ul}],["COMPARE",{argTypes:[X,X],retType:A,type:"template",template:"(#0) == (#1) ? 1 : 0"}],["COMPAREI",{argTypes:[X,X,A],retType:A,type:"header",path:"compareI",body:hl}],["COS",{argTypes:[A],retType:A,type:"template",template:"Math.cos(#0) || 0"}],["DEG",{argTypes:[A],retType:A,type:"template",template:"180 * (#0) / Math.PI || 0"}],["DELTA",{argTypes:[A],retType:A,type:"template",template:"(#0) ? 0 : 1"}],["ED",{argTypes:[A],retType:A,type:"template",template:"(#0) > 0 ? 1 : 0"}],["ED",{argTypes:[Jt],retType:A,type:"template",template:"(#0) > 0 ? 1 : 0"}],["EXP",{argTypes:[A],retType:A,type:"template",template:"Math.exp(#0) || 0"}],["FLOAT",{argTypes:[A],retType:A,type:"template",template:"parseFloat(#0) || 0"}],["FLOAT",{argTypes:[X],retType:A,type:"template",template:"parseFloat(#0) || 0"}],["FLOAT",{argTypes:[Jt],retType:A,type:"template",template:"parseFloat(#0) || 0"}],["FLOAT",{argTypes:[Tl],retType:A,type:"template",template:"parseFloat(#0) || 0"}],["GETANGLEBYXY",{argTypes:[A,A],retType:A,type:"header",path:"getAngleByXY",body:pl}],["HANDLE",{argTypes:[A],retType:Jt,type:"template",template:"parseInt(#0) || 0"}],["LEFT",{argTypes:[X,A],retType:X,type:"template",template:"(#0).substring(0, #1)"}],["LENGTH",{argTypes:[X],retType:A,type:"template",template:"(#0).length"}],["LG",{argTypes:[A],retType:A,type:"header",path:"lg",body:dl}],["LIMIT",{argTypes:[A,A,A],retType:A,type:"template",template:"Math.max(#1, Math.min(#2, #0))||0"}],["LN",{argTypes:[A],retType:A,type:"header",path:"ln",body:fl}],["LOG",{argTypes:[A,A],retType:A,type:"header",path:"log",body:ml}],["LOWER",{argTypes:[X],retType:X,type:"template",template:"(#0).toLowerCase()"}],["LTRIM",{argTypes:[X],retType:X,type:"template",template:'(#0).replace(/^\\s+/, "")'}],["MAX",{argTypes:[A,A],retType:A,type:"template",template:"Math.max(#0, #1) || 0"}],["MIN",{argTypes:[A,A],retType:A,type:"template",template:"Math.min(#0, #1) || 0"}],["NOT",{argTypes:[A],retType:A,type:"template",template:"(#0) ? 0 : 1"}],["NOT",{argTypes:[Jt],retType:A,type:"template",template:"(#0) ? 0 : 1"}],["NOTBIN",{argTypes:[A],retType:A,type:"template",template:"#0"}],["OR",{argTypes:[A,A],retType:A,type:"template",template:"(#0) || (#1) ? 1 : 0"}],["POS",{argTypes:[X,X,A],retType:A,type:"header",path:"pos",body:gl}],["RAD",{argTypes:[A],retType:A,type:"template",template:"Math.PI * (#0) / 180 || 0"}],["REPLICATE",{argTypes:[X,A],retType:X,type:"template",template:"(#0).repeat(#1)"}],["RIGHT",{argTypes:[X,A],retType:X,type:"header",path:"right",body:bl}],["RND",{argTypes:[A],retType:A,type:"template",template:"(#0) * Math.random()"}],["ROUND",{argTypes:[A,A],retType:A,type:"header",path:"round",body:yl}],["RTRIM",{argTypes:[X],retType:X,type:"template",template:'(#0).replace(/\\s+$/, "")'}],["SGN",{argTypes:[A],retType:A,type:"template",template:"Math.sign(#0) || 0"}],["SIN",{argTypes:[A],retType:A,type:"template",template:"Math.sin(#0) || 0"}],["SQR",{argTypes:[A],retType:A,type:"template",template:"(#0) ** 2"}],["SQRT",{argTypes:[A],retType:A,type:"template",template:"Math.sqrt(#0) || 0"}],["STRING",vr],["SUBSTR",{argTypes:[X,A,A],retType:X,type:"header",path:"substr",body:Sl}],["SUBSTR",{argTypes:[X,A],retType:X,type:"template",template:"(#0).substring(#1)"}],["TAN",{argTypes:[A],retType:A,type:"template",template:"Math.tan(#0) || 0"}],["TRUNC",{argTypes:[A],retType:A,type:"template",template:"Math.trunc(#0) || 0"}],["UPPER",{argTypes:[X],retType:X,type:"template",template:"(#0).toUpperCase()"}],["XOR",{argTypes:[A,A],retType:A,type:"template",template:"(#0) !== 0 ^ (#1) !== 0"}],["XORBIN",{argTypes:[A,A],retType:A,type:"template",template:"(#0) ^ (#1)"}]],si=(()=>{let u=new Map;return Wl.forEach(([r,e])=>{let t=u.get(r);t||u.set(r,t=[]),t.push(e)}),u})();var ii="v",Zt="c",Qt="s",Pr="n",Ir="o",Ar={[1]:"f",[3]:"i",[4]:"i",[2]:"s"},ni=`
var v = m.map;
var mem = m.memory;
var of = mem.oldFloats;
var nf = mem.newFloats;
var oi = mem.oldInts;
var ni = mem.newInts;
var os = mem.oldStrings;
var ns = mem.newStrings;
`,oi="userFunc",ai="solveEquationsFor";var{FLOAT:B,STRING:ne,HANDLE:Oe,COLORREF:er}=z,Nr=[{name:"^",arg:[B,B],ret:B,text:"#0 ** #1",prior:13},{name:"*",arg:[B,B],ret:B,text:"#0 * #1",prior:12},{name:"/",arg:[B,B],ret:B,text:"#0 / (#1 || Infinity)",prior:12},{name:"%",arg:[B,B],ret:B,text:"#0 % #1",prior:12},{name:"+",arg:[B,B],ret:B,text:"#0 + #1",prior:11},{name:"+",arg:[ne,ne],ret:ne,text:"#0 + #1",prior:11},{name:"+",arg:[ne,B],ret:ne,text:"#0 + string(#1)",prior:11},{name:"+",arg:[B,ne],ret:ne,text:"string(#0) + #1",prior:11},{name:"-",arg:[B,B],ret:B,text:"#0 - #1",prior:11},{name:"<<",arg:[B,B],ret:B,text:"#0 << #1",prior:10},{name:">>",arg:[B,B],ret:B,text:"#0 >> #1",prior:10},{name:">",arg:[B,B],ret:B,text:"+(#0 > #1)",prior:9},{name:">=",arg:[B,B],ret:B,text:"+(#0 >= #1)",prior:9},{name:"<",arg:[B,B],ret:B,text:"+(#0 < #1)",prior:9},{name:"<=",arg:[B,B],ret:B,text:"+(#0 <= #1)",prior:9},{name:">",arg:[ne,ne],ret:B,text:"+(#0 > #1)",prior:9},{name:">=",arg:[ne,ne],ret:B,text:"+(#0 >= #1)",prior:9},{name:"<",arg:[ne,ne],ret:B,text:"+(#0 < #1)",prior:9},{name:"<=",arg:[ne,ne],ret:B,text:"+(#0 <= #1)",prior:9},{name:"==",arg:[B,B],ret:B,text:"+(#0 == #1)",prior:8},{name:"==",arg:[ne,ne],ret:B,text:"+(#0 == #1)",prior:8},{name:"==",arg:[Oe,Oe],ret:B,text:"+(#0 == #1)",prior:8},{name:"==",arg:[er,er],ret:B,text:"+(#0 == #1)",prior:8},{name:"!=",arg:[B,B],ret:B,text:"+(#0 != #1)",prior:8},{name:"!=",arg:[ne,ne],ret:B,text:"+(#0 != #1)",prior:8},{name:"!=",arg:[Oe,Oe],ret:B,text:"+(#0 != #1)",prior:8},{name:"!=",arg:[er,er],ret:B,text:"+(#0 != #1)",prior:8},{name:"&",arg:[B,B],ret:B,text:"#0 & #1",prior:7},{name:"|",arg:[B,B],ret:B,text:"#0 | #1",prior:5},{name:"&&",arg:[B,B],ret:B,text:"+Boolean(#0 && #1)",prior:4},{name:"&&",arg:[Oe,Oe],ret:Oe,text:"+Boolean(#0 && #1)",prior:4},{name:"||",arg:[B,B],ret:B,text:"+Boolean(#0 || #1)",prior:3},{name:"||",arg:[Oe,Oe],ret:Oe,text:"+Boolean(#0 || #1)",prior:3}],li=Array.from(new ye(Nr.map(u=>[u.prior,u.name]))).sort((u,r)=>r[0]-u[0]).map(u=>Array.from(u[1]));var tr=class{constructor(){a(this,"m",new Map)}createVar(r,e,t){let s=r.toLowerCase(),i=this.m.get(s);if(i&&i[0].type!==e)throw Error(`\u041F\u0435\u0440\u0435\u043C\u0435\u043D\u043D\u0430\u044F \u0443\u0436\u0435 \u043E\u0431\u044A\u044F\u0432\u043B\u0435\u043D\u0430: ${r}`);let o={name:r,type:e,attrib:t||void 0};this.m.set(s,[o,this.m.size])}makeInEquation(r){let e=r.toLowerCase(),t=this.m.get(e);if(!t)throw Error(`\u041D\u0435\u0438\u0437\u0432\u0435\u0441\u0442\u043D\u0430\u044F \u043F\u0435\u0440\u0435\u043C\u0435\u043D\u043D\u0430\u044F: ${r}`);if(t[0].type!==1)throw Error(`\u041F\u0435\u0440\u0435\u043C\u0435\u043D\u043D\u0430\u044F \u0443\u0440\u0430\u0432\u043D\u0435\u043D\u0438\u044F ${r} \u043D\u0435 \u0438\u043C\u0435\u0435\u0442 \u0442\u0438\u043F FLOAT`);t[0].inEquation=!0}setAsReturn(r){var s;let e=r.toLowerCase(),t=this.m.get(e);if(!t)throw Error(`\u041D\u0435\u0438\u0437\u0432\u0435\u0441\u0442\u043D\u0430\u044F \u043F\u0435\u0440\u0435\u043C\u0435\u043D\u043D\u0430\u044F: ${r}`);t[0].attrib=((s=t[0].attrib)!=null?s:0)|1024}getFloatVar(r){let e=r.toLowerCase(),t=this.m.get(e);if(!t)throw Error(`\u041D\u0435\u0438\u0437\u0432\u0435\u0441\u0442\u043D\u0430\u044F \u043F\u0435\u0440\u0435\u043C\u0435\u043D\u043D\u0430\u044F: ${r}`);if(t[0].type!==1)throw Error(`\u041F\u0435\u0440\u0435\u043C\u0435\u043D\u043D\u0430\u044F \u0443\u0440\u0430\u0432\u043D\u0435\u043D\u0438\u044F ${r} \u043D\u0435 \u0438\u043C\u0435\u0435\u0442 \u0442\u0438\u043F FLOAT`);return`$${e}`}_getOrCreateVar(r,e){let t=r.toLowerCase(),s=this.m.get(t);if(s)return[t,s[0]];let i={name:r,type:e};return this.m.set(t,[i,this.m.size]),[t,i]}getOrCreateVar(r,e,t=1){let[s,{type:i}]=this._getOrCreateVar(e,t),o=`${r?Pr:Ir}${Ar[i]}`,l=`$${s}`;return{text:`${o}[${l}]`,type:i}}derefer(r,e=1){let t=r.first;if(t.type!=="var"||r.rest.length>0)throw Error("\u0414\u043E\u043B\u0436\u043D\u043E \u0431\u044B\u0442\u044C \u0438\u043C\u044F \u043F\u0435\u0440\u0435\u043C\u0435\u043D\u043D\u043E\u0439");let[s,{type:i}]=this._getOrCreateVar(t.name,e),o=`${t.isNew?Pr:Ir}${Ar[i]}`,l=`$${s}`;return[o,l]}result(){return[...this.m.values()].sort((r,e)=>r[1]-e[1]).map(r=>r[0])}};function pi(u,r){var h;let e=r.args.map(p=>De(u,p)),t=r.name.toUpperCase(),s=si.get(t);if(s){let p=s.find(({argTypes:T})=>T.length===e.length&&T.every((v,_)=>v===e[_].type));if(!p)throw Error(`\u041D\u0435\u043A\u043E\u0440\u0440\u0435\u043A\u0442\u043D\u0430\u044F \u0441\u0438\u0433\u043D\u0430\u0442\u0443\u0440\u0430 \u0444\u0443\u043D\u043A\u0446\u0438\u0438 ${r.name}(${e.map(T=>z[T.type])}).
\u0412\u043E\u0437\u043C\u043E\u0436\u043D\u044B\u0435 \u0432\u0430\u0440\u0438\u0430\u043D\u0442\u044B:
`+s.map(T=>`${r.name}(${T.argTypes.map(v=>z[v])})`).join(`
`));let b=e.map(T=>T.text),y;return p.type==="header"?(u.headerFuncs.add(p),y=`${p.path}(${b})`):y=p.template.replace(/#(\d)/g,(T,v)=>b[v]),{text:y,type:p.retType}}if(t==="EXIT"){if(e.length>0)throw Error(`${r.name}: \u043E\u0436\u0438\u0434\u0430\u043B\u043E\u0441\u044C 0 \u0430\u0440\u0433\u0443\u043C\u0435\u043D\u0442\u043E\u0432, \u043F\u043E\u043B\u0443\u0447\u0435\u043D\u043E ${e.length}`);return{text:"return",type:null}}let i=(h=u.funcTable)==null?void 0:h.get(t);if(!i)throw Error(`\u0424\u0443\u043D\u043A\u0446\u0438\u044F \u043D\u0435 \u0441\u0443\u0449\u0435\u0441\u0442\u0432\u0443\u0435\u0442: "${r.name}"`);if(i.type==="method"){let p=i.overloads.find(({argTypes:T})=>{let v=-1;return T.every((I,R)=>{if(typeof I=="number"){if(R>=e.length)return!1;v=R;let N=I&Pe-1;return e[R].type===N}v=e.length-1;let W=e.slice(R);return W.length%I.length===0&&W.every((N,j)=>N.type===I[j%I.length])})&&v===e.length-1});if(!p){let T=`${r.name}(${e.map(_=>z[_.type])})`,v=i.overloads.map(_=>{let I=_.argTypes.map(R=>typeof R=="number"?(R&Pe?"&":"")+z[R&Pe-1]:`[${R.map(W=>z[W])}]`);return` - ${r.name}(${I})`});throw Error(`\u041D\u0435\u043A\u043E\u0440\u0440\u0435\u043A\u0442\u043D\u0430\u044F \u0441\u0438\u0433\u043D\u0430\u0442\u0443\u0440\u0430 \u0444\u0443\u043D\u043A\u0446\u0438\u0438 ${T}.
\u0412\u043E\u0437\u043C\u043E\u0436\u043D\u044B\u0435 \u0432\u0430\u0440\u0438\u0430\u043D\u0442\u044B:
${v.join(`;
`)}`)}let b=e.map((T,v)=>{let _=p.argTypes[v];return typeof _=="number"&&_&Pe?u.vars.derefer(r.args[v]):T.text});return{text:`${Zt}.${p.path}(${p.passState?[Qt,...b]:b})`,type:p.retType}}if(i.argTypes.length!==e.length||i.argTypes.some((p,b)=>p!==e[b].type))throw Error(`${r.name} \u043F\u0440\u0438\u043D\u0438\u043C\u0430\u0435\u0442 [${i.argTypes.map(p=>z[p])}], \u043F\u043E\u043B\u0443\u0447\u0435\u043D\u043E [${e.map(p=>z[p.type])}]`);let o=e.map(p=>p.text);return{text:`${Zt}.${oi}(${[Qt,`"${i.name}"`,`[${o}]`]})`,type:i.retType}}function El(u){return`t${u.tmpVarCount++}`}function rr(u,r){var e;switch(r.isNew&&r.type!=="var"&&u.bugs.push("\u041F\u0440\u0438\u043C\u0435\u043D\u0435\u043D\u0438\u0435 \u043E\u043F\u0435\u0440\u0430\u0442\u043E\u0440\u0430 '~' \u043D\u0435 \u043A \u043F\u0435\u0440\u0435\u043C\u0435\u043D\u043D\u043E\u0439"),r.type){case"float":return{text:r.value,type:1};case"handle":return{text:r.value,type:3};case"string":return{text:"`"+r.value.replace(/[`$\\]/g,"\\$&")+"`",type:2};case"var":{let t=(e=Te[r.name.toUpperCase()])==null?void 0:e.toString();return t?{text:t,type:1}:u.vars.getOrCreateVar(r.isNew,r.name)}case"call":{let t=El(u),s=pi(u,r);if(!s.type)throw Error(`\u0424\u0443\u043D\u043A\u0446\u0438\u044F ${r.name} \u043D\u0435 \u0432\u043E\u0437\u0432\u0440\u0430\u0449\u0430\u0435\u0442 \u0437\u043D\u0430\u0447\u0435\u043D\u0438\u044F`);return u.lines.push(`var ${t}=${s.text};`),{text:t,type:s.type}}case"-":case"!":{let t=rr(u,r.op);if(t.type!==1)throw Error(`\u041E\u043F\u0435\u0440\u0430\u0442\u043E\u0440 "${r.type}" \u043D\u0435 \u043F\u0440\u0438\u043C\u0435\u043D\u0438\u043C \u043A ${z[t.type]}`);return{text:`(${r.type}${t.text})`,type:t.type}}case"subexpr":{let t=De(u,r.expr);return{text:`(${t.text})`,type:t.type}}}}function De(u,{first:r,rest:e}){if(!e.length)return rr(u,r);let t=[{type:"decl",op:r},...Ce(e.map(i=>[i.action,{type:"decl",op:i.operand}]))];li.forEach(i=>{for(;;){let o=t.findIndex(_=>typeof _=="string"&&i.includes(_));if(o<0)break;let l=t[o],h=t[o-1],p=t[o+1],b=h.type=="decl"?rr(u,h.op):h.res,y=p.type=="decl"?rr(u,p.op):p.res,T=Nr.find(({name:_,arg:I})=>_===l&&I[0]===b.type&&I[1]===y.type);if(!T)throw Error(`\u041E\u043F\u0435\u0440\u0430\u0442\u043E\u0440 '${l}' \u043D\u0435\u043F\u0440\u0438\u043C\u0435\u043D\u0438\u043C \u043A '${z[b.type]}', '${z[y.type]}'`);let v={text:T.text.replace(/#\d/g,_=>(_==="#0"?b:y).text),type:T.ret};t.splice(o-1,3,{type:"parsed",res:v})}});let s=t[0];if(typeof s!="object"||s.type!=="parsed")throw Error("\u041E\u0448\u0438\u0431\u043A\u0430 \u0440\u0430\u0437\u0431\u043E\u0440\u0430 \u0432\u044B\u0440\u0430\u0436\u0435\u043D\u0438\u044F");return s.res}function ci(u){u.tmpVarCount=0}function ui(u,r,e){if(r!==e)throw Error(`"${u}" \u0438\u043C\u0435\u0435\u0442 \u0442\u0438\u043F ${z[r]}, \u043D\u043E \u043F\u0440\u0430\u0432\u043E\u0435 \u0432\u044B\u0440\u0430\u0436\u0435\u043D\u0438\u0435 \u0432\u043E\u0437\u0432\u0440\u0430\u0449\u0430\u0435\u0442 ${z[e]}`)}function hi(u,r){switch(ci(u),r.type){case":=":{let t=De(u,r.expr),s=u.vars.getOrCreateVar(!0,r.to,t.type);ui(r.to,s.type,t.type),u.lines.push(`${s.text} = ${t.text};`);break}case"callChain":{r.functions.forEach(t=>{ci(u);let s=pi(u,t);u.lines.push(`${s.text};`)});break}case"if":{u.b.pushBlock({canBreak:!1,expect:"endif",hasElse:!1});let t=De(u,r.expr);u.lines.push(`if (${t.text}) {`);break}case"else":{let t=u.b.lastBlock();if((t==null?void 0:t.expect)!=="endif"||t.hasElse)throw Error("else \u0434\u043E\u043B\u0436\u0435\u043D \u043D\u0430\u0445\u043E\u0434\u0438\u0442\u044C\u0441\u044F \u043F\u043E\u0441\u043B\u0435 if");t.hasElse=!0,u.lines.push("} else {");break}case"endif":{u.b.popBlock("endif"),u.lines.push("}");break}case"varsDec":{let{datatype:t,modifiers:s,names:i}=r,o;switch(t){case"FLOAT":case"INTEGER":o=1;break;case"HANDLE":o=3;break;case"STRING":o=2;break;case"COLORREF":o=4;break}let l=(s.includes("LOCAL")?2:0)|(s.includes("PARAMETER")?512:0);i.forEach(h=>u.vars.createVar(h,o,l));break}case"while":{u.b.pushBlock({expect:"endwhile",canBreak:!0});let t=`g${++u.whileGuardCount}`;u.lines.push(`var ${t} = 0;`),u.lines.push("while (true) {"),u.lines.push(`if (++${t} > 100000) throw Error("\u0411\u0435\u0441\u043A\u043E\u043D\u0435\u0447\u043D\u044B\u0439 \u0446\u0438\u043A\u043B (100000 \u0438\u0442\u0435\u0440\u0430\u0446\u0438\u0439)");`);let s=De(u,r.expr);u.lines.push(`if (!(${s.text})) break;`);break}case"endwhile":{u.b.popBlock("endwhile"),u.lines.push("}");break}case"do":{u.b.pushBlock({expect:"until",canBreak:!0}),u.lines.push("do {");break}case"until":{u.b.popBlock("until");let t=De(u,r.expr);u.lines.push(`} while (${t.text});`);break}case"switch":{u.b.pushBlock({expect:"endswitch",canBreak:!0,caseCount:0}),u.lines.push("do { //switch");break}case"endswitch":{let t=u.b.popBlock("endswitch");if(!t.caseCount)throw Error("\u041E\u0436\u0438\u0434\u0430\u043B\u043E\u0441\u044C case");for(let s=0;s<t.caseCount;++s)u.lines.push("}");u.lines.push("} while (false); //endswitch");break}case"case":{let t=u.b.lastBlock();if((t==null?void 0:t.expect)!=="endswitch")throw Error("case \u0434\u043E\u043B\u0436\u0435\u043D \u043D\u0430\u0445\u043E\u0434\u0438\u0442\u044C\u0441\u044F \u0432\u043D\u0443\u0442\u0440\u0438 \u0431\u043B\u043E\u043A\u0430 switch");t.caseCount&&u.lines.push("} else {"),++t.caseCount;let s=De(u,r.expr);u.lines.push(`if (${s.text}) { //case`);break}case"default":{let t=u.b.lastBlock();if((t==null?void 0:t.expect)!=="endswitch")throw Error("default \u0434\u043E\u043B\u0436\u0435\u043D \u043D\u0430\u0445\u043E\u0434\u0438\u0442\u044C\u0441\u044F \u0432\u043D\u0443\u0442\u0440\u0438 \u0431\u043B\u043E\u043A\u0430 switch");u.lines.push("} else { //default");break}case"break":u.lines.push(u.b.haveABreakHaveAKitKat());break;case"=":{let t=k(G({},u),{lines:[]}),s=De(t,r.rhs),i=De(t,r.lhs);if(s.type!==1||i.type!==1)throw Error("\u0412 \u0443\u0440\u0430\u0432\u043D\u0435\u043D\u0438\u0438 \u0434\u043E\u043F\u0443\u0441\u043A\u0430\u0435\u0442\u0441\u044F \u0438\u0441\u043F\u043E\u043B\u044C\u0437\u043E\u0432\u0430\u043D\u0438\u0435 \u0442\u043E\u043B\u044C\u043A\u043E \u0447\u0438\u0441\u0435\u043B \u0442\u0438\u043F\u0430 FLOAT");t.lines.push(`return ${s.text} - (${i.text});`),u.equations.push(t.lines);break}case"::=":{let t=k(G({},u),{lines:[]}),s=De(t,r.expr),i=u.vars.getOrCreateVar(!0,r.to,s.type);ui(r.to,i.type,s.type),t.lines.push(`${i.text} = ${s.text};`),u.defers.push(t.lines);break}case"eqResult":{if(r.deferred)r.vars.forEach(t=>u.vars.makeInEquation(t));else{let t=r.vars.map(i=>u.vars.getFloatVar(i)),s=[Qt,`[${t}]`];u.lines.push(`${Zt}.${ai}(${s});`)}break}case"function":{u.hasFuncDecl=!0;break}case"return":{u.vars.setAsReturn(r.to);break}default:throw Error(`\u041D\u0435\u0438\u0437\u0432\u0435\u0441\u0442\u043D\u044B\u0439 \u043E\u043F\u0435\u0440\u0430\u0442\u043E\u0440: "${r.type}"`)}}function $l(u,r,e){var R;let t=u.vars.result(),{lines:s,bugs:i,equations:o,defers:l}=u;if(s.length===0&&o.length===0&&l.length===0)return{bugs:i,vars:t,mainText:"",equationsTexts:[],defersTexts:[]};let h=[...u.headerFuncs].map(W=>W.body).join(`
`),p=t.map((W,N)=>`var $${W.name.toLowerCase()} = ${ii}[${N}];`).join(`
`),b=ni+`
`+h+`
`+p+`

`,y=r?`//# sourceURL=_transpiled/${r}`:"",T=(R=e==null?void 0:e.split(`
`).map(W=>"// "+W).join(`
`))!=null?R:"",v=s.length?T+b+s.join(`
`)+y:"",_=o.map((W,N)=>b+W.join(`
`)+(y&&`${y}_eq_${N}`)),I=l.map((W,N)=>b+W.join(`
`)+(y&&`${y}_defer_${N}`));return{bugs:i,vars:t,mainText:v,equationsTexts:_,defersTexts:I}}function di(u,{funcTable:r,sourceURL:e,comment:t}={}){let s={funcTable:r,vars:new tr,b:new zt,lines:[],defers:[],equations:[],hasFuncDecl:!1,bugs:[],tmpVarCount:0,whileGuardCount:0,headerFuncs:new Set([vr])};u.forEach((o,l)=>{try{hi(s,o);let h=o.then;for(;h;)hi(s,h),h=h.then}catch(h){throw h instanceof Error?Error(`\u0421\u0442\u0440\u043E\u043A\u0430 ${l+1}: ${h.message}`):h}});let i=s.b.lastBlock();if(i)throw Error(`\u0421\u0442\u0440\u043E\u043A\u0430 ${u.length}: \u043E\u0436\u0438\u0434\u0430\u043B\u043E\u0441\u044C ${i.expect}`);return $l(s,e,t)}var Rr="'",Gr='"';function fi(u){let r="",e=null;for(let t=0;t<u.length;++t){let s=u[t];if(s===Rr&&e!==Gr?e=e?null:Rr:s===Gr&&e!==Rr&&(e=e?null:Gr),e){r+=s;continue}if(s==="/"){let i=u[t+1];if(i==="*"){for(t+=2;t<u.length&&(u[t]!=="*"||u[t+1]!=="/");)++t;++t;continue}if(i==="/"){for(++t;t<u.length&&u[++t]!==`
`;);r[r.length-1]!==`
`&&(r+=`
`);continue}}if(s===";"||s===`
`){r[r.length-1]!==`
`&&(r+=`
`);continue}if(s==="\r"){u[t+1]===`
`&&++t,r[r.length-1]!==`
`&&(r+=`
`);continue}r+=s}return r[r.length-1]===`
`?r:r+`
`}function xl(u,r){function e(){this.constructor=u}e.prototype=r.prototype,u.prototype=new e}function Ze(u,r,e,t){this.message=u,this.expected=r,this.found=e,this.location=t,this.name="SyntaxError",typeof Error.captureStackTrace=="function"&&Error.captureStackTrace(this,Ze)}xl(Ze,Error);Ze.buildMessage=function(u,r){var e={literal:function(p){return'"'+s(p.text)+'"'},class:function(p){var b="",y;for(y=0;y<p.parts.length;y++)b+=p.parts[y]instanceof Array?i(p.parts[y][0])+"-"+i(p.parts[y][1]):i(p.parts[y]);return"["+(p.inverted?"^":"")+b+"]"},any:function(p){return"any character"},end:function(p){return"end of input"},other:function(p){return p.description}};function t(p){return p.charCodeAt(0).toString(16).toUpperCase()}function s(p){return p.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(b){return"\\x0"+t(b)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(b){return"\\x"+t(b)})}function i(p){return p.replace(/\\/g,"\\\\").replace(/\]/g,"\\]").replace(/\^/g,"\\^").replace(/-/g,"\\-").replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(b){return"\\x0"+t(b)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(b){return"\\x"+t(b)})}function o(p){return e[p.type](p)}function l(p){var b=new Array(p.length),y,T;for(y=0;y<p.length;y++)b[y]=o(p[y]);if(b.sort(),b.length>0){for(y=1,T=1;y<b.length;y++)b[y-1]!==b[y]&&(b[T]=b[y],T++);b.length=T}switch(b.length){case 1:return b[0];case 2:return b[0]+" or "+b[1];default:return b.slice(0,-1).join(", ")+", or "+b[b.length-1]}}function h(p){return p?'"'+s(p)+'"':"end of input"}return"Expected "+l(u)+" but "+h(r)+" found."};function Ol(u,r){r=r!==void 0?r:{};var e={},t={Code:Ss},s=Ss,i=function(c){return c},o=function(c){return c.filter(g=>g)},l=Q("variable name"),h=function(c){return{type:"var",name:c}},p=",",b=H(",",!1),y=function(c){return c},T=Q("function call"),v="(",_=H("(",!1),I=")",R=H(")",!1),W=function(c,g){return{type:"call",name:c,args:g}},N="-",j=H("-",!1),q="!",te=H("!",!1),we=Q("!<operand> or -<operand>"),_e=function(c,g){return{type:c,op:g}},st=Q("(<expression>)"),Oi=function(c){return{type:"subexpr",expr:c}},Di=Q("operand"),_i="~",vi=H("~",!1),Pi=function(c,g){return k(G({},g),{isNew:!!c})},Ii="^",Ai=H("^",!1),Ni="*",Ri=H("*",!1),Gi="/",ki=H("/",!1),Mi="%",Li=H("%",!1),Bi="+",Vi=H("+",!1),jr=">=",Ui=H(">=",!1),ji=">",Hi=H(">",!1),Hr="<=",Fi=H("<=",!1),Ci="<",Ki=H("<",!1),Fr="==",qi=H("==",!1),Cr="!=",Xi=H("!=",!1),Kr="&&",Yi=H("&&",!1),zi="&",Ji=H("&",!1),qr="||",Zi=H("||",!1),Qi="|",en=H("|",!1),tn=Q("expression"),Xr=function(c,g,w){return{action:g,operand:w}},rn=function(c,g){return{first:c,rest:g}},Yr=function(c,g){return g},sn=function(c,g){return[c].concat(g)},zr=function(c,g){return g},nn=function(c,g,w){return{type:"varsDec",datatype:c,modifiers:g,names:w}},on=Q("assignment operator"),Jr=":=",an=H(":=",!1),Zr="::=",ln=H("::=",!1),cn=function(c,g,w){return{type:g,to:c,expr:w}},un=Q("equality operator"),Qr="=",es=H("=",!1),hn=function(c,g,w){return{type:g,lhs:c,rhs:w}},pn=Q("immediately equation result"),je=function(c,g){return g},ts="?",rs=H("?",!1),dn=function(c,g){return{type:"eqResult",deferred:!1,vars:[c].concat(g)}},fn=Q("deferred equation result"),mn=function(c,g){return{type:"eqResult",deferred:!0,vars:[c].concat(g)}},gn=Q("function call chain"),bn=function(c,g){return{type:"callChain",functions:[c].concat(g)}},ss=Q("( <expression> )"),is=function(c){return c},yn=Q("if(<condition>)"),Sn="if",wn=H("if",!0),Tn=function(c){return{type:"if",expr:c}},Wn=Q("while(<condition>)"),En="while",$n=H("while",!0),xn=function(c){return{type:"while",expr:c}},On=Q("until(<condition>)"),Dn="until",_n=H("until",!0),vn=function(c){return{type:"until",expr:c}},Pn=Q("case(<condition>)"),In="case",An=H("case",!0),Nn=function(c,g){return{type:"case",expr:c,then:g}},Rn="else",Gn=H("else",!0),kn=function(c){return{type:"else",then:c}},Mn="endif",Ln=H("endif",!0),Bn=function(c){return{type:"endif",then:c}},Vn="break",Un=H("break",!0),jn=function(){return{type:"break"}},Hn="endwhile",Fn=H("endwhile",!0),Cn=function(){return{type:"endwhile"}},Kn="do",qn=H("do",!0),Xn=function(){return{type:"do"}},Yn="endswitch",zn=H("endswitch",!0),Jn=function(){return{type:"endswitch"}},Zn="switch",Qn=H("switch",!0),eo=function(){return{type:"switch"}},to="default",ro=H("default",!0),so=function(c){return{type:"default",then:c}},io="function",no=H("function",!0),oo=function(){return{type:"function"}},ao=Q("return <var name>"),lo="return",co=H("return",!0),uo=function(c){return{type:"return",to:c}},ho="handle",po=H("HANDLE",!0),fo=function(){return"HANDLE"},mo="string",go=H("STRING",!0),bo=function(){return"STRING"},yo="float",So=H("FLOAT",!0),wo=function(){return"FLOAT"},To="colorref",Wo=H("COLORREF",!0),Eo=function(){return"COLORREF"},$o="integer",xo=H("INTEGER",!0),Oo=function(){return"INTEGER"},Do="local",_o=H("LOCAL",!0),vo=function(){return"LOCAL"},Po="nosave",Io=H("NOSAVE",!0),Ao=function(){return"NOSAVE"},No="parameter",Ro=H("PARAMETER",!0),Go=function(){return"PARAMETER"},ns=/^[_a-z\u0430-\u044F0-9]/i,os=Ne(["_",["a","z"],["\u0430","\u044F"],["0","9"]],!1,!0),ko=Q("function name"),ut=/^[0-9]/,ht=Ne([["0","9"]],!1,!1),Mo=".",Lo=H(".",!1),Bo=/^[eE]/,Vo=Ne(["e","E"],!1,!1),Uo=/^[+\-]/,jo=Ne(["+","-"],!1,!1),Ho=Q("float"),Fo=function(c){return{type:"float",value:c}},Co=Q("handle"),Ko="#",qo=H("#",!1),Xo=function(c){return{type:"handle",value:c.length>0?c:"0"}},as="'",ls=H("'",!1),cs=/^[^']/,us=Ne(["'"],!0,!1),hs='"',ps=H('"',!1),ds=/^[^"]/,fs=Ne(['"'],!0,!1),Yo=function(c){return{type:"string",value:c[1]}},zo=Q("space or tab"),Jo=/^[ \t]/,Zo=Ne([" ","	"],!1,!1),Qo=Q("new line"),ea=`
`,ta=H(`
`,!1),ra=Q("whitespace"),ms=/^[ \t\n\r]/,gs=Ne([" ","	",`
`,"\r"],!1,!1),f=0,V=0,pt=[{line:1,column:1}],xe=0,fr=[],x=0,dt;if("startRule"in r){if(!(r.startRule in t))throw new Error(`Can't start parsing from rule "`+r.startRule+'".');s=t[r.startRule]}function vl(){return u.substring(V,f)}function Pl(){return it(V,f)}function Il(c,g){throw g=g!==void 0?g:it(V,f),ys([Q(c)],u.substring(V,f),g)}function Al(c,g){throw g=g!==void 0?g:it(V,f),ia(c,g)}function H(c,g){return{type:"literal",text:c,ignoreCase:g}}function Ne(c,g,w){return{type:"class",parts:c,inverted:g,ignoreCase:w}}function Nl(){return{type:"any"}}function sa(){return{type:"end"}}function Q(c){return{type:"other",description:c}}function bs(c){var g=pt[c],w;if(g)return g;for(w=c-1;!pt[w];)w--;for(g=pt[w],g={line:g.line,column:g.column};w<c;)u.charCodeAt(w)===10?(g.line++,g.column=1):g.column++,w++;return pt[c]=g,g}function it(c,g){var w=bs(c),S=bs(g);return{start:{offset:c,line:w.line,column:w.column},end:{offset:g,line:S.line,column:S.column}}}function P(c){f<xe||(f>xe&&(xe=f,fr=[]),fr.push(c))}function ia(c,g){return new Ze(c,null,null,g)}function ys(c,g,w){return new Ze(Ze.buildMessage(c,g),c,g,w)}function Ss(){var c,g,w,S,O,$,L;for(c=f,g=[],w=f,S=[],O=M();O!==e;)S.push(O),O=M();if(S!==e)if(O=mr(),O===e&&(O=null),O!==e){for($=[],L=M();L!==e;)$.push(L),L=M();$!==e?(L=Es(),L!==e?(V=w,S=i(O),w=S):(f=w,w=e)):(f=w,w=e)}else f=w,w=e;else f=w,w=e;for(;w!==e;){for(g.push(w),w=f,S=[],O=M();O!==e;)S.push(O),O=M();if(S!==e)if(O=mr(),O===e&&(O=null),O!==e){for($=[],L=M();L!==e;)$.push(L),L=M();$!==e?(L=Es(),L!==e?(V=w,S=i(O),w=S):(f=w,w=e)):(f=w,w=e)}else f=w,w=e;else f=w,w=e}return g!==e&&(V=c,g=o(g)),c=g,c}function na(){var c,g;return x++,c=f,g=be(),g!==e&&(V=c,g=h(g)),c=g,x--,c===e&&(g=e,x===0&&P(l)),c}function ws(){var c,g,w,S,O;for(c=f,g=[],w=M();w!==e;)g.push(w),w=M();if(g!==e)if(w=Me(),w!==e){for(S=[],O=M();O!==e;)S.push(O),O=M();S!==e?(u.charCodeAt(f)===44?(O=p,f++):(O=e,x===0&&P(b)),O===e&&(O=null),O!==e?(V=c,g=y(w),c=g):(f=c,c=e)):(f=c,c=e)}else f=c,c=e;else f=c,c=e;return c}function ft(){var c,g,w,S,O,$,L,U;if(x++,c=f,g=Na(),g!==e){for(w=[],S=M();S!==e;)w.push(S),S=M();if(w!==e)if(u.charCodeAt(f)===40?(S=v,f++):(S=e,x===0&&P(_)),S!==e){for(O=[],$=M();$!==e;)O.push($),$=M();if(O!==e){for($=[],L=ws();L!==e;)$.push(L),L=ws();if($!==e){for(L=[],U=M();U!==e;)L.push(U),U=M();L!==e?(u.charCodeAt(f)===41?(U=I,f++):(U=e,x===0&&P(R)),U!==e?(V=c,g=W(g,$),c=g):(f=c,c=e)):(f=c,c=e)}else f=c,c=e}else f=c,c=e}else f=c,c=e;else f=c,c=e}else f=c,c=e;return x--,c===e&&(g=e,x===0&&P(T)),c}function oa(){var c;return u.charCodeAt(f)===45?(c=N,f++):(c=e,x===0&&P(j)),c===e&&(u.charCodeAt(f)===33?(c=q,f++):(c=e,x===0&&P(te))),c}function aa(){var c,g,w,S;if(x++,c=f,g=oa(),g!==e){for(w=[],S=M();S!==e;)w.push(S),S=M();w!==e?(S=mt(),S!==e?(V=c,g=_e(g,S),c=g):(f=c,c=e)):(f=c,c=e)}else f=c,c=e;return x--,c===e&&(g=e,x===0&&P(we)),c}function la(){var c,g,w,S,O,$;if(x++,c=f,u.charCodeAt(f)===40?(g=v,f++):(g=e,x===0&&P(_)),g!==e){for(w=[],S=M();S!==e;)w.push(S),S=M();if(w!==e)if(S=Me(),S!==e){for(O=[],$=M();$!==e;)O.push($),$=M();O!==e?(u.charCodeAt(f)===41?($=I,f++):($=e,x===0&&P(R)),$!==e?(V=c,g=Oi(S),c=g):(f=c,c=e)):(f=c,c=e)}else f=c,c=e;else f=c,c=e}else f=c,c=e;return x--,c===e&&(g=e,x===0&&P(st)),c}function mt(){var c,g,w,S;if(x++,c=f,u.charCodeAt(f)===126?(g=_i,f++):(g=e,x===0&&P(vi)),g===e&&(g=null),g!==e){for(w=[],S=M();S!==e;)w.push(S),S=M();w!==e?(S=aa(),S===e&&(S=ka(),S===e&&(S=Ma(),S===e&&(S=La(),S===e&&(S=ft(),S===e&&(S=na(),S===e&&(S=la())))))),S!==e?(V=c,g=Pi(g,S),c=g):(f=c,c=e)):(f=c,c=e)}else f=c,c=e;return x--,c===e&&(g=e,x===0&&P(Di)),c}function Ts(){var c;return u.charCodeAt(f)===94?(c=Ii,f++):(c=e,x===0&&P(Ai)),c===e&&(u.charCodeAt(f)===42?(c=Ni,f++):(c=e,x===0&&P(Ri)),c===e&&(u.charCodeAt(f)===47?(c=Gi,f++):(c=e,x===0&&P(ki)),c===e&&(u.charCodeAt(f)===37?(c=Mi,f++):(c=e,x===0&&P(Li)),c===e&&(u.charCodeAt(f)===43?(c=Bi,f++):(c=e,x===0&&P(Vi)),c===e&&(u.charCodeAt(f)===45?(c=N,f++):(c=e,x===0&&P(j)),c===e&&(u.substr(f,2)===jr?(c=jr,f+=2):(c=e,x===0&&P(Ui)),c===e&&(u.charCodeAt(f)===62?(c=ji,f++):(c=e,x===0&&P(Hi)),c===e&&(u.substr(f,2)===Hr?(c=Hr,f+=2):(c=e,x===0&&P(Fi)),c===e&&(u.charCodeAt(f)===60?(c=Ci,f++):(c=e,x===0&&P(Ki)),c===e&&(u.substr(f,2)===Fr?(c=Fr,f+=2):(c=e,x===0&&P(qi)),c===e&&(u.substr(f,2)===Cr?(c=Cr,f+=2):(c=e,x===0&&P(Xi)),c===e&&(u.substr(f,2)===Kr?(c=Kr,f+=2):(c=e,x===0&&P(Yi)),c===e&&(u.charCodeAt(f)===38?(c=zi,f++):(c=e,x===0&&P(Ji)),c===e&&(u.substr(f,2)===qr?(c=qr,f+=2):(c=e,x===0&&P(Zi)),c===e&&(u.charCodeAt(f)===124?(c=Qi,f++):(c=e,x===0&&P(en))))))))))))))))),c}function Me(){var c,g,w,S,O,$,L,U;if(x++,c=f,g=mt(),g!==e){for(w=[],S=f,O=[],$=M();$!==e;)O.push($),$=M();if(O!==e)if($=Ts(),$!==e){for(L=[],U=M();U!==e;)L.push(U),U=M();L!==e?(U=mt(),U!==e?(V=S,O=Xr(g,$,U),S=O):(f=S,S=e)):(f=S,S=e)}else f=S,S=e;else f=S,S=e;for(;S!==e;){for(w.push(S),S=f,O=[],$=M();$!==e;)O.push($),$=M();if(O!==e)if($=Ts(),$!==e){for(L=[],U=M();U!==e;)L.push(U),U=M();L!==e?(U=mt(),U!==e?(V=S,O=Xr(g,$,U),S=O):(f=S,S=e)):(f=S,S=e)}else f=S,S=e;else f=S,S=e}w!==e?(V=c,g=rn(g,w),c=g):(f=c,c=e)}else f=c,c=e;return x--,c===e&&(g=e,x===0&&P(tn)),c}function ca(){var c,g,w,S,O,$,L,U;if(c=f,g=be(),g!==e){for(w=[],S=f,O=ce(),O!==e?(u.charCodeAt(f)===44?($=p,f++):($=e,x===0&&P(b)),$!==e?(L=ce(),L!==e?(U=be(),U!==e?(V=S,O=Yr(g,U),S=O):(f=S,S=e)):(f=S,S=e)):(f=S,S=e)):(f=S,S=e);S!==e;)w.push(S),S=f,O=ce(),O!==e?(u.charCodeAt(f)===44?($=p,f++):($=e,x===0&&P(b)),$!==e?(L=ce(),L!==e?(U=be(),U!==e?(V=S,O=Yr(g,U),S=O):(f=S,S=e)):(f=S,S=e)):(f=S,S=e)):(f=S,S=e);w!==e?(V=c,g=sn(g,w),c=g):(f=c,c=e)}else f=c,c=e;return c}function ua(){var c,g,w,S,O,$,L,U,pe;if(c=f,g=Aa(),g!==e){if(w=[],S=M(),S!==e)for(;S!==e;)w.push(S),S=M();else w=e;if(w!==e)if(S=ce(),S!==e){if(O=[],$=f,L=Ws(),L!==e){if(U=[],pe=M(),pe!==e)for(;pe!==e;)U.push(pe),pe=M();else U=e;U!==e?(V=$,L=zr(g,L),$=L):(f=$,$=e)}else f=$,$=e;for(;$!==e;)if(O.push($),$=f,L=Ws(),L!==e){if(U=[],pe=M(),pe!==e)for(;pe!==e;)U.push(pe),pe=M();else U=e;U!==e?(V=$,L=zr(g,L),$=L):(f=$,$=e)}else f=$,$=e;O!==e?($=ca(),$!==e?(V=c,g=nn(g,O,$),c=g):(f=c,c=e)):(f=c,c=e)}else f=c,c=e;else f=c,c=e}else f=c,c=e;return c}function ha(){var c,g,w,S,O,$;if(x++,c=f,g=be(),g!==e)if(w=ce(),w!==e)if(u.substr(f,2)===Jr?(S=Jr,f+=2):(S=e,x===0&&P(an)),S===e&&(u.substr(f,3)===Zr?(S=Zr,f+=3):(S=e,x===0&&P(ln))),S!==e){for(O=[],$=M();$!==e;)O.push($),$=M();O!==e?($=Me(),$!==e?(V=c,g=cn(g,S,$),c=g):(f=c,c=e)):(f=c,c=e)}else f=c,c=e;else f=c,c=e;else f=c,c=e;return x--,c===e&&(g=e,x===0&&P(on)),c}function pa(){var c,g,w,S,O,$;if(x++,c=f,g=Me(),g!==e)if(w=ce(),w!==e)if(u.charCodeAt(f)===61?(S=Qr,f++):(S=e,x===0&&P(es)),S!==e){for(O=[],$=M();$!==e;)O.push($),$=M();O!==e?($=Me(),$!==e?(V=c,g=hn(g,S,$),c=g):(f=c,c=e)):(f=c,c=e)}else f=c,c=e;else f=c,c=e;else f=c,c=e;return x--,c===e&&(g=e,x===0&&P(un)),c}function da(){var c,g,w,S,O,$,L,U;if(x++,c=f,g=be(),g!==e){for(w=[],S=f,O=[],$=M();$!==e;)O.push($),$=M();if(O!==e)if(u.charCodeAt(f)===44?($=p,f++):($=e,x===0&&P(b)),$!==e){for(L=[],U=M();U!==e;)L.push(U),U=M();L!==e?(U=be(),U!==e?(V=S,O=je(g,U),S=O):(f=S,S=e)):(f=S,S=e)}else f=S,S=e;else f=S,S=e;for(;S!==e;){for(w.push(S),S=f,O=[],$=M();$!==e;)O.push($),$=M();if(O!==e)if(u.charCodeAt(f)===44?($=p,f++):($=e,x===0&&P(b)),$!==e){for(L=[],U=M();U!==e;)L.push(U),U=M();L!==e?(U=be(),U!==e?(V=S,O=je(g,U),S=O):(f=S,S=e)):(f=S,S=e)}else f=S,S=e;else f=S,S=e}if(w!==e){for(S=[],O=M();O!==e;)S.push(O),O=M();if(S!==e)if(u.charCodeAt(f)===61?(O=Qr,f++):(O=e,x===0&&P(es)),O!==e){for($=[],L=M();L!==e;)$.push(L),L=M();$!==e?(u.charCodeAt(f)===63?(L=ts,f++):(L=e,x===0&&P(rs)),L!==e?(V=c,g=dn(g,w),c=g):(f=c,c=e)):(f=c,c=e)}else f=c,c=e;else f=c,c=e}else f=c,c=e}else f=c,c=e;return x--,c===e&&(g=e,x===0&&P(pn)),c}function fa(){var c,g,w,S,O,$,L,U,pe,He;if(x++,c=f,u.charCodeAt(f)===63?(g=ts,f++):(g=e,x===0&&P(rs)),g!==e)if(w=ce(),w!==e)if(S=be(),S!==e){for(O=[],$=f,L=ce(),L!==e?(u.charCodeAt(f)===44?(U=p,f++):(U=e,x===0&&P(b)),U!==e?(pe=ce(),pe!==e?(He=be(),He!==e?(V=$,L=je(S,He),$=L):(f=$,$=e)):(f=$,$=e)):(f=$,$=e)):(f=$,$=e);$!==e;)O.push($),$=f,L=ce(),L!==e?(u.charCodeAt(f)===44?(U=p,f++):(U=e,x===0&&P(b)),U!==e?(pe=ce(),pe!==e?(He=be(),He!==e?(V=$,L=je(S,He),$=L):(f=$,$=e)):(f=$,$=e)):(f=$,$=e)):(f=$,$=e);O!==e?(V=c,g=mn(S,O),c=g):(f=c,c=e)}else f=c,c=e;else f=c,c=e;else f=c,c=e;return x--,c===e&&(g=e,x===0&&P(fn)),c}function ma(){var c,g,w,S,O,$;if(x++,c=f,g=ft(),g!==e){if(w=[],S=f,O=[],$=M(),$!==e)for(;$!==e;)O.push($),$=M();else O=e;for(O!==e?($=ft(),$!==e?(V=S,O=je(g,$),S=O):(f=S,S=e)):(f=S,S=e);S!==e;){if(w.push(S),S=f,O=[],$=M(),$!==e)for(;$!==e;)O.push($),$=M();else O=e;O!==e?($=ft(),$!==e?(V=S,O=je(g,$),S=O):(f=S,S=e)):(f=S,S=e)}w!==e?(V=c,g=bn(g,w),c=g):(f=c,c=e)}else f=c,c=e;return x--,c===e&&(g=e,x===0&&P(gn)),c}function ga(){var c,g,w,S,O,$;if(x++,c=f,u.charCodeAt(f)===40?(g=v,f++):(g=e,x===0&&P(_)),g!==e){for(w=[],S=M();S!==e;)w.push(S),S=M();if(w!==e)if(S=Me(),S!==e){for(O=[],$=M();$!==e;)O.push($),$=M();O!==e?(u.charCodeAt(f)===41?($=I,f++):($=e,x===0&&P(R)),$!==e?(V=c,g=is(S),c=g):(f=c,c=e)):(f=c,c=e)}else f=c,c=e;else f=c,c=e}else f=c,c=e;return x--,c===e&&(g=e,x===0&&P(ss)),c}function ba(){var c,g,w,S,O;for(x++,c=f,g=[],w=M();w!==e;)g.push(w),w=M();if(g!==e)if(w=Me(),w!==e){for(S=[],O=M();O!==e;)S.push(O),O=M();S!==e?(u.charCodeAt(f)===41?(O=I,f++):(O=e,x===0&&P(R)),O!==e?(V=c,g=is(w),c=g):(f=c,c=e)):(f=c,c=e)}else f=c,c=e;else f=c,c=e;return x--,c===e&&(g=e,x===0&&P(ss)),c}function gt(){var c;return c=ga(),c===e&&(c=ba()),c}function bt(){var c,g,w;if(c=f,g=[],w=M(),w!==e)for(;w!==e;)g.push(w),w=M();else g=e;return g!==e?(w=mr(),w!==e?(V=c,g=y(w),c=g):(f=c,c=e)):(f=c,c=e),c}function ya(){var c,g,w,S;return x++,c=f,u.substr(f,2).toLowerCase()===Sn?(g=u.substr(f,2),f+=2):(g=e,x===0&&P(wn)),g!==e?(w=ce(),w!==e?(S=gt(),S!==e?(V=c,g=Tn(S),c=g):(f=c,c=e)):(f=c,c=e)):(f=c,c=e),x--,c===e&&(g=e,x===0&&P(yn)),c}function Sa(){var c,g,w,S;return x++,c=f,u.substr(f,5).toLowerCase()===En?(g=u.substr(f,5),f+=5):(g=e,x===0&&P($n)),g!==e?(w=ce(),w!==e?(S=gt(),S!==e?(V=c,g=xn(S),c=g):(f=c,c=e)):(f=c,c=e)):(f=c,c=e),x--,c===e&&(g=e,x===0&&P(Wn)),c}function wa(){var c,g,w,S;return x++,c=f,u.substr(f,5).toLowerCase()===Dn?(g=u.substr(f,5),f+=5):(g=e,x===0&&P(_n)),g!==e?(w=ce(),w!==e?(S=gt(),S!==e?(V=c,g=vn(S),c=g):(f=c,c=e)):(f=c,c=e)):(f=c,c=e),x--,c===e&&(g=e,x===0&&P(On)),c}function Ta(){var c,g,w,S,O;return x++,c=f,u.substr(f,4).toLowerCase()===In?(g=u.substr(f,4),f+=4):(g=e,x===0&&P(An)),g!==e?(w=ce(),w!==e?(S=gt(),S!==e?(O=bt(),O===e&&(O=null),O!==e?(V=c,g=Nn(S,O),c=g):(f=c,c=e)):(f=c,c=e)):(f=c,c=e)):(f=c,c=e),x--,c===e&&(g=e,x===0&&P(Pn)),c}function Wa(){var c,g,w;return c=f,u.substr(f,4).toLowerCase()===Rn?(g=u.substr(f,4),f+=4):(g=e,x===0&&P(Gn)),g!==e?(w=bt(),w===e&&(w=null),w!==e?(V=c,g=kn(w),c=g):(f=c,c=e)):(f=c,c=e),c}function Ea(){var c,g,w;return c=f,u.substr(f,5).toLowerCase()===Mn?(g=u.substr(f,5),f+=5):(g=e,x===0&&P(Ln)),g!==e?(w=bt(),w===e&&(w=null),w!==e?(V=c,g=Bn(w),c=g):(f=c,c=e)):(f=c,c=e),c}function $a(){var c,g;return c=f,u.substr(f,5).toLowerCase()===Vn?(g=u.substr(f,5),f+=5):(g=e,x===0&&P(Un)),g!==e&&(V=c,g=jn()),c=g,c}function xa(){var c,g;return c=f,u.substr(f,8).toLowerCase()===Hn?(g=u.substr(f,8),f+=8):(g=e,x===0&&P(Fn)),g!==e&&(V=c,g=Cn()),c=g,c}function Oa(){var c,g;return c=f,u.substr(f,2).toLowerCase()===Kn?(g=u.substr(f,2),f+=2):(g=e,x===0&&P(qn)),g!==e&&(V=c,g=Xn()),c=g,c}function Da(){var c,g;return c=f,u.substr(f,9).toLowerCase()===Yn?(g=u.substr(f,9),f+=9):(g=e,x===0&&P(zn)),g!==e&&(V=c,g=Jn()),c=g,c}function _a(){var c,g;return c=f,u.substr(f,6).toLowerCase()===Zn?(g=u.substr(f,6),f+=6):(g=e,x===0&&P(Qn)),g!==e&&(V=c,g=eo()),c=g,c}function va(){var c,g,w;return c=f,u.substr(f,7).toLowerCase()===to?(g=u.substr(f,7),f+=7):(g=e,x===0&&P(ro)),g!==e?(w=bt(),w===e&&(w=null),w!==e?(V=c,g=so(w),c=g):(f=c,c=e)):(f=c,c=e),c}function Pa(){var c,g;return c=f,u.substr(f,8).toLowerCase()===io?(g=u.substr(f,8),f+=8):(g=e,x===0&&P(no)),g!==e&&(V=c,g=oo()),c=g,c}function Ia(){var c,g,w,S;return x++,c=f,u.substr(f,6).toLowerCase()===lo?(g=u.substr(f,6),f+=6):(g=e,x===0&&P(co)),g!==e?(w=ce(),w!==e?(S=be(),S!==e?(V=c,g=uo(S),c=g):(f=c,c=e)):(f=c,c=e)):(f=c,c=e),x--,c===e&&(g=e,x===0&&P(ao)),c}function mr(){var c;return c=ua(),c===e&&(c=ha(),c===e&&(c=pa(),c===e&&(c=da(),c===e&&(c=fa(),c===e&&(c=ya(),c===e&&(c=Wa(),c===e&&(c=Ea(),c===e&&(c=$a(),c===e&&(c=Sa(),c===e&&(c=xa(),c===e&&(c=Oa(),c===e&&(c=wa(),c===e&&(c=Da(),c===e&&(c=_a(),c===e&&(c=Ta(),c===e&&(c=va(),c===e&&(c=ma(),c===e&&(c=Pa(),c===e&&(c=Ia()))))))))))))))))))),c}function Aa(){var c,g;return c=f,u.substr(f,6).toLowerCase()===ho?(g=u.substr(f,6),f+=6):(g=e,x===0&&P(po)),g!==e&&(V=c,g=fo()),c=g,c===e&&(c=f,u.substr(f,6).toLowerCase()===mo?(g=u.substr(f,6),f+=6):(g=e,x===0&&P(go)),g!==e&&(V=c,g=bo()),c=g,c===e&&(c=f,u.substr(f,5).toLowerCase()===yo?(g=u.substr(f,5),f+=5):(g=e,x===0&&P(So)),g!==e&&(V=c,g=wo()),c=g,c===e&&(c=f,u.substr(f,8).toLowerCase()===To?(g=u.substr(f,8),f+=8):(g=e,x===0&&P(Wo)),g!==e&&(V=c,g=Eo()),c=g,c===e&&(c=f,u.substr(f,7).toLowerCase()===$o?(g=u.substr(f,7),f+=7):(g=e,x===0&&P(xo)),g!==e&&(V=c,g=Oo()),c=g)))),c}function Ws(){var c,g;return c=f,u.substr(f,5).toLowerCase()===Do?(g=u.substr(f,5),f+=5):(g=e,x===0&&P(_o)),g!==e&&(V=c,g=vo()),c=g,c===e&&(c=f,u.substr(f,6).toLowerCase()===Po?(g=u.substr(f,6),f+=6):(g=e,x===0&&P(Io)),g!==e&&(V=c,g=Ao()),c=g,c===e&&(c=f,u.substr(f,9).toLowerCase()===No?(g=u.substr(f,9),f+=9):(g=e,x===0&&P(Ro)),g!==e&&(V=c,g=Go()),c=g)),c}function be(){var c,g,w;if(x++,c=f,g=[],ns.test(u.charAt(f))?(w=u.charAt(f),f++):(w=e,x===0&&P(os)),w!==e)for(;w!==e;)g.push(w),ns.test(u.charAt(f))?(w=u.charAt(f),f++):(w=e,x===0&&P(os));else g=e;return g!==e?c=u.substring(c,f):c=g,x--,c===e&&(g=e,x===0&&P(l)),c}function Na(){var c,g;return x++,c=be(),x--,c===e&&(g=e,x===0&&P(ko)),c}function gr(){var c,g;if(c=[],ut.test(u.charAt(f))?(g=u.charAt(f),f++):(g=e,x===0&&P(ht)),g!==e)for(;g!==e;)c.push(g),ut.test(u.charAt(f))?(g=u.charAt(f),f++):(g=e,x===0&&P(ht));else c=e;return c}function Ra(){var c,g,w;return c=f,u.charCodeAt(f)===46?(g=Mo,f++):(g=e,x===0&&P(Lo)),g!==e?(w=gr(),w!==e?(g=[g,w],c=g):(f=c,c=e)):(f=c,c=e),c}function Ga(){var c,g,w,S;return c=f,Bo.test(u.charAt(f))?(g=u.charAt(f),f++):(g=e,x===0&&P(Vo)),g!==e?(Uo.test(u.charAt(f))?(w=u.charAt(f),f++):(w=e,x===0&&P(jo)),w===e&&(w=null),w!==e?(S=gr(),S!==e?(g=[g,w,S],c=g):(f=c,c=e)):(f=c,c=e)):(f=c,c=e),c}function ka(){var c,g,w,S,O,$;return x++,c=f,g=f,w=f,S=gr(),S!==e?(O=Ra(),O===e&&(O=null),O!==e?($=Ga(),$===e&&($=null),$!==e?(S=[S,O,$],w=S):(f=w,w=e)):(f=w,w=e)):(f=w,w=e),w!==e?g=u.substring(g,f):g=w,g!==e&&(V=c,g=Fo(g)),c=g,x--,c===e&&(g=e,x===0&&P(Ho)),c}function Ma(){var c,g,w,S,O;if(x++,c=f,u.charCodeAt(f)===35?(g=Ko,f++):(g=e,x===0&&P(qo)),g!==e){for(w=f,S=[],ut.test(u.charAt(f))?(O=u.charAt(f),f++):(O=e,x===0&&P(ht));O!==e;)S.push(O),ut.test(u.charAt(f))?(O=u.charAt(f),f++):(O=e,x===0&&P(ht));S!==e?w=u.substring(w,f):w=S,w!==e?(V=c,g=Xo(w),c=g):(f=c,c=e)}else f=c,c=e;return x--,c===e&&(g=e,x===0&&P(Co)),c}function La(){var c,g,w,S,O,$;if(c=f,g=f,u.charCodeAt(f)===39?(w=as,f++):(w=e,x===0&&P(ls)),w!==e){for(S=f,O=[],cs.test(u.charAt(f))?($=u.charAt(f),f++):($=e,x===0&&P(us));$!==e;)O.push($),cs.test(u.charAt(f))?($=u.charAt(f),f++):($=e,x===0&&P(us));O!==e?S=u.substring(S,f):S=O,S!==e?(u.charCodeAt(f)===39?(O=as,f++):(O=e,x===0&&P(ls)),O!==e?(w=[w,S,O],g=w):(f=g,g=e)):(f=g,g=e)}else f=g,g=e;if(g===e)if(g=f,u.charCodeAt(f)===34?(w=hs,f++):(w=e,x===0&&P(ps)),w!==e){for(S=f,O=[],ds.test(u.charAt(f))?($=u.charAt(f),f++):($=e,x===0&&P(fs));$!==e;)O.push($),ds.test(u.charAt(f))?($=u.charAt(f),f++):($=e,x===0&&P(fs));O!==e?S=u.substring(S,f):S=O,S!==e?(u.charCodeAt(f)===34?(O=hs,f++):(O=e,x===0&&P(ps)),O!==e?(w=[w,S,O],g=w):(f=g,g=e)):(f=g,g=e)}else f=g,g=e;return g!==e&&(V=c,g=Yo(g)),c=g,c}function M(){var c,g;return x++,Jo.test(u.charAt(f))?(c=u.charAt(f),f++):(c=e,x===0&&P(Zo)),x--,c===e&&(g=e,x===0&&P(zo)),c}function Es(){var c,g;return x++,u.charCodeAt(f)===10?(c=ea,f++):(c=e,x===0&&P(ta)),x--,c===e&&(g=e,x===0&&P(Qo)),c}function ce(){var c,g;for(x++,c=[],ms.test(u.charAt(f))?(g=u.charAt(f),f++):(g=e,x===0&&P(gs));g!==e;)c.push(g),ms.test(u.charAt(f))?(g=u.charAt(f),f++):(g=e,x===0&&P(gs));return x--,c===e&&(g=e,x===0&&P(ra)),c}if(dt=s(),dt!==e&&f===u.length)return dt;throw dt!==e&&f<u.length&&P(sa()),ys(fr,xe<u.length?u.charAt(xe):null,xe<u.length?it(xe,xe+1):it(xe,xe))}var mi=Ol;var Ve=class extends Error{constructor(e){super(e.join(`
`));this.errors=e}format(e=`
`){return this.errors.join(e)}};function Dl(u,r){let e;try{e=mi(u)}catch(t){if(!(t instanceof Error))throw t;let s=t.location.start,i=`\u0421\u0442\u0440\u043E\u043A\u0430 ${s.line} \u0441\u0442\u043E\u043B\u0431\u0435\u0446 ${s.column}: ${t.message}`;throw new Ve([i])}try{return di(e,r)}catch(t){throw t instanceof Error?new Ve([t.message]):t}}function gi(u,r){let e;try{e=fi(u)}catch(t){throw t instanceof Error?new Ve([t.message]):t}return Dl(e,r)}var kr=class{constructor(r,e){this.id=r;a(this,"type");a(this,"name");a(this,"attrib",0);a(this,"description","");a(this,"defaultValue",null);a(this,"inEquation",!1);a(this,"parsed",null);this.name=e.name,this.type=e.type,this.set(e)}set({attrib:r=this.attrib,defaultValue:e=this.defaultValue,description:t=this.description,inEquation:s=this.inEquation}){return this.parsed=e!==null?Xt(this.type,e):null,this.attrib=r,this.defaultValue=e,this.description=t,this.inEquation=s,this}},ct=class{constructor(r){a(this,"m");a(this,"list");a(this,"_disable",null);a(this,"_enable",null);a(this,"orgx",null);a(this,"orgy",null);a(this,"_hobject",null);a(this,"_objname",null);a(this,"_classname",null);a(this,"msg",null);a(this,"xpos",null);a(this,"ypos",null);a(this,"fwkeys",null);a(this,"wvkey",null);a(this,"repeat",null);a(this,"scancode",null);a(this,"nwidth",null);a(this,"nheight",null);a(this,"_hspace",null);a(this,"_windowName",null);a(this,"iditem",null);a(this,"wnotifycode",null);var t;let e=r==null?void 0:r.map((s,i)=>[s.name.toUpperCase(),new kr(i,s)]);if(this.list=(t=e==null?void 0:e.map(s=>s[1]))!=null?t:[],this.m=new Map(e),!!e)for(let[s,i]of e){let o=i.type,{FLOAT:l,STRING:h,HANDLE:p}=z;s==="_ENABLE"&&o===l?this._enable=i:s==="_DISABLE"&&o===l?this._disable=i:s==="MSG"&&o===l?this.msg=i:s==="_HOBJECT"&&o===p?this._hobject=i:s==="IDITEM"&&o===l?this.iditem=i:s==="WNOTIFYCODE"&&o===l?this.wnotifycode=i:s==="NWIDTH"&&o===l?this.nwidth=i:s==="NHEIGHT"&&o===l?this.nheight=i:s==="XPOS"&&o===l?this.xpos=i:s==="YPOS"&&o===l?this.ypos=i:s==="FWKEYS"&&o===l?this.fwkeys=i:s==="ORGX"&&o===l?this.orgx=i:s==="ORGY"&&o===l?this.orgy=i:s==="_OBJNAME"&&o===h?this._objname=i:s==="_CLASSNAME"&&o===h?this._classname=i:s==="WVKEY"&&o===l?this.wvkey=i:s==="REPEAT"&&o===l?this.repeat=i:s==="SCANCODE"&&o===l?this.scancode=i:s==="_HSPACE"&&o===p?this._hspace=i:s==="_WINDOWNAME"&&o===h&&(this._windowName=i)}}get(r){var e;return(e=this.m.get(r.toUpperCase()))!=null?e:null}};var sr=class{constructor(r,p,l,h){this.id=r;this.file=l;this.compiler=h;a(this,"childrenChangedCallbacks",new Set);a(this,"_transpiled",null);a(this,"compiled",!1);a(this,"name");a(this,"uniqid");a(this,"vars");a(this,"children",[]);a(this,"connections",[]);a(this,"scene",null);a(this,"image",null);a(this,"modelText","");a(this,"isFunction",!1);a(this,"main",null);a(this,"defers",[]);a(this,"equations",[]);var b=p,{name:e,uniqid:t,vars:s,transpiled:i}=b,o=oe(b,["name","uniqid","vars","transpiled"]);this.name=e,this.vars=new ct(s),this.set(o),this._transpiled=i!=null?i:null,this.uniqid=t!=null?t:0}set({vars:r,children:e=this.children,connections:t=this.connections,scene:s=this.scene,image:i=this.image,modelText:o=this.modelText,isFunction:l=this.isFunction}){return r&&(this.vars=new ct(r)),this.modelText!==o&&(this.compiled=!1),this.children!==e&&(this.children=e,this.childrenChangedCallbacks.forEach(h=>h(e))),this.connections=t,this.scene=s,this.image=i,this.modelText=o,this.isFunction=l,this}compile(){if(this.compiled)return;this.compiled=!0;let r;if(this._transpiled)Z.debugCompiler&&console.log(`\u041A\u043E\u043C\u043F\u0438\u043B\u044F\u0446\u0438\u044F (\u043A\u0435\u0448\u0438\u0440\u043E\u0432\u0430\u043D\u043E) ${this.name} (${this.vars.list.length} \u043F\u0435\u0440\u0435\u043C\u0435\u043D\u043D\u044B\u0445)`),r=this._transpiled,this._transpiled=null;else{let e=this.file.path.toString().slice(3);Z.debugCompiler&&console.log(`\u041A\u043E\u043C\u043F\u0438\u043B\u044F\u0446\u0438\u044F '${this.name}' ('${e}'): ${this.vars.list.length} \u043F\u0435\u0440\u0435\u043C\u0435\u043D\u043D\u044B\u0445`);try{let t=this.compiler.compile(this.modelText,this.name,e);Z.debugCompiler&&t.bugs.length&&console.warn(`${this.name}:
${t.bugs.map(o=>` -${o}`).join(`
`)}`);let s=this.vars,i=t.vars.map(o=>{let l=s.get(o.name);if(!l)return o;let{defaultValue:h,description:p}=l;return k(G({},o),{defaultValue:h,description:p})});this.set({vars:i}),r=t}catch(t){throw t instanceof Ve?Error(`\u041E\u0448\u0438\u0431\u043A\u0430 \u043A\u043E\u043C\u043F\u0438\u043B\u044F\u0446\u0438\u0438 '${this.name}' ('${e}'): '${t.message}'`):t}}this.main=r.mainText?ei(r.mainText):null,this.defers=r.defersTexts?ti(r.defersTexts):[],this.equations=r.equationsTexts?ri(r.equationsTexts):[]}on(r,e){this.childrenChangedCallbacks.add(e)}};var ir=class{constructor(){a(this,"files",new WeakSet);a(this,"m",new Map)}hasFile(r){return this.files.has(r)}get(r){var e;return(e=this.m.get(r.toUpperCase()))!=null?e:null}add(r){let e=r.name.toUpperCase();if(this.m.has(e))throw Error(`\u041A\u043E\u043D\u0444\u043B\u0438\u043A\u0442 \u0438\u043C\u0435\u043D \u0438\u043C\u0438\u0434\u0436\u0435\u0439: ${r.name}`);return this.m.set(e,r),this.files.add(r.file),this}unload(r){this.m.forEach(e=>e.id===r&&this.files.delete(e.file)),this.m=new Map([...this.m].filter(e=>e[1].id!==r))}};var Qe=class{constructor(){a(this,"float",0);a(this,"int",0);a(this,"string",0)}alloc(r){switch(r.type){case 1:return this.float++;case 3:case 4:return this.int++;case 2:return this.string++}}createMemory(r){let e=new Float64Array(this.float),t=new Int32Array(this.int),s=new Array(this.string).fill("");return{newFloats:e,oldFloats:r?e:e.slice(),newInts:t,oldInts:r?t:t.slice(),newStrings:s,oldStrings:r?s:s.slice()}}},et=class{constructor(r){this.v=r;a(this,"_index",-1);a(this,"connected",new Set)}propagateIndex(r){this._index>=0||(this._index=r,this.connected.forEach(e=>e.propagateIndex(r)))}allocIndex(r){return this._index<0&&this.propagateIndex(r.alloc(this.v)),this._index}};var nr=class{constructor(r){this.k=r}inject(r,e){if(this[r])throw Error(`Namespace '${r}' \u0443\u0436\u0435 \u043E\u043F\u0440\u0435\u0434\u0435\u043B\u0435\u043D`);this[r]=new e(this.k)}userFunc(r,e,t){var p;let s=this.k.classes.get(e);if(!s)throw Error(`\u0424\u0443\u043D\u043A\u0446\u0438\u044F \u043D\u0435 \u0441\u0443\u0449\u0435\u0441\u0442\u0432\u0443\u0435\u0442: ${e}`);if(!s.isFunction)throw Error(`\u0418\u043C\u0438\u0434\u0436 ${e} \u0441\u0443\u0449\u0435\u0441\u0442\u0432\u0443\u0435\u0442, \u043D\u043E \u043D\u0435 \u044F\u0432\u043B\u044F\u0435\u0442\u0441\u044F \u0444\u0443\u043D\u043A\u0446\u0438\u0435\u0439`);s.compile();let i=s.vars.list;if(t.length>i.length)throw Error(`${e}: ${t.length} \u0430\u0440\u0433\u0443\u043C\u0435\u043D\u0442\u043E\u0432, \u043D\u043E \u0444\u0443\u043D\u043A\u0446\u0438\u044F \u0438\u043C\u0435\u0435\u0442 ${i.length} \u043F\u0435\u0440\u0435\u043C\u0435\u043D\u043D\u044B\u0445`);let o=new Qe,l={map:i.map(b=>new et(b).allocIndex(o)),memory:o.createMemory(!0)};t.forEach((b,y)=>{let T=i[y];if(!J(l,T,b))throw Error(`\u0410\u0440\u0433\u0443\u043C\u0435\u043D\u0442 ${y} \u0438\u043C\u0435\u0435\u0442 \u0442\u0438\u043F ${typeof b}; \u043E\u0436\u0438\u0434\u0430\u043B\u043E\u0441\u044C ${T.type}`)}),(p=s.main)==null||p.call(s,r,l,this);let h=i.find(b=>b.attrib&1024);if(h)return Be(l,h)}solveEquationsFor({prj:{root:r}},e){let t=r.createLinearSystem(this,e),s;try{s=ks(t)}catch(o){s=new Array(e.length).fill(0)}let i=r.vars.memory.newFloats;e.forEach((o,l)=>i[o]=s[l])}_notImplemented(r){throw Error(`${r} \u043D\u0435 \u0440\u0435\u0430\u043B\u0438\u0437\u043E\u0432\u0430\u043D\u0430`)}};var d=1,E=2,m=3,C=4,ee=9,Ie=10;var bi=.752812499999996,yi=1.3283520132835271,Si=new Date().getTime(),Ge=new Date("1998-05-12"),Mr=13.204656862745098;function or(u,r){let e=u.toUpperCase(),t=e.includes("WS_CHILD"),s=e.includes("WS_BYSPACE"),i=e.includes("WS_POPUP"),o=e.includes("WS_NORESIZE"),l=e.includes("WS_AUTOORG"),h=e.includes("WS_SPACESIZE"),p=e.includes("WS_VSCROLL"),b=e.includes("WS_HSCROLL"),y=s?G({},r):{};return t&&(y.child=!0),b&&(y.hscroll=!0),p&&(y.vscroll=!0),h&&(y.size={type:"content"}),o&&(y.fixed=!0),i&&(y.popup=!0),l&&(y.autoorg=!0),y}var se=class{constructor(r){this.k=r;a(this,"arrays");this.arrays=r.arrays}$new(){let r=re.freeKey(this.arrays);return this.arrays.set(r,new Ye),r}$delete(r){this.arrays.delete(r)}$vGetCount(r){var e,t;return(t=(e=this.arrays.get(r))==null?void 0:e.count())!=null?t:0}$vGetType(r,e){var t,s;return(s=(t=this.arrays.get(r))==null?void 0:t.type(e))!=null?s:""}$vInsert(r,e){let t=this.arrays.get(r);if(!t)return 0;let s=e.toUpperCase();if(s==="STRING"||s==="FLOAT"||s==="HANDLE")return t.insert(s);let i=this.k.classes.get(e);if(!i)return 0;let o=i.vars.list.map(l=>[l.name,l.type]);return t.insertClass(i.name,o)}$vDelete(r,e){var t,s;return(s=(t=this.arrays.get(r))==null?void 0:t.remove(e))!=null?s:0}$vClearAll(){return this.arrays.clear(),1}$vGetS(r,e,t){var s,i;return(i=(s=this.arrays.get(r))==null?void 0:s.getString(Math.floor(e),t))!=null?i:""}$vGetH(r,e,t){var s,i;return(i=(s=this.arrays.get(r))==null?void 0:s.getHandle(Math.floor(e),t))!=null?i:0}$vGetF(r,e,t){var s,i;return(i=(s=this.arrays.get(r))==null?void 0:s.getFloat(Math.floor(e),t))!=null?i:0}$vSet(r,e,t,s){var i;(i=this.arrays.get(r))==null||i.set(e,t,s)}$vSort(r,...e){let t=this.arrays.get(r);if(!t)return 0;if(e.length===0)return t.sort();if(typeof e[0]=="number"){let i=!!e[0],o=e.length>1?e[1]:"";return t.sort([{desc:i,field:o}])}let s=[];for(let i=0;i<e.length;i+=2){let o=e[i],l=!!e[i+1];s.push({desc:l,field:o})}return t.sort(s)}};a(se,"namespace","a"),a(se,"$new",{r:m}),a(se,"$delete",{a:[m]}),a(se,"$vGetCount",{a:[m],r:d}),a(se,"$vGetType",{a:[m,d],r:E}),a(se,"$vInsert",{a:[m,E],r:d}),a(se,"$vDelete",{a:[m,d],r:d}),a(se,"$vClearAll",{}),a(se,"$vGetS",{a:[m,d,E],r:E}),a(se,"$vGetH",{a:[m,d,E],r:m}),a(se,"$vGetF",{a:[m,d,E],r:d}),a(se,"$vSet$F",{a:[m,d,E,d]}),a(se,"$vSet$S",{a:[m,d,E,E]}),a(se,"$vSet$H",{a:[m,d,E,m]}),a(se,"$vSort",{a:[m,d,[E]],r:d}),a(se,"$vSort$2",{a:[m,[E]],r:d}),a(se,"$vSort$3",{a:[m,[E,d]],r:d});var K=class{constructor(r){this.k=r}$getClassName(r,e){var t,s;return(s=(t=r.resolve(e))==null?void 0:t.klass.name)!=null?s:""}$getObjectCount(r){var e,t;return(t=(e=this.k.classes.get(r))==null?void 0:e.children.length)!=null?t:0}$getHObject(r){var e,t;return(t=(e=r.ndata)==null?void 0:e.key)!=null?t:0}$getHObjectByName(r,e){var t,s,i;return(i=(s=(t=r.resolve(e))==null?void 0:t.ndata)==null?void 0:s.key)!=null?i:0}$getHObjectByNum(r,e){var s;if(e<0)return 0;let t=(s=this.k.classes.get(r))==null?void 0:s.children;return t&&e<t.length?t[e].key:0}$getObjectClass(r,e){var t,s,i;return(i=(s=(t=this.k.classes.get(r))==null?void 0:t.children.find(o=>o.key===e))==null?void 0:s.klass)!=null?i:""}$getLink(r,e,t){var s,i,o;return(o=(i=(s=this.k.classes.get(r))==null?void 0:s.connections.find(({nodes:[l,h]})=>l===e&&h===t||l===t&&h===e))==null?void 0:i.key)!=null?o:0}$getModelText(r,e){var o;let t=(o=this.k.classes.get(r))==null?void 0:o.modelText;if(!t)return 0;let s=this.k.streams.get(e);if(!s)return 0;let i=ae.encode(t);return s.write(i),i.length}$setModelText(r,e){var l;let t=this.k.classes.get(r);if(!t)return 0;let s=(l=this.k.streams.get(e))==null?void 0:l.buffer();if(!s)return 0;let i=ae.decode(new Uint8Array(s)),o=t.modelText;t.set({modelText:i});try{t.compile()}catch(h){if(!(h instanceof Error))throw h;return console.warn(h.message),t.set({modelText:o}),0}return 1}$getVarS(r,e,t){var o;let s=r.resolve(e);if(!s)return"";let i=s.klass.vars.get(t);return i&&(o=zs(s.vars,i))!=null?o:""}getVarValueN(r,e,t){var o;let s=r.resolve(e);if(!s)return 0;let i=s.klass.vars.get(t);return i&&(o=Ys(s.vars,i))!=null?o:0}$getVarF(r,e,t){return this.getVarValueN(r,e,t)}$getVarH(r,e,t){return this.getVarValueN(r,e,t)}$getVarC(r,e,t){return this.getVarValueN(r,e,t)}$setVar(r,e,t,s){let i=r.resolve(e);if(!i)return;let o=i.klass.vars.get(t);o&&J(i.vars,o,s)}$getVarInfo(r,e,t,s,i,o,l,h,p,b,y,T){var I,R,W;let v=(I=this.k.classes.get(r))==null?void 0:I.vars.list;if(e<0||!v||e>=v.length)return t[s]="",i[o]="",l[h]="",p[b]="",y&&(y[T]=0),0;let _=v[e];return t[s]=_.name,i[o]=z[_.type],l[h]=(R=_.defaultValue)!=null?R:"",p[b]=(W=_.description)!=null?W:"",y&&(y[T]=_.attrib),1}$getVarCount(r){var e,t;return(t=(e=this.k.classes.get(r))==null?void 0:e.vars.list.length)!=null?t:0}$setObjectName(r,e,t){let s=this.k.classes.get(r);if(!s)return 0;let i=s.children.findIndex(l=>l.key===e);if(i<0)return 0;let o=s.children.slice();return o[i]=k(G({},o[i]),{name:t}),s.set({children:o}),1}$getNameByHandle(r,e){var t,s,i;return(i=(s=(t=this.k.classes.get(r))==null?void 0:t.children.find(o=>o.key===e))==null?void 0:s.name)!=null?i:""}$saveObjectState(r,e,t){let s=r.resolve(e);if(!s)return 0;let i=r.prj.dir.resolve(t).file();if(!i)return 0;let o=s.getValues();return i.set({stt:o}),1}$loadObjectState(r,e,t){var o;let s=r.resolve(e);if(!s)return 0;let i=(o=r.prj.dir.resolve(t).file())==null?void 0:o.stt;return i?(s.applyValues(i),1):0}$setVarsToDefault(r,e){var t;return(t=r.resolve(e))!=null&&t.initValues(!0)?1:0}$stop(r){this.k._functionNotImplemented("Stop",r)}$quit(r){r<=0||this.k.set({projects:[]})}$closeAll({prj:r}){this.k.set({projects:this.k.projects.filter(e=>e!==r)})}};a(K,"namespace","cl"),a(K,"$getClassName",{s:!0,a:[E],r:E}),a(K,"$getObjectCount",{a:[E],r:d}),a(K,"$getHObject",{s:!0,r:m}),a(K,"$getHObjectByName",{s:!0,a:[E],r:m}),a(K,"$getHObjectByNum",{a:[E,d],r:m}),a(K,"$getObjectClass",{a:[E,m],r:E}),a(K,"$getLink",{a:[E,m,m],r:m}),a(K,"$getModelText",{a:[E,m],r:d}),a(K,"$setModelText",{a:[E,m],r:d}),a(K,"$setModelText$2",{a:[E,m,d],r:d}),a(K,"$getVarS",{s:!0,a:[E,E],r:E}),a(K,"$getVarF",{s:!0,a:[E,E],r:d}),a(K,"$getVarH",{s:!0,a:[E,E],r:m}),a(K,"$getVarC",{s:!0,a:[E,E],r:C}),a(K,"$setVar$F",{s:!0,a:[E,E,d]}),a(K,"$setVar$S",{s:!0,a:[E,E,E]}),a(K,"$setVar$H",{s:!0,a:[E,E,m]}),a(K,"$setVar$C",{s:!0,a:[E,E,C]}),a(K,"$getVarInfo",{a:[E,d,Ie,Ie,Ie,Ie],r:d}),a(K,"$getVarInfo$2",{a:[E,d,Ie,Ie,Ie,Ie,ee],r:d}),a(K,"$getVarCount",{a:[E],r:d}),a(K,"$setObjectName",{a:[E,m,E],r:d}),a(K,"$getNameByHandle",{a:[E,m],r:E}),a(K,"$saveObjectState",{s:!0,a:[E,E],r:d}),a(K,"$loadObjectState",{s:!0,a:[E,E],r:d}),a(K,"$setVarsToDefault",{s:!0,a:[E],r:d}),a(K,"$stop",{s:!0,a:[d]}),a(K,"$quit",{a:[d]}),a(K,"$closeAll",{s:!0});var We=class{constructor(r){this.k=r}$createDir({prj:r},e){return r.dir.resolve(e).create("folder")?1:0}$fileExist({prj:r},e){let t=r.dir.resolve(e);return t.file()||this.k.projectLoader.exists(t)?1:0}$getClassDirectory(r){var e,t;return(t=(e=this.k.classes.get(r))==null?void 0:e.file.path.resolve("..").toString())!=null?t:""}$getProjectDirectory({prj:r}){return r.dir.toString()}$getWindowsDirectory(){return"C:\\Windows"}$getFileList({prj:r},e){let t=r.dir.resolve(e).resolveMany();if(!t.length)return 0;let s=t.map(o=>{let l=[["NAME",{type:"STRING",value:o.name}],["SIZE",{type:"FLOAT",value:o.size}],["ATTR",{type:"FLOAT",value:0}],["YEAR",{type:"FLOAT",value:Ge.getFullYear()}],["MONTH",{type:"FLOAT",value:Ge.getMonth()+1}],["DAY",{type:"FLOAT",value:Ge.getDate()}],["DAYOFWEEK",{type:"FLOAT",value:Ge.getDay()}],["HOUR",{type:"FLOAT",value:Ge.getHours()}],["MINUTE",{type:"FLOAT",value:Ge.getMinutes()}],["SECOND",{type:"FLOAT",value:Ge.getSeconds()}]];return{type:"STRUCT",realType:"FILE_ATTRIBUTE",value:new Map(l)}}),i=re.freeKey(this.k.arrays);return this.k.arrays.set(i,new Ye(s)),i}$addSlash(r){return r.length===0||r[r.length-1]==="\\"?r:r+"\\"}};a(We,"namespace","fs"),a(We,"$createDir",{s:!0,a:[E],r:d}),a(We,"$fileExist",{s:!0,a:[E],r:d}),a(We,"$getClassDirectory",{a:[E],r:E}),a(We,"$getProjectDirectory",{s:!0,r:E}),a(We,"$getWindowsDirectory",{r:E}),a(We,"$getFileList",{s:!0,a:[E,d],r:m}),a(We,"$addSlash",{a:[E],r:E});var D=class{constructor(r){this.k=r;a(this,"clipboard",null);a(this,"s");this.s=r.scenes}$getSpaceOrg2dx(r){var e,t;return(t=(e=this.s.get(r))==null?void 0:e.scene.x)!=null?t:0}$getSpaceOrg2dy(r){var e,t;return(t=(e=this.s.get(r))==null?void 0:e.scene.y)!=null?t:0}$setSpaceOrg2d(r,e,t){var s;return(s=this.s.get(r))!=null&&s.scene.set({x:e,y:t})?1:0}$getScaleSpace2d(r){var e,t;return(t=(e=this.s.get(r))==null?void 0:e.scene.scale)!=null?t:0}$setScaleSpace2d(r,e){var t;return(t=this.s.get(r))!=null&&t.scene.set({scale:e})?1:0}$saveRectArea2d(r,e,t,s,i,o,l){var T;let h=(T=this.s.get(r))==null?void 0:T.scene.toDataURL({x:s,y:i,w:o,h:l});if(!h)return 0;let p=e.replace("\\","/"),b=p.slice(p.lastIndexOf("/")+1,p.lastIndexOf(".")),y=document.createElement("a");return y.setAttribute("href",h.url),y.setAttribute("download",`${b||"Screenshot"}.${h.ext}`),y.style.display="none",document.body.appendChild(y),y.click(),document.body.removeChild(y),1}$getBkBrush2d(r){var e,t,s;return(s=(t=(e=this.s.get(r))==null?void 0:e.scene.background)==null?void 0:t.key)!=null?s:0}$setBkBrush2d(r,e){var s,i;let t=(s=this.s.get(r))==null?void 0:s.scene;return t!=null&&t.set({background:(i=t.brushes.get(e))!=null?i:null})?1:0}$lockSpace2d(){return 0}$getSpaceLayers2d(r){var e,t;return(t=(e=this.s.get(r))==null?void 0:e.scene.hiddenLayers)!=null?t:0}$setSpaceLayers2d(r,e){var t;return(t=this.s.get(r))!=null&&t.scene.set({hiddenLayers:e})?1:0}$setSpaceRenderEngine2d(){return 1}$createPen2d(r,e,t,s,i){var o,l;return(l=(o=this.s.get(r))==null?void 0:o.scene.pen({color:s,rop:i,style:e,width:t}).key)!=null?l:0}$getPenColor2d(r,e){var t,s,i;return(i=(s=(t=this.s.get(r))==null?void 0:t.scene.pens.get(e))==null?void 0:s.color)!=null?i:0}$getPenRop2d(r,e){var t,s,i;return(i=(s=(t=this.s.get(r))==null?void 0:t.scene.pens.get(e))==null?void 0:s.rop)!=null?i:0}$getPenStyle2d(r,e){var t,s,i;return(i=(s=(t=this.s.get(r))==null?void 0:t.scene.pens.get(e))==null?void 0:s.style)!=null?i:0}$getPenWidth2d(r,e){var t,s,i;return(i=(s=(t=this.s.get(r))==null?void 0:t.scene.pens.get(e))==null?void 0:s.width)!=null?i:0}$setPenColor2d(r,e,t){var s,i;return(i=(s=this.s.get(r))==null?void 0:s.scene.pens.get(e))!=null&&i.set({color:t})?1:0}$setPenRop2d(r,e,t){var s,i;return(i=(s=this.s.get(r))==null?void 0:s.scene.pens.get(e))!=null&&i.set({rop:t})?1:0}$setPenStyle2d(r,e,t){var s,i;return(i=(s=this.s.get(r))==null?void 0:s.scene.pens.get(e))!=null&&i.set({style:t})?1:0}$setPenWidth2d(r,e,t){var s,i;return(i=(s=this.s.get(r))==null?void 0:s.scene.pens.get(e))!=null&&i.set({width:t})?1:0}$createBrush2d(r,e,t,s,i,o){var h,p;let l=(h=this.s.get(r))==null?void 0:h.scene;return(p=l==null?void 0:l.brush({color:s,hatch:t,rop:o,style:e,image:l.imagesOpaque.get(i)}).key)!=null?p:0}$getBrushColor2d(r,e){var t,s,i;return(i=(s=(t=this.s.get(r))==null?void 0:t.scene.brushes.get(e))==null?void 0:s.color)!=null?i:0}$getBrushRop2d(r,e){var t,s,i;return(i=(s=(t=this.s.get(r))==null?void 0:t.scene.brushes.get(e))==null?void 0:s.rop)!=null?i:0}$getBrushStyle2d(r,e){var t,s,i;return(i=(s=(t=this.s.get(r))==null?void 0:t.scene.brushes.get(e))==null?void 0:s.style)!=null?i:0}$getBrushHatch2d(r,e){var t,s,i;return(i=(s=(t=this.s.get(r))==null?void 0:t.scene.brushes.get(e))==null?void 0:s.hatch)!=null?i:0}$getBrushDib2d(r,e){var t,s,i,o;return(o=(i=(s=(t=this.s.get(r))==null?void 0:t.scene.brushes.get(e))==null?void 0:s.image)==null?void 0:i.key)!=null?o:0}$setBrushColor2d(r,e,t){var s,i;return(i=(s=this.s.get(r))==null?void 0:s.scene.brushes.get(e))!=null&&i.set({color:t})?1:0}$setBrushRop2d(r,e,t){var s,i;return(i=(s=this.s.get(r))==null?void 0:s.scene.brushes.get(e))!=null&&i.set({rop:t})?1:0}$setBrushStyle2d(r,e,t){var s,i;return(i=(s=this.s.get(r))==null?void 0:s.scene.brushes.get(e))!=null&&i.set({style:t})?1:0}$setBrushHatch2d(r,e,t){var s,i;return(i=(s=this.s.get(r))==null?void 0:s.scene.brushes.get(e))!=null&&i.set({hatch:t})?1:0}$setBrushDib2d(r,e,t){var i,o,l;let s=(i=this.s.get(r))==null?void 0:i.scene;return(l=s==null?void 0:s.brushes.get(e))!=null&&l.set({image:(o=s.imagesOpaque.get(t))!=null?o:null})?1:0}createFont(r,e,t,s){var i,o;return(o=(i=this.s.get(r))==null?void 0:i.scene.font({name:e,size:t,style:s}).key)!=null?o:0}$createFont2d(r,e,t,s){return this.createFont(r,e,t,s)}$createFont2dpt(r,e,t,s){return this.createFont(r,e,t*yi,s)}$getFontName2d(r,e){var t,s,i;return(i=(s=(t=this.s.get(r))==null?void 0:t.scene.fonts.get(e))==null?void 0:s.name)!=null?i:""}$getFontSize2d(r,e){var t,s,i;return((i=(s=(t=this.s.get(r))==null?void 0:t.scene.fonts.get(e))==null?void 0:s.size)!=null?i:0)*bi}$getFontStyle2d(r,e){var t,s,i;return(i=(s=(t=this.s.get(r))==null?void 0:t.scene.fonts.get(e))==null?void 0:s.style)!=null?i:0}$setFontName2d(r,e,t){var s,i;return(i=(s=this.s.get(r))==null?void 0:s.scene.fonts.get(e))!=null&&i.set({name:t})?1:0}$setFontSize2d(r,e,t){var s,i;return(i=(s=this.s.get(r))==null?void 0:s.scene.fonts.get(e))!=null&&i.set({size:t})?1:0}$setFontStyle2d(r,e,t){var s,i;return(i=(s=this.s.get(r))==null?void 0:s.scene.fonts.get(e))!=null&&i.set({style:t})?1:0}$createString2d(r,e){var t,s;return(s=(t=this.s.get(r))==null?void 0:t.scene.string(e).key)!=null?s:0}$getString2d(r,e){var t,s,i;return(i=(s=(t=this.s.get(r))==null?void 0:t.scene.strings.get(e))==null?void 0:s.text)!=null?i:""}$setString2d(r,e,t){var s,i;return(i=(s=this.s.get(r))==null?void 0:s.scene.strings.get(e))!=null&&i.set({text:t})?1:0}$createText2d(r,e,t,s,i){var p;let o=(p=this.s.get(r))==null?void 0:p.scene;if(!o)return 0;let l=o.strings.get(t);if(!l)return 0;let h=o.fonts.get(e);return h?o.text([{string:l,font:h,fgcolor:s,bgcolor:i}]).key:0}$getTextCount2d(r,e){var t,s,i;return(i=(s=(t=this.s.get(r))==null?void 0:t.scene.texts.get(e))==null?void 0:s.parts.length)!=null?i:0}getTextPart(r,e,t){var i,o;if(t<0)return null;let s=(o=(i=this.s.get(r))==null?void 0:i.scene.texts.get(e))==null?void 0:o.parts;return s&&t<s.length?s[t]:null}$getTextFont2d(r,e,t=0){var s,i;return(i=(s=this.getTextPart(r,e,t))==null?void 0:s.font.key)!=null?i:0}$getTextString2d(r,e,t=0){var s,i;return(i=(s=this.getTextPart(r,e,t))==null?void 0:s.string.key)!=null?i:0}$getTextFgColor2d(r,e,t=0){var s,i;return(i=(s=this.getTextPart(r,e,t))==null?void 0:s.fgcolor)!=null?i:0}$getTextBkColor2d(r,e,t=0){var s,i;return(i=(s=this.getTextPart(r,e,t))==null?void 0:s.bgcolor)!=null?i:0}$setText2d(r,e,t,s,i,o,l){var R,W,N,j;let h=typeof l!="undefined"?t:0,p=typeof l!="undefined"?s:t,b=typeof l!="undefined"?i:s,y=typeof l!="undefined"?o:i,T=typeof l!="undefined"?l:o;if(h<0)return 0;let v=(R=this.s.get(r))==null?void 0:R.scene;if(!v)return 0;let _=(W=v.texts.get(e))==null?void 0:W.parts;if(!_||h>=_.length)return 0;let I=_[h];return I.string=(N=v.strings.get(b))!=null?N:I.string,I.font=(j=v.fonts.get(p))!=null?j:I.font,I.fgcolor=y,I.bgcolor=T,1}$setTextFont2d(r,e,t,s){var p,b;if(t<0)return 0;let i=(p=this.s.get(r))==null?void 0:p.scene;if(!i)return 0;let o=(b=i.texts.get(e))==null?void 0:b.parts;if(!o||t>=o.length)return 0;let l=o[t],h=i.fonts.get(s);return h?(l.font=h,1):0}$setTextString2d(r,e,t,s){var p,b;if(t<0)return 0;let i=(p=this.s.get(r))==null?void 0:p.scene;if(!i)return 0;let o=(b=i.texts.get(e))==null?void 0:b.parts;if(!o||t>=o.length)return 0;let l=o[t],h=i.strings.get(s);return h?(l.string=h,1):0}$setTextFgColor2d(r,e,t,s){let i=this.getTextPart(r,e,t);return i?(i.fgcolor=s,1):0}$setTextBkColor2d(r,e,t,s){let i=this.getTextPart(r,e,t);return i?(i.bgcolor=s,1):0}$addText2d(r,e,t,s,i,o,l){var N;if(typeof l!="undefined"&&t<0)return 0;let h=typeof l!="undefined"?s:t,p=typeof l!="undefined"?i:s,b=typeof l!="undefined"?o:i,y=typeof l!="undefined"?l:o,T=(N=this.s.get(r))==null?void 0:N.scene;if(!T)return 0;let v=T.texts.get(e);if(!v)return 0;let _=typeof l!="undefined"?t:v.parts.length;if(_>v.parts.length)return 0;let I=T.fonts.get(h);if(!I)return 0;let R=T.strings.get(p);if(!R)return 0;let W=v.parts.slice();return W.splice(_,0,{string:R,font:I,fgcolor:b,bgcolor:y}),v.set({parts:W}),1}$removeText2d(r,e,t){var l;if(t<0)return 0;let s=(l=this.s.get(r))==null?void 0:l.scene;if(!s)return 0;let i=s.texts.get(e);if(!i||t>=i.parts.length)return 0;let o=i.parts.slice();return o.splice(t,1),i.set({parts:o}),1}createImage({prj:r},e,t,s){var l,h;let i=(l=this.s.get(e))==null?void 0:l.scene;if(!i)return 0;let o=(h=r.dir.resolve(t).file())==null?void 0:h.image;return o?i.image(o,{opaque:s}).key:0}$createDIB2d(r,e,t){return this.createImage(r,e,t,!0)}$createDoubleDIB2d(r,e,t){return this.createImage(r,e,t)}$getDibPixel2d(r,e,t,s){var i,o,l;return(l=(o=(i=this.s.get(r))==null?void 0:i.scene.imagesOpaque.get(e))==null?void 0:o.pixel(t,s))!=null?l:0}$setDibPixel2d(r,e,t,s,i){var o,l;return(l=(o=this.s.get(r))==null?void 0:o.scene.imagesOpaque.get(e))!=null&&l.setPixel(t,s,i)?1:0}$deleteTool2d(r,e,t){var o,l;let s=(o=this.s.get(r))==null?void 0:o.scene;if(!s)return 0;let i;switch(e){case 1:i=s.pens;break;case 2:i=s.brushes;break;case 4:i=s.images;break;case 3:i=s.imagesOpaque;break;case 6:i=s.strings;break;case 5:i=s.fonts;break;case 7:i=s.texts;break;case 8:throw Error("\u041D\u0435 \u0440\u0435\u0430\u043B\u0438\u0437\u043E\u0432\u0430\u043D\u043E");default:return 0}return(l=i.get(t))!=null&&l.delete()?1:0}$getNextTool2d(r,e,t){var l;let s=(l=this.s.get(r))==null?void 0:l.scene;if(!s)return 0;let i;switch(e){case 1:i=s.pens;break;case 2:i=s.brushes;break;case 4:i=s.images;break;case 3:i=s.imagesOpaque;break;case 6:i=s.strings;break;case 5:i=s.fonts;break;case 7:i=s.texts;break;case 8:throw Error("\u041D\u0435 \u0440\u0435\u0430\u043B\u0438\u0437\u043E\u0432\u0430\u043D\u043E");default:return 0}let o=1/0;for(let h of i.keys())h>t&&h<o&&(o=h);return o===1/0?0:o}$getToolRef2d(r,e,t){var o,l,h;let s=(o=this.s.get(r))==null?void 0:o.scene;if(!s)return 0;let i;switch(e){case 1:i=s.pens;break;case 2:i=s.brushes;break;case 4:i=s.images;break;case 3:i=s.imagesOpaque;break;case 6:i=s.strings;break;case 5:i=s.fonts;break;case 7:i=s.texts;break;case 8:throw Error("\u041D\u0435 \u0440\u0435\u0430\u043B\u0438\u0437\u043E\u0432\u0430\u043D\u043E");default:return 0}return(h=(l=i.get(t))==null?void 0:l.refCount)!=null?h:0}$rgb(r,e,t){return Sr(r,e,t)}$rgbEx(r,e,t,s){return Sr(r,e,t,s===1?"transparent":s===2?"syscolor":"rgb")}$rgbf(r){return r&4294967295}$getRValue(r){return As(r)}$getGValue(r){return Ns(r)}$getBValue(r){return Rs(r)}$createObjectFromFile2d({prj:r},e,t,s,i,o){var p,b,y,T;let l=this.s.get(e);if(!l)return 0;let h=(b=(p=r.dir.resolve(t).file())==null?void 0:p.scene)==null?void 0:b.data;return h&&(T=(y=l.paste(h,s,i,o))==null?void 0:y.key)!=null?T:0}$deleteObject2d(r,e){var t,s;return(s=(t=this.s.get(r))==null?void 0:t.scene.objects.get(e))!=null&&s.delete()?1:0}$getObjectType2d(r,e){var s;let t=(s=this.s.get(r))==null?void 0:s.scene.objects.get(e);if(!t)return 0;switch(t.type){case"group":return 3;case"line":return 20;case"imageView":return t.opaque?21:22;case"textView":return 23;case"videoView":return 0;case"input":return 26}}$getObjectName2d(r,e){var t,s,i,o;return(o=(i=(s=(t=this.s.get(r))==null?void 0:t.scene.objects.get(e))==null?void 0:s.data)==null?void 0:i.name)!=null?o:""}$setObjectName2d(r,e,t){var i;let s=(i=this.s.get(r))==null?void 0:i.scene.objects.get(e);return s?(s.data=k(G({},s.data),{name:t}),1):0}$getObject2dByName(r,e,t){var o,l,h;if(!t)return 0;let s=(o=this.s.get(r))==null?void 0:o.scene;if(!s)return 0;let i;if(!e)i=s.objects.values();else{let p=s.objects.get(e);if((p==null?void 0:p.type)!=="group")return 0;if(((l=p.data)==null?void 0:l.name)===t)return p.key;i=p.descendants()}for(let p of i)if(((h=p.data)==null?void 0:h.name)===t)return p.key;return 0}$getObjectOrg2dx(r,e){let t=this.s.get(r);if(!t)return 0;let s=t.scene.objects.get(e);if(!s)return 0;let i=t.invmatrix;if(!i)return s.x;let o=s.x,l=s.y,h=o*i[2]+l*i[5]+i[8];return(o*i[0]+l*i[3]+i[6])/h}$getObjectOrg2dy(r,e){let t=this.s.get(r);if(!t)return 0;let s=t.scene.objects.get(e);if(!s)return 0;let i=t.invmatrix;if(!i)return s.y;let o=s.x,l=s.y,h=o*i[2]+l*i[5]+i[8];return(o*i[1]+l*i[4]+i[7])/h}$setObjectOrg2d(r,e,t,s){let i=this.s.get(r);if(!i)return 0;let o=i.scene.objects.get(e);if(!o)return 0;let l=t,h=s,p=i.matrix;if(p){let b=t*p[2]+s*p[5]+p[8];l=(t*p[0]+s*p[3]+p[6])/b,h=(t*p[1]+s*p[4]+p[7])/b}return o.set({x:l,y:h}),1}$getObjectWidth2d(r,e){var t,s,i;return(i=(s=(t=this.s.get(r))==null?void 0:t.scene.objects.get(e))==null?void 0:s.width)!=null?i:0}$getObjectHeight2d(r,e){var t,s,i;return(i=(s=(t=this.s.get(r))==null?void 0:t.scene.objects.get(e))==null?void 0:s.height)!=null?i:0}$setObjectSize2d(r,e,t,s){var i,o;return(o=(i=this.s.get(r))==null?void 0:i.scene.objects.get(e))!=null&&o.set({width:t,height:s})?1:0}$getActualWidth2d(r,e){var s;let t=(s=this.s.get(r))==null?void 0:s.scene.objects.get(e);if(!t)return 0;switch(t.type){case"group":case"line":case"input":return t.width;case"imageView":return t.image.width;case"textView":return t.text.width;case"videoView":return t.video.width}}$getActualHeight2d(r,e){var s;let t=(s=this.s.get(r))==null?void 0:s.scene.objects.get(e);if(!t)return 0;switch(t.type){case"group":case"line":case"input":return t.height;case"imageView":return t.image.height;case"textView":return t.text.height;case"videoView":return t.video.height}}$getActualSize2d(r,e,t,s,i,o){var h;let l=(h=this.s.get(r))==null?void 0:h.scene.objects.get(e);if(!l)return t[s]=0,i[o]=0,0;switch(l.type){case"group":case"line":case"input":return t[s]=l.width,i[o]=l.height,1;case"imageView":return t[s]=l.image.width,i[o]=l.image.height,1;case"textView":return t[s]=l.text.width,i[o]=l.text.height,1;case"videoView":return t[s]=l.video.width,i[o]=l.video.height,1}}$getObjectAngle2d(r,e){var s;let t=(s=this.s.get(r))==null?void 0:s.scene.objects.get(e);return t&&t.type==="textView"?t.angle:0}$rotateObject2d(r,e,t,s,i){let o=this.s.get(r);if(!o)return 0;let l=o.scene.objects.get(e);if(!l)return 0;let h=t,p=s,b=o.matrix;if(b){let y=t*b[2]+s*b[5]+b[8];h=(t*b[0]+s*b[3]+b[6])/y,p=(t*b[1]+s*b[4]+b[7])/y}return l.rotate(i,{x:h,y:p}),1}setShow(r,e,t){var o;let s=(o=this.s.get(r))==null?void 0:o.scene.objects.get(e);if(!s)return 0;let i=t?s.attrib&-2:s.attrib|1;return s.set({attrib:i}),1}$setShowObject2d(r,e,t){return this.setShow(r,e,!!t)}$showObject2d(r,e){this.setShow(r,e,!0)}$hideObject2d(r,e){this.setShow(r,e,!1)}$getObjectFromPoint2d(r,e,t){var s,i,o;return(o=(i=(s=this.s.get(r))==null?void 0:s.pick(e,t,!0))==null?void 0:i.key)!=null?o:0}$getLastPrimary2d(){return this.k.lastPickedPrimaryKey}$copyToClipboard2d(r,e){var s;let t=(s=this.s.get(r))==null?void 0:s.scene.objects.get(e);return t?(this.clipboard=Fs([t]),1):0}$pasteFromClipboard2d(r,e,t,s){var o,l,h;let i=this.clipboard;return i&&(h=(l=(o=this.s.get(r))==null?void 0:o.paste(i,e,t,s))==null?void 0:l.key)!=null?h:0}$lockObject2d(r,e,t){var o;let s=(o=this.s.get(r))==null?void 0:o.scene.objects.get(e);if(!s)return 0;let i=s.attrib;switch(t){case 0:i&=-13;break;case 1:i&=-5,i|=8;break;case 2:i&=-9,i|=4;break;default:return 0}return s.set({attrib:i}),1}$getObjectAttribute2d(r,e){var t,s,i;return(i=(s=(t=this.s.get(r))==null?void 0:t.scene.objects.get(e))==null?void 0:s.attrib)!=null?i:0}$setObjectAttribute2d(r,e,t,s){var l;let i=(l=this.s.get(r))==null?void 0:l.scene.objects.get(e);if(!i)return 0;let{attrib:o}=i;switch(s){case 1:o|=t;break;case 2:o&=~t;break;case 3:o=t;break;default:return 0}return i.set({attrib:o}),1}$getNextObject2d(r,e){var i;let t=(i=this.s.get(r))==null?void 0:i.scene;if(!t)return 0;let s=1/0;for(let o of t.objects.keys())o>e&&o<s&&(s=o);return s===1/0?0:s}$isObjectsIntersect2d(r,e,t){var l;let s=(l=this.s.get(r))==null?void 0:l.scene;if(!s)return 0;let i=s.objects.get(e);if(!i)return 0;let o=s.objects.get(t);return o&&i.x+i.width>=o.x&&o.x+o.width>=i.x&&i.y+i.height>=o.y&&o.y+o.height>=i.y?1:0}$getBottomObject2d(r){var t;let e=(t=this.s.get(r))==null?void 0:t.scene.order;return e&&e.length>0?e[0].key:0}$getTopObject2d(r){var t;let e=(t=this.s.get(r))==null?void 0:t.scene.order;return e&&e.length>0?e[e.length-1].key:0}$getLowerObject2d(r,e){var l;let t=(l=this.s.get(r))==null?void 0:l.scene;if(!t)return 0;let s=t.objects.get(e);if(!s||s.type==="group")return 0;let i=t.order,o=i.indexOf(s);return o<1?0:i[o-1].key}$getUpperObject2d(r,e){var l;let t=(l=this.s.get(r))==null?void 0:l.scene;if(!t)return 0;let s=t.objects.get(e);if(!s||s.type==="group")return 0;let i=t.order,o=i.indexOf(s);return o>-1&&o<i.length-1?i[o+1].key:0}$getObjectFromZOrder2d(r,e){var i;let t=e-1;if(t<0)return 0;let s=(i=this.s.get(r))==null?void 0:i.scene.order;return s&&t<s.length?s[t].key:0}$getZOrder2d(r,e){var l;let t=(l=this.s.get(r))==null?void 0:l.scene;if(!t)return 0;let s=t.objects.get(e);if(!s||s.type==="group")return 0;let o=t.order.indexOf(s);return o<0?0:o+1}$setZOrder2d(r,e,t){var p;let s=t-1;if(s<0)return 0;let i=(p=this.s.get(r))==null?void 0:p.scene;if(!i)return 0;let o=i.objects.get(e);if(!o||o.type==="group")return 0;let l=i.order,h=[];for(let b=0;b<l.length;++b){s===b&&h.push(o);let y=l[b];y!==o&&h.push(y)}return s>=l.length&&h.push(o),i.set({order:h}),1}$objectToBottom2d(r,e){var o;let t=(o=this.s.get(r))==null?void 0:o.scene;if(!t)return 0;let s=t.objects.get(e);if(!s||s.type==="group")return 0;let i=t.order.filter(l=>l!==s);return i.unshift(s),t.set({order:i}),1}$objectToTop2d(r,e){var o;let t=(o=this.s.get(r))==null?void 0:o.scene;if(!t)return 0;let s=t.objects.get(e);if(!s||s.type==="group")return 0;let i=t.order.filter(l=>l!==s);return i.push(s),t.set({order:i}),1}$swapObject2d(r,e,t){var y;let s=(y=this.s.get(r))==null?void 0:y.scene;if(!s)return 0;let i=s.objects.get(e);if(!i||i.type==="group")return 0;let o=s.objects.get(t);if(!o||o.type==="group")return 0;let l=s.order.slice(),h=l.indexOf(i);if(h<0)return 0;let p=l.indexOf(o);if(p<0)return 0;let b=l[h];return l[h]=l[p],l[p]=b,s.set({order:l}),1}createLine(r,e,t,s){let i=this.s.get(r);if(!i)return 0;let{matrix:o,scene:l}=i;if(o)for(let p=0;p<s.length;p+=2){let b=s[p+0],y=s[p+1],T=b*o[2]+y*o[5]+o[8];s[p+0]=(b*o[0]+y*o[3]+o[6])/T,s[p+1]=(b*o[1]+y*o[4]+o[7])/T}let h=l.line(s,{pen:l.pens.get(e),brush:l.brushes.get(t)});return l.set({order:l.order.concat(h)}),h.key}$createPolyLine2d(r,e,t,...s){return this.createLine(r,e,t,s)}$createLine2d(r,e,t,s,i){return this.createLine(r,e,t,[s,i])}$addPoint2d(r,e,t,s,i){let o=this.s.get(r);if(!o)return 0;let l=o.scene.objects.get(e);if((l==null?void 0:l.type)!=="line")return 0;let h=s,p=i,b=o.matrix;if(b){let y=s*b[2]+i*b[5]+b[8];h=(s*b[0]+i*b[3]+b[6])/y,p=(s*b[1]+i*b[4]+b[7])/y}return l.addPoint({x:h,y:p},t)?1:0}$setVectorPoint2d(r,e,t,s,i){let o=this.s.get(r);if(!o)return 0;let l=o.scene.objects.get(e);if((l==null?void 0:l.type)!=="line")return 0;let h=s,p=i,b=o.matrix;if(b){let y=s*b[2]+i*b[5]+b[8];h=(s*b[0]+i*b[3]+b[6])/y,p=(s*b[1]+i*b[4]+b[7])/y}return l.setPoint(t,{x:h,y:p})?1:0}$delPoint2d(r,e,t){var i;let s=(i=this.s.get(r))==null?void 0:i.scene.objects.get(e);return(s==null?void 0:s.type)==="line"&&s.delPoint(t)?1:0}$getPenObject2d(r,e){var s,i;let t=(s=this.s.get(r))==null?void 0:s.scene.objects.get(e);return(t==null?void 0:t.type)==="line"&&((i=t.pen)==null?void 0:i.key)||0}$getBrushObject2d(r,e){var s,i;let t=(s=this.s.get(r))==null?void 0:s.scene.objects.get(e);return(t==null?void 0:t.type)==="line"&&((i=t.brush)==null?void 0:i.key)||0}$getVectorNumPoints2d(r,e){var s;let t=(s=this.s.get(r))==null?void 0:s.scene.objects.get(e);return(t==null?void 0:t.type)==="line"?t.length:0}$getVectorPoint2dx(r,e,t){let s=this.s.get(r);if(!s)return 0;let i=s.scene.objects.get(e),o=(i==null?void 0:i.type)==="line"&&i.point(t);if(!o)return 0;let{x:l,y:h}=o,p=s.invmatrix;if(!p)return l;let b=l*p[2]+h*p[5]+p[8];return(l*p[0]+h*p[3]+p[6])/b}$getVectorPoint2dy(r,e,t){let s=this.s.get(r);if(!s)return 0;let i=s.scene.objects.get(e),o=(i==null?void 0:i.type)==="line"&&i.point(t);if(!o)return 0;let{x:l,y:h}=o,p=s.invmatrix;if(!p)return h;let b=l*p[2]+h*p[5]+p[8];return(l*p[1]+h*p[4]+p[7])/b}$setBrushObject2d(r,e,t){var o,l;let s=(o=this.s.get(r))==null?void 0:o.scene;if(!s)return 0;let i=s.objects.get(e);return(i==null?void 0:i.type)==="line"&&i.set({brush:(l=s.brushes.get(t))!=null?l:null})?1:0}$setPenObject2d(r,e,t){var o,l;let s=(o=this.s.get(r))==null?void 0:o.scene;if(!s)return 0;let i=s.objects.get(e);return(i==null?void 0:i.type)==="line"&&i.set({pen:(l=s.pens.get(t))!=null?l:null})?1:0}$setLineArrows2d(r,e,t,s,i,o,l,h){var T;let p=(T=this.s.get(r))==null?void 0:T.scene.objects.get(e);if((p==null?void 0:p.type)!=="line")return 0;let b={angle:t,length:s,fill:!!i},y={angle:o,length:l,fill:!!h};return p.set({start:b,end:y}),1}$createGroup2d(r,...e){var o;let t=(o=this.s.get(r))==null?void 0:o.scene;if(!t)return 0;let s=!0,i=e.map(l=>{let h=t.objects.get(l);return(!h||h.parent)&&(s=!1),h});return s?t.group(i).key:0}$deleteGroup2d(r,e){var s;let t=(s=this.s.get(r))==null?void 0:s.scene.objects.get(e);return(t==null?void 0:t.type)==="group"&&t.set({children:[]}).delete()?1:0}$addGroupItem2d(r,e,t){var l;if(e===t)return 0;let s=(l=this.s.get(r))==null?void 0:l.scene;if(!s)return 0;let i=s.objects.get(e);if((i==null?void 0:i.type)!=="group")return 0;let o=s.objects.get(t);if(!o||o.parent)return 0;if(o.type==="group"){let h=i;for(;h=h.parent;)if(h===o)return 0}return i.set({children:i.children.concat(o)}),1}$delGroupItem2d(r,e,t){var l;let s=(l=this.s.get(r))==null?void 0:l.scene;if(!s)return 0;let i=s.objects.get(e);if((i==null?void 0:i.type)!=="group")return 0;let o=s.objects.get(t);return(o==null?void 0:o.parent)!==i?0:(i.set({children:i.children.filter(h=>h!==o)}),1)}$getGroupItemsNum2d(r,e){var s;let t=(s=this.s.get(r))==null?void 0:s.scene.objects.get(e);return(t==null?void 0:t.type)==="group"?t.children.length:0}$getGroupItem2d(r,e,t){var o;if(t<0)return 0;let s=(o=this.s.get(r))==null?void 0:o.scene.objects.get(e);if((s==null?void 0:s.type)!=="group")return 0;let i=s.children;return t<i.length?i[t].key:0}$getObjectParent2d(r,e){var t,s,i,o;return(o=(i=(s=(t=this.s.get(r))==null?void 0:t.scene.objects.get(e))==null?void 0:s.parent)==null?void 0:i.key)!=null?o:0}$isGroupContainObject2d(r,e,t){var o;let s=(o=this.s.get(r))==null?void 0:o.scene;if(!s)return 0;let i=s.objects.get(e);if((i==null?void 0:i.type)!=="group")return 0;for(let l=0;l<i.children.length;++l){let h=i.children[l];if(h.key===t)return l+1;if(h.type==="group"){for(let p of h.descendants())if(p.key===t)return l+1}}return 0}createImageView(r,e,t,s,i){let o=this.s.get(r);if(!o)return 0;let l=o.scene,h=(i?l.imagesOpaque:l.images).get(e);if(!h)return 0;let p=t,b=s,y=o.matrix;if(y){let v=t*y[2]+s*y[5]+y[8];p=(t*y[0]+s*y[3]+y[6])/v,b=(t*y[1]+s*y[4]+y[7])/v}let T=l.imageView(h,{x:p,y:b,opaque:i});return l.set({order:l.order.concat(T)}),T.key}$createBitmap2d(r,e,t,s){return this.createImageView(r,e,t,s,!0)}$createDoubleBitmap2d(r,e,t,s){return this.createImageView(r,e,t,s)}$getBitmapSrcRect2d(r,e,t,s,i,o,l,h,p,b){var v,_,I,R,W;let y=(v=this.s.get(r))==null?void 0:v.scene.objects.get(e);if((y==null?void 0:y.type)!=="imageView")return t[s]=0,i[o]=0,l[h]=0,p[b]=0,0;let T=y.area;return t[s]=(_=T==null?void 0:T.x)!=null?_:0,i[o]=(I=T==null?void 0:T.y)!=null?I:0,l[h]=(R=T==null?void 0:T.w)!=null?R:y.image.width,p[b]=(W=T==null?void 0:T.h)!=null?W:y.image.height,1}$setBitmapSrcRect2d(r,e,t,s,i,o){var h;let l=(h=this.s.get(r))==null?void 0:h.scene.objects.get(e);return(l==null?void 0:l.type)==="imageView"&&l.set({area:{x:t,y:s,w:i,h:o}})?1:0}$getDibObject2d(r,e){var s;let t=(s=this.s.get(r))==null?void 0:s.scene.objects.get(e);return(t==null?void 0:t.type)==="imageView"&&t.opaque&&t.image.key||0}$getDDibObject2d(r,e){var s;let t=(s=this.s.get(r))==null?void 0:s.scene.objects.get(e);return(t==null?void 0:t.type)==="imageView"&&!t.opaque&&t.image.key||0}$setDibObject2d(r,e,t){var l;let s=(l=this.s.get(r))==null?void 0:l.scene;if(!s)return 0;let i=s.imagesOpaque.get(t);if(!i)return 0;let o=s.objects.get(e);return(o==null?void 0:o.type)==="imageView"&&o.opaque&&o.set({image:i})?1:0}$setDDibObject2d(r,e,t){var l;let s=(l=this.s.get(r))==null?void 0:l.scene;if(!s)return 0;let i=s.images.get(t);if(!i)return 0;let o=s.objects.get(e);return(o==null?void 0:o.type)==="imageView"&&!o.opaque&&o.set({image:i})?1:0}$createRasterText2d(r,e,t,s,i){let o=this.s.get(r);if(!o)return 0;let l=o.scene,h=l.texts.get(e);if(!h)return 0;let p=t,b=s,y=o.matrix;if(y){let v=t*y[2]+s*y[5]+y[8];p=(t*y[0]+s*y[3]+y[6])/v,b=(t*y[1]+s*y[4]+y[7])/v}let T=l.textView(h,{x:p,y:b,angle:i});return l.set({order:l.order.concat(T)}),T.key}$getTextObject2d(r,e){var s;let t=(s=this.s.get(r))==null?void 0:s.scene.objects.get(e);return(t==null?void 0:t.type)==="textView"&&t.text.key||0}};a(D,"namespace","g"),a(D,"$getSpaceOrg2dx",{a:[m],r:d}),a(D,"$getSpaceOrg2dy",{a:[m],r:d}),a(D,"$setSpaceOrg2d",{a:[m,d,d],r:d}),a(D,"$getScaleSpace2d",{a:[m],r:d}),a(D,"$setScaleSpace2d",{a:[m,d],r:d}),a(D,"$saveRectArea2d",{a:[m,E,d,d,d,d,d],r:d}),a(D,"$getBkBrush2d",{a:[m],r:m}),a(D,"$setBkBrush2d",{a:[m,m],r:d}),a(D,"$lockSpace2d",{a:[m,d],r:d}),a(D,"$getSpaceLayers2d",{a:[m],r:d}),a(D,"$setSpaceLayers2d",{a:[m,d],r:d}),a(D,"$setSpaceRenderEngine2d",{a:[m,d],r:d}),a(D,"$createPen2d",{a:[m,d,d,C,d],r:m}),a(D,"$getPenColor2d",{a:[m,m],r:C}),a(D,"$getPenRop2d",{a:[m,m],r:d}),a(D,"$getPenStyle2d",{a:[m,m],r:d}),a(D,"$getPenWidth2d",{a:[m,m],r:d}),a(D,"$setPenColor2d",{a:[m,m,C],r:d}),a(D,"$setPenRop2d",{a:[m,m,d],r:d}),a(D,"$setPenStyle2d",{a:[m,m,d],r:d}),a(D,"$setPenWidth2d",{a:[m,m,d],r:d}),a(D,"$createBrush2d",{a:[m,d,d,C,m,d],r:m}),a(D,"$getBrushColor2d",{a:[m,m],r:C}),a(D,"$getBrushRop2d",{a:[m,m],r:d}),a(D,"$getBrushStyle2d",{a:[m,m],r:d}),a(D,"$getBrushHatch2d",{a:[m,m],r:d}),a(D,"$getBrushDib2d",{a:[m,m],r:m}),a(D,"$setBrushColor2d",{a:[m,m,C],r:d}),a(D,"$setBrushRop2d",{a:[m,m,d],r:d}),a(D,"$setBrushStyle2d",{a:[m,m,d],r:d}),a(D,"$setBrushHatch2d",{a:[m,m,d],r:d}),a(D,"$setBrushDib2d",{a:[m,m,m],r:d}),a(D,"$createFont2d",{a:[m,E,d,d],r:m}),a(D,"$createFont2dpt",{a:[m,E,d,d],r:m}),a(D,"$getFontName2d",{a:[m,m],r:E}),a(D,"$getFontSize2d",{a:[m,m],r:d}),a(D,"$getFontStyle2d",{a:[m,m],r:d}),a(D,"$setFontName2d",{a:[m,m,E],r:d}),a(D,"$setFontSize2d",{a:[m,m,d],r:d}),a(D,"$setFontStyle2d",{a:[m,m,d],r:d}),a(D,"$createString2d",{a:[m,E],r:m}),a(D,"$getString2d",{a:[m,m],r:E}),a(D,"$setString2d",{a:[m,m,E],r:d}),a(D,"$createText2d",{a:[m,m,m,C,C],r:m}),a(D,"$getTextCount2d",{a:[m,m],r:d}),a(D,"$getTextFont2d",{a:[m,m],r:m}),a(D,"$getTextFont2d$2",{a:[m,m,d],r:m}),a(D,"$getTextString2d",{a:[m,m],r:m}),a(D,"$getTextString2d$2",{a:[m,m,d],r:m}),a(D,"$getTextFgColor2d",{a:[m,m],r:C}),a(D,"$getTextFgColor2d$2",{a:[m,m,d],r:C}),a(D,"$getTextBkColor2d",{a:[m,m],r:C}),a(D,"$getTextBkColor2d$2",{a:[m,m,d],r:C}),a(D,"$setText2d",{a:[m,m,m,m,C,C],r:d}),a(D,"$setText2d$2",{a:[m,m,d,m,m,C,C],r:d}),a(D,"$setTextFont2d",{a:[m,m,d,m],r:d}),a(D,"$setTextString2d",{a:[m,m,d,m],r:d}),a(D,"$setTextFgColor2d",{a:[m,m,d,C],r:d}),a(D,"$setTextBkColor2d",{a:[m,m,d,C],r:d}),a(D,"$addText2d",{a:[m,m,d,m,m,C,C],r:d}),a(D,"$addText2d$2",{a:[m,m,m,m,C,C],r:d}),a(D,"$removeText2d",{a:[m,m,d],r:d}),a(D,"$createDIB2d",{s:!0,a:[m,E],r:m}),a(D,"$createDoubleDIB2d",{s:!0,a:[m,E],r:m}),a(D,"$getDibPixel2d",{a:[m,m,d,d],r:C}),a(D,"$setDibPixel2d",{a:[m,m,d,d,C],r:d}),a(D,"$deleteTool2d",{a:[m,d,m],r:d}),a(D,"$getNextTool2d",{a:[m,d,m],r:m}),a(D,"$getToolRef2d",{a:[m,d,m],r:d}),a(D,"$rgb",{a:[d,d,d],r:C}),a(D,"$rgbEx",{a:[d,d,d,d],r:C}),a(D,"$rgbf",{a:[d],r:C}),a(D,"$getRValue",{a:[C],r:d}),a(D,"$getGValue",{a:[C],r:d}),a(D,"$getBValue",{a:[C],r:d}),a(D,"$createObjectFromFile2d",{s:!0,a:[m,E,d,d,d],r:m}),a(D,"$deleteObject2d",{a:[m,m],r:d}),a(D,"$getObjectType2d",{a:[m,m],r:d}),a(D,"$getObjectName2d",{a:[m,m],r:E}),a(D,"$setObjectName2d",{a:[m,m,E],r:d}),a(D,"$getObject2dByName",{a:[m,m,E],r:m}),a(D,"$getObjectOrg2dx",{a:[m,m],r:d}),a(D,"$getObjectOrg2dy",{a:[m,m],r:d}),a(D,"$setObjectOrg2d",{a:[m,m,d,d],r:d}),a(D,"$getObjectWidth2d",{a:[m,m],r:d}),a(D,"$getObjectHeight2d",{a:[m,m],r:d}),a(D,"$setObjectSize2d",{a:[m,m,d,d],r:d}),a(D,"$getActualWidth2d",{a:[m,m],r:d}),a(D,"$getActualHeight2d",{a:[m,m],r:d}),a(D,"$getActualSize2d",{a:[m,m,ee,ee],r:d}),a(D,"$getObjectAngle2d",{a:[m,m],r:d}),a(D,"$rotateObject2d",{a:[m,m,d,d,d],r:d}),a(D,"$setShowObject2d",{a:[m,m,d],r:d}),a(D,"$showObject2d",{a:[m,m]}),a(D,"$hideObject2d",{a:[m,m]}),a(D,"$getObjectFromPoint2d",{a:[m,d,d],r:m}),a(D,"$getLastPrimary2d",{r:m}),a(D,"$copyToClipboard2d",{a:[m,m],r:d}),a(D,"$pasteFromClipboard2d",{a:[m,d,d,d],r:m}),a(D,"$lockObject2d",{a:[m,m,d],r:d}),a(D,"$getObjectAttribute2d",{a:[m,m],r:d}),a(D,"$setObjectAttribute2d",{a:[m,m,d,d],r:d}),a(D,"$getNextObject2d",{a:[m,m],r:m}),a(D,"$isObjectsIntersect2d",{a:[m,m,m,d],r:d}),a(D,"$getBottomObject2d",{a:[m],r:m}),a(D,"$getTopObject2d",{a:[m],r:m}),a(D,"$getLowerObject2d",{a:[m,m],r:m}),a(D,"$getUpperObject2d",{a:[m,m],r:m}),a(D,"$getObjectFromZOrder2d",{a:[m,d],r:m}),a(D,"$getZOrder2d",{a:[m,m],r:d}),a(D,"$setZOrder2d",{a:[m,m,d],r:d}),a(D,"$objectToBottom2d",{a:[m,m],r:d}),a(D,"$objectToTop2d",{a:[m,m],r:d}),a(D,"$swapObject2d",{a:[m,m,m],r:d}),a(D,"$createPolyLine2d",{a:[m,m,m,[d,d]],r:m}),a(D,"$createLine2d",{a:[m,m,m,d,d],r:m}),a(D,"$addPoint2d",{a:[m,m,d,d,d],r:d}),a(D,"$setVectorPoint2d",{a:[m,m,d,d,d],r:d}),a(D,"$delPoint2d",{a:[m,m,d],r:d}),a(D,"$getPenObject2d",{a:[m,m],r:m}),a(D,"$getBrushObject2d",{a:[m,m],r:m}),a(D,"$getVectorNumPoints2d",{a:[m,m],r:d}),a(D,"$getVectorPoint2dx",{a:[m,m,d],r:d}),a(D,"$getVectorPoint2dy",{a:[m,m,d],r:d}),a(D,"$setBrushObject2d",{a:[m,m,m],r:m}),a(D,"$setPenObject2d",{a:[m,m,m],r:m}),a(D,"$setLineArrows2d",{a:[m,m,d,d,d,d,d,d],r:d}),a(D,"$createGroup2d",{a:[m,[m]],r:m}),a(D,"$deleteGroup2d",{a:[m,m],r:d}),a(D,"$addGroupItem2d",{a:[m,m,m],r:d}),a(D,"$delGroupItem2d",{a:[m,m,m],r:d}),a(D,"$getGroupItemsNum2d",{a:[m,m],r:d}),a(D,"$getGroupItem2d",{a:[m,m,d],r:m}),a(D,"$getObjectParent2d",{a:[m,m],r:m}),a(D,"$isGroupContainObject2d",{a:[m,m,m],r:d}),a(D,"$createBitmap2d",{a:[m,m,d,d],r:m}),a(D,"$createDoubleBitmap2d",{a:[m,m,d,d],r:m}),a(D,"$getBitmapSrcRect2d",{a:[m,m,ee,ee,ee,ee],r:d}),a(D,"$setBitmapSrcRect2d",{a:[m,m,d,d,d,d],r:d}),a(D,"$getDibObject2d",{a:[m,m],r:m}),a(D,"$getDDibObject2d",{a:[m,m],r:m}),a(D,"$setDibObject2d",{a:[m,m,m],r:d}),a(D,"$setDDibObject2d",{a:[m,m,m],r:d}),a(D,"$createRasterText2d",{a:[m,m,d,d,d],r:m}),a(D,"$getTextObject2d",{a:[m,m],r:m});var Se=class{constructor(r){this.k=r;a(this,"s");this.s=r.scenes}$createControlObject2d(r,e,t,s,i,o,l,h){let p;switch(e.toUpperCase()){case"EDIT":p="Edit";break;case"BUTTON":p="Button";break;case"COMBOBOX":p="ComboBox";break;case"LISTBOX":p="ListBox";break;default:return 0}let b=this.s.get(r);if(!b)return 0;let y=b.scene,T=i,v=o,_=b.matrix;if(_){let R=i*_[2]+o*_[5]+_[8];T=(i*_[0]+o*_[3]+_[6])/R,v=(i*_[1]+o*_[4]+_[7])/R}let I=y.input(p,{x:T,y:v,width:l,height:h,value:t,style:s});return y.set({order:y.order.concat(I)}),I.key}$getControlText2d(r,e,t,s){var l;let i=(l=this.s.get(r))==null?void 0:l.scene.objects.get(e);if((i==null?void 0:i.type)!=="input")return"";let{value:o}=i;return typeof t=="undefined"?o:o.slice(t,t+s)}$setControlText2d(r,e,t){var i;let s=(i=this.s.get(r))==null?void 0:i.scene.objects.get(e);return(s==null?void 0:s.type)==="input"&&s.set({value:t})?1:0}$setControlFont2d(r,e,t){var o,l;let s=(o=this.s.get(r))==null?void 0:o.scene;if(!s)return 0;let i=s.objects.get(e);return(i==null?void 0:i.type)==="input"&&i.set({font:(l=s.fonts.get(t))!=null?l:null})?1:0}$enableControl2d(){return this.k._functionNotImplemented("EnableControl2d"),0}$isDlgButtonChecked2d(){return this.k._functionNotImplemented("IsDlgButtonChecked"),0}$checkDlgButton2d(){return this.k._functionNotImplemented("CheckDlgButton2d"),1}};a(Se,"namespace","c"),a(Se,"$createControlObject2d",{a:[m,E,E,d,d,d,d,d,d],r:m}),a(Se,"$getControlText2d",{a:[m,m],r:E}),a(Se,"$getControlText2d$2",{a:[m,m,d,d],r:E}),a(Se,"$setControlText2d",{a:[m,m,E],r:d}),a(Se,"$setControlFont2d",{a:[m,m,m],r:d}),a(Se,"$enableControl2d",{a:[m,m,d],r:d}),a(Se,"$isDlgButtonChecked2d",{a:[m,m],r:d}),a(Se,"$checkDlgButton2d",{a:[m,m,d],r:d});var ie=class{constructor(r){this.k=r;a(this,"matrices");this.matrices=r.matrices}$mCreate(r,e,t,s,i,o){if(o<=0)return 0;let l=Math.floor(t)-Math.floor(e)+1,h=Math.floor(i)-Math.floor(s)+1;if(l<=0||h<=0)return 0;let p=r||re.freeNegativeKey(this.matrices);return this.matrices.set(p,new ge({rows:l,cols:h,minV:e,minH:s})),p}$mDelete(r,e){return e<=0?0:this.matrices.delete(r)?1:0}$mFill(r,e,t){var s,i;return t<=0?0:(i=(s=this.matrices.get(r))==null?void 0:s.fill(e))!=null?i:0}$mGet(r,e,t,s){var i,o;return s<=0?0:(o=(i=this.matrices.get(r))==null?void 0:i.get(e,t))!=null?o:0}$mPut(r,e,t,s,i){var o,l;return i<=0?0:(l=(o=this.matrices.get(r))==null?void 0:o.set(e,t,s))!=null?l:0}$mEditor(r,e){if(e<=0)return 0;throw Error("MEditor: \u0440\u0435\u0434\u0430\u043A\u0442\u043E\u0440 \u043C\u0430\u0442\u0440\u0438\u0446 \u043D\u0435 \u0440\u0435\u0430\u043B\u0438\u0437\u043E\u0432\u0430\u043D")}$mDiag(r,e,t){var s,i;return t<=0?0:(i=(s=this.matrices.get(r))==null?void 0:s.diag(e))!=null?i:0}$mDet(r,e){if(e<=0)return 0;let t=this.matrices.get(r);return!t||!t.isSquare()?0:t.det()}$mSum(r,e){var t,s;return e<=0?0:(s=(t=this.matrices.get(r))==null?void 0:t.sum())!=null?s:0}$mMul(r,e,t,s){if(s<=0)return 0;let i=this.matrices.get(r),o=this.matrices.get(e);if(!i||!o)return 0;let l=ge.mul(i,o);if(!l)return 0;let h=t||re.freeNegativeKey(this.matrices);return this.matrices.set(h,l),h}$mGlue(r,e,t,s,i,o){if(o<=0)return 0;let l=this.matrices.get(r),h=this.matrices.get(e);if(!l||!h)return 0;let p=t||re.freeNegativeKey(this.matrices);return this.matrices.set(p,ge.glue(l,h,Math.floor(s),Math.floor(i))),p}$mObr(r,e,t){if(t<=0)return 0;let s=this.matrices.get(r);if(!s)return 0;let i=s.obr();if(!i)return 0;let o=e||re.freeNegativeKey(this.matrices);return this.matrices.set(o,i),o}$mSaveAs({prj:r},e,t,s){if(s<=0)return 0;let i=this.matrices.get(e);if(!i)return 0;let o=r.dir.resolve(t).create("file");return o?(o.set({mat:i.data()}),1):0}$mLoad({prj:r},e,t,s){var l;if(s<=0)return 0;let i=(l=r.dir.resolve(t).file())==null?void 0:l.mat;if(!i)return 0;let o=e||re.freeNegativeKey(this.matrices);return this.matrices.set(o,new ge(i)),o}$mSort(r,e,t,s){if(s<=0)return 0;let i=this.matrices.get(r);if(!i)return 0;switch(t){case 1:return i.sortByColumn(e,!1);case 2:return i.sortByColumn(e,!0);case 3:return i.sortByRow(e,!1);case 4:return i.sortByRow(e,!0);default:return 0}}};a(ie,"namespace","m"),a(ie,"$mCreate",{a:[d,d,d,d,d,d],r:d}),a(ie,"$mDelete",{a:[d,d],r:d}),a(ie,"$mFill",{a:[d,d,d],r:d}),a(ie,"$mGet",{a:[d,d,d,d],r:d}),a(ie,"$mPut",{a:[d,d,d,d,d],r:d}),a(ie,"$mEditor",{a:[d,d]}),a(ie,"$mDiag",{a:[d,d,d],r:d}),a(ie,"$mDet",{a:[d,d],r:d}),a(ie,"$mSum",{a:[d,d],r:d}),a(ie,"$mMul",{a:[d,d,d,d],r:d}),a(ie,"$mGlue",{a:[d,d,d,d,d,d],r:d}),a(ie,"$mObr",{a:[d,d,d],r:d}),a(ie,"$mSaveAs",{s:!0,a:[d,E,d],r:d}),a(ie,"$mLoad",{s:!0,a:[d,E,d],r:d}),a(ie,"$mSort",{a:[d,d,d,d],r:d});var Ee=class{constructor(r){this.k=r;a(this,"lvl",0)}$registerObject(r,e,t,s,i,o){let l=typeof e=="number"?this.k.scenes.get(e):this.k.windows.get(e);if(!l)return;let h=r.resolve(s);h!=null&&h.klass.vars.msg&&l.subscribe(h,i,t,o)}$unregisterObject(r,e,t,s){let i=typeof e=="number"?this.k.scenes.get(e):this.k.windows.get(e);if(!i)return;let o=r.resolve(t);o!=null&&o.klass.vars.msg&&i.unsubscribe(o,s)}$setCapture(r,e,t){let s=this.k.scenes.get(e);if(!s)return;let i=r.resolve(t);i!=null&&i.klass.vars.msg&&s.setCapture(i)}$releaseCapture(){this.k.releaseCapture()}$sendMessage(r,e,t,...s){if(this.lvl>58)return;let i=null;if(t&&(i=this.k.classes.get(t),!i))return;/[\*\?]/.test(e)&&this.k._functionNotImplemented("SendMessage \u0441 path \u0441\u043E\u0434\u0435\u0440\u0436\u0430\u0449\u0438\u043C '*'/'?'",r);let o=r.resolveMany(e,i);if(!o.length)return;let l=new Array(s.length),h=r.klass.vars,p=o[0].klass.vars;for(let b=0;b<s.length;b+=2){let y=h.get(s[b+0]);if(!y)continue;let T=p.get(s[b+1]);T&&(l[b+0]=y,l[b+1]=T)}o.forEach(b=>{if(b!==r){for(let y=0;y<l.length;y+=2){let T=l[y+0];if(!T)continue;let v=l[y+1];J(b.vars,v,Be(r.vars,T))}++this.lvl,b.computeSchema(this.k.ctx),--this.lvl;{let{map:y,memory:{newFloats:T,oldFloats:v,newInts:_,oldInts:I,newStrings:R,oldStrings:W}}=b.vars;for(let N=0;N<y.length;++N){let j=y[N];v[j]=T[j],I[j]=_[j],W[j]=R[j]}}for(let y=0;y<l.length;y+=2){let T=l[y+0];if(!T)continue;let v=l[y+1];Js(r.vars,T,Be(b.vars,v))}}})}};a(Ee,"namespace","msg"),a(Ee,"$registerObject",{s:!0,a:[m,m,E,d,d]}),a(Ee,"$registerObject$2",{s:!0,a:[E,m,E,d,d]}),a(Ee,"$unregisterObject",{s:!0,a:[m,E,d]}),a(Ee,"$unregisterObject$2",{s:!0,a:[E,E,d]}),a(Ee,"$setCapture",{s:!0,a:[m,E,d]}),a(Ee,"$releaseCapture",{}),a(Ee,"$sendMessage",{s:!0,a:[E,E,[E,E]]});var fe=class{constructor(r){this.k=r}$ascii(r){if(!r)return 0;let e=ae.table.indexOf(r[0]);return e<0?0:e}$chr(r){return r<0||r>255?"":ae.table[r]}$messageBox(){return this.k._functionNotImplemented("MessageBox"),1}$inc(r,e,t=1){r[e]+=t}$dec(r,e,t=1){r[e]-=t}$randomize(){}$floatToString(r){return r.toString()}$convertToAscii(r){return r<0||r>255?"":ae.table[r]}};a(fe,"namespace","misc"),a(fe,"$ascii",{a:[E],r:d}),a(fe,"$chr",{a:[d],r:E}),a(fe,"$messageBox",{a:[E,E,d],r:d}),a(fe,"$inc",{a:[ee]}),a(fe,"$inc$2",{a:[ee,d]}),a(fe,"$dec",{a:[ee]}),a(fe,"$dec$2",{a:[ee,d]}),a(fe,"$randomize",{a:[d]}),a(fe,"$floatToString",{a:[d],r:E}),a(fe,"$convertToAscii",{a:[d,d],r:E});var he=class{constructor(r){this.k=r;a(this,"s");a(this,"v",new Map);this.s=r.scenes}$openVideo({prj:r},e){var s;let t=(s=r.dir.resolve(e).file())==null?void 0:s.video;return t?(this.v.set(re.freeKey(this.v),t),1):0}$createVideoFrame2d(r,e,t,s,i,o){let l=this.v.get(e);if(!l)return 0;let h=this.s.get(r);if(!h)return 0;let p=h.scene,b=t,y=s,T=h.matrix;if(T){let I=t*T[2]+s*T[5]+T[8];b=(t*T[0]+s*T[3]+T[6])/I,y=(t*T[1]+s*T[4]+T[7])/I}let v=i>=0||o>=0,_=p.video(l.src,{x:b,y,width:Math.max(0,i),height:Math.max(0,o),fixed:v});return p.set({order:p.order.concat(_)}),_.key}$frameGetPos2d(r,e){var s;let t=(s=this.s.get(r))==null?void 0:s.scene.objects.get(e);return(t==null?void 0:t.type)==="videoView"?t.position*Mr:0}$frameSetPos2d(r,e,t){var i;let s=(i=this.s.get(r))==null?void 0:i.scene.objects.get(e);return(s==null?void 0:s.type)==="videoView"&&s.set({position:t/Mr})?1:0}$videoPlay2d(r,e){var s;let t=(s=this.s.get(r))==null?void 0:s.scene.objects.get(e);return(t==null?void 0:t.type)==="videoView"&&t.set({state:"play"})?1:0}$videoPause2d(r,e){var s;let t=(s=this.s.get(r))==null?void 0:s.scene.objects.get(e);return(t==null?void 0:t.type)==="videoView"&&t.set({state:"pause"})?1:0}$videoResume2d(r,e){var s;let t=(s=this.s.get(r))==null?void 0:s.scene.objects.get(e);return(t==null?void 0:t.type)==="videoView"&&t.set({state:"play"})?1:0}$videoStop2d(r,e){var s;let t=(s=this.s.get(r))==null?void 0:s.scene.objects.get(e);return(t==null?void 0:t.type)==="videoView"&&t.set({state:"stop"})?1:0}$mciSendString(){return 263}$mciSendStringStr(){return""}$sndPlaySound(){return 0}};a(he,"namespace","media"),a(he,"$openVideo",{s:!0,a:[E,d],r:m}),a(he,"$createVideoFrame2d",{a:[m,m,d,d,d,d,d],r:m}),a(he,"$frameGetPos2d",{a:[m,m],r:d}),a(he,"$frameSetPos2d",{a:[m,m,d],r:d}),a(he,"$videoPlay2d",{a:[m,m,d,d,d,d],r:d}),a(he,"$videoPause2d",{a:[m,m],r:d}),a(he,"$videoResume2d",{a:[m,m],r:d}),a(he,"$videoStop2d",{a:[m,m],r:d}),a(he,"$mciSendString",{a:[E],r:d}),a(he,"$mciSendStringStr",{a:[E],r:E}),a(he,"$sndPlaySound",{a:[E,d],r:d});var le=class{constructor(r){this.k=r;a(this,"streams");this.streams=r.streams}$createStream({prj:r},e,t,s){let i=e.toUpperCase(),o=s.toUpperCase(),l=o.includes("CREATE"),h=o.includes("READONLY"),p=re.freeKey(this.streams);if(i==="FILE"){let b=r.dir.resolve(t),y,T;if(l){if(!(y=b.create("file")))return 0;y.set({base64:T=""})}else if(!(y=b.file())||(T=y.base64)===null)return 0;return this.streams.set(p,new ke(T,h?null:y)),p}return i==="MEMORY"?(this.streams.set(p,new ke),p):(console.warn(`\u041F\u043E\u0442\u043E\u043A \u0442\u0438\u043F\u0430 ${i} \u043D\u0435 \u043F\u043E\u0434\u0434\u0435\u0440\u0436\u0438\u0432\u0430\u0435\u0442\u0441\u044F`),0)}$closeStream(r){let e=this.streams.get(r);if(!e)return 0;if(this.streams.delete(r),!e.file)return 1;let t=new Uint8Array(e.buffer());return e.file.set({base64:_s(t)}),this.k.handleWrite(e.file,t),1}$seek(r,e){var t,s;return(s=(t=this.streams.get(r))==null?void 0:t.seek(e))!=null?s:0}$eof(r){var e,t;return(t=(e=this.streams.get(r))==null?void 0:e.eof())!=null?t:0}$getPos(r){var e,t;return(t=(e=this.streams.get(r))==null?void 0:e.pos())!=null?t:0}$getSize(r){var e,t;return(t=(e=this.streams.get(r))==null?void 0:e.size())!=null?t:0}$setWidth(r,e){var t,s;return(s=(t=this.streams.get(r))==null?void 0:t.setWidth(e))!=null?s:0}$read(r){var e,t;return(t=(e=this.streams.get(r))==null?void 0:e.widthNumber())!=null?t:0}$readLn(r){var e,t;return(t=(e=this.streams.get(r))==null?void 0:e.line())!=null?t:""}$write(r,e){var t,s;return(s=(t=this.streams.get(r))==null?void 0:t.writeWidthNumber(e))!=null?s:0}$writeLn(r,e){var t,s;return(s=(t=this.streams.get(r))==null?void 0:t.writeLine(e))!=null?s:0}$getLine(r,e,t){var s,i;return(i=(s=this.streams.get(r))==null?void 0:s.getLine(e,t))!=null?i:""}$copyBlock(r,e,t,s){let i=this.streams.get(r);if(!i)return 0;let o=this.streams.get(e);return o?i.copyTo(o,t,s):0}};a(le,"namespace","s"),a(le,"$createStream",{s:!0,a:[E,E,E],r:m}),a(le,"$closeStream",{a:[m],r:d}),a(le,"$seek",{a:[m,d],r:d}),a(le,"$eof",{a:[m],r:d}),a(le,"$getPos",{a:[m],r:d}),a(le,"$getSize",{a:[m],r:d}),a(le,"$setWidth",{a:[m,d],r:d}),a(le,"$read",{a:[m],r:d}),a(le,"$readLn",{a:[m],r:E}),a(le,"$write",{a:[m,d],r:d}),a(le,"$writeLn",{a:[m,E],r:d}),a(le,"$getLine",{a:[m,d,E],r:E}),a(le,"$copyBlock",{a:[m,m,d,d],r:d});var Y=class{constructor(r){this.k=r}$system(){return this.k._functionNotImplemented("System"),0}$getAsyncKeyState(r){return Xs(r)?1:0}$getMousePos(r,e,t,s,i){let o=this.k.windows.get(r);if(!o)return e[t]=0,s[i]=0,0;let{x:l,y:h}=o.scene.mouse(),p=o.invmatrix;if(!p)return e[t]=l,s[i]=h,1;let b=l*p[2]+h*p[5]+p[8];return e[t]=(l*p[0]+h*p[3]+p[6])/b,s[i]=(l*p[1]+h*p[4]+p[7])/b,1}$showCursor(r){this.k.showCursor(r>0)}$loadCursor({prj:r},e,t){var o;let s=typeof e=="number"?this.k.scenes.get(e):this.k.windows.get(e);if(!s)return;let i=(o=r.dir.resolve(t).file())==null?void 0:o.cursor;s.setCursor(i?`url(${qe(i.src)}), auto`:"default")}$getTickCount(){return new Date().getTime()-Si}$getTime(r,e,t,s,i,o,l,h){let p=new Date;r[e]=p.getHours(),t[s]=p.getMinutes(),i[o]=p.getSeconds(),l[h]=p.getMilliseconds()*.1}$getDate(r,e,t,s,i,o){let l=new Date;r[e]=l.getFullYear(),t[s]=l.getMonth()+1,i[o]=l.getDate()}$setHyperJump2d(r,e,t,...[s,i,o,l,h]){var y;if(t<-1||t>4)return 0;let p=(y=this.k.scenes.get(r))==null?void 0:y.scene.objects.get(e);if(!p)return 0;let b=t===-1?null:{mode:t,target:s,object:i,effect:o,window:l,params:h};return p.data=k(G({},p.data),{hyper:b}),1}$stdHyperJump(r,e,t,s){var l,h,p;let i=this.k.scenes.get(r);if(!i)return;let o=(p=(h=(l=i.scene.objects.get(s))!=null?l:i.pick(e,t))==null?void 0:h.data)==null?void 0:p.hyper;o&&i.hyperClick(o,{x:e,y:t})}$getScreenWidth(){return this.k.screenWidth}$getScreenHeight(){return this.k.screenHeight}$getWorkAreaX(){return 0}$getWorkAreaY(){return 0}$getWorkAreaWidth(){return this.k.screenWidth}$getWorkAreaHeight(){return this.k.screenHeight}$getTitleHeight(){return 0}$getSmallTitleHeight(){return 0}$getFixedFrameWidth(){return 0}$getFixedFrameHeight(){return 0}$getSizeFrameWidth(){return 0}$getSizeFrameHeight(){return 0}$winExecute(r,e){return this.k.handleExe(r,e)?1:0}$shell(r,e,t,s){return this.k.handleShell(r,e,t,s)?1:0}$logMessage(r,e){this.k.log(e,r)}};a(Y,"namespace","sys"),a(Y,"$system",{a:[d,[d]],r:d}),a(Y,"$getAsyncKeyState",{a:[d],r:d}),a(Y,"$getMousePos",{a:[E,ee,ee],r:d}),a(Y,"$showCursor",{a:[d]}),a(Y,"$loadCursor",{s:!0,a:[m,E]}),a(Y,"$loadCursor$2",{s:!0,a:[E,E]}),a(Y,"$getTickCount",{r:d}),a(Y,"$getTime",{a:[ee,ee,ee,ee]}),a(Y,"$getDate",{a:[ee,ee,ee]}),a(Y,"$setHyperJump2d",{a:[m,m,d,[E]],r:d}),a(Y,"$stdHyperJump",{a:[m,d,d,m,d]}),a(Y,"$getScreenWidth",{r:d}),a(Y,"$getScreenHeight",{r:d}),a(Y,"$getWorkAreaX",{r:d}),a(Y,"$getWorkAreaY",{r:d}),a(Y,"$getWorkAreaWidth",{r:d}),a(Y,"$getWorkAreaHeight",{r:d}),a(Y,"$getTitleHeight",{r:d}),a(Y,"$getSmallTitleHeight",{r:d}),a(Y,"$getFixedFrameWidth",{r:d}),a(Y,"$getFixedFrameHeight",{r:d}),a(Y,"$getSizeFrameWidth",{r:d}),a(Y,"$getSizeFrameHeight",{r:d}),a(Y,"$winExecute",{a:[E,d],r:d}),a(Y,"$shell",{a:[E,E,E,d],r:d}),a(Y,"$logMessage",{s:!0,a:[E]});var F=class{constructor(r){this.k=r;a(this,"w");this.w=r.windows}$createWindowEx({prj:r},e,t,s,i,o,l,h,p){var N;let b=this.w.get(e);if(b)return b.key;let y=null,T=null,v=null;if(s){let j=this.k.classes.get(s),q=j==null?void 0:j.scene;if(q)y=q,T={type:"classname",data:j.name},v=j.children;else{let te=r.dir.resolve(s),we=(N=te.file())==null?void 0:N.scene;we&&(y=we,T={type:"filename",data:te.toString()})}}let _=or(p,y==null?void 0:y.options);!_.size&&l&&h&&(_.size={type:"fixed",width:l,height:h});let I={coords:{x:i,y:o},wname:e,data:k(G({},y),{options:_}),prj:r,source:T},R=_.child&&this.w.get(t),W=R?R.subwindow(I):this.k.window(I);return v&&lt(W.scene,v,this.k.classes),W.key}$getClientWidth(r){var e,t;return(t=(e=this.w.get(r))==null?void 0:e.window.clientWidth)!=null?t:0}$getClientHeight(r){var e,t;return(t=(e=this.w.get(r))==null?void 0:e.window.clientHeight)!=null?t:0}$getWindowName(r){var e,t;return(t=(e=this.k.scenes.get(r))==null?void 0:e.name)!=null?t:""}$getWindowOrgX(r){var e,t;return(t=(e=this.w.get(r))==null?void 0:e.window.x)!=null?t:0}$getWindowOrgY(r){var e,t;return(t=(e=this.w.get(r))==null?void 0:e.window.y)!=null?t:0}$getWindowSpace(r){var e,t;return(t=(e=this.w.get(r))==null?void 0:e.key)!=null?t:0}$getWindowWidth(r){var e,t;return(t=(e=this.w.get(r))==null?void 0:e.window.width)!=null?t:0}$getWindowHeight(r){var e,t;return(t=(e=this.w.get(r))==null?void 0:e.window.height)!=null?t:0}$getWindowTitle(r){var e,t;return(t=(e=this.w.get(r))==null?void 0:e.window.title)!=null?t:""}$setClientSize(r,e,t){var s;return(s=this.w.get(r))!=null&&s.window.set({clientWidth:e,clientHeight:t})?1:0}$setScrollRange(){return this.k._functionNotImplemented("SetScrollRange"),1}$setWindowOrg(r,e,t){var s;return(s=this.w.get(r))!=null&&s.window.set({x:e,y:t})?1:0}$setWindowPos(r,e,t,s,i){var o;return(o=this.w.get(r))!=null&&o.window.set({x:e,y:t,width:s,height:i})?1:0}$setWindowSize(r,e,t){var s;return(s=this.w.get(r))!=null&&s.window.set({width:e,height:t})?1:0}$setWindowTitle(r,e){var t;return(t=this.w.get(r))!=null&&t.window.set({title:e})?1:0}$setWindowTransparent(){return this.k._functionNotImplemented("SetWindowTransparent"),1}$setWindowTransparentColor(){return this.k._functionNotImplemented("SetWindowTransparentColor"),1}$setWindowRegion(){return this.k._functionNotImplemented("SetWindowRegion"),1}$setWindowOwner(){return this.k._functionNotImplemented("SetWindowOwner"),1}$showWindow(r,e){var s;let t=(s=this.w.get(r))==null?void 0:s.window;if(!t)return 0;switch(e){case 0:t.set({visible:!1});break;case 5:case 1:t.set({visible:!0});break}return 1}$bringWindowToTop(){return this.k._functionNotImplemented("BringWindowToTop"),1}$closeWindow(r){var e;return(e=this.w.get(r))!=null&&e.remove()?1:0}$isIconic(){return 0}$isWindowExist(r){return this.w.has(r)?1:0}$isWindowVisible(r){var e;return(e=this.w.get(r))!=null&&e.window.visible?1:0}$loadSpaceWindow({prj:r},e,t,s){var b,y;let i=this.w.get(e);if(i)return i.key;let o=r.dir.resolve(t),l=(y=(b=o.file())==null?void 0:b.scene)!=null?y:null,h=or(s,l==null?void 0:l.options);return this.k.window({wname:e,data:k(G({},l),{options:h}),prj:r,source:l?{type:"filename",data:o.toString()}:null}).key}$openSchemeWindow({prj:r},e,t,s){let i=this.w.get(e);if(i)return i.key;let o=this.k.classes.get(t),l=o==null?void 0:o.scene,h=or(s,l==null?void 0:l.options),p=this.k.window({wname:e,data:k(G({},l),{options:h}),prj:r,source:o?{type:"classname",data:o.name}:null});return l&&lt(p.scene,o.children,this.k.classes),p.key}$openClassScheme(){return this.k._functionNotImplemented("OpenClassScheme"),1}$closeClassScheme(){return this.k._functionNotImplemented("CloseClassScheme"),1}$cascadeWindows(){}$tile(){}$arrangeIcons(){}$getWindowProp(r,e){var s;let t=(s=this.w.get(r))==null?void 0:s.source;return t&&t.type===e.toLowerCase()&&t.data||""}};a(F,"namespace","w"),a(F,"$createWindowEx",{s:!0,a:[E,E,E,d,d,d,d,E],r:m}),a(F,"$getClientWidth",{a:[E],r:d}),a(F,"$getClientHeight",{a:[E],r:d}),a(F,"$getWindowName",{a:[m],r:E}),a(F,"$getWindowOrgX",{a:[E],r:d}),a(F,"$getWindowOrgY",{a:[E],r:d}),a(F,"$getWindowSpace",{a:[E],r:m}),a(F,"$getWindowWidth",{a:[E],r:d}),a(F,"$getWindowHeight",{a:[E],r:d}),a(F,"$getWindowTitle",{a:[E],r:E}),a(F,"$setClientSize",{a:[E,d,d],r:d}),a(F,"$setScrollRange",{a:[E,d,d,d],r:d}),a(F,"$setWindowOrg",{a:[E,d,d],r:d}),a(F,"$setWindowPos",{a:[E,d,d,d,d],r:d}),a(F,"$setWindowSize",{a:[E,d,d],r:d}),a(F,"$setWindowTitle",{a:[E,E],r:d}),a(F,"$setWindowTransparent",{a:[E,d],r:d}),a(F,"$setWindowTransparent$2",{a:[m,d],r:d}),a(F,"$setWindowTransparentColor",{a:[E,C],r:d}),a(F,"$setWindowTransparentColor$2",{a:[m,C],r:d}),a(F,"$setWindowRegion",{a:[E,m],r:d}),a(F,"$setWindowRegion$2",{a:[m,m],r:d}),a(F,"$setWindowOwner",{a:[m,m],r:d}),a(F,"$showWindow",{a:[E,d],r:d}),a(F,"$bringWindowToTop",{a:[E],r:d}),a(F,"$closeWindow",{a:[E],r:d}),a(F,"$isIconic",{a:[E],r:d}),a(F,"$isWindowExist",{a:[E],r:d}),a(F,"$isWindowVisible",{a:[E],r:d}),a(F,"$loadSpaceWindow",{s:!0,a:[E,E,E],r:m}),a(F,"$openSchemeWindow",{s:!0,a:[E,E,E],r:m}),a(F,"$openClassScheme",{a:[E,d],r:m}),a(F,"$closeClassScheme",{a:[E],r:d}),a(F,"$cascadeWindows",{}),a(F,"$tile",{a:[d]}),a(F,"$arrangeIcons",{}),a(F,"$getWindowProp",{a:[E,E],r:E});var wi=[ie,se,Y,We,le,K,D,F,Ee,Se,he,fe];function _l(u,r){let{children:e}=u;r.forEach(({nodes:[t,s],vars:i,attrib:o=0})=>{if(o&1)return;let l=`\u0418\u043C\u0438\u0434\u0436 ${u.klass.name}: \u0441\u0432\u044F\u0437\u044C #${t}-#${s}: `,h=t>0?e.find(b=>b.ndata.key===t):u;if(!h){console.warn(l+`\u0414\u043E\u0447\u0435\u0440\u043D\u0438\u0439 \u0438\u043C\u0438\u0434\u0436 #${t} \u043D\u0435 \u0441\u0443\u0449\u0435\u0441\u0442\u0432\u0443\u0435\u0442`);return}let p=s>0?e.find(b=>b.ndata.key===s):u;if(!p){console.warn(l+`\u0414\u043E\u0447\u0435\u0440\u043D\u0438\u0439 \u0438\u043C\u0438\u0434\u0436 #${s} \u043D\u0435 \u0441\u0443\u0449\u0435\u0441\u0442\u0432\u0443\u0435\u0442`);return}l=`\u0418\u043C\u0438\u0434\u0436 ${u.klass.name}: \u0441\u0432\u044F\u0437\u044C #${t} (${h.klass.name}) - #${s} (${p.klass.name}): `,i.forEach(([b,y])=>{let T=h.klass.vars.get(b);if(!T){console.warn(l+`\u041F\u0435\u0440\u0435\u043C\u0435\u043D\u043D\u0430\u044F ${h.klass.name}:${b} \u043D\u0435 \u0441\u0443\u0449\u0435\u0441\u0442\u0432\u0443\u0435\u0442`);return}let v=p.klass.vars.get(y);if(!v){console.warn(l+`\u041F\u0435\u0440\u0435\u043C\u0435\u043D\u043D\u0430\u044F ${p.klass.name}:${y} \u043D\u0435 \u0441\u0443\u0449\u0435\u0441\u0442\u0432\u0443\u0435\u0442`);return}if(T.type!==v.type){console.warn(l+`\u0422\u0438\u043F\u044B \u043F\u0435\u0440\u0435\u043C\u0435\u043D\u043D\u044B\u0445 ${h.klass.name}:${b} \u0438 ${p.klass.name}:${y} \u043D\u0435 \u0441\u043E\u0432\u043F\u0430\u0434\u0430\u044E\u0442`);return}let _=h.vars[T.id],I=p.vars[v.id];_.connected.add(I),I.connected.add(_)})})}function Lr(u,r,e=null){var o;u.compile();let t=(o=u.vars.list.map(l=>new et(l)))!=null?o:[],s=u.children.map(l=>{let h=r.get(l.klass);if(!h)throw Error(`\u041F\u043E\u0434\u0438\u043C\u0438\u0434\u0436 ${l.klass} #${l.key} \u0438\u043C\u0438\u0434\u0436\u0430 ${u.name} \u043D\u0435 \u0441\u0443\u0449\u0435\u0441\u0442\u0432\u0443\u0435\u0442`);return Lr(h,r,l)}),i={klass:u,ndata:e,vars:t,children:s};return u.connections&&_l(i,u.connections),i}function Br(u,r,e){let t=u.vars.map(i=>i.allocIndex(r));u.klass.vars.list.forEach(i=>i.inEquation&&e.add(t[i.id]));let s=u.children.map(i=>Br(i,r,e));return k(G({},u),{map:t,children:s})}function Vr(u,r,e){let t=u.children.map(s=>Vr(s,r,e));return r.schema(k(G({},u),{vars:{map:u.map,memory:e},children:t}))}function Ti(u,r,{a:e,b:t},s,i){let{oldFloats:o,newFloats:l}=s.vars.memory,h=!1,p=u(s,s.vars,i),b=r.map(y=>{l[y]=o[y]=1;let T=p-u(s,s.vars,i);return l[y]=o[y]=0,T&&(h=!0),T});h&&(e.push(b),t.push(p))}function Wi(u,r,e){return u[r[e]]>0}function Ei(u,r,e){return u[r[e]]<=0}function $i(){return!1}var Ae=class extends Error{constructor(e,t){super(e);this.original=t}};var ar=class{constructor(r,{klass:e,ndata:t,vars:s,children:i}){this.prj=r;a(this,"isDisabled",$i);a(this,"resolveMap");a(this,"klass");a(this,"vars");a(this,"children");a(this,"ndata");this.klass=e,this.ndata=t,this.vars=s,this.children=i;let{_disable:o,_enable:l}=e.vars;o&&(!l||o.id<l.id)?this.isDisabled=Wi.bind(null,this.vars.memory.newFloats,this.vars.map,o.id):l&&(!o||l.id<o.id)&&(this.isDisabled=Ei.bind(null,this.vars.memory.newFloats,this.vars.map,l.id)),this.resolveMap=new Map([["",this]]),i.forEach(h=>{h.resolveMap.set("..",this);let{key:p,name:b}=h.ndata;this.resolveMap.set("#"+p,h),b&&this.resolveMap.set(b.toUpperCase(),h)}),e.on("childrenChanged",this.updateChildNodeData.bind(this))}updateChildNodeData(r){r.length===this.children.length&&r.forEach((e,t)=>{let s=this.children[t],i=s.ndata;i.key!==e.key||i.klass!==e.klass||(i.name&&this.resolveMap.delete(i.name),e.name&&this.resolveMap.set(e.name.toUpperCase(),s),s.ndata=e)})}resolve(r){if(r.length===0)return this;let e=r.toUpperCase().split("\\"),t=r[0]==="\\"?this.prj.root:this;for(let s of e){let i=t.resolveMap.get(s);if(!i)return null;t=i}return t}resolveMany(r,e){if(r){let t=this.resolve(r);return!t||e&&t.klass!==e?[]:[t]}return e?this.prj.classSchemas(e):[]}initValues(r){this.children.forEach(t=>t.initValues());let{vars:e}=this.klass;return e.list.forEach(t=>{var i,o,l,h,p,b,y,T;let s;if(t.parsed!==null)s=t.parsed;else switch(t){case e.orgx:s=(o=(i=this.ndata)==null?void 0:i.x)!=null?o:0;break;case e.orgy:s=(h=(l=this.ndata)==null?void 0:l.y)!=null?h:0;break;case e._hobject:s=(b=(p=this.ndata)==null?void 0:p.key)!=null?b:0;break;case e._objname:s=(T=(y=this.ndata)==null?void 0:y.name)!=null?T:"";break;case e._classname:s=this.klass.name;break;default:if(!r)return;s=t.type===2?"":0;break}J(this.vars,t,s)}),this}applyValues({values:r,klass:e,klassID:t,children:s}){let i=this.klass.uniqid;if(!i&&e.toUpperCase()===this.klass.name.toUpperCase()||i===t){let{vars:o}=this.klass;r==null||r.forEach(({name:l,value:h})=>{let p=o.get(l);p&&J(this.vars,p,Xt(p.type,h))})}return s==null||s.forEach(o=>{var l;return(l=this.children.find(h=>h.ndata.key===o.key))==null?void 0:l.applyValues(o)}),this}getValues(){var o;let{klass:r,vars:e,ndata:t}=this,s=this.children.map(l=>l.getValues()),i=r.vars.list.map(l=>{let h=qs(l.type,Be(e,l));return{name:l.name,value:h}});return{key:(o=t==null?void 0:t.key)!=null?o:0,klass:r.name,klassID:r.uniqid,values:i,children:s}}computeEquationVectors(r,e,t){this.children.forEach(s=>s.computeEquationVectors(r,e,t)),this.klass.equations.forEach(s=>Ti(s,r,e,this,t))}computeSchemaDefers(r){this.children.forEach(e=>!e.isDisabled()&&e.computeSchemaDefers(r)),this.klass.defers.forEach(e=>e(this,this.vars,r))}computeSchema(r){var e,t;this.children.forEach(s=>!s.isDisabled()&&s.computeSchema(r)),Z.debugExecution&&console.log(`\u0412\u044B\u043F\u043E\u043B\u043D\u044F\u0435\u0442\u0441\u044F ${this.path()}`);try{(t=(e=this.klass).main)==null||t.call(e,this,this.vars,r)}catch(s){throw s instanceof Error?new Ae(`${this.path()}: ${s.message}`,s):s}return this}compute(r,e){if(!e&&this.isDisabled())return this;this.computeSchema(r);let t=this.prj.equationVars;t.length>0&&r.solveEquationsFor(this,t),this.computeSchemaDefers(r);let{newFloats:s,oldFloats:i,newInts:o,oldInts:l,newStrings:h,oldStrings:p}=this.vars.memory;i.set(s),l.set(o);for(let b=0;b<h.length;++b)p[b]=h[b];return this}createLinearSystem(r,e){let{oldFloats:t,newFloats:s}=this.vars.memory,i=e.map(l=>{let h=t[l];return s[l]=t[l]=0,h}),o={a:[],b:[]};return this.computeEquationVectors(e,o,r),e.forEach((l,h)=>t[l]=i[h]),o}path(){if(this===this.prj.root)return this.klass.name;let r=[this];for(;;){let e=r[0].resolveMap.get("..");if(e===this.prj.root)break;r.unshift(e)}return r.map(e=>`${e.klass.name} (#${e.ndata.key})`).join(" - ")}};var lr=class{constructor({id:r,dir:e,klass:t,state:s},i){a(this,"classTypes",new WeakMap);a(this,"id");a(this,"dir");a(this,"root");a(this,"equationVars");this.id=r,this.dir=e;let o=Lr(t,i),l=new Qe,h=new Set,p=Br(o,l,h);this.equationVars=[...h];let b=l.createMemory();this.root=Vr(p,this,b).initValues(),s&&this.root.applyValues(s)}schema(r){let e=new ar(this,r),t=this.classTypes.get(e.klass);return t?t.push(e):this.classTypes.set(e.klass,[e]),e}classSchemas(r){var e;return(e=this.classTypes.get(r))!=null?e:[]}};var cr=class{constructor(r){this.ctx=r;a(this,"m",new Map)}loadPlugin(r){let e=r.namespace;if(!e)throw Error(`\u041F\u043B\u0430\u0433\u0438\u043D '${r.name}': \u043D\u0435 \u0443\u043A\u0430\u0437\u0430\u043D\u043E namespace`);Object.keys(r).forEach(t=>{var b,y;if(!t.startsWith("$"))return;let s=r[t];if(typeof s!="object")return;let i=t.split("$")[1],o;if(typeof(r.prototype[o=t]||r.prototype[o="$"+i])!="function")throw Error(`\u041F\u043B\u0430\u0433\u0438\u043D '${r.name}': \u043D\u0435\u0442 \u043E\u043F\u0440\u0435\u0434\u0435\u043B\u0435\u043D\u0438\u044F '${i}' ('${t}')`);let h=i.toUpperCase(),p=this.m.get(h);(p==null?void 0:p.type)!=="method"&&this.m.set(h,p={type:"method",overloads:[]}),p.overloads.push({argTypes:(b=s.a)!=null?b:[],retType:(y=s.r)!=null?y:null,path:`${e}.${o}`,passState:!!s.s})}),this.ctx.inject(e,r)}addUserFunc(r){let e=r.name.toUpperCase();this.m.has(e)||this.m.set(e,r)}removeUserFunc(r){let e=r.toUpperCase(),t=this.m.get(e);(t==null?void 0:t.type)==="user"&&this.m.delete(e)}compile(r,e,t){return gi(r,{funcTable:this.m,sourceURL:e,comment:t})}};var ur=class{constructor({projectLoader:r,swgBackend:e,windowFactory:t}){a(this,"handlers",{closed:new Set,error:new Set,shell:new Set,write:new Set});a(this,"compiler");a(this,"prevProjects",[]);a(this,"projectLoader");a(this,"swgBackend");a(this,"windowFactory");a(this,"classes",new ir);a(this,"scenes",new Map);a(this,"windows",new Map);a(this,"arrays",new Map);a(this,"matrices",new Map);a(this,"streams",new Map);a(this,"screenWidth");a(this,"screenHeight");a(this,"ctx");a(this,"cursorVisible",!0);a(this,"captureTarget",null);a(this,"lastPickedPrimaryKey",0);a(this,"projects",[]);a(this,"openedPopups",new Set);a(this,"showed",new Set);this.projectLoader=r,this.swgBackend=e,this.windowFactory=t,this.screenWidth=t.screenWidth,this.screenHeight=t.screenHeight;let s=this.ctx=new nr(this),i=this.compiler=new cr(s);wi.forEach(o=>i.loadPlugin(o))}project({filepath:r,searchDirs:e,nonRecursive:t,rootClass:s,matrices:i,dir:o,stt:l},h){Z.debugProject&&console.log(`\u041E\u0442\u043A\u0440\u044B\u0432\u0430\u0435\u0442\u0441\u044F ${r}`);let p=Symbol(r.toString()),b;try{e.forEach(T=>{let v=!t||T===this.projectLoader.stdlibDir;T.forEach(_=>{var R,W;if(!_.cls||this.classes.hasFile(_))return;let I=new sr(p,_.cls,_,this.compiler);if(I.isFunction){let N=I.vars.list,j=N.filter(te=>te.attrib&512).map(te=>te.type),q=(W=(R=N.find(te=>te.attrib&1024))==null?void 0:R.type)!=null?W:null;this.compiler.addUserFunc({type:"user",name:I.name,argTypes:j,retType:q})}this.classes.add(I)},v)});let y=this.classes.get(s);if(!y)throw Error(`${r}: \u041A\u043E\u0440\u043D\u0435\u0432\u043E\u0439 \u0438\u043C\u0438\u0434\u0436 ${s} \u043D\u0435 \u0441\u0443\u0449\u0435\u0441\u0442\u0432\u0443\u0435\u0442.`);b=new lr({id:p,filepath:r,dir:o,klass:y,state:l},this.classes)}catch(y){throw this.classes.unload(p),y}return i==null||i.forEach(([y,T])=>!this.matrices.has(y)&&this.matrices.set(y,new ge(T))),h||this.set({projects:this.projects.concat(b)}),b}compute(){if(this.prevProjects!==this.projects){let e=this.prevProjects.filter(t=>!this.projects.includes(t));this.prevProjects=this.projects,e.forEach(t=>{Z.debugProject&&console.log(`\u0417\u0430\u043A\u0440\u044B\u0432\u0430\u0435\u0442\u0441\u044F ${t.id.description}`),this.classes.unload(t.id),this.closeProjectWindows(t),this.restorePrevProjectWindows(t)})}if(!this.projects.length)return this.clearAll(),!1;let r=this.projects[this.projects.length-1];try{r.root.compute(this.ctx)}catch(e){throw e instanceof Ae?new Ae(`\u041F\u0440\u043E\u0435\u043A\u0442 ${r.id.description}, ${e.message}`,e.original):e}return!0}set({projects:r=this.projects}){return this.projects=r,this}window({data:{data:r,matrix:e,options:t},prj:s,wname:i,coords:o,source:l}){let h=Ct(this.swgBackend,r),p=k(G({},o),{title:i,popup:t==null?void 0:t.popup}),b=t==null?void 0:t.size,y=(b==null?void 0:b.type)==="content"||!b&&p.popup;if(t!=null&&t.autoorg||y){let I=qt(h.objects);t!=null&&t.autoorg&&h.set({x:I.x,y:I.y}),y&&(p.width=I.w,p.height=I.h)}(b==null?void 0:b.type)==="fixed"&&(p.width=b.width,p.height=b.height);let T=this.windowFactory.window(h.view,p),v=re.freeKey(this.scenes),_=new Je(this,{key:v,name:i,prj:s,scene:h,window:T,matrix:e,source:l});return t!=null&&t.popup&&this.openedPopups.add(_),this.scenes.set(v,_),this.windows.set(i,_),_}releaseCapture(){var r;(r=this.captureTarget)==null||r.w.scene.stopCapturingMouseEvents(),this.captureTarget=null}showCursor(r){this.cursorVisible=r,this.windows.forEach(e=>e.updateCursor())}log(r,e){Z.logMessage&&console.info(e?`${e.path()}: ${r}`:r)}handleExe(r,e){let t=r.lastIndexOf(".exe"),s=t<0?r:r.substring(0,t);return this.handlers.shell.forEach(i=>i(s,"","",e!=null?e:0)),!0}handleShell(r,e,t,s){return this.handlers.shell.forEach(i=>i(r,e,t,s)),!0}handleWrite(r,e){this.handlers.write.forEach(t=>t(r.path.toString(),e))}closeWindows(r){this.scenes.forEach(e=>{var i;if(!r.has(e))return;e===((i=this.captureTarget)==null?void 0:i.w)&&(this.captureTarget=null);let{key:t,name:s}=e;setTimeout(()=>{let o=1539;e.spaceDoneSubs.forEach(l=>{let{msg:h,_hspace:p,_windowName:b}=l.klass.vars;J(l.vars,h,o),p&&J(l.vars,p,t),b&&J(l.vars,b,s),l.compute(this.ctx,!0)})}),e.scene.dispose(),e.window.close(),this.scenes.delete(e.key),this.windows.delete(e.name),this.openedPopups.delete(e)})}closePopups(r){let e=new Set;this.openedPopups.forEach(t=>{t!==r&&t.all.forEach(s=>e.add(s))}),this.closeWindows(e)}hideProjectWindows(r,e){this.windows.forEach(t=>{t.prj===r&&(t.window.set({visible:!1}),t.hiddenBy=e)})}clearAll(){this.prevProjects=[],this.scenes.clear(),this.windows.clear(),this.arrays.clear(),this.matrices.clear(),this.streams.clear(),this.cursorVisible=!0,this.lastPickedPrimaryKey=0}closeProjectWindows(r){let e=new Set([...this.windows.values()].filter(t=>t.prj===r));this.closeWindows(e)}restorePrevProjectWindows(r){this.windows.forEach(e=>{e.hiddenBy===r&&(e.window.set({visible:!0}),e.hiddenBy=null)})}_functionNotImplemented(r,e){if(this.showed.size===this.showed.add(r.toUpperCase()).size)return;let t=`${r} \u043D\u0435 \u0440\u0435\u0430\u043B\u0438\u0437\u043E\u0432\u0430\u043D\u0430`;console.warn(e?`${e.path()}: ${t}`:t)}};var Ue=class{constructor(r,e){this.file=e;a(this,"v");a(this,"p");a(this,"width");if(r){let t=vs(r);this.v=new DataView(t.buffer)}else this.v=new DataView(new ArrayBuffer(0));this.p=0,this.width=8}static widthToSize(r){return r<0||r>9?0:Ue.widthTable[r]}copyTo(r,e,t){return e<0||e+t>this.v.byteLength?0:(r.v.byteLength<t?r.v=new DataView(this.v.buffer.slice(e,t)):new Uint8Array(r.v.buffer).set(new Uint8Array(this.v.buffer,e,t)),1)}seek(r){return this.p=r}eof(){return this.p>=this.size()?1:0}pos(){return this.p}size(){return this.v.byteLength}setWidth(r){return this.width=r,1}widthNumber(){let r=Ue.widthToSize(this.width);if(r===0)return 0;let e=this.p,t=e+r;if(t>this.size())return 0;switch(this.p=t,this.width){case 0:return this.v.getUint8(e);case 1:return this.v.getInt8(e);case 2:return this.v.getUint16(e,!0);case 3:return this.v.getInt16(e,!0);case 4:return this.v.getUint32(e,!0);case 5:return this.v.getInt32(e,!0);case 6:return this.v.getFloat32(e,!0);case 7:throw Error("\u0427\u0442\u0435\u043D\u0438\u0435 FLOAT40 \u043D\u0435 \u043F\u043E\u0434\u0434\u0435\u0440\u0436\u0438\u0432\u0430\u0435\u0442\u0441\u044F");case 8:return this.v.getFloat64(e,!0);case 9:throw Error("\u0427\u0442\u0435\u043D\u0438\u0435 FLOAT80 \u043D\u0435 \u043F\u043E\u0434\u0434\u0435\u0440\u0436\u0438\u0432\u0430\u0435\u0442\u0441\u044F");default:return 0}}resize(r){let e=new Uint8Array(new ArrayBuffer(r));e.set(new Uint8Array(this.v.buffer)),this.v=new DataView(e.buffer)}writeWidthNumber(r){let e=Ue.widthToSize(this.width);if(e===0)return 0;let t=this.p,s=t+e;switch(s>this.size()&&this.resize(s),this.p=s,this.width){case 0:return this.v.setUint8(t,r),1;case 1:return this.v.setInt8(t,r),1;case 2:return this.v.setUint16(t,r,!0),2;case 3:return this.v.setInt16(t,r,!0),2;case 4:return this.v.setUint32(t,r,!0),4;case 5:return this.v.setInt32(t,r,!0),4;case 6:return this.v.setFloat32(t,r,!0),4;case 7:throw Error("FLOAT40 \u043D\u0435 \u043F\u043E\u0434\u0434\u0435\u0440\u0436\u0438\u0432\u0430\u0435\u0442\u0441\u044F");case 8:return this.v.setFloat64(t,r,!0),8;case 9:throw Error("FLOAT80 \u043D\u0435 \u043F\u043E\u0434\u0434\u0435\u0440\u0436\u0438\u0432\u0430\u0435\u0442\u0441\u044F");default:return 0}}getLine(r,e){let t=this.p,s=Math.min(r,this.size()-t);if(s<=0)return"";let i=0,o="";for(;i<s;){let l=this.v.getUint8(t+i);i++;let h=ae.table[l];if(o+=h,h===e)break}return this.p+=i,o}line(){let r=this.p,e=this.size()-r;if(e<=0)return"";let t=0,s=0;for(;t<e;){let o=this.v.getUint8(r+t);if(o===0){s=1;break}if(o===Ue.slashR&&t+1<e&&this.v.getUint8(r+t+1)===Ue.slashN){s=2;break}t+=1}let i=ae.decode(new Uint8Array(this.v.buffer,r,t));return this.p=r+t+s,i}writeLine(r){let e=r+`\r
`,t=this.p,s=t+e.length;return s>this.size()&&this.resize(s),this.p=s,ae.encode(e).forEach((o,l)=>this.v.setUint8(t+l,o)),e.length}write(r){let e=this.p,t=e+r.length;t>this.size()&&this.resize(t),this.p=t,r.forEach((s,i)=>this.v.setUint8(e+i,s))}buffer(){return this.v.buffer}},ke=Ue;a(ke,"slashR","\r".charCodeAt(0)),a(ke,"slashN",`
`.charCodeAt(0)),a(ke,"widthTable",[1,1,2,2,4,4,4,5,8,10]);var hr=class{constructor(r,e={}){this.path=r;a(this,"type","file");a(this,"size",null);a(this,"cls",null);a(this,"image",null);a(this,"scene",null);a(this,"video",null);a(this,"audio",null);a(this,"ttf",null);a(this,"cursor",null);a(this,"stt",null);a(this,"mat",null);a(this,"base64",null);this.set(e)}set({size:r=this.size,cls:e=this.cls,image:t=this.image,scene:s=this.scene,video:i=this.video,audio:o=this.audio,ttf:l=this.ttf,cursor:h=this.cursor,stt:p=this.stt,mat:b=this.mat,base64:y=this.base64}){return this.size=r,this.cls=e,this.image=t,this.scene=s,this.video=i,this.audio=o,this.ttf=l,this.cursor=h,this.stt=p,this.mat=b,this.base64=y,this}},tt=class{constructor(r=""){this.name=r;a(this,"type","folder");a(this,"items",new Map)}},$e=class{constructor(r,e,t){this.fs=r;this.parts=e;a(this,"str",null);a(this,"partsUC");if(e[0].length!==2&&e[0][1]!==":")throw Error("\u041D\u0435\u043F\u0440\u0430\u0432\u0438\u043B\u044C\u043D\u043E\u0435 \u0438\u043C\u044F \u0442\u043E\u043C\u0430 \u0434\u0438\u0441\u043A\u0430");this.partsUC=t!=null?t:e.map(s=>s.toUpperCase())}static splitPath(r){return r.split(/[/\\]/).map(e=>e.trim()).filter(e=>e.length>0)}resolve(r){let e=$e.splitPath(r);if(!e.length)return this;let t=e[0].length===2&&e[0][1]===":",s=t?[e[0]]:this.parts.slice(),i=t?[e[0].toUpperCase()]:this.partsUC.slice();for(let o=t?1:0;o<e.length;++o){let l=e[o];l===".."?s.length>1&&(s.pop(),i.pop()):l!=="."&&(s.push(l),i.push(l.toUpperCase()))}return new $e(this.fs,s,i)}toString(){return this.str?this.str:this.str=this.parts.join("\\")}basename(){return this.parts[this.parts.length-1]}equals(r){let e=this.partsUC,t=r.partsUC;if(e.length!==t.length)return!1;for(let s=0;s<e.length;++s)if(e[s]!==t[s])return!1;return!0}startsWith(r){let e=this.partsUC,t=r.partsUC;if(e.length<t.length)return!1;for(let s=0;s<t.length;++s)if(e[s]!==t[s])return!1;return!0}static getFolder(r,e,t){let s=r;for(let i=0;i<e.length-(t?0:1);++i){let o=s.items.get(e[i]);if(!o||o.type!=="folder")return null;s=o}return s}create(r,e){let{partsUC:t}=this,s=$e.getFolder(this.fs,t);if(!s)return null;let i=t[t.length-1],o=s.items.has(i);if(r==="folder")return o||s.items.set(i,new tt),this;if(o)return null;let l=new hr(this,e);return s.items.set(i,l),l}createWithDirs(r){let{parts:e,partsUC:t}=this,s=this.fs;for(let h=0;h<e.length-1;++h){let p=s.items.get(t[h]);if(!p)p=new tt(e[h]),s.items.set(t[h],p);else if(p.type==="file")throw Error(`\u041D\u0435\u0432\u043E\u0437\u043C\u043E\u0436\u043D\u043E \u0441\u043E\u0437\u0434\u0430\u0442\u044C \u0434\u0438\u0440\u0435\u043A\u0442\u043E\u0440\u0438\u044E ${this}: \u0444\u0430\u0439\u043B ${p.path} \u0443\u0436\u0435 \u0441\u0443\u0449\u0435\u0441\u0442\u0432\u0443\u0435\u0442.`);s=p}let i=t[t.length-1];if(s.items.has(i))throw Error(`\u041D\u0435\u0432\u043E\u0437\u043C\u043E\u0436\u043D\u043E \u0441\u043E\u0437\u0434\u0430\u0442\u044C \u0434\u0438\u0440\u0435\u043A\u0442\u043E\u0440\u0438\u044E ${this}: \u0444\u0430\u0439\u043B \u0443\u0436\u0435 \u0441\u0443\u0449\u0435\u0441\u0442\u0432\u0443\u0435\u0442.`);let l=new hr(this,r);return s.items.set(i,l),l}file(){let{partsUC:r}=this,e=$e.getFolder(this.fs,r);if(!e)return Z.debugFile&&console.warn(`${this.toString()} \u043D\u0435 \u0441\u0443\u0449\u0435\u0441\u0442\u0432\u0443\u0435\u0442`),null;let t=r[r.length-1],s=e.items.get(t);return s?s.type!=="file"?(Z.debugFile&&console.warn(`${this.toString()} \u044F\u0432\u043B\u044F\u0435\u0442\u0441\u044F \u0434\u0438\u0440\u0435\u043A\u0442\u043E\u0440\u0438\u0435\u0439`),null):s:(Z.debugFile&&console.warn(`${this.toString()} \u043D\u0435 \u0441\u0443\u0449\u0435\u0441\u0442\u0432\u0443\u0435\u0442`),null)}forEach(r,e=!0){let{partsUC:t}=this,s=$e.getFolder(this.fs,t,!0);s&&s.items.forEach(function i(o){o.type==="folder"?e&&o.items.forEach(i):r(o)})}resolveMany(){var o;let{partsUC:r}=this,e=$e.getFolder(this.fs,r);if(!e)return[];let t=r[r.length-1];if(t.includes("*")){let[l,h]=t.split("*"),p;return!l&&!h?p=[".","..",...e.items]:p=[...e.items].filter(([b])=>b.startsWith(l)&&b.endsWith(h)),p.map(b=>{var T;if(typeof b=="string")return{name:b,size:0};let y=b[1];return y.type==="folder"?{name:y.name,size:0}:{name:y.path.basename(),size:(T=y.size)!=null?T:0}})}let s=e.items.get(t);return s?[s.type==="folder"?{name:s.name,size:0}:{name:s.path.basename(),size:(o=s.size)!=null?o:0}]:[]}};var pr=class{constructor(r){a(this,"stdlib",{id:Z.libraryURL,mount:"library"});a(this,"loadedLibs",new Set);a(this,"projects");a(this,"fs",new tt);a(this,"stdlibDir",new $e(this.fs,["D:",this.stdlib.mount]));this.projects=r.map(e=>[this.path(e.filepath),e])}path(r,e="C:"){return new $e(this.fs,[e].concat(r.split("/")))}exists(r){return!!this.projects.find(([e])=>e.equals(r))}open(r){return nt(this,null,function*(){var R,W;let e=this.projects.find(([N])=>N.equals(r));if(!e)return null;let[t,{data:s,libs:i}]=e,o=i.concat(this.stdlib).map(q=>nt(this,[q],function*({mount:N,id:j}){if(this.loadedLibs.size===this.loadedLibs.add(j).size)return;let te=yield fetch(`${qe(j)}/index.json`,{cache:Z.cache});if(!te.ok)throw Error(`\u041D\u0435 \u0443\u0434\u0430\u043B\u043E\u0441\u044C \u0437\u0430\u0433\u0440\u0443\u0437\u0438\u0442\u044C "${N}" (${j})`);let{files:we}=yield te.json(),_e=j===this.stdlib.id?"D:":"C:";we.forEach(st=>this.path(N?`${N}/${st.path}`:st.path,_e).createWithDirs(st))}));yield Promise.all(o);let I=s,{searchDirs:l,stt:h}=I,p=oe(I,["searchDirs","stt"]),b=t.resolve(".."),y=[this.stdlibDir,b].concat((R=l==null?void 0:l.map(N=>this.path(N)))!=null?R:[]),T=h?this.path(h):b.resolve("_preload.stt"),v=(W=T.file())==null?void 0:W.stt;v||console.warn(`\u0424\u0430\u0439\u043B \u0441\u043E\u0441\u0442\u043E\u044F\u043D\u0438\u044F ${T} \u043D\u0435 \u0441\u0443\u0449\u0435\u0441\u0442\u0432\u0443\u0435\u0442`);let _=[];return b.forEach(N=>{if(!N.mat)return;let j=N.path.basename(),q=parseInt(j.substring(0,j.length-5));isNaN(q)||!q||_.push([q,N.mat])},!1),G({filepath:t,dir:b,searchDirs:y,stt:v,matrices:_},p)})}};var Ur=class{constructor(r,e,o){this.root=r;this.view=e;a(this,"origTitle");a(this,"popup");a(this,"x",0);a(this,"y",0);a(this,"width",0);a(this,"height",0);a(this,"clientWidth",0);a(this,"clientHeight",0);a(this,"title");a(this,"visible",!0);a(this,"hideTimeout",0);var l=o,{popup:t,title:s}=l,i=oe(l,["popup","title"]);this.origTitle=document.title,!t&&s&&(document.title=this.origTitle?`${this.origTitle} - ${s}`:s),this.title=s!=null?s:"",this.popup=t||!1,r.appendChild(e),this.set(i),this.width=i.width||e.clientWidth,this.height=i.height||e.clientHeight,this.clientWidth=i.clientWidth||e.clientWidth,this.clientHeight=i.clientHeight||e.clientHeight}set({x:r=this.x,y:e=this.y,width:t=this.width,height:s=this.height,clientWidth:i=this.clientWidth,clientHeight:o=this.clientHeight,title:l=this.title,visible:h=this.visible}){return this.popup&&(this.x!==r&&this.view.style.setProperty("left",r+"px"),this.y!==e&&this.view.style.setProperty("top",e+"px")),this.clientWidth!==i&&this.view.style.setProperty("width",i+"px"),this.clientHeight!==o&&this.view.style.setProperty("height",o+"px"),this.title!==l&&(document.title=l),this.visible!==h&&(this.view.style.opacity=h?"1":"0",this.hideTimeout&&window.clearTimeout(this.hideTimeout),this.hideTimeout=window.setTimeout(()=>this.view.style.setProperty("display",h?"block":"none"),h?0:250)),this.x=r,this.y=e,this.width=t,this.height=s,this.clientWidth=i,this.clientHeight=o,this.title=l,this.visible=h,this}close(){this.popup?(this.view.style.opacity="0",setTimeout(()=>this.view.remove(),250)):(this.view.style.opacity="0",setTimeout(()=>this.view.remove(),250),document.title=this.origTitle)}},dr=class{constructor(r){a(this,"root");this.root=(typeof r=="string"?document.getElementById(r):r)||document.body,this.root.style.setProperty("position","relative")}get screenWidth(){var r;return((r=this.root)==null?void 0:r.clientWidth)||window.innerWidth}get screenHeight(){var r;return((r=this.root)==null?void 0:r.clientHeight)||window.innerHeight}window(r,e){let t=document.createElement("div"),{x:s,y:i}=e;if(e.popup?(s=Math.max(e.x||0,0),i=Math.max(e.y||0,0),e.height&&(i=Math.min(i,this.screenHeight-e.height-11)),t.style.setProperty("position","absolute"),t.style.setProperty("left",s+"px"),t.style.setProperty("top",i+"px"),t.style.setProperty("box-shadow","13px 11px 6px 0px rgb(0 0 0 / 50%)")):(t.style.setProperty("position","absolute"),t.setAttribute("class","stratum-window")),t.style.setProperty("opacity","0"),t.style.setProperty("transition","opacity 250ms linear"),setTimeout(()=>t.style.setProperty("opacity","1")),t.style.setProperty("width",e.width?e.width+"px":"100%"),t.style.setProperty("height",e.height?e.height+"px":"100%"),t.appendChild(r),this.root)return new Ur(this.root,t,k(G({},e),{x:s,y:i}));throw Error(`\u041D\u0435 \u0443\u0434\u0430\u043B\u043E\u0441\u044C \u043E\u0442\u043A\u0440\u044B\u0442\u044C \u043E\u043A\u043D\u043E ${e.title}`)}};var rt=class{constructor(r,e){this.kernel=r;this.initial=e;a(this,"_diag",{iterations:0,missingCommands:[]});a(this,"_status","closed");a(this,"computer",new Le);a(this,"loop",null);a(this,"speed","smooth")}static create(r,e){return nt(this,null,function*(){var l;if(!r.length)throw Error("\u0421\u043F\u0438\u0441\u043E\u043A \u043F\u0440\u043E\u0435\u043A\u0442\u043E\u0432 \u043F\u0443\u0441\u0442");let t=new pr(r),s=t.path(e||r[0].filepath),i=yield t.open(s);if(!i)throw Error(`\u041F\u0440\u043E\u0435\u043A\u0442 ${s} \u043D\u0435 \u0441\u0443\u0449\u0435\u0441\u0442\u0432\u0443\u0435\u0442`);let o=new ur({projectLoader:t,swgBackend:Cs,windowFactory:(l=Z.windowFactory)!=null?l:new dr(Z.root)});return new rt(o,i)})}set({speed:r=this.speed}){if(this.speed!==r){let e=r==="smooth"?new Le:new wt(typeof r=="number"?r:void 0);this.computer.running&&(this.computer.stop(),this.loop&&e.run(this.loop)),this.computer=e}return this.speed=r,this}get status(){return this._status}get diag(){return this._diag}play(){return this.loop?this:(this.kernel.project(this.initial),this._diag.iterations=0,this.loop=()=>{let r;try{r=this.kernel.compute()}catch(e){if(!(e instanceof Ae))throw e;console.error(e.message),console.error(e.original);let t=e.message;return this._status="error",this.kernel.handlers.error.forEach(s=>s(t)),!1}return r?++this._diag.iterations:(this.loop=null,this._status="closed",this.kernel.handlers.closed.forEach(e=>e())),r},this.computer.run(this.loop),this._status="playing",this)}close(){return this._status==="error"?(this.kernel.set({projects:[]}).compute(),this.loop=null,this._status="closed",this):(this.kernel.set({projects:[]}),this.step())}pause(){return this.computer.running&&(this.computer.stop(),this._status="paused"),this}continue(){return!this.computer.running&&this.loop&&(this.computer.run(this.loop),this._status="playing"),this}step(){return!this.computer.running&&this.loop&&this.loop(),this}on(r,e){return this.kernel.handlers[r].add(e),this}off(r,e){return e?this.kernel.handlers[r].delete(e):this.kernel.handlers[r].clear(),this}};var xi=rt.create;xi.options=Z;(window.stratum||(window.stratum={})).player=xi;})();
/**
 * Gauss-Jordan elimination by lovasoa (https://github.com/lovasoa) @license (MIT)
 */
;stratum.player.info = { title: 'feat:     ', url: 'https://github.com/Stratum-IIT/stratum-iit/pull/4', hash: 'bb36805574fa4ad7f9aa23ea4f7385152deb8253' };
