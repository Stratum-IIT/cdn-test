"use strict";(()=>{var Es=Object.defineProperty,Va=Object.defineProperties;var Ua=Object.getOwnPropertyDescriptors;var gt=Object.getOwnPropertySymbols;var $s=Object.prototype.hasOwnProperty,Os=Object.prototype.propertyIsEnumerable;var Ws=(c,r,e)=>r in c?Es(c,r,{enumerable:!0,configurable:!0,writable:!0,value:e}):c[r]=e,N=(c,r)=>{for(var e in r||(r={}))$s.call(r,e)&&Ws(c,e,r[e]);if(gt)for(var e of gt(r))Os.call(r,e)&&Ws(c,e,r[e]);return c},R=(c,r)=>Va(c,Ua(r));var ne=(c,r)=>{var e={};for(var t in c)$s.call(c,t)&&r.indexOf(t)<0&&(e[t]=c[t]);if(c!=null&&gt)for(var t of gt(c))r.indexOf(t)<0&&Os.call(c,t)&&(e[t]=c[t]);return e};var ja=(c,r)=>{for(var e in r)Es(c,e,{get:r[e],enumerable:!0})};var st=(c,r,e)=>new Promise((t,s)=>{var i=h=>{try{a(e.next(h))}catch(u){s(u)}},o=h=>{try{a(e.throw(h))}catch(u){s(u)}},a=h=>h.done?t(h.value):Promise.resolve(h.value).then(i,o);a((e=e.apply(c,r)).next())});var De=["A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","0","1","2","3","4","5","6","7","8","9","+","/"],xs=[255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,62,255,255,255,63,52,53,54,55,56,57,58,59,60,61,255,255,255,0,255,255,255,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,255,255,255,255,255,255,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51];function bt(c){if(c>=xs.length)throw new Error("Unable to parse base64 string.");let r=xs[c];if(r===255)throw new Error("Unable to parse base64 string.");return r}function vs(c){let r="",e,t=c.length;for(e=2;e<t;e+=3)r+=De[c[e-2]>>2],r+=De[(c[e-2]&3)<<4|c[e-1]>>4],r+=De[(c[e-1]&15)<<2|c[e]>>6],r+=De[c[e]&63];return e===t+1&&(r+=De[c[e-2]>>2],r+=De[(c[e-2]&3)<<4],r+="=="),e===t&&(r+=De[c[e-2]>>2],r+=De[(c[e-2]&3)<<4|c[e-1]>>4],r+=De[(c[e-1]&15)<<2],r+="="),r}function Ds(c){if(c.length%4!==0)throw new Error("Unable to parse base64 string.");let r=c.indexOf("=");if(r!==-1&&r<c.length-2)throw new Error("Unable to parse base64 string.");let e=c.endsWith("==")?2:c.endsWith("=")?1:0,t=c.length,s=new Uint8Array(3*(t/4)),i;for(let o=0,a=0;o<t;o+=4,a+=3)i=bt(c.charCodeAt(o))<<18|bt(c.charCodeAt(o+1))<<12|bt(c.charCodeAt(o+2))<<6|bt(c.charCodeAt(o+3)),s[a]=i>>16,s[a+1]=i>>8&255,s[a+2]=i&255;return s.subarray(0,s.length-e)}var oe={};ja(oe,{decode:()=>_s,encode:()=>Ha,table:()=>gr});var gr=[...Array.from({length:128},(c,r)=>String.fromCharCode(r)),"\u0402","\u0403","\u201A","\u0453","\u201E","\u2026","\u2020","\u2021","\u20AC","\u2030","\u0409","\u2039","\u040A","\u040C","\u040B","\u040F","\u0452","\u2018","\u2019","\u201C","\u201D","\u2022","\u2013","\u2014","","\u2122","\u0459","\u203A","\u045A","\u045C","\u045B","\u045F"," ","\u040E","\u045E","\u040B","\xA4","\u0490","\xA6","\xA7","\u0401","\xA9","\u0404","\xAB","\xAC","","\xAE","\u0407","\xB0","\xB1","\u0406","\u0456","\u0491","\xB5","\xB6","\xB7","\u0451","\u2116","\u0454","\xBB","\u0458","\u0405","\u0455","\u0457","\u0410","\u0411","\u0412","\u0413","\u0414","\u0415","\u0416","\u0417","\u0418","\u0419","\u041A","\u041B","\u041C","\u041D","\u041E","\u041F","\u0420","\u0421","\u0422","\u0423","\u0424","\u0425","\u0426","\u0427","\u0428","\u0429","\u042A","\u042B","\u042C","\u042D","\u042E","\u042F","\u0430","\u0431","\u0432","\u0433","\u0434","\u0435","\u0436","\u0437","\u0438","\u0439","\u043A","\u043B","\u043C","\u043D","\u043E","\u043F","\u0440","\u0441","\u0442","\u0443","\u0444","\u0445","\u0446","\u0447","\u0448","\u0449","\u044A","\u044B","\u044C","\u044D","\u044E","\u044F"];function _s(c){return Array.from(c).map(r=>gr[r]).join("")}var Fa=" ".charCodeAt(0);function Ha(c){return new Uint8Array([...c].map(r=>{let e=gr.indexOf(r);return e>-1?e:Fa}))}var Ca=["gray","blue","navy","gray","#b5b5b5","white","black","black","black","white","gray","gray","gray","navy","white","#b5b5b5","gray","gray","black","gray","white"];function Ps(c){let r=parseInt(c);if(!isNaN(r))return r;let e=c.toLowerCase().trim();if(e.startsWith("rgb")){let t=e.split("(")[1].split(")")[0].split(",").map(s=>parseInt(s));return t[0]|t[1]<<8|t[2]<<16}return e.startsWith("transparent")?16777216:e.startsWith("syscolor")?33554432|parseInt(e.split("(")[1].split(")")[0]):(console.warn(`\u041D\u0435\u0438\u0437\u0432\u0435\u0441\u0442\u043D\u044B\u0439 \u043A\u043E\u0434 \u0446\u0432\u0435\u0442\u0430: "${c}"`),0)}function Fe(c){if(c&16777216)return null;let r=c&255;if(c&33554432)return Ca[r]||"black";let e=c>>8&255,t=c>>16&255;return c&67108864?`rgba(${r},${e},${t}, 0.5)`:`rgb(${r},${e},${t})`}function br(c,r,e,t){let s=t==="transparent"?16777216:t==="syscolor"?33554432:t==="editor"?67108864:0;return c&255|(r&255)<<8|(e&255)<<16|s}function Is(c){return c&255}function As(c){return c>>8&255}function Ns(c){return c>>16&255}function Rs(c){if(c&16777216)return"Transparent";let r=c&255;if(c&33554432)return`SysColor(${r})`;let e=c>>8&255,t=c>>16&255;return`rgb(${r},${e},${t})`}var Me=class{constructor(){this.frameId=0}get running(){return this.frameId!==0}run(r){if(this.running)return;let e=()=>{this.frameId=r()?requestAnimationFrame(e):0};this.frameId=requestAnimationFrame(e)}stop(){this.running&&(cancelAnimationFrame(this.frameId),this.frameId=0)}},yt=class{constructor(r=1){this.cycles=r;this.frameId=0}get running(){return this.frameId!==0}run(r){if(this.running)return;let e=()=>{for(let t=0;t<this.cycles;++t)if(!r()){this.frameId=0;return}this.frameId=setTimeout(e,0)};this.frameId=setTimeout(e)}stop(){this.running&&(clearTimeout(this.frameId),this.frameId=0)}};var Ul=new Intl.Collator(void 0,{numeric:!0,sensitivity:"base"}).compare;function He(c){return new Array().concat(...c)}var it=class{constructor(r,e){this.data=new Array(r.length);for(var t=0,s=r[0].length;t<r.length;t++){this.data[t]=new Array(s);for(var i=0;i<s;i++)this.data[t][i]=r[t][i]}if(e){if(typeof e[0]!="object")for(var t=0;t<e.length;t++)e[t]=[e[t]];this.mirror=new it(e)}}swap(r,e){this.mirror&&this.mirror.swap(r,e);var t=this.data[r];this.data[r]=this.data[e],this.data[e]=t}multline(r,e){this.mirror&&this.mirror.multline(r,e);for(var t=this.data[r],s=t.length-1;s>=0;s--)t[s]*=e}addmul(r,e,t){this.mirror&&this.mirror.addmul(r,e,t);for(var s=this.data[r],i=this.data[e],o=s.length-1;o>=0;o--)s[o]=s[o]+t*i[o]}hasNullLine(r){for(var e=0;e<this.data[r].length;e++)if(this.data[r][e]!==0)return!1;return!0}gauss(){for(var r=0,e=this.data.length,t=this.data[0].length,s=[],i=0;i<t;i++){for(var o=0,a=0,h=r;h<e;h++){var u=this.data[h][i];Math.abs(u)>Math.abs(o)&&(a=h,o=u)}if(o===0)s.push(r);else{this.multline(a,1/o),this.swap(a,r);for(var g=0;g<e;g++)g!==r&&this.addmul(g,r,-this.data[g][i])}r++}for(var g=0;g<s.length;g++)if(!this.mirror.hasNullLine(s[g]))throw new Error("singular matrix");return this.mirror.data}};function Gs({a:c,b:r}){var e=new it(c,r).gauss();if(e.length>0&&e[0].length===1)for(var t=0;t<e.length;t++)e[t]=e[t][0];return e}function ks(c,r,e,t){let s=e-c,i=t-r;return Math.sqrt(s*s+i*i)}function Ms(c,r,e,t,s){for(let i=r?0:2,o=r?c.length-2:0;i<c.length;o=i,i+=2){let a=c[i],h=c[i+1],u=c[o],g=c[o+1],b=a-u,w=h-g,D=b*b+w*w;if(D===0&&ks(t,s,u,g)<=e)return!0;let v=((t-u)*b+(s-g)*w)/D;if(v=Math.max(0,Math.min(1,v)),ks(t,s,u+v*b,g+v*w)<=e)return!0}return!1}function Ls(c,r,e){let t=!1;for(let s=0,i=c.length-2;s<c.length;i=s,s+=2){let o=c[s],a=c[s+1],h=c[i],u=c[i+1];(a<=e&&e<u||u<=e&&e<a)&&u-a!==0&&r>(h-o)*(e-a)/(u-a)+o&&(t=!t)}return t}function Bs(c){let r=c[0]*(c[4]*c[8]-c[7]*c[5])-c[1]*(c[3]*c[8]-c[5]*c[6])+c[2]*(c[3]*c[7]-c[4]*c[6]);return[(c[4]*c[8]-c[7]*c[5])/r,(c[2]*c[7]-c[1]*c[8])/r,(c[1]*c[5]-c[2]*c[4])/r,(c[5]*c[6]-c[3]*c[8])/r,(c[0]*c[8]-c[2]*c[6])/r,(c[3]*c[2]-c[0]*c[5])/r,(c[3]*c[7]-c[6]*c[4])/r,(c[6]*c[1]-c[0]*c[7])/r,(c[0]*c[4]-c[3]*c[1])/r]}var ye=class{constructor(r){this.m=new Map;r==null||r.forEach(([e,t])=>this.set(e,t))}set(r,e){let t=this.m.get(r);return t?t.add(e):this.m.set(r,new Set([e])),this}get(r){var e;return(e=this.m.get(r))!=null?e:null}delete(r){return this.m.delete(r)}forEach(r){return this.m.forEach(r)}[Symbol.iterator](){return this.m.entries()}values(){return this.m.values()}};function yr(c){c.preventDefault()}var ee=class extends Map{static freeKey(r,e){let t=e||0;for(;r.has(++t););return t}static freeNegativeKey(r){let e=0;for(;r.has(--e););return e}};var he=class{constructor(r,e,{key:t,data:s}){this.scene=r;this.m=e;this.subs=new Set;this.key=t||ee.freeKey(e),this.key>0&&this.m.set(this.key,this),this.data=s!=null?s:null}get refCount(){return this.subs.size}delete(){return this.key===0?!0:this.refCount?!1:(this.m.delete(this.key),this.key=0,!0)}toJSON(){let{key:r,data:e}=this;return{key:r,data:e}}};var fe=class extends he{constructor(e,t){super(e,e.objects,t);this.parent=null;let{x:s,y:i,width:o,height:a,attrib:h}=t;this.x=s!=null?s:0,this.y=i!=null?i:0,this.width=o!=null?o:0,this.height=a!=null?a:0,this.attrib=h!=null?h:0}delete(e){var s;if(super.delete(),e)return!0;(s=this.parent)==null||s.set({children:this.parent.children.filter(i=>i!==this)});let t=this.scene.order.filter(i=>i.key);return this.scene.set({order:t}),!0}set(e){var u;let{attrib:t,x:s,y:i,width:o,height:a}=e;this.attrib=t!=null?t:this.attrib;let h=!1;{let g=(s!=null?s:this.x)-this.x,b=(i!=null?i:this.y)-this.y;(g!==0||b!==0)&&(this._virtualMoved(g,b),h=!0)}if(o||a){let g=this.width||1,b=this.height||1,w=o&&o>0?o:g,D=a&&a>0?a:b,v=w/g,P=D/b;(v!==1||P!==1)&&(this._virtualResized(this.x,this.y,v,P),h=!0)}return h&&((u=this.parent)==null||u._childChanged()),this.scene._dirty=!0,this}rotate(e,{x:t,y:s}={x:this.x,y:this.y}){var i;return e===0?this:(this._virtualRotated(t,s,e),(i=this.parent)==null||i._childChanged(),this)}_virtualUpdateBBox(e,t,s,i){this.x=e,this.y=t,this.width=s,this.height=i}_virtualMoved(e,t){this._virtualUpdateBBox(this.x+e,this.y+t,this.width,this.height)}_virtualResized(e,t,s,i){let o=e+(this.x-e)*s,a=t+(this.y-t)*i,h=(this.width||1)*s,u=(this.height||1)*i;this._virtualUpdateBBox(o,a,h,u)}_virtualRotated(e,t,s){let i=Math.sin(s),o=Math.cos(s),a=this.x-e,h=this.y-t,u=a*o-h*i+e,g=a*i+h*o+t;this._virtualUpdateBBox(u,g,this.width,this.height)}toJSON(){let{attrib:e,height:t,width:s,x:i,y:o}=this;return R(N({},super.toJSON()),{attrib:e,height:t,width:s,x:i,y:o})}};var St=class extends fe{constructor(e,t,s){super(e,s);this.type="group";this.children=[];this.set(R(N({},s),{children:t}))}delete(e){return this.children.forEach(t=>t.delete(!0)),super.delete(e)}set(e){var s;typeof e.children!="undefined"&&(this.children.forEach(i=>i.parent=null),this.children=e.children,this.children.forEach(i=>i.parent=this),this.children.length>0?this._childChanged():(this._virtualUpdateBBox(this.x,this.y,0,0),(s=this.parent)==null||s._childChanged()));let{attrib:t}=e;return typeof t!="undefined"&&this.children.forEach(i=>i.set({attrib:t})),super.set(e)}_childChanged(){var o;let e=1/0,t=-1/0,s=1/0,i=-1/0;this.children.forEach(a=>{e=Math.min(e,a.x),s=Math.min(s,a.y),t=Math.max(t,a.x+a.width),i=Math.max(i,a.y+a.height)}),this._virtualUpdateBBox(e,s,t-e,i-s),(o=this.parent)==null||o._childChanged()}_virtualMoved(e,t){if(this.children.length===0){super._virtualMoved(e,t);return}this.children.forEach(s=>s._virtualMoved(e,t)),this._virtualUpdateBBox(this.x+e,this.y+t,this.width,this.height)}_virtualResized(e,t,s,i){if(this.children.length===0){super._virtualResized(e,t,s,i);return}let o=1/0,a=-1/0,h=1/0,u=-1/0;this.children.forEach(g=>{g._virtualResized(e,t,s,i),o=Math.min(o,g.x),h=Math.min(h,g.y),a=Math.max(a,g.x+g.width),u=Math.max(u,g.y+g.height)}),this._virtualUpdateBBox(o,h,a-o,u-h)}_virtualRotated(e,t,s){if(this.children.length===0){super._virtualRotated(e,t,s);return}let i=1/0,o=-1/0,a=1/0,h=-1/0;this.children.forEach(u=>{u._virtualRotated(e,t,s),i=Math.min(i,u.x),a=Math.min(a,u.y),o=Math.max(o,u.x+u.width),h=Math.max(h,u.y+u.height)}),this._virtualUpdateBBox(i,a,o-i,h-a)}*descendants(){for(let e of this.children)e.type==="group"&&(yield*e.descendants()),yield e}toJSON(){let{type:e}=this,u=super.toJSON(),{x:t,y:s,width:i,height:o}=u,a=ne(u,["x","y","width","height"]),h=this.children.filter(g=>g.key>0).map(g=>g.key);return R(N({},a),{type:e,children:h})}};var wt=class{constructor(r){this._dirty=!0;this.x=0;this.y=0;this.scale=1;this.order=[];this.background=null;this.hiddenLayers=0;this.grid=null;this.cursor=null;this.selectUnselectable=!1;this.disableInputs=!1;this.objects=new Map;this.pens=new Map;this.brushes=new Map;this.images=new Map;this.imagesOpaque=new Map;this.strings=new Map;this.fonts=new Map;this.texts=new Map;this.onpointermove=null;this.onpointerdown=null;this.onpointerup=null;this.oninputchanged=null;if(r){let e=r,{background:t,order:s}=e,i=ne(e,["background","order"]);this.set(i)}}set({x:r=this.x,y:e=this.y,order:t=this.order,scale:s=this.scale,hiddenLayers:i=this.hiddenLayers,selectUnselectable:o=this.selectUnselectable,disableInputs:a=this.disableInputs,grid:h=this.grid,background:u=this.background,cursor:g=this.cursor}){var b,w;if(this.background!==u&&((b=this.background)==null||b.subs.delete(this),this.background=u,(w=this.background)==null||w.subs.add(this)),this.disableInputs!==a){let D=a?"none":"auto";this.objects.forEach(v=>{v.type==="input"&&(v._html.style.pointerEvents=D)})}return this.x=r,this.y=e,this.order=t,this.scale=s,this.hiddenLayers=i,this.selectUnselectable=o,this.disableInputs=a,this.grid=h,this.cursor=g,this}pick(r,e){let{order:t,hiddenLayers:s,selectUnselectable:i}=this;for(let o=t.length-1;o>=0;--o){let a=t[o],h=a.attrib,u=h&1,g=h&2,b=h&4,w=h&8,D=h>>8&31;if(u||w&&!i||!g&&1<<D&s||b)continue;let v=r-a.x,P=e-a.y,k=0;if(a.type==="line"){if(a.pen)k=a.pen.width/2||.5;else if(!a.brush)continue;k=Math.max(k,4)}else if(a.type==="textView"){let E=Math.sin(-a.angle),A=Math.cos(-a.angle),U=v*A-P*E,q=v*E+P*A;v=U,P=q}if(!(v<-k||v>a.width+k||P<-k||P>a.height+k)&&!(a.type==="line"&&!a.inside(v,P,k)))return a}return null}toJSON(){let{background:r,x:e,y:t,scale:s,hiddenLayers:i,selectUnselectable:o,grid:a,pens:h,brushes:u,images:g,imagesOpaque:b,fonts:w,strings:D,texts:v,objects:P,order:k}=this;return{background:r==null?void 0:r.key,x:e,y:t,scale:s,hiddenLayers:i,selectUnselectable:o,grid:a,pens:[...h.values()].map(E=>E.toJSON()),brushes:[...u.values()].map(E=>E.toJSON()),images:[...g.values()].map(E=>E.toJSON()),imagesOpaque:[...b.values()].map(E=>E.toJSON()),fonts:[...w.values()].map(E=>E.toJSON()),strings:[...D.values()].map(E=>E.toJSON()),texts:[...v.values()].map(E=>E.toJSON()),objects:[...P.values()].map(E=>E.toJSON()),order:k.filter(E=>E.key>0).map(E=>E.key)}}group(r,e={}){return new St(this,r,e)}};var Tt=class extends fe{constructor(e,t,s){var o,a,h;let i=R(N({},s),{width:(o=s.width)!=null?o:t.width,height:(a=s.height)!=null?a:t.height,image:t});super(e,i);this.image=t;this.type="imageView";this.area=null;this.opaque=(h=s.opaque)!=null?h:!1,t.subs.add(this),this.set(i)}set(i){var o=i,{area:e=this.area,image:t=this.image}=o,s=ne(o,["area","image"]);return this.image!==t&&(this.image.subs.delete(this),this.image=t,this.image.subs.add(this)),this.area=e,super.set(s)}toJSON(){let{image:e,area:t,opaque:s,type:i}=this;return R(N({},super.toJSON()),{type:i,image:e.key,area:t,opaque:s})}delete(e){return this.image.subs.delete(this),super.delete(e)}};var Wt=class extends Tt{constructor(e,t,s){super(e,t,s);this._svg=document.createElementNS("http://www.w3.org/2000/svg","svg");this._visible=!0;this._src=null;this._area=null;this._x=0;this._y=0;this._w=0;this._h=0;this._svg.setAttribute("preserveAspectRatio","none"),this._svg.appendChild(this.img=document.createElementNS("http://www.w3.org/2000/svg","image"))}_render(){let e=this.attrib,t=e&1,s=e>>8&31,i=!(t||1<<s&this.scene.hiddenLayers);if(this._visible!==i&&(this._visible=i,i?this._svg.removeAttribute("display"):this._svg.setAttribute("display","none")),!i)return;let o=this.image,a=this._src!==o.realSrc;a&&this.img.setAttribute("href",this._src=o.realSrc);let h=this.area;if(this._area!==h||a){this._area=h;let D=o.width,v=o.height;if(h){let P=Math.min(Math.max(h.x,0),D),k=Math.min(Math.max(h.y,0),v),E=Math.min(Math.max(h.w,0),D-P),A=Math.min(Math.max(h.h,0),v-k);this._svg.setAttribute("viewBox",`${P} ${k} ${E} ${A}`)}else this._svg.setAttribute("viewBox",`0 0 ${D} ${v}`)}let u=this.x-this.scene.x,g=this.y-this.scene.y,b=this.width,w=this.height;this._x!==u&&this._svg.setAttribute("x",(this._x=u).toString()),this._y!==g&&this._svg.setAttribute("y",(this._y=g).toString()),this._w!==b&&this._svg.setAttribute("width",(this._w=b).toString()),this._h!==w&&this._svg.setAttribute("height",(this._h=w).toString())}};var Et=class extends fe{constructor(e,t,s){super(e,s);this.inputType=t;this.type="input";this.value="";this.style=0;this.font=null;this.set(s)}set(o){var a=o,{value:e=this.value,style:t=this.style,font:s=this.font}=a,i=ne(a,["value","style","font"]);var h,u;return this.value=e,this.style=t,this.font!==s&&((h=this.font)==null||h.subs.delete(this),this.font=s,(u=this.font)==null||u.subs.add(this)),super.set(i)}toJSON(){let{inputType:e,style:t,font:s,type:i,value:o}=this;return R(N({},super.toJSON()),{type:i,inputType:e,exStyle:0,font:s==null?void 0:s.key,style:t,value:o})}delete(e){var t;return(t=this.font)==null||t.subs.delete(this),super.delete(e)}};var $t=class extends Et{constructor(e,t,s){super(e,t,s);this._svg=!1;this._html=document.createElement("input");this.st=this._html.style;this._visible=!0;this._css=null;this._value="";this._x=0;this._y=0;this._w=0;this._h=0;let i=this._html;t==="Button"?(i.setAttribute("type","button"),i.setAttribute("class","swg-input swg-button"),i.addEventListener("click",this)):(i.setAttribute("type","text"),i.setAttribute("class","swg-input swg-textbox"),i.setAttribute("spellcheck","false"),i.addEventListener("input",this)),this.st.setProperty("position","absolute"),this.st.pointerEvents=e.disableInputs?"none":"auto",i.addEventListener("focus",this),i.addEventListener("blur",this)}handleEvent(e){var o;let t=this,{scene:s,_html:i}=this;this.value=this._value=i.value,(o=s.oninputchanged)==null||o.call(s,{type:e.type,scene:s,target:t})}_render(){var b;let e=this.attrib,t=e&1,s=e>>8&31,i=!(t||1<<s&this.scene.hiddenLayers);if(this._visible!==i&&(this._visible=i,i?this.st.removeProperty("display"):this.st.setProperty("display","none")),!i)return;let o=((b=this.font)==null?void 0:b.css())||null;if(this._css!==o)if(this._css=o,o){let w=.566726660156244,D=`${o.fontWeight} ${o.fontStyle} ${o.fontSize*w}px ${o.fontFamily}`;this.st.setProperty("font",D)}else this.st.removeProperty("font");this._value!==this.value&&(this._html.value=this._value=this.value);let a=this.x-this.scene.x,h=this.y-this.scene.y,u=this.width,g=this.height;this._x!==a&&this.st.setProperty("left",(this._x=a).toString()+"px"),this._y!==h&&this.st.setProperty("top",(this._y=h).toString()+"px"),this._w!==u&&this.st.setProperty("width",(this._w=u).toString()+"px"),this._h!==g&&this.st.setProperty("height",(this._h=g).toString()+"px")}};var Ot=class extends fe{constructor(e,t,s){super(e,s);this.type="line";this._coordsDirty=!0;this.pen=null;this.brush=null;this.start=null;this.end=null;this.setCoords(t).set(s)}get length(){return this.coords.length/2}set(a){var h=a,{pen:e=this.pen,brush:t=this.brush,start:s=this.start,end:i=this.end}=h,o=ne(h,["pen","brush","start","end"]);var u,g,b,w;return this.pen!==e&&((u=this.pen)==null||u.subs.delete(this),this.pen=e,(g=this.pen)==null||g.subs.add(this)),this.brush!==t&&((b=this.brush)==null||b.subs.delete(this),this.brush=t,(w=this.brush)==null||w.subs.add(this)),this.start=s,this.end=i,super.set(o)}addPoint({x:e,y:t},s=0){let i=s*2,o=this.coords,a=e-this.x,h=t-this.y;return i<0||i>=o.length?o.push(a,h):o.splice(i,0,a,h),this._pointCountChanged(),!0}point(e){let t=e*2,s=this.coords;return t>=0&&t<s.length?{x:s[t]+this.x,y:s[t+1]+this.y}:null}setPoint(e,{x:t,y:s}){let i=e*2,o=this.coords;return i<0||i>=o.length?!1:(o[i+0]=t-this.x,o[i+1]=s-this.y,this._pointCountChanged(),!0)}delPoint(e){let t=e*2,s=this.coords;return s.length<=2||t<0||t>=s.length?!1:(s.splice(t,2),this._pointCountChanged(),!0)}setCoords(e){if(!e.length||e.length%2)throw Error("\u041A\u043E\u043B\u0438\u0447\u0435\u0441\u0442\u0432\u043E \u043A\u043E\u043E\u0440\u0434\u0438\u043D\u0430\u0442 \u0434\u043E\u043B\u0436\u043D\u043E \u0431\u044B\u0442\u044C \u0447\u0435\u0442\u043D\u044B\u043C.");return this.x=0,this.y=0,this.coords=e.slice(),this._pointCountChanged(),this}inside(e,t,s){let{coords:i,brush:o}=this;return o&&Ls(i,e,t)||Ms(i,!!o,s,e,t)}_pointCountChanged(){var a;let e=this.coords,t=e[0],s=e[1],i=t,o=s;for(let h=2;h<e.length;h+=2){let u=e[h+0],g=e[h+1];u<t&&(t=u),u>i&&(i=u),g<s&&(s=g),g>o&&(o=g)}if(t!==0||s!==0)for(let h=0;h<e.length;h+=2)e[h+0]-=t,e[h+1]-=s;this._virtualUpdateBBox(this.x+t,this.y+s,i-t,o-s),(a=this.parent)==null||a._childChanged(),this._coordsDirty=this.scene._dirty=!0}_virtualResized(e,t,s,i){let o=this.coords;for(let u=0;u<o.length;u+=2)o[u+0]*=s,o[u+1]*=i;let a=e+(this.x-e)*s,h=t+(this.y-t)*i;this._virtualUpdateBBox(a,h,this.width*s,this.height*i),this._coordsDirty=!0}_virtualRotated(e,t,s){let i=this.coords,o=e-this.x,a=t-this.y,h=Math.sin(s),u=Math.cos(s),g=1/0,b=-1/0,w=1/0,D=-1/0;for(let v=0;v<i.length;v+=2){let P=i[v+0]-o,k=i[v+1]-a,E=P*u-k*h+o,A=P*h+k*u+a;i[v+0]=E,i[v+1]=A,E<g&&(g=E),E>b&&(b=E),A<w&&(w=A),A>D&&(D=A)}if(g!==0||w!==0)for(let v=0;v<i.length;v+=2)i[v+0]-=g,i[v+1]-=w;this._virtualUpdateBBox(this.x+g,this.y+w,b-g,D-w),this._coordsDirty=!0}toJSON(){let{coords:e,brush:t,end:s,pen:i,start:o,type:a}=this;return R(N({},super.toJSON()),{type:a,coords:e.slice(),brush:t==null?void 0:t.key,end:s,pen:i==null?void 0:i.key,start:o})}delete(e){var t,s;return(t=this.pen)==null||t.subs.delete(this),(s=this.brush)==null||s.subs.delete(this),super.delete(e)}};var Ka=0;function Vs(){let c=`mark_${++Ka}`,r=document.createElementNS("http://www.w3.org/2000/svg","marker");r.setAttribute("id",c),r.setAttribute("orient","auto"),r.setAttribute("refX","0");let e=document.createElementNS("http://www.w3.org/2000/svg","polyline");return r.appendChild(e),{shape:e,marker:r,id:c}}function Sr(c,r,e,t){let s=e.width||1,i=e.stroke(),o=r.fill?i:null,a=r.fill?null:i;c.marker.setAttribute("markerWidth",(r.width+s).toString()),c.marker.setAttribute("markerHeight",(r.oy*2+s).toString()),t&&c.marker.setAttribute("refX",r.width.toString()),c.marker.setAttribute("refY",r.oy.toString()),c.marker.setAttribute("markerUnits","userSpaceOnUse"),c.shape.setAttribute("points",r.coords),c.shape.setAttribute("stroke-width",s.toString()),a?c.shape.setAttribute("stroke",a):c.shape.removeAttribute("stroke"),c.shape.setAttribute("fill",o||"none")}function wr(c,r){var i;if(c.angle===0||c.length===0)return null;let e=Math.abs(c.length*Math.sin(c.angle)),t=Math.abs(c.length*Math.cos(c.angle)),s=r?[0,0,t,e,0,e*2]:[t,0,0,e,t,e*2];return{coords:Tr(s),fill:(i=c.fill)!=null?i:!1,width:t,oy:e}}function Tr(c){let r="";for(let e=0;e<c.length;e+=2)r+=c[e]+","+c[e+1]+" ";return r}var xt=class extends Ot{constructor(e,t,s){super(e,t,s);this._visible=!0;this._width=0;this._stroke=null;this._dash=null;this._fill=null;this._blend=null;this._start=null;this._startMark=null;this._end=null;this._endMark=null;this._x=0;this._y=0;this._svg=document.createElementNS("http://www.w3.org/2000/svg",s.brush?"polygon":"polyline"),this._svg.setAttribute("fill-rule","evenodd"),this._svg.setAttribute("stroke-linecap","round"),this._svg.setAttribute("stroke-linejoin","round")}createMarker(e){let t=Vs();return this.scene.defs.appendChild(t.marker),this._svg.setAttribute(e?"marker-end":"marker-start",`url(#${t.id})`),t}_render(){var A,U;let e=this.attrib,t=e&1,s=!!(e&2),i=e>>8&31,o=this.pen,a=this.brush,h=s||!(t||1<<i&this.scene.hiddenLayers)&&!!(o||a);if(this._visible!==h&&(this._visible=h,h?this._svg.removeAttribute("display"):this._svg.setAttribute("display","none")),!h)return;this._coordsDirty&&(this._coordsDirty=!1,this._svg.setAttribute("points",Tr(this.coords)));let u=(o==null?void 0:o.width)||1,g=(o==null?void 0:o.stroke())||null,b=(o==null?void 0:o.dash())||null;this._width!==u&&(this._width=u,this._svg.setAttribute("stroke-width",u.toString())),this._stroke!==g&&(this._stroke=g,g?this._svg.setAttribute("stroke",g):this._svg.removeAttribute("stroke")),this._dash!==b&&(this._dash=b,b?this._svg.setAttribute("stroke-dasharray",b):this._svg.removeAttribute("stroke-dasharray"));let w=this.length>2&&(a==null?void 0:a.fill())||"none";this._fill!==w&&(this._fill=w,this._svg.setAttribute("fill",w));let D=(a==null?void 0:a.blend())||(o==null?void 0:o.blend())||null;this._blend!==D&&(this._blend=D,D?this._svg.style.setProperty("mix-blend-mode",D):this._svg.style.removeProperty("mix-blend-mode"));let v=o&&this.start,P=o&&this.end;if(this._start!==v){this._start=v;let q=v&&wr(v,!0);q?Sr(this._startMark||(this._startMark=this.createMarker(!0)),q,o,!0):((A=this._startMark)==null||A.marker.remove(),this._startMark=null)}if(this._end!==P){this._end=P;let q=P&&wr(P,!1);q?Sr(this._endMark||(this._endMark=this.createMarker(!1)),q,o,!1):((U=this._endMark)==null||U.marker.remove(),this._endMark=null)}let k=this.x-this.scene.x,E=this.y-this.scene.y;(k!==this._x||E!==this._y)&&(this._x=k,this._y=E,this._svg.setAttribute("transform",`translate(${k}, ${E})`))}};var vt=class extends fe{constructor(e,t,s){var o,a,h;let i=R(N({},s),{width:(o=s.width)!=null?o:t.width,height:(a=s.height)!=null?a:t.height,text:t});super(e,i);this.text=t;this.type="textView";t.subs.add(this),this.angle=(h=s.angle)!=null?h:0,this.set(R(N({},s),{text:t}))}set(s){var i=s,{text:e=this.text}=i,t=ne(i,["text"]);return this.text!==e&&(this.text.subs.delete(this),this.text=e,this.text.subs.add(this)),super.set(t)}_virtualRotated(e,t,s){super._virtualRotated(e,t,s),this.angle+=s}toJSON(){let{text:e,angle:t,type:s}=this;return R(N({},super.toJSON()),{type:s,text:e.key,angle:t})}delete(e){return this.text.subs.delete(this),super.delete(e)}};function Us(c){let r=document.createElementNS("http://www.w3.org/2000/svg","tspan");return c&&(r.setAttribute("x","0px"),r.setAttribute("dy","1.15em")),r}var Dt=class{constructor(r,e){this.owner=r;this.part=e;this._strs=[];this._css=null;this._fgcolor=NaN;this.spans=e.string.split().map((t,s)=>Us(s>0))}update(){var o,a;let r=!1,{part:e,spans:t}=this,s=e.string.split(),i=e.font.css();if(this._strs!==s){this._strs=s,r=!0,t.length!==s.length&&(this._fgcolor=NaN);let h;for(let u=0;u<s.length;++u){if(u<t.length)h=t[u];else{let b=Us(!0);t.push(b),h.after(b),h=b,this._css=null}let g=s[u];i.fontFamily==="Symbol"&&(g=[...oe.encode(g)].map(b=>String.fromCharCode(b===142?163:b)).join("")),h.textContent=g||"\u200B"}for(;t.length>s.length;)(o=t.pop())==null||o.remove()}if(this._css!==i&&(this._css=i,r=!0,t.forEach(h=>{h.setAttribute("font-family",i.fontFamily),h.setAttribute("font-size",i.fontSize.toString()),h.setAttribute("font-style",i.fontStyle),h.setAttribute("text-decoration",i.textDecoration),h.setAttribute("font-weight",i.fontWeight)})),this._fgcolor!==e.fgcolor){this._fgcolor=e.fgcolor;let h=(a=Fe(e.fgcolor))!=null?a:"transparent";t.forEach(u=>u.setAttribute("fill",h))}return r}};var _t=class extends vt{constructor(e,t,s){var i,o;super(e,t,s);this._svg=document.createElementNS("http://www.w3.org/2000/svg","text");this._visible=!0;this._parts=[];this._partsSVG=[];this._sizes={w:0,h:0};this._angle=0;this._x=0;this._y=0;if(this._svg.setAttribute("dominant-baseline","text-before-edge"),this._svg.setAttribute("alignment-baseline","text-before-edge"),this._svg.setAttribute("letter-spacing","-0.07"),this._svg.style.setProperty("white-space","pre"),this._svg.style.setProperty("user-select","none"),this._svg.style.setProperty("pointer-events","none"),t._textCalc=this._calcSizes.bind(this),!s.width||!s.height){let a=(i=s.width)!=null?i:t.width,h=(o=s.height)!=null?o:t.height;this._virtualUpdateBBox(this.x,this.y,a,h)}}_calcSizes(){var o;let e=(o=this.text)==null?void 0:o.parts;if(!e||!this.updateParts(e))return this._sizes;let t=this._svg.parentElement;t||this.scene.root.appendChild(this._svg);let{width:s,height:i}=this._svg.getBoundingClientRect();return t||this._svg.remove(),this._sizes={w:s,h:i}}updateParts(e){if(this._parts!==e){this._parts=e;let t=[];this._partsSVG=e.map(s=>{let i=new Dt(this,s);return t.push(...i.spans),i}),this._svg.replaceChildren(...t)}return this._partsSVG.reduce((t,s)=>s.update()||t,!1)}_render(){var g;let e=this.attrib,t=e&1,s=e>>8&31,i=(g=this.text)==null?void 0:g.parts,o=!(t||1<<s&this.scene.hiddenLayers)&&!!i;if(this._visible!==o&&(this._visible=o,o?this._svg.removeAttribute("display"):this._svg.setAttribute("display","none")),!o)return;this.updateParts(i);let a=this.x-this.scene.x,h=this.y-this.scene.y,u=this.angle;(a!==this._x||h!==this._y||this._angle!==u)&&(this._x=a,this._y=h,this._angle=u,this._svg.setAttribute("transform",`translate(${a}, ${h}), rotate(${u*180/Math.PI})`))}};var Ce={};function Ke(c){return Ce.baseURL?`${Ce.baseURL}/${c}`:c}var Pt=class extends fe{constructor(e,t){super(e,t);this.type="videoView";this.fixed=!1;this.set(t)}set(e){var t,s,i;return this.position=(t=e.position)!=null?t:this.position,this.state=(s=e.state)!=null?s:this.state,this.fixed=(i=e.fixed)!=null?i:this.fixed,super.set(e)}toJSON(){throw new Error("Method not implemented.")}};var Wr=class{constructor(r){this.e=r}get width(){return this.e.videoWidth}get height(){return this.e.videoHeight}},It=class extends Pt{constructor(e,t,s){super(e,s);this._svg=!1;this._html=document.createElement("video");this.st=this._html.style;this._visible=!0;this._x=0;this._y=0;this._w=0;this._h=0;let i=this._html;i.src=t,this.video=new Wr(i),this.st.setProperty("position","absolute"),this.st.setProperty("background","black"),Ce.hideVideoControls?this.st.setProperty("pointer-events","none"):i.setAttribute("controls","true")}get state(){let e=this._html;return e.paused?e.currentTime?"pause":"stop":"play"}set state(e){let t=this._html;switch(e){case"play":t.play();break;case"pause":t.pause();break;case"stop":t.pause(),t.currentTime=0;break}}get position(){return this._html.currentTime}set position(e){this._html.currentTime=e}_render(){let e=this.attrib,t=e&1,s=e>>8&31,i=!(t||1<<s&this.scene.hiddenLayers);if(this._visible!==i&&(this._visible=i,i?this.st.removeProperty("display"):this.st.setProperty("display","none")),!i)return;let o=this.x-this.scene.x,a=this.y-this.scene.y;if(this._x!==o&&this.st.setProperty("left",(this._x=o).toString()+"px"),this._y!==a&&this.st.setProperty("top",(this._y=a).toString()+"px"),this.fixed){let h=this.width,u=this.height;this._w!==h&&this.st.setProperty("width",(this._w=h).toString()+"px"),this._h!==u&&this.st.setProperty("height",(this._h=u).toString()+"px")}}};var At=class extends he{constructor(e,t){super(e,e.brushes,t);this.color=0;this.style=0;this.rop=0;this.hatch=0;this.image=null;this.set(t)}set({color:e=this.color,hatch:t=this.hatch,image:s=this.image,rop:i=this.rop,style:o=this.style}){var a,h;return this.image!==s&&((a=this.image)==null||a.subs.delete(this),this.image=s,(h=this.image)==null||h.subs.add(this)),this.color=e,this.style=o,this.rop=i,this.hatch=t,this}toJSON(){let{color:e,hatch:t,image:s,rop:i,style:o}=this;return R(N({},super.toJSON()),{color:e,hatch:t,image:s==null?void 0:s.key,rop:i,style:o})}delete(){var e;return super.delete()?((e=this.image)==null||e.subs.delete(this),!0):!1}};var qa=9,Xa=10,Ya=0,za=1,Ja=3,Nt=class extends At{constructor(){super(...arguments);this._color=NaN;this._cssColor=null}cssColor(){return this._color!==this.color?this._cssColor=Fe(this._color=this.color):this._cssColor}blend(){switch(this.rop){case qa:return"multiply";case Xa:return"multiply";default:return null}}fill(){var e,t;switch(this.style){case Ya:return this.cssColor();case za:return null;case Ja:return(t=(e=this.image)==null?void 0:e.pattern())!=null?t:"black";default:return"white"}}};var Rt=class extends he{constructor(e,t){super(e,e.fonts,t);this.name="";this.size=0;this.style=0;this.set(t)}set({name:e,size:t,style:s}){return this.name=e!=null?e:this.name,this.size=t!=null?t:this.size,this.style=s!=null?s:this.style,this}toJSON(){let{name:e,size:t,style:s}=this;return R(N({},super.toJSON()),{name:e,size:t,style:s})}};var Gt=class extends Rt{constructor(){super(...arguments);this._name="";this._size=NaN;this._style=NaN;this._family="";this._decoration="";this._fstyle="";this._weight="";this._css=this.css()}css(){let{name:e,size:t,style:s}=this,i=!1;if(this._style!==s){this._style=s,i=!0;let o=s&1,a=s&2,h=s&4,u=s&8;this._decoration=`${a?"underline":""} ${h?"line-through":""}`,this._fstyle=o?"italic":"normal",this._weight=u?"bold":"normal"}return this._name!==e&&(this._name=e,i=!0,this._family=(e.toUpperCase().endsWith(" CYR")?e.slice(0,e.length-4):e)||"Arial"),this._size!==t&&(this._size=t,i=!0),i?this._css={fontFamily:this._family,textDecoration:this._decoration,fontSize:t||15.940224159402327,fontStyle:this._fstyle,fontWeight:this._weight}:this._css}};var kt=class extends he{constructor(e,{width:t,height:s,src:i},o){super(e,o.opaque?e.imagesOpaque:e.images,o);this.width=t,this.height=s,this.src=i,this.realSrc=Ke(i)}toJSON(){let{height:e,src:t,width:s}=this;return R(N({},super.toJSON()),{height:e,src:t,width:s})}};var Er=class extends kt{constructor(){super(...arguments);this._pattern=null}pixel(){return 0}setPixel(){return!0}pattern(){if(this._pattern)return this._pattern.url;let e=document.createElementNS("http://www.w3.org/2000/svg","pattern"),t=`patt_${++Er.id}`;e.setAttribute("id",t),e.setAttribute("patternUnits","userSpaceOnUse"),e.setAttribute("width",this.width.toString()),e.setAttribute("height",this.height.toString());let s=document.createElementNS("http://www.w3.org/2000/svg","image");s.setAttribute("href",this.realSrc),e.appendChild(s),this.scene.defs.appendChild(e);let i=`url(#${t})`;return this._pattern={e,url:i},i}},nt=Er;nt.id=0;var Mt=class extends he{constructor(e,t){super(e,e.pens,t);this.color=0;this.style=0;this.rop=0;this.width=0;this.set(t)}set({color:e,rop:t,style:s,width:i}){return this.color=e!=null?e:this.color,this.style=s!=null?s:this.style,this.rop=t!=null?t:this.rop,this.width=i!=null?i:this.width,this}toJSON(){let{color:e,rop:t,style:s,width:i}=this;return R(N({},super.toJSON()),{color:e,rop:t,style:s,width:i})}};var Za=0,Qa=1,el=2,tl=3,rl=4,sl=5,il=9,nl=10,Lt=class extends Mt{constructor(){super(...arguments);this._color=NaN;this._cssColor=null}cssColor(){return this._color!==this.color?this._cssColor=Fe(this._color=this.color):this._cssColor}blend(){switch(this.rop){case il:return"multiply";case nl:return"multiply";default:return null}}stroke(){return this.style===sl?null:this.cssColor()}dash(){switch(this.style){case Za:return null;case Qa:return"16 4";case el:return"2 4";case tl:return"16 4 2 4";case rl:return"16 4 2 4 2 4";default:return null}}};var Bt=class extends he{constructor(e,t,s){super(e,e.strings,s);this.text=t;this.set(R(N({},s),{text:t}))}set({text:e}){return this.text=e!=null?e:this.text,this}toJSON(){let{text:e}=this;return R(N({},super.toJSON()),{text:e})}};var Vt=class extends Bt{constructor(){super(...arguments);this._text="";this._parts=[""]}split(){return this._text!==this.text?this._parts=(this._text=this.text).split(`\r
`).join(`
`).split(`
`):this._parts}};var Ut=class extends he{constructor(e,t,s){super(e,e.texts,s);this.parts=[];this.set(R(N({},s),{parts:t}))}set({parts:e=this.parts}){return this.parts!==e&&(this.parts.forEach(t=>{t.string.subs.delete(this),t.font.subs.delete(this)}),this.parts=e,this.parts.forEach(t=>{t.string.subs.add(this),t.font.subs.add(this)})),this}toJSON(){let e=this.parts.map(({bgcolor:t,fgcolor:s,font:i,string:o})=>({bgcolor:t,fgcolor:s,font:i.key,string:o.key}));return R(N({},super.toJSON()),{parts:e})}delete(){return super.delete()?(this.parts.forEach(e=>{e.string.subs.delete(this),e.font.subs.delete(this)}),!0):!1}};var jt=class extends Ut{constructor(){super(...arguments);this._textCalc=null}get width(){var e,t;return(t=(e=this._textCalc)==null?void 0:e.call(this).w)!=null?t:0}get height(){var e,t;return(t=(e=this._textCalc)==null?void 0:e.call(this).h)!=null?t:0}};function $r(c,r,e){let t=new Set(e),s=0,i=null;r.forEach(o=>{if(t.delete(o),s<e.length&&o===e[s])++s;else{let a=i?i.nextElementSibling:c.firstElementChild;c.insertBefore(o._svg||o._html,a)}i=o._svg||o._html}),t.forEach(o=>(o._svg||o._html).remove())}var Ne=class extends wt{constructor(e){super(e);this._cursor=null;this.currentPointerId=null;this.canCaptureMouseEvents=!1;this.prevOrder=[];this.svgOrder=[];this.htmlOrder=[];this.bgRect=null;this._mouse={x:0,y:0};this._bg=null;let t=this.view=document.createElement("div");t.style.setProperty("overflow","hidden"),t.style.setProperty("position","relative"),t.style.setProperty("width","100%"),t.style.setProperty("height","100%"),t.style.setProperty("background-color","white");let s=this.root=document.createElementNS("http://www.w3.org/2000/svg","svg");s.style.setProperty("width","100%"),s.style.setProperty("height","100%"),s.style.setProperty("transform-origin","top left"),s.style.setProperty("touch-action","none"),s.style.setProperty("outline","none"),s.tabIndex=0;let i=this.defs=document.createElementNS("http://www.w3.org/2000/svg","defs"),o=this.htmlRoot=document.createElement("div");o.style.setProperty("width","100%"),o.style.setProperty("height","100%"),o.style.setProperty("transform-origin","top left"),s.appendChild(i),t.appendChild(s),t.appendChild(o);let a=this._handlePointer.bind(this);s.addEventListener("pointerdown",a),s.addEventListener("pointermove",a),s.addEventListener("pointerup",a),s.addEventListener("selectstart",yr),s.addEventListener("contextmenu",yr),Ne.scenes.add(this),Ne.updater.run(Ne.redrawAll)}static redrawAll(){return Ne.scenes.forEach(e=>e._render()),Ne.scenes.size>0}dispose(){Ne.scenes.delete(this)}_render(e=!1){var D,v;if(!e&&!this.view.parentElement)return;let{background:t,prevOrder:s,svgOrder:i,root:o,htmlOrder:a,htmlRoot:h,cursor:u}=this;this._cursor!==u&&(this._cursor=u,o.style.cursor=u||"auto");let g=(D=t==null?void 0:t.fill())!=null?D:null,b=!1;if(b=this._bg!==g)if(this._bg=g,g){if(!this.bgRect){let P=document.createElementNS("http://www.w3.org/2000/svg","rect");P.setAttribute("width","100%"),P.setAttribute("height","100%"),this.bgRect={_svg:P,_render:()=>{}}}this.bgRect._svg.setAttribute("fill",g)}else(v=this.bgRect)==null||v._svg.remove(),this.bgRect=null;let w=this.order;if(s!==w||b){let P=this.bgRect?[this.bgRect]:[],k=[];w.forEach(E=>{E._svg?P.push(E):k.push(E)}),i.length>0?$r(o,P,i):o.append(...P.map(E=>E._svg)),a.length>0?$r(h,k,a):k.length>0&&h.append(...k.map(E=>E._html)),this.svgOrder=P,this.htmlOrder=k,this.prevOrder=w}w.forEach(P=>P._render())}mouse(){return this._mouse}toDataURL(e){let{x:t,y:s}=this;e&&(this.x=e.x,this.y=e.y,this.root.style.setProperty("width",e.w+"px"),this.root.style.setProperty("height",e.h+"px")),this._render(!0);let i=new XMLSerializer().serializeToString(this.root);i.match(/^<svg[^>]+xmlns="http\:\/\/www\.w3\.org\/2000\/svg"/)||(i=i.replace(/^<svg/,'<svg xmlns="http://www.w3.org/2000/svg"')),i.match(/^<svg[^>]+"http\:\/\/www\.w3\.org\/1999\/xlink"/)||(i=i.replace(/^<svg/,'<svg xmlns:xlink="http://www.w3.org/1999/xlink"')),i=`<?xml version="1.0" standalone="no"?>\r
`+i;let o="data:image/svg+xml;charset=utf-8,"+encodeURIComponent(i);return e&&(this.x=t,this.y=s,this.root.style.setProperty("width","100%"),this.root.style.setProperty("height","100%"),this._render(!0)),{ext:"svg",url:o}}_handlePointer(e){if(!e.isPrimary)return;let t=e.type;this.canCaptureMouseEvents&&(this.currentPointerId===null||t==="pointerdown")&&(this.root.setPointerCapture(e.pointerId),this.currentPointerId=e.pointerId),t==="pointerup"&&this.currentPointerId!==null&&(this.root.releasePointerCapture(this.currentPointerId),this.currentPointerId=null);let s=e.offsetX+this.x,i=e.offsetY+this.y;this._mouse={x:s,y:i};let o=e.button===0?"left":e.button===1?"middle":e.button===2?"right":"unknown",a={left:!!(e.buttons&1),right:!!(e.buttons&2),middle:!!(e.buttons&4)},h=t==="pointerdown"?this.onpointerdown:t==="pointerup"?this.onpointerup:this.onpointermove;h==null||h({e,type:t,scene:this,x:s,y:i,button:o,buttons:a})}startCapturingMouseEvents(){this.canCaptureMouseEvents=!0}stopCapturingMouseEvents(){this.canCaptureMouseEvents=!1,this.currentPointerId!==null&&(this.root.releasePointerCapture(this.currentPointerId),this.currentPointerId=null)}line(e,t={}){return new xt(this,e,t)}imageView(e,t={}){return new Wt(this,e,t)}textView(e,t={}){return new _t(this,e,t)}input(e,t={}){return new $t(this,e,t)}video(e,t={}){return new It(this,e,t)}pen(e={}){return new Lt(this,e)}brush(e={}){return new Nt(this,e)}image(e,t={}){return new nt(this,e,t)}string(e,t={}){return new Vt(this,e,t)}font(e={}){return new Gt(this,e)}text(e,t={}){return new jt(this,e,t)}},qe=Ne;qe.scenes=new Set,qe.updater=new Me;function js(c,r,e="random"){var D,v,P,k;let t=r.pens?new Map(r.pens.map(E=>{let A=e==="exact"?E.key:e==="random"?0:-1;return[E.key,c.pen(R(N({},E),{key:A}))]})):c.pens,s=r.imagesOpaque?new Map(r.imagesOpaque.map(E=>{let A=e==="exact"?E.key:e==="random"?0:-1;return[E.key,c.image(E,R(N({},E),{key:A,opaque:!0}))]})):c.imagesOpaque,i=r.brushes?new Map(r.brushes.map(E=>{let A=e==="exact"?E.key:e==="random"?0:-1,U=E.image&&(s.get(E.image)||c.imagesOpaque.get(E.image))||null;return[E.key,c.brush(R(N({},E),{key:A,image:U}))]})):c.brushes,o=r.images?new Map(r.images.map(E=>{let A=e==="exact"?E.key:e==="random"?0:-1;return[E.key,c.image(E,R(N({},E),{key:A}))]})):c.images,a=r.strings?new Map(r.strings.map(E=>{let A=e==="exact"?E.key:e==="random"?0:-1;return[E.key,c.string(E.text||"",R(N({},E),{key:A}))]})):c.strings,h=r.fonts?new Map((D=r.fonts)==null?void 0:D.map(E=>{let A=e==="exact"?E.key:e==="random"?0:-1;return[E.key,c.font(R(N({},E),{key:A}))]})):c.fonts,u=r.texts?new Map(r.texts.map(E=>{let A=e==="exact"?E.key:e==="random"?0:-1,U=E.parts.map((q,ce)=>{let Te=a.get(q.string)||c.strings.get(q.string);if(!Te)throw Error(`\u0422\u0435\u043A\u0441\u0442 #${E.key}[${ce}]: \u0421\u0442\u0440\u043E\u043A\u0430 #${q.string} \u043D\u0435 \u0441\u0443\u0449\u0435\u0441\u0442\u0432\u0443\u0435\u0442`);let ie=h.get(q.font)||c.fonts.get(q.font);if(!ie)throw Error(`\u0422\u0435\u043A\u0441\u0442 #${E.key}[${ce}]: \u0428\u0440\u0438\u0444\u0442 #${q.string} \u043D\u0435 \u0441\u0443\u0449\u0435\u0441\u0442\u0432\u0443\u0435\u0442`);return R(N({},q),{string:Te,font:ie})});return[E.key,c.text(U,R(N({},E),{key:A}))]})):c.texts,g=new Set,b=new Map((v=r.objects)==null?void 0:v.map(E=>{switch(E.type){case"line":{let A=e==="exact"?E.key:e==="random"?0:-1,U=E.pen&&(t.get(E.pen)||c.pens.get(E.pen))||null,q=E.brush&&(i.get(E.brush)||c.brushes.get(E.brush))||null;return[E.key,c.line(E.coords,R(N({},E),{key:A,pen:U,brush:q}))]}case"imageView":{let A=e==="exact"?E.key:e==="random"?0:-1,U=(E.opaque?s:o).get(E.image)||(E.opaque?c.imagesOpaque:c.images).get(E.image);if(!U)throw Error(`${E.opaque?"\u0411":"\u0414\u0432\u043E\u0439\u043D\u0430\u044F \u0431"}\u0438\u0442\u043E\u0432\u0430\u044F \u043A\u0430\u0440\u0442\u0430 #${E.key}: \u0418\u0437\u043E\u0431\u0440\u0430\u0436\u0435\u043D\u0438\u0435 #${E.image} \u043D\u0435 \u0441\u0443\u0449\u0435\u0441\u0442\u0432\u0443\u0435\u0442`);return[E.key,c.imageView(U,R(N({},E),{key:A}))]}case"textView":{let A=e==="exact"?E.key:e==="random"?0:-1,U=u.get(E.text)||c.texts.get(E.text);if(!U)throw Error(`TextView #${E.key}: \u0422\u0435\u043A\u0441\u0442 #${E.text} \u043D\u0435 \u0441\u0443\u0449\u0435\u0441\u0442\u0432\u0443\u0435\u0442`);return[E.key,c.textView(U,R(N({},E),{key:A}))]}case"input":{let A=e==="exact"?E.key:e==="random"?0:-1,U=E.font&&(h.get(E.font)||c.fonts.get(E.font))||null;return[E.key,c.input(E.inputType,R(N({},E),{key:A,font:U}))]}case"videoView":{let A=e==="exact"?E.key:e==="random"?0:-1;return[E.key,c.video(E.res,R(N({},E),{key:A}))]}case"group":{let A=e==="exact"?E.key:e==="random"?0:-1,U=c.group([],R(N({},E),{key:A}));return g.add([U,E.children]),[E.key,U]}case"3dView":throw Error(`\u041E\u0431\u044A\u0435\u043A\u0442 #${E.key} \u044F\u0432\u043B\u044F\u0435\u0442\u0441\u044F 3D \u043F\u0440\u043E\u0435\u043A\u0446\u0438\u0435\u0439. \u041E\u043D\u0438 \u0435\u0449\u0435 \u043D\u0435 \u0440\u0435\u0430\u043B\u0438\u0437\u043E\u0432\u0430\u043D\u044B.`)}}));g.forEach(([E,A])=>{let U=A.map(q=>{let ce=b.get(q);if(!ce)throw Error(`\u0413\u0440\u0443\u043F\u043F\u0430 ${E.key}: \u0414\u043E\u0447\u0435\u0440\u043D\u0438\u0439 \u043E\u0431\u044A\u0435\u043A\u0442 #${q} \u043D\u0435 \u0441\u0443\u0449\u0435\u0441\u0442\u0432\u0443\u0435\u0442.`);return ce});E.set({children:U})});let w=(k=(P=r.order)==null?void 0:P.map(E=>{let A=b.get(E);if(!A)throw Error(`\u041E\u0431\u044A\u0435\u043A\u0442 #${E} \u043D\u0435 \u0441\u0443\u0449\u0435\u0441\u0442\u0432\u0443\u0435\u0442 \u0438 \u043D\u0435 \u043C\u043E\u0436\u0435\u0442 \u0431\u044B\u0442\u044C \u043E\u0442\u043E\u0431\u0440\u0430\u0436\u0435\u043D.`);if(A.type==="group")throw Error(`\u041E\u0431\u044A\u0435\u043A\u0442 #${E} \u044F\u0432\u043B\u044F\u0435\u0442\u0441\u044F \u0433\u0440\u0443\u043F\u043F\u043E\u0439 \u0438 \u043D\u0435 \u043C\u043E\u0436\u0435\u0442 \u0431\u044B\u0442\u044C \u043E\u0442\u043E\u0431\u0440\u0430\u0436\u0435\u043D.`);return A}))!=null?k:[];return c.set({order:c.order.concat(w)}),{objects:b,brushes:i,fonts:h,images:o,imagesOpaque:s,pens:t,strings:a,texts:u,order:w}}function Ft(c,r){if(!r)return new c;let e=new c(r);js(e,r,"exact");let t=r.background&&e.brushes.get(r.background)||null;return e.set({background:t})}function ol(c){return Array.from(c.values()).filter(r=>!r.parent)}function Ht(c,r,e="random"){let{objects:t}=js(c,r,e),s=ol(t);return s.length>1?c.group(s,{key:e==="unused"?-1:0}):s[0]}function Fs(c){let r=He(c.map(b=>b.type==="group"?[...b.descendants(),b]:[b])).filter(b=>b.key>0);if(!r.length)return{};let{scene:e}=r[0],t=new Set,s=new Set,i=new Set,o=new Set,a=new Set,h=new Set,u=new Set;r.forEach(b=>{var w;switch(b.type){case"line":b.pen&&t.add(b.pen),b.brush&&s.add(b.brush),(w=b.brush)!=null&&w.image&&o.add(b.brush.image);break;case"imageView":(b.opaque?o:i).add(b.image);break;case"textView":b.text.parts.forEach(D=>{a.add(D.string),h.add(D.font)}),u.add(b.text);break;case"input":b.font&&h.add(b.font);break}});let g=new WeakSet(r);return{pens:[...t].map(b=>b.toJSON()),brushes:[...s].map(b=>b.toJSON()),images:[...i].map(b=>b.toJSON()),imagesOpaque:[...o].map(b=>b.toJSON()),strings:[...a].map(b=>b.toJSON()),fonts:[...h].map(b=>b.toJSON()),texts:[...u].map(b=>b.toJSON()),objects:r.map(b=>b.toJSON()),order:e.order.filter(b=>g.has(b)).map(b=>b.key)}}function Ct(c){let r=1/0,e=1/0,t=-1/0,s=-1/0;return c.forEach(i=>{i.x<r&&(r=i.x),i.y<e&&(e=i.y),i.x+i.width>t&&(t=i.x+i.width),i.y+i.height>s&&(s=i.y+i.height)}),{x:r,y:e,w:t-r,h:s-e}}var Hs=qe;var J=Ce;J.libraryURL="library";var ae=new URLSearchParams(location.search).get("debug"),Kt=ae==null?void 0:ae.includes("all");J.logMessage=Kt||(ae==null?void 0:ae.includes("log"));J.debugCompiler=Kt||(ae==null?void 0:ae.includes("compiler"));J.debugProject=Kt||(ae==null?void 0:ae.includes("project"));J.debugFile=Kt||(ae==null?void 0:ae.includes("file"));J.debugExecution=ae==null?void 0:ae.includes("execution");var Y=(s=>(s[s.FLOAT=1]="FLOAT",s[s.STRING=2]="STRING",s[s.HANDLE=3]="HANDLE",s[s.COLORREF=4]="COLORREF",s))(Y||{});var Se=(n=>(n[n.PI=Math.PI]="PI",n[n.WORD8=0]="WORD8",n[n.INT8=1]="INT8",n[n.WORD16=2]="WORD16",n[n.INT16=3]="INT16",n[n.WORD32=4]="WORD32",n[n.INT32=5]="INT32",n[n.FLOAT32=6]="FLOAT32",n[n.FLOAT40=7]="FLOAT40",n[n.FLOAT64=8]="FLOAT64",n[n.FLOAT80=9]="FLOAT80",n[n.PEN2D=1]="PEN2D",n[n.BRUSH2D=2]="BRUSH2D",n[n.DIB2D=3]="DIB2D",n[n.DOUBLEDIB2D=4]="DOUBLEDIB2D",n[n.FONT2D=5]="FONT2D",n[n.STRING2D=6]="STRING2D",n[n.TEXT2D=7]="TEXT2D",n[n.SPACE3D=8]="SPACE3D",n[n.TEXTURE3D=9]="TEXTURE3D",n[n.SIZE_RESTORED=0]="SIZE_RESTORED",n[n.SIZE_MINIMIZED=1]="SIZE_MINIMIZED",n[n.SIZE_MAXIMIZED=2]="SIZE_MAXIMIZED",n[n.SIZE_MAXSHOW=3]="SIZE_MAXSHOW",n[n.SIZE_MAXHIDE=4]="SIZE_MAXHIDE",n[n.OTGROUP2D=3]="OTGROUP2D",n[n.OTRGROUP2D=4]="OTRGROUP2D",n[n.OTGROUP3D=5]="OTGROUP3D",n[n.OTOBJECT3D=10]="OTOBJECT3D",n[n.OTLINE_2D=20]="OTLINE_2D",n[n.OTBITMAP_2D=21]="OTBITMAP_2D",n[n.OTDOUBLEBITMAP_2D=22]="OTDOUBLEBITMAP_2D",n[n.OTTEXT_2D=23]="OTTEXT_2D",n[n.OTVIEW3D_2D=24]="OTVIEW3D_2D",n[n.OTEDITFRAME=50]="OTEDITFRAME",n[n.OTROTATECENTER=51]="OTROTATECENTER",n[n.OTFRAME3D=52]="OTFRAME3D",n[n.OTAXIS3D=53]="OTAXIS3D",n[n.OTPEN2D=101]="OTPEN2D",n[n.OTBRUSH2D=102]="OTBRUSH2D",n[n.OTDIB2D=103]="OTDIB2D",n[n.OTDOUBLEDIB2D=104]="OTDOUBLEDIB2D",n[n.OTFONT2D=105]="OTFONT2D",n[n.OTSTRING2D=106]="OTSTRING2D",n[n.OTTEXT2D=107]="OTTEXT2D",n[n.OTREFTODIB2D=110]="OTREFTODIB2D",n[n.OTREFTODOUBLEDIB2D=111]="OTREFTODOUBLEDIB2D",n[n.ATTRSET=1]="ATTRSET",n[n.ATTRRESET=2]="ATTRRESET",n[n.ATTRPUT=3]="ATTRPUT",n[n.PFC_MOVEOBJECT=32768]="PFC_MOVEOBJECT",n[n.PFC_SETCURRENT=16384]="PFC_SETCURRENT",n[n.PFC_SETFRAME=8192]="PFC_SETFRAME",n[n.PFC_PENS=1]="PFC_PENS",n[n.PFC_BRUHS=2]="PFC_BRUHS",n[n.PFC_DIBS=4]="PFC_DIBS",n[n.PFC_DDIBS=8]="PFC_DDIBS",n[n.PFC_STRINGS=16]="PFC_STRINGS",n[n.PFC_FONTS=32]="PFC_FONTS",n[n.PFC_TEXTS=64]="PFC_TEXTS",n[n.PFC_3D=128]="PFC_3D",n[n.PFC_ALL=255]="PFC_ALL",n[n.OID_RESERVED=32e3]="OID_RESERVED",n[n.OID_RCENTER=32001]="OID_RCENTER",n[n.OID_FRAME2D1=32002]="OID_FRAME2D1",n[n.OID_FRAME2D2=32003]="OID_FRAME2D2",n[n.OID_FRAME2D3=32004]="OID_FRAME2D3",n[n.OID_FRAME2D4=32005]="OID_FRAME2D4",n[n.OID_FRAME2D5=32006]="OID_FRAME2D5",n[n.OID_FRAME2D6=32007]="OID_FRAME2D6",n[n.OID_FRAME2D7=32008]="OID_FRAME2D7",n[n.OID_FRAME2D8=32009]="OID_FRAME2D8",n[n.OID_FRAME2D=32010]="OID_FRAME2D",n[n.OID_AXIS3D=32100]="OID_AXIS3D",n[n.OID_FRAME3D1=32102]="OID_FRAME3D1",n[n.OID_FRAME3D2=32103]="OID_FRAME3D2",n[n.OID_FRAME3D3=32104]="OID_FRAME3D3",n[n.OID_FRAME3D4=32105]="OID_FRAME3D4",n[n.OID_FRAME3D5=32106]="OID_FRAME3D5",n[n.OID_FRAME3D6=32107]="OID_FRAME3D6",n[n.OID_FRAME3D7=32108]="OID_FRAME3D7",n[n.OID_FRAME3D8=32109]="OID_FRAME3D8",n[n.OID_FRAME3D=32110]="OID_FRAME3D",n[n.MB_OK=0]="MB_OK",n[n.MB_OKCANCEL=1]="MB_OKCANCEL",n[n.MB_ABORTRETRYIGNORE=2]="MB_ABORTRETRYIGNORE",n[n.MB_YESNOCANCEL=3]="MB_YESNOCANCEL",n[n.MB_YESNO=4]="MB_YESNO",n[n.MB_RETRYCANCEL=5]="MB_RETRYCANCEL",n[n.MB_TYPEMASK=15]="MB_TYPEMASK",n[n.MB_ICONHAND=16]="MB_ICONHAND",n[n.MB_ICONQUESTION=32]="MB_ICONQUESTION",n[n.MB_ICONEXCLAMATION=48]="MB_ICONEXCLAMATION",n[n.MB_ICONASTERISK=64]="MB_ICONASTERISK",n[n.MB_ICONMASK=240]="MB_ICONMASK",n[n.MB_ICONINFORMATION=64]="MB_ICONINFORMATION",n[n.MB_ICONSTOP=16]="MB_ICONSTOP",n[n.MB_DEFBUTTON1=0]="MB_DEFBUTTON1",n[n.MB_DEFBUTTON2=256]="MB_DEFBUTTON2",n[n.MB_DEFBUTTON3=512]="MB_DEFBUTTON3",n[n.MB_DEFMASK=3840]="MB_DEFMASK",n[n.MB_APPLMODAL=0]="MB_APPLMODAL",n[n.MB_SYSTEMMODAL=4096]="MB_SYSTEMMODAL",n[n.MB_TASKMODAL=8192]="MB_TASKMODAL",n[n.MB_NOFOCUS=32768]="MB_NOFOCUS",n[n.SW_HIDE=0]="SW_HIDE",n[n.SW_SHOWNORMAL=1]="SW_SHOWNORMAL",n[n.SW_NORMAL=1]="SW_NORMAL",n[n.SW_SHOWMINIMIZED=2]="SW_SHOWMINIMIZED",n[n.SW_SHOWMAXIMIZED=3]="SW_SHOWMAXIMIZED",n[n.SW_MAXIMIZE=3]="SW_MAXIMIZE",n[n.SW_SHOWNOACTIVATE=4]="SW_SHOWNOACTIVATE",n[n.SW_SHOW=5]="SW_SHOW",n[n.SW_MINIMIZE=6]="SW_MINIMIZE",n[n.SW_SHOWMINNOACTIVE=7]="SW_SHOWMINNOACTIVE",n[n.SW_SHOWNA=8]="SW_SHOWNA",n[n.SW_RESTORE=9]="SW_RESTORE",n[n.MCIERR_INVALID_DEVICE_ID=257]="MCIERR_INVALID_DEVICE_ID",n[n.MCIERR_UNRECOGNIZED_KEYWORD=259]="MCIERR_UNRECOGNIZED_KEYWORD",n[n.MCIERR_UNRECOGNIZED_COMMAND=261]="MCIERR_UNRECOGNIZED_COMMAND",n[n.MCIERR_HARDWARE=262]="MCIERR_HARDWARE",n[n.MCIERR_INVALID_DEVICE_NAME=263]="MCIERR_INVALID_DEVICE_NAME",n[n.MCIERR_OUT_OF_MEMORY=264]="MCIERR_OUT_OF_MEMORY",n[n.MCIERR_DEVICE_OPEN=265]="MCIERR_DEVICE_OPEN",n[n.MCIERR_CANNOT_LOAD_DRIVER=266]="MCIERR_CANNOT_LOAD_DRIVER",n[n.MCIERR_MISSING_COMMAND_STRING=267]="MCIERR_MISSING_COMMAND_STRING",n[n.MCIERR_PARAM_OVERFLOW=268]="MCIERR_PARAM_OVERFLOW",n[n.MCIERR_MISSING_STRING_ARGUMENT=269]="MCIERR_MISSING_STRING_ARGUMENT",n[n.MCIERR_BAD_INTEGER=270]="MCIERR_BAD_INTEGER",n[n.MCIERR_PARSER_INTERNAL=271]="MCIERR_PARSER_INTERNAL",n[n.MCIERR_DRIVER_INTERNAL=272]="MCIERR_DRIVER_INTERNAL",n[n.MCIERR_MISSING_PARAMETER=273]="MCIERR_MISSING_PARAMETER",n[n.MCIERR_UNSUPPORTED_FUNCTION=274]="MCIERR_UNSUPPORTED_FUNCTION",n[n.MCIERR_FILE_NOT_FOUND=275]="MCIERR_FILE_NOT_FOUND",n[n.MCIERR_DEVICE_NOT_READY=276]="MCIERR_DEVICE_NOT_READY",n[n.MCIERR_INTERNAL=277]="MCIERR_INTERNAL",n[n.MCIERR_DRIVER=278]="MCIERR_DRIVER",n[n.MCIERR_CANNOT_USE_ALL=279]="MCIERR_CANNOT_USE_ALL",n[n.MCIERR_MULTIPLE=280]="MCIERR_MULTIPLE",n[n.MCIERR_EXTENSION_NOT_FOUND=281]="MCIERR_EXTENSION_NOT_FOUND",n[n.MCIERR_OUTOFRANGE=282]="MCIERR_OUTOFRANGE",n[n.MCIERR_FLAGS_NOT_COMPATIBLE=284]="MCIERR_FLAGS_NOT_COMPATIBLE",n[n.MCIERR_FILE_NOT_SAVED=286]="MCIERR_FILE_NOT_SAVED",n[n.MCIERR_DEVICE_TYPE_REQUIRED=287]="MCIERR_DEVICE_TYPE_REQUIRED",n[n.MCIERR_DEVICE_LOCKED=288]="MCIERR_DEVICE_LOCKED",n[n.MCIERR_DUPLICATE_ALIAS=289]="MCIERR_DUPLICATE_ALIAS",n[n.MCIERR_BAD_CONSTANT=290]="MCIERR_BAD_CONSTANT",n[n.MCIERR_MUST_USE_SHAREABLE=291]="MCIERR_MUST_USE_SHAREABLE",n[n.MCIERR_MISSING_DEVICE_NAME=292]="MCIERR_MISSING_DEVICE_NAME",n[n.MCIERR_BAD_TIME_FORMAT=293]="MCIERR_BAD_TIME_FORMAT",n[n.MCIERR_NO_CLOSING_QUOTE=294]="MCIERR_NO_CLOSING_QUOTE",n[n.MCIERR_DUPLICATE_FLAGS=295]="MCIERR_DUPLICATE_FLAGS",n[n.MCIERR_INVALID_FILE=296]="MCIERR_INVALID_FILE",n[n.MCIERR_NULL_PARAMETER_BLOCK=297]="MCIERR_NULL_PARAMETER_BLOCK",n[n.MCIERR_UNNAMED_RESOURCE=298]="MCIERR_UNNAMED_RESOURCE",n[n.MCIERR_NEW_REQUIRES_ALIAS=299]="MCIERR_NEW_REQUIRES_ALIAS",n[n.MCIERR_NOTIFY_ON_AUTO_OPEN=300]="MCIERR_NOTIFY_ON_AUTO_OPEN",n[n.MCIERR_NO_ELEMENT_ALLOWED=301]="MCIERR_NO_ELEMENT_ALLOWED",n[n.MCIERR_NONAPPLICABLE_FUNCTION=302]="MCIERR_NONAPPLICABLE_FUNCTION",n[n.MCIERR_ILLEGAL_FOR_AUTO_OPEN=303]="MCIERR_ILLEGAL_FOR_AUTO_OPEN",n[n.MCIERR_FILENAME_REQUIRED=304]="MCIERR_FILENAME_REQUIRED",n[n.MCIERR_EXTRA_CHARACTERS=305]="MCIERR_EXTRA_CHARACTERS",n[n.MCIERR_DEVICE_NOT_INSTALLED=306]="MCIERR_DEVICE_NOT_INSTALLED",n[n.MCIERR_GET_CD=307]="MCIERR_GET_CD",n[n.MCIERR_SET_CD=308]="MCIERR_SET_CD",n[n.MCIERR_SET_DRIVE=309]="MCIERR_SET_DRIVE",n[n.MCIERR_DEVICE_LENGTH=310]="MCIERR_DEVICE_LENGTH",n[n.MCIERR_DEVICE_ORD_LENGTH=311]="MCIERR_DEVICE_ORD_LENGTH",n[n.MCIERR_NO_INTEGER=312]="MCIERR_NO_INTEGER",n[n.MCIERR_WAVE_OUTPUTSINUSE=320]="MCIERR_WAVE_OUTPUTSINUSE",n[n.MCIERR_WAVE_SETOUTPUTINUSE=321]="MCIERR_WAVE_SETOUTPUTINUSE",n[n.MCIERR_WAVE_INPUTSINUSE=322]="MCIERR_WAVE_INPUTSINUSE",n[n.MCIERR_WAVE_SETINPUTINUSE=323]="MCIERR_WAVE_SETINPUTINUSE",n[n.MCIERR_WAVE_OUTPUTUNSPECIFIED=324]="MCIERR_WAVE_OUTPUTUNSPECIFIED",n[n.MCIERR_WAVE_INPUTUNSPECIFIED=325]="MCIERR_WAVE_INPUTUNSPECIFIED",n[n.MCIERR_WAVE_OUTPUTSUNSUITABLE=326]="MCIERR_WAVE_OUTPUTSUNSUITABLE",n[n.MCIERR_WAVE_SETOUTPUTUNSUITABLE=327]="MCIERR_WAVE_SETOUTPUTUNSUITABLE",n[n.MCIERR_WAVE_INPUTSUNSUITABLE=328]="MCIERR_WAVE_INPUTSUNSUITABLE",n[n.MCIERR_WAVE_SETINPUTUNSUITABLE=329]="MCIERR_WAVE_SETINPUTUNSUITABLE",n[n.MCIERR_SEQ_DIV_INCOMPATIBLE=336]="MCIERR_SEQ_DIV_INCOMPATIBLE",n[n.MCIERR_SEQ_PORT_INUSE=337]="MCIERR_SEQ_PORT_INUSE",n[n.MCIERR_SEQ_PORT_NONEXISTENT=338]="MCIERR_SEQ_PORT_NONEXISTENT",n[n.MCIERR_SEQ_PORT_MAPNODEVICE=339]="MCIERR_SEQ_PORT_MAPNODEVICE",n[n.MCIERR_SEQ_PORT_MISCERROR=340]="MCIERR_SEQ_PORT_MISCERROR",n[n.MCIERR_SEQ_TIMER=341]="MCIERR_SEQ_TIMER",n[n.MCIERR_SEQ_PORTUNSPECIFIED=342]="MCIERR_SEQ_PORTUNSPECIFIED",n[n.MCIERR_SEQ_NOMIDIPRESENT=343]="MCIERR_SEQ_NOMIDIPRESENT",n[n.MCIERR_NO_WINDOW=346]="MCIERR_NO_WINDOW",n[n.MCIERR_CREATEWINDOW=347]="MCIERR_CREATEWINDOW",n[n.MCIERR_FILE_READ=348]="MCIERR_FILE_READ",n[n.MCIERR_FILE_WRITE=349]="MCIERR_FILE_WRITE",n[n.WS_VISIBLE=268435456]="WS_VISIBLE",n[n.WS_DISABLED=134217728]="WS_DISABLED",n[n.WS_CAPTION=12582912]="WS_CAPTION",n[n.WS_BORDER=8388608]="WS_BORDER",n[n.WS_DLGFRAME=4194304]="WS_DLGFRAME",n[n.WS_VSCROLL=2097152]="WS_VSCROLL",n[n.WS_HSCROLL=1048576]="WS_HSCROLL",n[n.WS_SYSMENU=524288]="WS_SYSMENU",n[n.WS_THICKFRAME=262144]="WS_THICKFRAME",n[n.WS_MINIMIZEBOX=131072]="WS_MINIMIZEBOX",n[n.WS_MAXIMIZEBOX=65536]="WS_MAXIMIZEBOX",n[n.WS_GROUP=131072]="WS_GROUP",n[n.WS_TABSTOP=65536]="WS_TABSTOP",n[n.WS_OVERLAPPED=0]="WS_OVERLAPPED",n[n.WS_POPUP=2147483648]="WS_POPUP",n[n.WS_CHILD=1073741824]="WS_CHILD",n[n.IDX_PRIMARY=1]="IDX_PRIMARY",n[n.IDX_UNIQUE=2]="IDX_UNIQUE",n[n.IDX_DESCENDING=4]="IDX_DESCENDING",n[n.IDX_MAINTAINED=8]="IDX_MAINTAINED",n[n.IDX_SUBSET=16]="IDX_SUBSET",n[n.IDX_EXPR=32]="IDX_EXPR",n[n.IDX_IDXOOD=64]="IDX_IDXOOD",n[n.IDX_CASEINSENS=128]="IDX_CASEINSENS",n[n.FLDDBCHAR=513]="FLDDBCHAR",n[n.FLDDBNUM=514]="FLDDBNUM",n[n.FLDDBMEMO=515]="FLDDBMEMO",n[n.FLDDBBOOL=516]="FLDDBBOOL",n[n.FLDDBDATE=517]="FLDDBDATE",n[n.FLDDBFLOAT=518]="FLDDBFLOAT",n[n.FLDDBLOCK=519]="FLDDBLOCK",n[n.FLDDBOLEBLOB=520]="FLDDBOLEBLOB",n[n.FLDDBBINARY=521]="FLDDBBINARY",n[n.FLDDBBYTES=522]="FLDDBBYTES",n[n.BS_PUSHBUTTON=0]="BS_PUSHBUTTON",n[n.BS_DEFPUSHBUTTON=1]="BS_DEFPUSHBUTTON",n[n.BS_CHECKBOX=2]="BS_CHECKBOX",n[n.BS_AUTOCHECKBOX=3]="BS_AUTOCHECKBOX",n[n.BS_RADIOBUTTON=4]="BS_RADIOBUTTON",n[n.BS_3STATE=5]="BS_3STATE",n[n.BS_AUTO3STATE=6]="BS_AUTO3STATE",n[n.BS_GROUPBOX=7]="BS_GROUPBOX",n[n.BS_USERBUTTON=8]="BS_USERBUTTON",n[n.BS_AUTORADIOBUTTON=9]="BS_AUTORADIOBUTTON",n[n.BS_OWNERDRAW=11]="BS_OWNERDRAW",n[n.BS_LEFTTEXT=32]="BS_LEFTTEXT",n[n.ES_LEFT=0]="ES_LEFT",n[n.ES_CENTER=1]="ES_CENTER",n[n.ES_RIGHT=2]="ES_RIGHT",n[n.ES_MULTILINE=4]="ES_MULTILINE",n[n.ES_UPPERCASE=8]="ES_UPPERCASE",n[n.ES_LOWERCASE=16]="ES_LOWERCASE",n[n.ES_PASSWORD=32]="ES_PASSWORD",n[n.ES_AUTOVSCROLL=64]="ES_AUTOVSCROLL",n[n.ES_AUTOHSCROLL=128]="ES_AUTOHSCROLL",n[n.ES_NOHIDESEL=256]="ES_NOHIDESEL",n[n.SBS_HORZ=0]="SBS_HORZ",n[n.SBS_VERT=1]="SBS_VERT",n[n.SBS_TOPALIGN=2]="SBS_TOPALIGN",n[n.SBS_LEFTALIGN=2]="SBS_LEFTALIGN",n[n.SBS_BOTTOMALIGN=4]="SBS_BOTTOMALIGN",n[n.SBS_RIGHTALIGN=4]="SBS_RIGHTALIGN",n[n.SBS_SIZEBOXTOPLEFTALIGN=2]="SBS_SIZEBOXTOPLEFTALIGN",n[n.SBS_SIZEBOXBOTTOMRIGHTALIGN=4]="SBS_SIZEBOXBOTTOMRIGHTALIGN",n[n.SBS_SIZEBOX=8]="SBS_SIZEBOX",n[n.LBS_NOTIFY=1]="LBS_NOTIFY",n[n.LBS_SORT=2]="LBS_SORT",n[n.LBS_NOREDRAW=4]="LBS_NOREDRAW",n[n.LBS_MULTIPLESEL=8]="LBS_MULTIPLESEL",n[n.LBS_OWNERDRAWFIXED=16]="LBS_OWNERDRAWFIXED",n[n.LBS_OWNERDRAWVARIABLE=32]="LBS_OWNERDRAWVARIABLE",n[n.LBS_HASSTRINGS=64]="LBS_HASSTRINGS",n[n.LBS_USETABSTOPS=128]="LBS_USETABSTOPS",n[n.LBS_NOINTEGRALHEIGHT=256]="LBS_NOINTEGRALHEIGHT",n[n.LBS_MULTICOLUMN=512]="LBS_MULTICOLUMN",n[n.LBS_WANTKEYBOARDINPUT=1024]="LBS_WANTKEYBOARDINPUT",n[n.LBS_EXTENDEDSEL=2048]="LBS_EXTENDEDSEL",n[n.CBS_SIMPLE=1]="CBS_SIMPLE",n[n.CBS_DROPDOWN=2]="CBS_DROPDOWN",n[n.CBS_DROPDOWNLIST=3]="CBS_DROPDOWNLIST",n[n.CBS_OWNERDRAWFIXED=16]="CBS_OWNERDRAWFIXED",n[n.CBS_OWNERDRAWVARIABLE=32]="CBS_OWNERDRAWVARIABLE",n[n.CBS_AUTOHSCROLL=64]="CBS_AUTOHSCROLL",n[n.CBS_OEMCONVERT=128]="CBS_OEMCONVERT",n[n.CBS_SORT=256]="CBS_SORT",n[n.CBS_HASSTRINGS=512]="CBS_HASSTRINGS",n[n.CBS_NOINTEGRALHEIGHT=1024]="CBS_NOINTEGRALHEIGHT",n[n.BS_SOLID=0]="BS_SOLID",n[n.BS_NULL=1]="BS_NULL",n[n.BS_HATCHED=2]="BS_HATCHED",n[n.BS_PATTERN=3]="BS_PATTERN",n[n.BS_GRADIENT_LINEAR=10]="BS_GRADIENT_LINEAR",n[n.HS_HORIZONTAL=0]="HS_HORIZONTAL",n[n.HS_VERTICAL=1]="HS_VERTICAL",n[n.HS_FDIAGONAL=2]="HS_FDIAGONAL",n[n.HS_BDIAGONAL=3]="HS_BDIAGONAL",n[n.HS_CROSS=4]="HS_CROSS",n[n.HS_DIAGCROSS=5]="HS_DIAGCROSS",n[n.PS_SOLID=0]="PS_SOLID",n[n.PS_DASH=1]="PS_DASH",n[n.PS_DOT=2]="PS_DOT",n[n.PS_DASHDOT=3]="PS_DASHDOT",n[n.PS_DASHDOTDOT=4]="PS_DASHDOTDOT",n[n.PS_NULL=5]="PS_NULL",n[n.PS_INSIDEFRAME=6]="PS_INSIDEFRAME",n[n.R2_BLACK=1]="R2_BLACK",n[n.R2_NOTMERGEPEN=2]="R2_NOTMERGEPEN",n[n.R2_MASKNOTPEN=3]="R2_MASKNOTPEN",n[n.R2_NOTCOPYPEN=4]="R2_NOTCOPYPEN",n[n.R2_MASKPENNOT=5]="R2_MASKPENNOT",n[n.R2_NOT=6]="R2_NOT",n[n.R2_XORPEN=7]="R2_XORPEN",n[n.R2_NOTMASKPEN=8]="R2_NOTMASKPEN",n[n.R2_MASKPEN=9]="R2_MASKPEN",n[n.R2_NOTXORPEN=10]="R2_NOTXORPEN",n[n.R2_NOP=11]="R2_NOP",n[n.R2_MERGENOTPEN=12]="R2_MERGENOTPEN",n[n.R2_COPYPEN=13]="R2_COPYPEN",n[n.R2_MERGEPENNOT=14]="R2_MERGEPENNOT",n[n.R2_MERGEPEN=15]="R2_MERGEPEN",n[n.R2_WHITE=16]="R2_WHITE",n[n.FILE_ATTRIBUTE_ARCHIVE=32]="FILE_ATTRIBUTE_ARCHIVE",n[n.FILE_ATTRIBUTE_COMPRESSED=2048]="FILE_ATTRIBUTE_COMPRESSED",n[n.FILE_ATTRIBUTE_DIRECTORY=16]="FILE_ATTRIBUTE_DIRECTORY",n[n.FILE_ATTRIBUTE_HIDDEN=2]="FILE_ATTRIBUTE_HIDDEN",n[n.FILE_ATTRIBUTE_NORMAL=128]="FILE_ATTRIBUTE_NORMAL",n[n.FILE_ATTRIBUTE_OFFLINE=4096]="FILE_ATTRIBUTE_OFFLINE",n[n.FILE_ATTRIBUTE_READONLY=1]="FILE_ATTRIBUTE_READONLY",n[n.FILE_ATTRIBUTE_SYSTEM=4]="FILE_ATTRIBUTE_SYSTEM",n[n.FILE_ATTRIBUTE_TEMPORARY=256]="FILE_ATTRIBUTE_TEMPORARY",n[n.VF_LOCAL=2]="VF_LOCAL",n[n.VF_EQVAR=256]="VF_EQVAR",n[n.VF_ARGUMENT=512]="VF_ARGUMENT",n[n.VF_RETURN=1024]="VF_RETURN",n[n.CUR_ARROW=0]="CUR_ARROW",n[n.CUR_CROSS=1]="CUR_CROSS",n[n.CUR_TEXT=2]="CUR_TEXT",n[n.CUR_NO=3]="CUR_NO",n[n.CUR_SIZE=4]="CUR_SIZE",n[n.CUR_SIZENESW=5]="CUR_SIZENESW",n[n.CUR_SIZENS=6]="CUR_SIZENS",n[n.CUR_SIZENWSE=7]="CUR_SIZENWSE",n[n.CUR_SIZEWE=8]="CUR_SIZEWE",n[n.CUR_UPARROW=9]="CUR_UPARROW",n[n.CUR_WAIT=10]="CUR_WAIT",n[n.CUR_LINK=11]="CUR_LINK",n[n.CUR_HELP=12]="CUR_HELP",n[n.SHADOWTYPE_STENCIL_MODULATIVE=18]="SHADOWTYPE_STENCIL_MODULATIVE",n[n.SHADOWTYPE_STENCIL_ADDITIVE=17]="SHADOWTYPE_STENCIL_ADDITIVE",n[n.SHADOWTYPE_TEXTURE_MODULATIVE=34]="SHADOWTYPE_TEXTURE_MODULATIVE",n[n.SHADOWTYPE_TEXTURE_ADDITIVE=33]="SHADOWTYPE_TEXTURE_ADDITIVE",n[n.FOG_NONE=0]="FOG_NONE",n[n.FOG_EXP=1]="FOG_EXP",n[n.FOG_EXP2=2]="FOG_EXP2",n[n.FOG_LINEAR=3]="FOG_LINEAR",n[n.TEX_TYPE_1D=1]="TEX_TYPE_1D",n[n.TEX_TYPE_2D=2]="TEX_TYPE_2D",n[n.TEX_TYPE_3D=3]="TEX_TYPE_3D",n[n.TEX_TYPE_CUBE_MAP=4]="TEX_TYPE_CUBE_MAP",n[n.SBF_ONE=0]="SBF_ONE",n[n.SBF_ZERO=1]="SBF_ZERO",n[n.SBF_DEST_COLOUR=2]="SBF_DEST_COLOUR",n[n.SBF_SOURCE_COLOUR=3]="SBF_SOURCE_COLOUR",n[n.SBF_ONE_MINUS_DEST_COLOUR=4]="SBF_ONE_MINUS_DEST_COLOUR",n[n.SBF_ONE_MINUS_SOURCE_COLOUR=5]="SBF_ONE_MINUS_SOURCE_COLOUR",n[n.SBF_DEST_ALPHA=6]="SBF_DEST_ALPHA",n[n.SBF_SOURCE_ALPHA=7]="SBF_SOURCE_ALPHA",n[n.SBF_ONE_MINUS_DEST_ALPHA=8]="SBF_ONE_MINUS_DEST_ALPHA",n[n.SBF_ONE_MINUS_SOURCE_ALPHA=9]="SBF_ONE_MINUS_SOURCE_ALPHA",n[n.CMPF_ALWAYS_FAIL=0]="CMPF_ALWAYS_FAIL",n[n.CMPF_ALWAYS_PASS=1]="CMPF_ALWAYS_PASS",n[n.CMPF_LESS=2]="CMPF_LESS",n[n.CMPF_LESS_EQUAL=3]="CMPF_LESS_EQUAL",n[n.CMPF_EQUAL=4]="CMPF_EQUAL",n[n.CMPF_NOT_EQUAL=5]="CMPF_NOT_EQUAL",n[n.CMPF_GREATER_EQUAL=6]="CMPF_GREATER_EQUAL",n[n.CMPF_GREATER=7]="CMPF_GREATER",n[n.CULL_NONE=1]="CULL_NONE",n[n.CULL_CLOCKWISE=2]="CULL_CLOCKWISE",n[n.CULL_ANTICLOCKWISE=3]="CULL_ANTICLOCKWISE",n[n.SO_FLAT=0]="SO_FLAT",n[n.SO_GOURAUD=1]="SO_GOURAUD",n[n.SO_PHONG=2]="SO_PHONG",n[n.PM_POINTS=1]="PM_POINTS",n[n.PM_WIREFRAME=2]="PM_WIREFRAME",n[n.PM_SOLID=3]="PM_SOLID",n[n.LT_POINT=0]="LT_POINT",n[n.LT_DIRECTIONAL=1]="LT_DIRECTIONAL",n[n.LT_SPOTLIGHT=2]="LT_SPOTLIGHT",n[n.PT_ORTHOGRAPHIC=0]="PT_ORTHOGRAPHIC",n[n.PT_PERSPECTIVE=1]="PT_PERSPECTIVE",n[n.OT_POINT_LIST=1]="OT_POINT_LIST",n[n.OT_LINE_LIST=2]="OT_LINE_LIST",n[n.OT_LINE_STRIP=3]="OT_LINE_STRIP",n[n.OT_TRIANGLE_LIST=4]="OT_TRIANGLE_LIST",n[n.OT_TRIANGLE_STRIP=5]="OT_TRIANGLE_STRIP",n[n.OT_TRIANGLE_FAN=6]="OT_TRIANGLE_FAN",n[n.BBT_POINT=0]="BBT_POINT",n[n.BBT_ORIENTED_COMMON=1]="BBT_ORIENTED_COMMON",n[n.BBT_ORIENTED_SELF=2]="BBT_ORIENTED_SELF",n[n.BBT_PERPENDICULAR_COMMON=3]="BBT_PERPENDICULAR_COMMON",n[n.BBT_PERPENDICULAR_SELF=4]="BBT_PERPENDICULAR_SELF",n[n.GMM_RELATIVE=0]="GMM_RELATIVE",n[n.GMM_PIXELS=1]="GMM_PIXELS",n[n.GMM_RELATIVE_ASPECT_ADJUSTED=2]="GMM_RELATIVE_ASPECT_ADJUSTED",n[n.GHA_LEFT=0]="GHA_LEFT",n[n.GHA_CENTER=1]="GHA_CENTER",n[n.GHA_RIGHT=2]="GHA_RIGHT",n[n.GVA_TOP=0]="GVA_TOP",n[n.GVA_CENTER=1]="GVA_CENTER",n[n.GVA_BOTTOM=2]="GVA_BOTTOM",n[n.MTHA_LEFT=0]="MTHA_LEFT",n[n.MTHA_CENTER=1]="MTHA_CENTER",n[n.MTVA_BELOW=0]="MTVA_BELOW",n[n.MTVA_ABOVE=1]="MTVA_ABOVE",n[n.MTVA_CENTER=2]="MTVA_CENTER",n[n.PT_BOOL=0]="PT_BOOL",n[n.PT_REAL=1]="PT_REAL",n[n.PT_INT=2]="PT_INT",n[n.PT_UNSIGNED_INT=3]="PT_UNSIGNED_INT",n[n.PT_SHORT=4]="PT_SHORT",n[n.PT_UNSIGNED_SHORT=5]="PT_UNSIGNED_SHORT",n[n.PT_LONG=6]="PT_LONG",n[n.PT_UNSIGNED_LONG=7]="PT_UNSIGNED_LONG",n[n.PT_STRING=8]="PT_STRING",n[n.PT_VECTOR3=9]="PT_VECTOR3",n[n.PT_MATRIX3=10]="PT_MATRIX3",n[n.PT_MATRIX4=11]="PT_MATRIX4",n[n.PT_QUATERNION=12]="PT_QUATERNION",n[n.PT_COLOURVALUE=13]="PT_COLOURVALUE",n[n.NUI_SP_HIP_CENTER=0]="NUI_SP_HIP_CENTER",n[n.NUI_SP_SPINE=1]="NUI_SP_SPINE",n[n.NUI_SP_SHOULDER_CENTER=2]="NUI_SP_SHOULDER_CENTER",n[n.NUI_SP_HEAD=3]="NUI_SP_HEAD",n[n.NUI_SP_SHOULDER_LEFT=4]="NUI_SP_SHOULDER_LEFT",n[n.NUI_SP_ELBOW_LEFT=5]="NUI_SP_ELBOW_LEFT",n[n.NUI_SP_WRIST_LEFT=6]="NUI_SP_WRIST_LEFT",n[n.NUI_SP_HAND_LEFT=7]="NUI_SP_HAND_LEFT",n[n.NUI_SP_SHOULDER_RIGHT=8]="NUI_SP_SHOULDER_RIGHT",n[n.NUI_SP_ELBOW_RIGHT=9]="NUI_SP_ELBOW_RIGHT",n[n.NUI_SP_WRIST_RIGHT=10]="NUI_SP_WRIST_RIGHT",n[n.NUI_SP_HAND_RIGHT=11]="NUI_SP_HAND_RIGHT",n[n.NUI_SP_HIP_LEFT=12]="NUI_SP_HIP_LEFT",n[n.NUI_SP_KNEE_LEFT=13]="NUI_SP_KNEE_LEFT",n[n.NUI_SP_ANKLE_LEFT=14]="NUI_SP_ANKLE_LEFT",n[n.NUI_SP_FOOT_LEFT=15]="NUI_SP_FOOT_LEFT",n[n.NUI_SP_HIP_RIGHT=16]="NUI_SP_HIP_RIGHT",n[n.NUI_SP_KNEE_RIGHT=17]="NUI_SP_KNEE_RIGHT",n[n.NUI_SP_ANKLE_RIGHT=18]="NUI_SP_ANKLE_RIGHT",n[n.NUI_SP_FOOT_RIGHT=19]="NUI_SP_FOOT_RIGHT",n[n.NUI_SP_COUNT=20]="NUI_SP_COUNT",n[n.WM_DESTROY=2]="WM_DESTROY",n[n.WM_MOVE=3]="WM_MOVE",n[n.WM_SIZE=5]="WM_SIZE",n[n.WM_CLOSE=16]="WM_CLOSE",n[n.WM_GETMINMAXINFO=36]="WM_GETMINMAXINFO",n[n.WM_COMMAND=273]="WM_COMMAND",n[n.WM_MOUSEMOVE=512]="WM_MOUSEMOVE",n[n.WM_LBUTTONDOWN=513]="WM_LBUTTONDOWN",n[n.WM_LBUTTONUP=514]="WM_LBUTTONUP",n[n.WM_LBUTTONDBLCLK=515]="WM_LBUTTONDBLCLK",n[n.WM_RBUTTONDOWN=516]="WM_RBUTTONDOWN",n[n.WM_RBUTTONUP=517]="WM_RBUTTONUP",n[n.WM_RBUTTONDBLCLK=518]="WM_RBUTTONDBLCLK",n[n.WM_MBUTTONDOWN=519]="WM_MBUTTONDOWN",n[n.WM_MBUTTONUP=520]="WM_MBUTTONUP",n[n.WM_MBUTTONDBLCLK=521]="WM_MBUTTONDBLCLK",n[n.WM_ALLMOUSEMESSAGE=1536]="WM_ALLMOUSEMESSAGE",n[n.WM_ALLKEYMESSAGE=1537]="WM_ALLKEYMESSAGE",n[n.WM_KEYDOWN=256]="WM_KEYDOWN",n[n.WM_KEYUP=257]="WM_KEYUP",n[n.WM_CANCLOSE=1538]="WM_CANCLOSE",n[n.WM_SPACEDONE=1539]="WM_SPACEDONE",n[n.WM_SPACEINIT=1540]="WM_SPACEINIT",n[n.WM_CONTROLNOTIFY=1544]="WM_CONTROLNOTIFY",n[n.WM_HYPERJUMP=1546]="WM_HYPERJUMP",n))(Se||{});function Cs(c,r,e,t="random"){let{children:s}=c,i=s.length?s[0]:null,o=Ht(c.scene,r,t).set({x:c.x,y:c.y,attrib:c.attrib});if(i){let a=c.attrib|1;e?(i.set({attrib:a}),o.set({width:i.width,height:i.height})):i.set({attrib:a,width:1,height:1})}return c.set({children:s.concat(o)}),o}function al(c){return(c.startsWith("#")?parseInt(c.slice(1)):parseInt(c))||0}function qt(c,r){switch(c){case 1:return parseFloat(r)||0;case 3:return al(r);case 2:return r;case 4:return Ps(r)}}function Ks(c,r){switch(c){case 1:case 2:return r.toString();case 3:return"#"+r;case 4:return Rs(r)}}var Xe=class{constructor(r){this.fields=r!=null?r:[]}insert(r){if(r==="FLOAT")return this.fields.push({type:r,value:0}),1;if(r==="HANDLE")return this.fields.push({type:r,value:0}),1;if(r==="STRING")return this.fields.push({type:r,value:""}),1;throw Error(`\u041D\u0435\u0438\u0437\u0432\u0435\u0441\u0442\u043D\u044B\u0439 \u0442\u0438\u043F \u044D\u043B\u0435\u043C\u0435\u043D\u0442\u0430: ${r}`)}insertClass(r,e){let t=e.map(s=>{let i=s[0].toUpperCase();switch(s[1]){case 1:return[i,{type:"FLOAT",value:0}];case 2:return[i,{type:"STRING",value:""}];default:return[i,{type:"HANDLE",value:0}]}});return this.fields.push({type:"STRUCT",realType:r,value:new Map(t)}),1}set(r,e,t){if(r<0||r>this.fields.length-1)return;let s=this.fields[r];if(s.type==="STRUCT"){let i=s.value.get(e.toUpperCase());if(!i)return;s=i}if(typeof t=="string"){if(s.type!=="STRING")return;s.value=t}else{if(s.type==="STRING")return;s.value=t}}remove(r){return this.fields.splice(r,1).length?1:0}count(){return this.fields.length}type(r){if(r<0||r>this.fields.length-1)return"";let e=this.fields[r];return e.type==="STRUCT"?e.realType:e.type}getFloat(r,e){if(r<0||r>this.fields.length-1)return 0;let t=this.fields[r];if(t.type==="STRUCT"){let s=t.value.get(e.toUpperCase());if(!s)return 0;t=s}return t.type==="FLOAT"?t.value:0}getHandle(r,e){if(r<0||r>this.fields.length-1)return 0;let t=this.fields[r];if(t.type==="STRUCT"){let s=t.value.get(e.toUpperCase());if(!s)return 0;t=s}return t.type==="HANDLE"?t.value:0}getString(r,e){if(r<0||r>this.fields.length-1)return"";let t=this.fields[r];if(t.type==="STRUCT"){let s=t.value.get(e.toUpperCase());if(!s)return"";t=s}return t.type==="STRING"?t.value:""}sort(r){if(!(r!=null&&r.length))return this.fields.sort((e,t)=>e.value-t.value),1;if(r.length===1)return r[0].desc?this.fields.sort((e,t)=>t.value-e.value):this.fields.sort((e,t)=>e.value-t.value),1;throw console.log(r),Error("VSort: \u0441\u043E\u0440\u0442\u0438\u0440\u043E\u0432\u043A\u0430 \u043F\u043E \u043D\u0435\u0441\u043A\u043E\u043B\u044C\u043A\u0438\u043C \u043F\u043E\u043B\u044F\u043C \u043D\u0435 \u0440\u0435\u0430\u043B\u0438\u0437\u043E\u0432\u0430\u043D\u0430")}};function ot(c,r,e){r.forEach(({key:t,klass:s})=>{var a,h,u,g;let i=(a=e.get(s))==null?void 0:a.image;if(!i||i.prior==="icon"||!((g=(u=(h=i.scene)==null?void 0:h.data)==null?void 0:u.objects)!=null&&g.length))return;let o=c.objects.get(t);(o==null?void 0:o.type)==="group"&&Cs(o,i.scene.data,i.resizable)})}function qs(c){var s,i;let r=c.vars.list,e=r.filter(o=>o.attrib&512).map(o=>o.type),t=(i=(s=r.find(o=>o.attrib&1024))==null?void 0:s.type)!=null?i:null;return{type:"user",name:c.name,argTypes:e,retType:t}}var Ye=new Uint8Array(256);function Xs(c){return c>=0&&c<256?Ye[c]:0}var ge=class{constructor(r){this.minV=Math.floor(r.minV),this.minH=Math.floor(r.minH),this.rows=r.rows,this.cols=r.cols,this.m=r.data?new Float64Array(r.data):new Float64Array(this.rows*this.cols)}isSquare(){return this.cols===this.rows}get(r,e){let t=Math.floor(r)-this.minV,s=Math.floor(e)-this.minH;return t<0||s<0||t>=this.rows||s>=this.cols?0:this.m[t*this.cols+s]}set(r,e,t){let s=Math.floor(r)-this.minV,i=Math.floor(e)-this.minH;return s<0||i<0||s>=this.rows||i>=this.cols?0:(this.m[s*this.cols+i]=t,t)}sum(){return this.m.reduce((r,e)=>r+e,0)}static glue(r,e,t,s){let i=Math.min(r.minH,e.minH+s),o=Math.min(r.minV,e.minV+t),a=Math.max(r.cols+r.minH,e.cols+e.minH+s),h=Math.max(r.rows+r.minV,e.rows+e.minV+t),u=new ge({cols:a-i,rows:h-o,minH:i,minV:o});for(let g=e.minV;g<e.rows+e.minV;g++)for(let b=e.minH;b<e.cols+e.minH;b++)u.set(g+t,b+s,e.get(g,b));for(let g=r.minV;g<r.rows+r.minV;g++)for(let b=r.minH;b<r.cols+r.minH;b++)u.set(g,b,r.get(g,b));return u}static mul(r,e){if(r.cols!==e.rows)return null;let t=e.cols,s=r.rows,i=new ge({cols:t,rows:s,minH:r.minH,minV:r.minV});for(let o=0;o<r.rows;o++)for(let a=0;a<e.cols;a++){let h=0;for(let u=0;u<r.rows;u++)h+=r.m[o*r.cols+u]*e.m[u*e.cols+a];i.m[o*r.rows+a]=h}return i}det(){if(!this.isSquare())throw Error("Not a square matrix");if(this.rows===1)return this.m[0];if(this.rows===2)return this.m[0]*this.m[3]-this.m[1]*this.m[2];let r=Array.from(this.m),e=this.rows,t=1;for(let s=0;s<e;s++){let i=0,o=0;for(let a=s;a<e;a++){let h=r[a*e+s];h>i&&(i=h,o=a)}if(i===0)return 0;if(o!==s){t=-t;for(let a=s;a<e;a++){let h=r[o*e+a];r[o*e+a]=r[s*e+a],r[s*e+a]=h}}for(let a=s+1;a<e;a++){let h=r[a*e+s]/i;for(let u=s+1;u<e;u++)r[a*e+u]=r[a*e+u]-h*r[s*e+u]}t=t*r[s*e+s]}return t}obr(){if(!this.isSquare()||this.det()===0)return null;let r=this.rows,e=new ge({cols:this.cols,rows:this.rows,minH:0,minV:0,data:Array.from(this.m)}),t=new ge({cols:this.cols,rows:this.rows,minH:0,minV:0});for(let s=0;s<r;s++)for(let i=0;i<r;i++)t.set(s,i,0),s===i&&t.set(s,i,1);for(let s=0;s<r;s++){let i=e.get(s,s);for(let o=0;o<r;o++)e.set(s,o,e.get(s,o)/i),t.set(s,o,t.get(s,o)/i);for(let o=s+1;o<r;o++){i=e.get(o,s);for(let a=0;a<r;a++)e.set(o,a,e.get(o,a)-e.get(s,a)*i),t.set(o,a,t.get(o,a)-t.get(s,a)*i)}}for(let s=r-1;s>0;s--)for(let i=s-1;i>=0;i--){let o=e.get(i,s);for(let a=0;a<r;a++)e.set(i,a,e.get(i,a)-e.get(s,a)*o),t.set(i,a,t.get(i,a)-t.get(s,a)*o)}return t.minH=this.minH,t.minV=this.minV,t}diag(r){this.fill(0);let e=Math.min(this.rows,this.cols);for(let t=0;t<e;t++)this.set(t,t,r);return 1}fill(r){return this.m.fill(r),1}sortByRow(r,e){let t=r-this.minV;if(t<0||t>=this.rows)return 0;let s=Array.from({length:this.cols},(o,a)=>Array.from({length:this.rows},(h,u)=>this.m[u*this.cols+a])),i=e?(o,a)=>a[t]-o[t]:(o,a)=>o[t]-a[t];return s.sort(i),s.forEach((o,a)=>{o.forEach((h,u)=>{this.m[u*this.cols+a]=h})}),1}sortByColumn(r,e){let t=r-this.minH;if(t<0||t>=this.cols)return 0;let s=Array.from({length:this.rows},(o,a)=>{let h=a*this.cols,u=h+this.cols;return Array.from(this.m.subarray(h,u))}),i=e?(o,a)=>a[t]-o[t]:(o,a)=>o[t]-a[t];return s.sort(i),this.m=new Float64Array(He(s)),1}data(){let{minH:r,minV:e,cols:t,rows:s,m:i}=this;return{minV:e,minH:r,cols:t,rows:s,data:[...i]}}};function Ys({map:c,memory:r},e){let{newFloats:t,newInts:s}=r,i=c[e.id];switch(e.type){case 1:return t[i];case 3:case 4:return s[i];default:return null}}function zs({map:c,memory:r},e){return e.type===2?r.newStrings[c[e.id]]:null}function Le({map:c,memory:r},e){let{newFloats:t,newInts:s,newStrings:i}=r,o=c[e.id];switch(e.type){case 1:return t[o];case 3:case 4:return s[o];case 2:return i[o]}}function z({map:c,memory:r},e,t){let{newFloats:s,oldFloats:i,newInts:o,oldInts:a,newStrings:h,oldStrings:u}=r,g=c[e.id];switch(e.type){case 1:if(typeof t!="number")return!1;s[g]=i[g]=t;break;case 3:case 4:if(typeof t!="number")return!1;o[g]=a[g]=t;break;case 2:if(typeof t!="string")return!1;h[g]=u[g]=t;break}return!0}function Js({map:c,memory:r},e,t){let{newFloats:s,newInts:i,newStrings:o}=r,a=c[e.id];switch(e.type){case 1:if(typeof t!="number")return!1;s[a]=t;break;case 3:case 4:if(typeof t!="number")return!1;i[a]=t;break;case 2:if(typeof t!="string")return!1;o[a]=t;break}return!0}var Zs=new Map([["Backspace",8],["Tab",9],["Enter",13],["ShiftLeft",16],["ControlLeft",17],["AltLeft",18],["Pause",19],["CapsLock",20],["Escape",27],["Space",32],["PageUp",33],["PageDown",34],["End",35],["Home",36],["ArrowLeft",37],["ArrowUp",38],["ArrowRight",39],["ArrowDown",40],["PrintScreen",44],["Insert",45],["Delete",46],["Digit0",48],["Digit1",49],["Digit2",50],["Digit3",51],["Digit4",52],["Digit5",53],["Digit6",54],["Digit7",55],["Digit8",56],["Digit9",57],["KeyA",65],["KeyB",66],["KeyC",67],["KeyD",68],["KeyE",69],["KeyF",70],["KeyG",71],["KeyH",72],["KeyI",73],["KeyJ",74],["KeyK",75],["KeyL",76],["KeyM",77],["KeyN",78],["KeyO",79],["KeyP",80],["KeyQ",81],["KeyR",82],["KeyS",83],["KeyT",84],["KeyU",85],["KeyV",86],["KeyW",87],["KeyX",88],["KeyY",89],["KeyZ",90],["Comma",188],["Period",190],["Slash",191]]),Qs=[37,38,39,40,45,46];var Xt=class{constructor(r,e,t){this.parent=r;this.view=e;this.realX=0;this.realY=0;this.x=0;this.y=0;this.width=0;this.height=0;this.clientWidth=0;this.clientHeight=0;this.title="";this.visible=!0;e.setAttribute("class","stratum-subwindow"),e.style.setProperty("position","absolute"),this.set(t),r.scene.view.appendChild(e)}set({x:r=this.x,y:e=this.y,width:t=this.width,height:s=this.height,clientWidth:i=this.clientWidth,clientHeight:o=this.clientHeight,title:a=this.title,visible:h=this.visible}){let{parent:u,view:g}=this,{style:b}=g,w=(r-u.scene.x)*u.scene.scale,D=(e-u.scene.y)*u.scene.scale;return this.realX!==w&&b.setProperty("left",w+"px"),this.realY!==D&&b.setProperty("top",D+"px"),this.width!==t?b.setProperty("width",t+"px"):this.clientWidth!==i&&b.setProperty("width",i+"px"),this.height!==s?b.setProperty("height",s+"px"):this.clientHeight!==o&&b.setProperty("height",o+"px"),this.visible!==h&&b.setProperty("display",h?"block":"none"),this.realX=w,this.realY=D,this.x=r,this.y=e,this.width=t,this.height=s,this.clientWidth=i,this.clientHeight=o,this.title=a,this.visible=h,this}close(){this.view.remove()}};var ze=class{constructor(r,{key:e,matrix:t,name:s,prj:i,scene:o,window:a,parent:h,source:u}){this.k=r;this.currentCursor="default";this.cursorOverHyp=!1;this.all=new Set([this]);this.mouseMoveSubs=new ye;this.leftButtonUpSubs=new ye;this.leftButtonDownSubs=new ye;this.rightButtonUpSubs=new ye;this.rightButtonDownSubs=new ye;this.middleButtonUpSubs=new ye;this.middleButtonDownSubs=new ye;this.keyDownSubs=new Set;this.keyUpSubs=new Set;this.keyCharSubs=new Set;this.controlNotifySubs=new ye;this.windowMoveSubs=new Set;this.spaceDoneSubs=new Set;this.sizeSubs=new Set;this.hiddenBy=null;this.scene=o,this.window=a,this.key=e,this.name=s,this.prj=i,this.matrix=t!=null?t:null,this.invmatrix=t?Bs(t):null,this.parent=h!=null?h:null,this.source=u!=null?u:null,o.onpointerdown=o.onpointerup=o.onpointermove=this.handlePointer.bind(this);let g=this.handleKeyboard.bind(this);o.root.addEventListener("keydown",g),o.root.addEventListener("keyup",g),o.oninputchanged=this.handleInput.bind(this)}handlePointer(r){var k;Ye[1]=+r.buttons.left,Ye[2]=+r.buttons.right,Ye[4]=+r.buttons.middle;let e=r.buttons.left?1:0,t=r.buttons.right?2:0,s=r.buttons.middle?16:0,i=e|t|s,{x:o,y:a}=r,h=this.scene.pick(o,a);for(;h;){let E=h.parent;if(!E)break;h=E}let u,g,b=(k=h==null?void 0:h.data)==null?void 0:k.hyper;switch(r.type){case"pointerdown":{switch(this.k.closePopups(this),r.button){case"left":b&&!b.disabled&&this.hyperClick(b,{x:o,y:a}),u=this.leftButtonDownSubs,g=513;break;case"middle":u=this.middleButtonDownSubs,g=519;break;case"right":u=this.rightButtonDownSubs,g=516;break;default:return}break}case"pointerup":{switch(r.button){case"left":u=this.leftButtonUpSubs,g=514;break;case"middle":u=this.middleButtonUpSubs,g=520;break;case"right":u=this.rightButtonUpSubs,g=517;break;default:return}break}case"pointermove":this.cursorOverHyp=!!b&&!b.disabled,this.updateCursor(),u=this.mouseMoveSubs,g=512;break}let w=o,D=a,v=this.invmatrix;if(v){let E=o*v[2]+a*v[5]+v[8];w=(o*v[0]+a*v[3]+v[6])/E,D=(o*v[1]+a*v[4]+v[7])/E}let{captureTarget:P}=this.k;u.forEach((E,A)=>{if(!((P==null?void 0:P.w.scene)===r.scene&&P.s===A||E.has(h)||E.has(null)))return;let{msg:q,xpos:ce,ypos:Te,fwkeys:ie}=A.klass.vars;z(A.vars,q,g),ce&&z(A.vars,ce,w),Te&&z(A.vars,Te,D),ie&&z(A.vars,ie,i),A.compute(this.k.ctx,!0)})}updateCursor(){this.scene.set({cursor:this.k.cursorVisible?this.cursorOverHyp?"pointer":this.currentCursor:"none"})}handleKeyboard(r){var h;let e=r.type,t=(h=Zs.get(r.code))!=null?h:0;!t&&r.code&&console.warn(`\u041D\u0435\u0438\u0437\u0432\u0435\u0441\u0442\u043D\u0430\u044F \u043A\u043B\u0430\u0432\u0438\u0448\u0430: ${r.code}`),Ye[t]=+(e==="keydown");let s=1,i=0,o,a;switch(e){case"keydown":o=this.keyDownSubs,a=256;break;case"keyup":o=this.keyUpSubs,a=257;break}if(o.forEach(u=>{let{msg:g,wvkey:b,repeat:w,scancode:D}=u.klass.vars;z(u.vars,g,a),b&&z(u.vars,b,t),w&&z(u.vars,w,s),D&&z(u.vars,D,i),u.compute(this.k.ctx,!0)}),e==="keydown"&&!Qs.includes(t)){let u=oe.table.indexOf(r.key),g=u<0?t:u;this.keyCharSubs.forEach(b=>{let{msg:w,wvkey:D,repeat:v,scancode:P}=b.klass.vars;z(b.vars,w,258),D&&z(b.vars,D,g),v&&z(b.vars,v,s),P&&z(b.vars,P,i),b.compute(this.k.ctx,!0)})}}handleInput(r){let e=this.controlNotifySubs,t=1544,s;switch(r.type){case"input":s=768;break;case"focus":s=256;break;case"blur":s=512;break;case"click":s=0;break;default:return}e.forEach((i,o)=>{if(!(i.has(r.target)||i.has(null)))return;let{msg:h,_hobject:u,iditem:g,wnotifycode:b}=o.klass.vars;z(o.vars,h,t),u&&z(o.vars,u,r.target.key),g&&z(o.vars,g,0),b&&z(o.vars,b,s),o.compute(this.k.ctx,!0)})}setCapture(r){var e;(e=this.k.captureTarget)==null||e.w.scene.stopCapturingMouseEvents(),this.k.captureTarget={w:this,s:r},this.scene.startCapturingMouseEvents()}subscribe(r,e,t,s){var a;let i=s&1,o=(a=this.scene.objects.get(t))!=null?a:null;switch(e){case 3:this.windowMoveSubs.add(r);break;case 1539:this.spaceDoneSubs.add(r);break;case 5:this.sizeSubs.add(r);break;case 1544:(o||t===0)&&this.controlNotifySubs.set(r,o);break;case 512:(o||!i)&&this.mouseMoveSubs.set(r,i?o:null);break;case 513:(o||!i)&&this.leftButtonDownSubs.set(r,i?o:null);break;case 514:(o||!i)&&this.leftButtonUpSubs.set(r,i?o:null);break;case 516:(o||!i)&&this.rightButtonDownSubs.set(r,i?o:null);break;case 517:(o||!i)&&this.rightButtonUpSubs.set(r,i?o:null);break;case 519:(o||!i)&&this.middleButtonDownSubs.set(r,i?o:null);break;case 520:(o||!i)&&this.middleButtonUpSubs.set(r,i?o:null);break;case 1536:if(!o&&i)break;let h=i?o:null;this.mouseMoveSubs.set(r,h),this.leftButtonDownSubs.set(r,h),this.leftButtonUpSubs.set(r,h),this.rightButtonDownSubs.set(r,h),this.rightButtonUpSubs.set(r,h),this.middleButtonDownSubs.set(r,h),this.middleButtonUpSubs.set(r,h);break;case 256:this.keyDownSubs.add(r);break;case 257:this.keyUpSubs.add(r);break;case 258:this.keyCharSubs.add(r);break;case 1537:this.keyDownSubs.add(r),this.keyUpSubs.add(r),this.keyCharSubs.add(r);break;default:this.k._functionNotImplemented(`\u041F\u043E\u0434\u043F\u0438\u0441\u043A\u0430 \u043D\u0430 ${Se[e]}`,r);break}}unsubscribe(r,e){switch(e){case 3:this.windowMoveSubs.delete(r);break;case 1539:this.spaceDoneSubs.delete(r);break;case 5:this.sizeSubs.delete(r);break;case 1544:this.controlNotifySubs.delete(r);break;case 512:this.mouseMoveSubs.delete(r);break;case 513:this.leftButtonDownSubs.delete(r);break;case 514:this.leftButtonUpSubs.delete(r);break;case 516:this.rightButtonDownSubs.delete(r);break;case 517:this.rightButtonUpSubs.delete(r);break;case 519:this.middleButtonDownSubs.delete(r);break;case 520:this.middleButtonUpSubs.delete(r);break;case 1536:this.mouseMoveSubs.delete(r),this.leftButtonDownSubs.delete(r),this.leftButtonUpSubs.delete(r),this.rightButtonDownSubs.delete(r),this.rightButtonUpSubs.delete(r),this.middleButtonDownSubs.delete(r),this.middleButtonUpSubs.delete(r);break;case 256:this.keyDownSubs.delete(r);break;case 257:this.keyUpSubs.delete(r);break;case 258:this.keyCharSubs.delete(r);break;case 1537:this.keyDownSubs.delete(r),this.keyUpSubs.delete(r),this.keyCharSubs.delete(r);break}}setCursor(r){this.currentCursor=r,this.updateCursor()}subwindow({data:{data:r,matrix:e,options:t},prj:s,wname:i,coords:o,source:a}){let h=Ft(this.k.swgBackend,r),u=R(N({},o),{title:i}),g=t==null?void 0:t.size;if((g==null?void 0:g.type)==="fixed")u.width=g.width,u.height=g.height;else if(h.objects.size){let v=Ct(h.objects);t!=null&&t.autoorg&&h.set({x:v.x,y:v.y}),u.width=v.w,u.height=v.h}let b=new Xt(this,h.view,u),w=ee.freeKey(this.k.scenes),D=new ze(this.k,{key:w,name:i,prj:s,scene:h,window:b,matrix:e,source:a,parent:this});return this.k.scenes.set(w,D),this.k.windows.set(i,D),this.all.add(D),D}pick(r,e,t){var h;let s=r,i=e,o=this.matrix;if(o){let u=r*o[2]+e*o[5]+o[8];s=(r*o[0]+e*o[3]+o[6])/u,i=(r*o[1]+e*o[4]+o[7])/u}let a=this.scene.pick(s,i);if(t&&(this.k.lastPickedPrimaryKey=(h=a==null?void 0:a.key)!=null?h:0),!a)return null;for(;a.parent;)a=a.parent;return a}paste(r,e,t,s){var g;if(!((g=r.objects)!=null&&g.length))return null;let i=r;if(s&255){let b=N({},r);s&1&&delete b.pens,s&2&&delete b.brushes,s&8&&delete b.images,s&4&&delete b.imagesOpaque,s&16&&delete b.strings,s&32&&delete b.fonts,s&64&&delete b.texts,i=b}let o=Ht(this.scene,i);if(!(s&32768))return o;let a=e,h=t,u=this.matrix;if(u){let b=e*u[2]+t*u[5]+u[8];a=(e*u[0]+t*u[3]+u[6])/b,h=(e*u[1]+t*u[4]+u[7])/b}return o.set({x:a,y:h})}hyperClick(r,e){var s,i,o;let{prj:t}=this;switch(r.mode){case 0:{let a=r.target;if(!a)break;let h=this.k.classes.get(a);if(!h)break;let{scene:u}=h,g=r.window||((s=u==null?void 0:u.options)!=null&&s.popup?"PopupWindow":"MainWindow");if(this.k.windows.has(g))return;let b={x:e.x-this.scene.x+this.window.view.offsetLeft,y:e.y-this.scene.y+this.window.view.offsetTop},w=this.k.window({wname:g,data:u!=null?u:{},prj:t,source:{type:"classname",data:h.name},coords:b});u&&ot(w.scene,h.children,this.k.classes);break}case 1:{let a=r.target;if(!a)break;this.k.handleExe(a);break}case 2:{let a=r.target;if(!a)break;let h=(i=r.params)==null?void 0:i.toUpperCase().includes("/HIDEWINDOWS"),u=t.dir.resolve(a);this.k.projectLoader.open(u).then(g=>{if(!g){console.warn(`${u} \u043D\u0435 \u0441\u0443\u0449\u0435\u0441\u0442\u0432\u0443\u0435\u0442`);return}let b=this.k.project(g);h&&this.k.hideProjectWindows(t,b)}).catch(g=>{if(!(g instanceof Error))throw g;console.warn(`\u041D\u0435 \u0443\u0434\u0430\u043B\u043E\u0441\u044C \u043E\u0442\u043A\u0440\u044B\u0442\u044C ${u}: ${g.message}`)});break}case 3:break;case 4:{let a=(o=r.target)==null?void 0:o.toUpperCase();if(!a)break;a==="CM_CLEARALL"?this.k.set({projects:[]}):a==="CM_PREVPAGE"?this.k.set({projects:this.k.projects.filter(h=>h!==t)}):console.warn(`\u041A\u043E\u043C\u0430\u043D\u0434\u0430 ${a} \u043D\u0435 \u0440\u0435\u0430\u043B\u0438\u0437\u043E\u0432\u0430\u043D\u0430.`);break}default:console.warn("\u041D\u0435\u0438\u0437\u0432\u0435\u0441\u0442\u043D\u044B\u0439 \u0442\u0438\u043F \u0433\u0438\u043F\u0435\u0440\u043F\u0435\u0440\u0435\u0445\u043E\u0434\u0430"),console.log(r)}}remove(){this.k.closeWindows(this.all)}};function xr(c){return new Function("s","m","c",c)}function ei(c){return xr(c)}function ti(c){return c.map(r=>xr(r))}function ri(c){return c.map(r=>xr(r))}var _e=8,ll=(s=>(s[s.FLOAT_REF=1|_e]="FLOAT_REF",s[s.STRING_REF=2|_e]="STRING_REF",s[s.HANDLE_REF=3|_e]="HANDLE_REF",s[s.COLORREF_REF=4|_e]="COLORREF_REF",s))(ll||{});var Yt=class{constructor(){this.blocks=[]}pushBlock(r){return this.blocks.push(r),r}popBlock(r){let e=this.blocks.pop();if((e==null?void 0:e.expect)!==r)throw Error(`\u041E\u0436\u0438\u0434\u0430\u043B\u043E\u0441\u044C ${r}`);return e}lastBlock(){return this.blocks.length>0?this.blocks[this.blocks.length-1]:null}haveABreakHaveAKitKat(){for(let r=this.blocks.length-1;r>=0;--r)if(this.blocks[r].canBreak)return"break;";return"return;"}};var cl=`function arccos(a) {
    if (a > 1) return 0;
    if (a < -1) return Math.PI;
    return Math.acos(a) || 0;
}`,ul=`function arcsin(a) {
    if (a > 1) return Math.PI / 2;
    if (a < -1) return -Math.PI / 2;
    return Math.asin(a) || 0;
}`,hl=`function change(s1, s2, s3) {
    return s1.split(s2).join(s3);
}`,pl=`function compareI(s1, s2, n) {
    return s1.substring(0, n) === s2.substring(0, n) ? 1 : 0;
}`,dl=`function getAngleByXY(x, y) {
    if (y === 0) return x >= 0 ? 0 : Math.PI;
    if (y > 0) return -Math.atan(x / y) + Math.PI / 2;
    return -Math.atan(x / y) + Math.PI * 1.5;
}`,ml=`function lg(a) {
    return a > 0 ? (Math.log(a) || 0) / Math.LN10 : -(10 ** 100);
}`,fl=`function ln(a) {
    return a > 0 ? Math.log(a) || 0 : -(10 ** 100);
}`,gl=`function log(a, b) {
    return a > 0 && b > 0 ? Math.log(b) / Math.log(a) || 0 : -(10 ** 100);
}`,bl=`function pos(s1, s2, n) {
    if (s2 === "") return -1;
    var idx = -1;
    var search = 0;
    for (var i = 0; i < n; ++i) {
        idx = s1.indexOf(s2, search);
        if (idx < 0) return -1;
        search = idx + s2.length;
    }
    return idx;
}`,yl=`function right(a, n) {
    return a.substring(a.length - n);
}`,Sl=`function round(a, b) {
    var pw = Math.ceil(10 ** b);
    return Math.round(a * pw - Number.EPSILON) / pw || 0;
}`,wl=`function substr(src, from, length) {
    return src.substring(from, from + length);
}`,Tl=`function string(value) {
    return (Math.round(value * 100000) / 100000).toString();
}`,{FLOAT:I,STRING:K,HANDLE:zt,COLORREF:Wl}=Y,vr={argTypes:[I],retType:K,type:"header",path:"string",body:Tl},El=[["ABS",{argTypes:[I],retType:I,type:"template",template:"Math.abs(#0) || 0"}],["ALLTRIM",{argTypes:[K],retType:K,type:"template",template:"(#0).trim()"}],["AND",{argTypes:[I,I],retType:I,type:"template",template:"(#0) && (#1) ? 1 : 0"}],["ARCCOS",{argTypes:[I],retType:I,type:"header",path:"arccos",body:cl}],["ARCSIN",{argTypes:[I],retType:I,type:"header",path:"arcsin",body:ul}],["ARCTAN",{argTypes:[I],retType:I,type:"template",template:"Math.atan(#0)||0"}],["AVERAGE",{argTypes:[I,I],retType:I,type:"template",template:"(#0) / 2 + (#1) / 2"}],["CHANGE",{argTypes:[K,K,K],retType:K,type:"header",path:"change",body:hl}],["COMPARE",{argTypes:[K,K],retType:I,type:"template",template:"(#0) == (#1) ? 1 : 0"}],["COMPAREI",{argTypes:[K,K,I],retType:I,type:"header",path:"compareI",body:pl}],["COS",{argTypes:[I],retType:I,type:"template",template:"Math.cos(#0) || 0"}],["DEG",{argTypes:[I],retType:I,type:"template",template:"180 * (#0) / Math.PI || 0"}],["DELTA",{argTypes:[I],retType:I,type:"template",template:"(#0) ? 0 : 1"}],["ED",{argTypes:[I],retType:I,type:"template",template:"(#0) > 0 ? 1 : 0"}],["ED",{argTypes:[zt],retType:I,type:"template",template:"(#0) > 0 ? 1 : 0"}],["EXP",{argTypes:[I],retType:I,type:"template",template:"Math.exp(#0) || 0"}],["FLOAT",{argTypes:[I],retType:I,type:"template",template:"parseFloat(#0) || 0"}],["FLOAT",{argTypes:[K],retType:I,type:"template",template:"parseFloat(#0) || 0"}],["FLOAT",{argTypes:[zt],retType:I,type:"template",template:"parseFloat(#0) || 0"}],["FLOAT",{argTypes:[Wl],retType:I,type:"template",template:"parseFloat(#0) || 0"}],["GETANGLEBYXY",{argTypes:[I,I],retType:I,type:"header",path:"getAngleByXY",body:dl}],["HANDLE",{argTypes:[I],retType:zt,type:"template",template:"parseInt(#0) || 0"}],["LEFT",{argTypes:[K,I],retType:K,type:"template",template:"(#0).substring(0, #1)"}],["LENGTH",{argTypes:[K],retType:I,type:"template",template:"(#0).length"}],["LG",{argTypes:[I],retType:I,type:"header",path:"lg",body:ml}],["LIMIT",{argTypes:[I,I,I],retType:I,type:"template",template:"Math.max(#1, Math.min(#2, #0))||0"}],["LN",{argTypes:[I],retType:I,type:"header",path:"ln",body:fl}],["LOG",{argTypes:[I,I],retType:I,type:"header",path:"log",body:gl}],["LOWER",{argTypes:[K],retType:K,type:"template",template:"(#0).toLowerCase()"}],["LTRIM",{argTypes:[K],retType:K,type:"template",template:'(#0).replace(/^\\s+/, "")'}],["MAX",{argTypes:[I,I],retType:I,type:"template",template:"Math.max(#0, #1) || 0"}],["MIN",{argTypes:[I,I],retType:I,type:"template",template:"Math.min(#0, #1) || 0"}],["NOT",{argTypes:[I],retType:I,type:"template",template:"(#0) ? 0 : 1"}],["NOT",{argTypes:[zt],retType:I,type:"template",template:"(#0) ? 0 : 1"}],["NOTBIN",{argTypes:[I],retType:I,type:"template",template:"#0"}],["OR",{argTypes:[I,I],retType:I,type:"template",template:"(#0) || (#1) ? 1 : 0"}],["POS",{argTypes:[K,K,I],retType:I,type:"header",path:"pos",body:bl}],["RAD",{argTypes:[I],retType:I,type:"template",template:"Math.PI * (#0) / 180 || 0"}],["REPLICATE",{argTypes:[K,I],retType:K,type:"template",template:"(#0).repeat(#1)"}],["RIGHT",{argTypes:[K,I],retType:K,type:"header",path:"right",body:yl}],["RND",{argTypes:[I],retType:I,type:"template",template:"(#0) * Math.random()"}],["ROUND",{argTypes:[I,I],retType:I,type:"header",path:"round",body:Sl}],["RTRIM",{argTypes:[K],retType:K,type:"template",template:'(#0).replace(/\\s+$/, "")'}],["SGN",{argTypes:[I],retType:I,type:"template",template:"Math.sign(#0) || 0"}],["SIN",{argTypes:[I],retType:I,type:"template",template:"Math.sin(#0) || 0"}],["SQR",{argTypes:[I],retType:I,type:"template",template:"(#0) ** 2"}],["SQRT",{argTypes:[I],retType:I,type:"template",template:"Math.sqrt(#0) || 0"}],["STRING",vr],["SUBSTR",{argTypes:[K,I,I],retType:K,type:"header",path:"substr",body:wl}],["SUBSTR",{argTypes:[K,I],retType:K,type:"template",template:"(#0).substring(#1)"}],["TAN",{argTypes:[I],retType:I,type:"template",template:"Math.tan(#0) || 0"}],["TRUNC",{argTypes:[I],retType:I,type:"template",template:"Math.trunc(#0) || 0"}],["UPPER",{argTypes:[K],retType:K,type:"template",template:"(#0).toUpperCase()"}],["XOR",{argTypes:[I,I],retType:I,type:"template",template:"(#0) !== 0 ^ (#1) !== 0"}],["XORBIN",{argTypes:[I,I],retType:I,type:"template",template:"(#0) ^ (#1)"}]],si=(()=>{let c=new Map;return El.forEach(([r,e])=>{let t=c.get(r);t||c.set(r,t=[]),t.push(e)}),c})();var ii="v",Jt="c",Zt="s",Dr="n",_r="o",Pr={[1]:"f",[3]:"i",[4]:"i",[2]:"s"},ni=`
var v = m.map;
var mem = m.memory;
var of = mem.oldFloats;
var nf = mem.newFloats;
var oi = mem.oldInts;
var ni = mem.newInts;
var os = mem.oldStrings;
var ns = mem.newStrings;
`,oi="userFunc",ai="solveEquationsFor";var{FLOAT:L,STRING:se,HANDLE:xe,COLORREF:Qt}=Y,Ir=[{name:"^",arg:[L,L],ret:L,text:"#0 ** #1",prior:13},{name:"*",arg:[L,L],ret:L,text:"#0 * #1",prior:12},{name:"/",arg:[L,L],ret:L,text:"#0 / (#1 || Infinity)",prior:12},{name:"%",arg:[L,L],ret:L,text:"#0 % #1",prior:12},{name:"+",arg:[L,L],ret:L,text:"#0 + #1",prior:11},{name:"+",arg:[se,se],ret:se,text:"#0 + #1",prior:11},{name:"+",arg:[se,L],ret:se,text:"#0 + string(#1)",prior:11},{name:"+",arg:[L,se],ret:se,text:"string(#0) + #1",prior:11},{name:"-",arg:[L,L],ret:L,text:"#0 - #1",prior:11},{name:"<<",arg:[L,L],ret:L,text:"#0 << #1",prior:10},{name:">>",arg:[L,L],ret:L,text:"#0 >> #1",prior:10},{name:">",arg:[L,L],ret:L,text:"+(#0 > #1)",prior:9},{name:">=",arg:[L,L],ret:L,text:"+(#0 >= #1)",prior:9},{name:"<",arg:[L,L],ret:L,text:"+(#0 < #1)",prior:9},{name:"<=",arg:[L,L],ret:L,text:"+(#0 <= #1)",prior:9},{name:">",arg:[se,se],ret:L,text:"+(#0 > #1)",prior:9},{name:">=",arg:[se,se],ret:L,text:"+(#0 >= #1)",prior:9},{name:"<",arg:[se,se],ret:L,text:"+(#0 < #1)",prior:9},{name:"<=",arg:[se,se],ret:L,text:"+(#0 <= #1)",prior:9},{name:"==",arg:[L,L],ret:L,text:"+(#0 == #1)",prior:8},{name:"==",arg:[se,se],ret:L,text:"+(#0 == #1)",prior:8},{name:"==",arg:[xe,xe],ret:L,text:"+(#0 == #1)",prior:8},{name:"==",arg:[Qt,Qt],ret:L,text:"+(#0 == #1)",prior:8},{name:"!=",arg:[L,L],ret:L,text:"+(#0 != #1)",prior:8},{name:"!=",arg:[se,se],ret:L,text:"+(#0 != #1)",prior:8},{name:"!=",arg:[xe,xe],ret:L,text:"+(#0 != #1)",prior:8},{name:"!=",arg:[Qt,Qt],ret:L,text:"+(#0 != #1)",prior:8},{name:"&",arg:[L,L],ret:L,text:"#0 & #1",prior:7},{name:"|",arg:[L,L],ret:L,text:"#0 | #1",prior:5},{name:"&&",arg:[L,L],ret:L,text:"+Boolean(#0 && #1)",prior:4},{name:"&&",arg:[xe,xe],ret:xe,text:"+Boolean(#0 && #1)",prior:4},{name:"||",arg:[L,L],ret:L,text:"+Boolean(#0 || #1)",prior:3},{name:"||",arg:[xe,xe],ret:xe,text:"+Boolean(#0 || #1)",prior:3}],li=Array.from(new ye(Ir.map(c=>[c.prior,c.name]))).sort((c,r)=>r[0]-c[0]).map(c=>Array.from(c[1]));var er=class{constructor(){this.m=new Map}createVar(r,e,t){let s=r.toLowerCase(),i=this.m.get(s);if(i&&i[0].type!==e)throw Error(`\u041F\u0435\u0440\u0435\u043C\u0435\u043D\u043D\u0430\u044F \u0443\u0436\u0435 \u043E\u0431\u044A\u044F\u0432\u043B\u0435\u043D\u0430: ${r}`);let o={name:r,type:e,attrib:t||void 0};this.m.set(s,[o,this.m.size])}makeInEquation(r){let e=r.toLowerCase(),t=this.m.get(e);if(!t)throw Error(`\u041D\u0435\u0438\u0437\u0432\u0435\u0441\u0442\u043D\u0430\u044F \u043F\u0435\u0440\u0435\u043C\u0435\u043D\u043D\u0430\u044F: ${r}`);if(t[0].type!==1)throw Error(`\u041F\u0435\u0440\u0435\u043C\u0435\u043D\u043D\u0430\u044F \u0443\u0440\u0430\u0432\u043D\u0435\u043D\u0438\u044F ${r} \u043D\u0435 \u0438\u043C\u0435\u0435\u0442 \u0442\u0438\u043F FLOAT`);t[0].inEquation=!0}setAsReturn(r){var s;let e=r.toLowerCase(),t=this.m.get(e);if(!t)throw Error(`\u041D\u0435\u0438\u0437\u0432\u0435\u0441\u0442\u043D\u0430\u044F \u043F\u0435\u0440\u0435\u043C\u0435\u043D\u043D\u0430\u044F: ${r}`);t[0].attrib=((s=t[0].attrib)!=null?s:0)|1024}getFloatVar(r){let e=r.toLowerCase(),t=this.m.get(e);if(!t)throw Error(`\u041D\u0435\u0438\u0437\u0432\u0435\u0441\u0442\u043D\u0430\u044F \u043F\u0435\u0440\u0435\u043C\u0435\u043D\u043D\u0430\u044F: ${r}`);if(t[0].type!==1)throw Error(`\u041F\u0435\u0440\u0435\u043C\u0435\u043D\u043D\u0430\u044F \u0443\u0440\u0430\u0432\u043D\u0435\u043D\u0438\u044F ${r} \u043D\u0435 \u0438\u043C\u0435\u0435\u0442 \u0442\u0438\u043F FLOAT`);return`$${e}`}_getOrCreateVar(r,e){let t=r.toLowerCase(),s=this.m.get(t);if(s)return[t,s[0]];let i={name:r,type:e};return this.m.set(t,[i,this.m.size]),[t,i]}getOrCreateVar(r,e,t=1){let[s,{type:i}]=this._getOrCreateVar(e,t),o=`${r?Dr:_r}${Pr[i]}`,a=`$${s}`;return{text:`${o}[${a}]`,type:i}}derefer(r,e=1){let t=r.first;if(t.type!=="var"||r.rest.length>0)throw Error("\u0414\u043E\u043B\u0436\u043D\u043E \u0431\u044B\u0442\u044C \u0438\u043C\u044F \u043F\u0435\u0440\u0435\u043C\u0435\u043D\u043D\u043E\u0439");let[s,{type:i}]=this._getOrCreateVar(t.name,e),o=`${t.isNew?Dr:_r}${Pr[i]}`,a=`$${s}`;return[o,a]}result(){return[...this.m.values()].sort((r,e)=>r[1]-e[1]).map(r=>r[0])}};function pi(c,r){var h;let e=r.args.map(u=>ve(c,u)),t=r.name.toUpperCase(),s=si.get(t);if(s){let u=s.find(({argTypes:w})=>w.length===e.length&&w.every((D,v)=>D===e[v].type));if(!u)throw Error(`\u041D\u0435\u043A\u043E\u0440\u0440\u0435\u043A\u0442\u043D\u0430\u044F \u0441\u0438\u0433\u043D\u0430\u0442\u0443\u0440\u0430 \u0444\u0443\u043D\u043A\u0446\u0438\u0438 ${r.name}(${e.map(w=>Y[w.type])}).
\u0412\u043E\u0437\u043C\u043E\u0436\u043D\u044B\u0435 \u0432\u0430\u0440\u0438\u0430\u043D\u0442\u044B:
`+s.map(w=>`${r.name}(${w.argTypes.map(D=>Y[D])})`).join(`
`));let g=e.map(w=>w.text),b;return u.type==="header"?(c.headerFuncs.add(u),b=`${u.path}(${g})`):b=u.template.replace(/#(\d)/g,(w,D)=>g[D]),{text:b,type:u.retType}}if(t==="EXIT"){if(e.length>0)throw Error(`${r.name}: \u043E\u0436\u0438\u0434\u0430\u043B\u043E\u0441\u044C 0 \u0430\u0440\u0433\u0443\u043C\u0435\u043D\u0442\u043E\u0432, \u043F\u043E\u043B\u0443\u0447\u0435\u043D\u043E ${e.length}`);return{text:"return",type:null}}let i=(h=c.funcTable)==null?void 0:h.get(t);if(!i)throw Error(`\u0424\u0443\u043D\u043A\u0446\u0438\u044F \u043D\u0435 \u0441\u0443\u0449\u0435\u0441\u0442\u0432\u0443\u0435\u0442: "${r.name}"`);if(i.type==="method"){let u=i.overloads.find(({argTypes:w})=>{let D=-1;return w.every((P,k)=>{if(typeof P=="number"){if(k>=e.length)return!1;D=k;let A=P&_e-1;return e[k].type===A}D=e.length-1;let E=e.slice(k);return E.length%P.length===0&&E.every((A,U)=>A.type===P[U%P.length])})&&D===e.length-1});if(!u){let w=`${r.name}(${e.map(v=>Y[v.type])})`,D=i.overloads.map(v=>{let P=v.argTypes.map(k=>typeof k=="number"?(k&_e?"&":"")+Y[k&_e-1]:`[${k.map(E=>Y[E])}]`);return` - ${r.name}(${P})`});throw Error(`\u041D\u0435\u043A\u043E\u0440\u0440\u0435\u043A\u0442\u043D\u0430\u044F \u0441\u0438\u0433\u043D\u0430\u0442\u0443\u0440\u0430 \u0444\u0443\u043D\u043A\u0446\u0438\u0438 ${w}.
\u0412\u043E\u0437\u043C\u043E\u0436\u043D\u044B\u0435 \u0432\u0430\u0440\u0438\u0430\u043D\u0442\u044B:
${D.join(`;
`)}`)}let g=e.map((w,D)=>{let v=u.argTypes[D];return typeof v=="number"&&v&_e?c.vars.derefer(r.args[D]):w.text});return{text:`${Jt}.${u.path}(${u.passState?[Zt,...g]:g})`,type:u.retType}}if(i.argTypes.length!==e.length||i.argTypes.some((u,g)=>u!==e[g].type))throw Error(`${r.name} \u043F\u0440\u0438\u043D\u0438\u043C\u0430\u0435\u0442 [${i.argTypes.map(u=>Y[u])}], \u043F\u043E\u043B\u0443\u0447\u0435\u043D\u043E [${e.map(u=>Y[u.type])}]`);let o=e.map(u=>u.text);return{text:`${Jt}.${oi}(${[Zt,`"${i.name}"`,`[${o}]`]})`,type:i.retType}}function $l(c){return`t${c.tmpVarCount++}`}function tr(c,r){var e;switch(r.isNew&&r.type!=="var"&&c.bugs.push("\u041F\u0440\u0438\u043C\u0435\u043D\u0435\u043D\u0438\u0435 \u043E\u043F\u0435\u0440\u0430\u0442\u043E\u0440\u0430 '~' \u043D\u0435 \u043A \u043F\u0435\u0440\u0435\u043C\u0435\u043D\u043D\u043E\u0439"),r.type){case"float":return{text:r.value,type:1};case"handle":return{text:r.value,type:3};case"string":return{text:"`"+r.value.replace(/[`$\\]/g,"\\$&")+"`",type:2};case"var":{let t=(e=Se[r.name.toUpperCase()])==null?void 0:e.toString();return t?{text:t,type:1}:c.vars.getOrCreateVar(r.isNew,r.name)}case"call":{let t=$l(c),s=pi(c,r);if(!s.type)throw Error(`\u0424\u0443\u043D\u043A\u0446\u0438\u044F ${r.name} \u043D\u0435 \u0432\u043E\u0437\u0432\u0440\u0430\u0449\u0430\u0435\u0442 \u0437\u043D\u0430\u0447\u0435\u043D\u0438\u044F`);return c.lines.push(`var ${t}=${s.text};`),{text:t,type:s.type}}case"-":case"!":{let t=tr(c,r.op);if(t.type!==1)throw Error(`\u041E\u043F\u0435\u0440\u0430\u0442\u043E\u0440 "${r.type}" \u043D\u0435 \u043F\u0440\u0438\u043C\u0435\u043D\u0438\u043C \u043A ${Y[t.type]}`);return{text:`(${r.type}${t.text})`,type:t.type}}case"subexpr":{let t=ve(c,r.expr);return{text:`(${t.text})`,type:t.type}}}}function ve(c,{first:r,rest:e}){if(!e.length)return tr(c,r);let t=[{type:"decl",op:r},...He(e.map(i=>[i.action,{type:"decl",op:i.operand}]))];li.forEach(i=>{for(;;){let o=t.findIndex(v=>typeof v=="string"&&i.includes(v));if(o<0)break;let a=t[o],h=t[o-1],u=t[o+1],g=h.type=="decl"?tr(c,h.op):h.res,b=u.type=="decl"?tr(c,u.op):u.res,w=Ir.find(({name:v,arg:P})=>v===a&&P[0]===g.type&&P[1]===b.type);if(!w)throw Error(`\u041E\u043F\u0435\u0440\u0430\u0442\u043E\u0440 '${a}' \u043D\u0435\u043F\u0440\u0438\u043C\u0435\u043D\u0438\u043C \u043A '${Y[g.type]}', '${Y[b.type]}'`);let D={text:w.text.replace(/#\d/g,v=>(v==="#0"?g:b).text),type:w.ret};t.splice(o-1,3,{type:"parsed",res:D})}});let s=t[0];if(typeof s!="object"||s.type!=="parsed")throw Error("\u041E\u0448\u0438\u0431\u043A\u0430 \u0440\u0430\u0437\u0431\u043E\u0440\u0430 \u0432\u044B\u0440\u0430\u0436\u0435\u043D\u0438\u044F");return s.res}function ci(c){c.tmpVarCount=0}function ui(c,r,e){if(r!==e)throw Error(`"${c}" \u0438\u043C\u0435\u0435\u0442 \u0442\u0438\u043F ${Y[r]}, \u043D\u043E \u043F\u0440\u0430\u0432\u043E\u0435 \u0432\u044B\u0440\u0430\u0436\u0435\u043D\u0438\u0435 \u0432\u043E\u0437\u0432\u0440\u0430\u0449\u0430\u0435\u0442 ${Y[e]}`)}function hi(c,r){switch(ci(c),r.type){case":=":{let t=ve(c,r.expr),s=c.vars.getOrCreateVar(!0,r.to,t.type);ui(r.to,s.type,t.type),c.lines.push(`${s.text} = ${t.text};`);break}case"callChain":{r.functions.forEach(t=>{ci(c);let s=pi(c,t);c.lines.push(`${s.text};`)});break}case"if":{c.b.pushBlock({canBreak:!1,expect:"endif",hasElse:!1});let t=ve(c,r.expr);c.lines.push(`if (${t.text}) {`);break}case"else":{let t=c.b.lastBlock();if((t==null?void 0:t.expect)!=="endif"||t.hasElse)throw Error("else \u0434\u043E\u043B\u0436\u0435\u043D \u043D\u0430\u0445\u043E\u0434\u0438\u0442\u044C\u0441\u044F \u043F\u043E\u0441\u043B\u0435 if");t.hasElse=!0,c.lines.push("} else {");break}case"endif":{c.b.popBlock("endif"),c.lines.push("}");break}case"varsDec":{let{datatype:t,modifiers:s,names:i}=r,o;switch(t){case"FLOAT":case"INTEGER":o=1;break;case"HANDLE":o=3;break;case"STRING":o=2;break;case"COLORREF":o=4;break}let a=(s.includes("LOCAL")?2:0)|(s.includes("PARAMETER")?512:0);i.forEach(h=>c.vars.createVar(h,o,a));break}case"while":{c.b.pushBlock({expect:"endwhile",canBreak:!0});let t=`g${++c.whileGuardCount}`;c.lines.push(`var ${t} = 0;`),c.lines.push("while (true) {"),c.lines.push(`if (++${t} > 100000) throw Error("\u0411\u0435\u0441\u043A\u043E\u043D\u0435\u0447\u043D\u044B\u0439 \u0446\u0438\u043A\u043B (100000 \u0438\u0442\u0435\u0440\u0430\u0446\u0438\u0439)");`);let s=ve(c,r.expr);c.lines.push(`if (!(${s.text})) break;`);break}case"endwhile":{c.b.popBlock("endwhile"),c.lines.push("}");break}case"do":{c.b.pushBlock({expect:"until",canBreak:!0}),c.lines.push("do {");break}case"until":{c.b.popBlock("until");let t=ve(c,r.expr);c.lines.push(`} while (${t.text});`);break}case"switch":{c.b.pushBlock({expect:"endswitch",canBreak:!0,caseCount:0}),c.lines.push("do { //switch");break}case"endswitch":{let t=c.b.popBlock("endswitch");if(!t.caseCount)throw Error("\u041E\u0436\u0438\u0434\u0430\u043B\u043E\u0441\u044C case");for(let s=0;s<t.caseCount;++s)c.lines.push("}");c.lines.push("} while (false); //endswitch");break}case"case":{let t=c.b.lastBlock();if((t==null?void 0:t.expect)!=="endswitch")throw Error("case \u0434\u043E\u043B\u0436\u0435\u043D \u043D\u0430\u0445\u043E\u0434\u0438\u0442\u044C\u0441\u044F \u0432\u043D\u0443\u0442\u0440\u0438 \u0431\u043B\u043E\u043A\u0430 switch");t.caseCount&&c.lines.push("} else {"),++t.caseCount;let s=ve(c,r.expr);c.lines.push(`if (${s.text}) { //case`);break}case"default":{let t=c.b.lastBlock();if((t==null?void 0:t.expect)!=="endswitch")throw Error("default \u0434\u043E\u043B\u0436\u0435\u043D \u043D\u0430\u0445\u043E\u0434\u0438\u0442\u044C\u0441\u044F \u0432\u043D\u0443\u0442\u0440\u0438 \u0431\u043B\u043E\u043A\u0430 switch");c.lines.push("} else { //default");break}case"break":c.lines.push(c.b.haveABreakHaveAKitKat());break;case"=":{let t=R(N({},c),{lines:[]}),s=ve(t,r.lhs);if(s.type!==1)throw Error("\u041B\u0435\u0432\u0430\u044F \u0447\u0430\u0441\u0442\u044C \u0432\u044B\u0440\u0430\u0436\u0435\u043D\u0438\u044F \u043D\u0435 \u0432\u043E\u0437\u0432\u0440\u0430\u0449\u0430\u0435\u0442 FLOAT");let i=ve(t,r.rhs);if(i.type!==1)throw Error("\u041F\u0440\u0430\u0432\u0430\u044F \u0447\u0430\u0441\u0442\u044C \u0432\u044B\u0440\u0430\u0436\u0435\u043D\u0438\u044F \u043D\u0435 \u0432\u043E\u0437\u0432\u0440\u0430\u0449\u0430\u0435\u0442 FLOAT");t.lines.push(`return ${i.text} - (${s.text});`),c.equations.push(t.lines);break}case"::=":{let t=R(N({},c),{lines:[]}),s=ve(t,r.expr),i=c.vars.getOrCreateVar(!0,r.to,s.type);ui(r.to,i.type,s.type),t.lines.push(`${i.text} = ${s.text};`),c.defers.push(t.lines);break}case"eqResult":{if(r.deferred)r.vars.forEach(t=>c.vars.makeInEquation(t));else{let t=r.vars.map(i=>c.vars.getFloatVar(i)),s=[Zt,`[${t}]`];c.lines.push(`${Jt}.${ai}(${s});`)}break}case"function":{c.isFunction=!0;break}case"return":{c.vars.setAsReturn(r.to);break}default:throw Error(`\u041D\u0435\u0438\u0437\u0432\u0435\u0441\u0442\u043D\u044B\u0439 \u043E\u043F\u0435\u0440\u0430\u0442\u043E\u0440: "${r.type}"`)}}function Ol(c,r,e){var E;let t=c.vars.result(),{lines:s,bugs:i,equations:o,defers:a,isFunction:h}=c;if(s.length===0&&o.length===0&&a.length===0)return{bugs:i,vars:t,isFunction:h,mainText:"",equationsTexts:[],defersTexts:[]};let u=[...c.headerFuncs].map(A=>A.body).join(`
`),g=t.map((A,U)=>`var $${A.name.toLowerCase()} = ${ii}[${U}];`).join(`
`),b=ni+`
`+u+`
`+g+`

`,w=r?`//# sourceURL=_transpiled/${r}`:"",D=(E=e==null?void 0:e.split(`
`).map(A=>"// "+A).join(`
`))!=null?E:"",v=s.length?D+b+s.join(`
`)+w:"",P=o.map((A,U)=>b+A.join(`
`)+(w&&`${w}_eq_${U}`)),k=a.map((A,U)=>b+A.join(`
`)+(w&&`${w}_defer_${U}`));return{bugs:i,vars:t,isFunction:h,mainText:v,equationsTexts:P,defersTexts:k}}function di(c,{funcTable:r,sourceURL:e,comment:t}={}){let s={funcTable:r,vars:new er,b:new Yt,lines:[],defers:[],equations:[],isFunction:!1,bugs:[],tmpVarCount:0,whileGuardCount:0,headerFuncs:new Set([vr])};c.forEach((o,a)=>{try{hi(s,o);let h=o.then;for(;h;)hi(s,h),h=h.then}catch(h){throw h instanceof Error?Error(`\u0421\u0442\u0440\u043E\u043A\u0430 ${a+1}: ${h.message}`):h}});let i=s.b.lastBlock();if(i)throw Error(`\u0421\u0442\u0440\u043E\u043A\u0430 ${c.length}: \u043E\u0436\u0438\u0434\u0430\u043B\u043E\u0441\u044C ${i.expect}`);return Ol(s,e,t)}var Ar="'",Nr='"';function mi(c){let r="",e=null;for(let t=0;t<c.length;++t){let s=c[t];if(s===Ar&&e!==Nr?e=e?null:Ar:s===Nr&&e!==Ar&&(e=e?null:Nr),e){r+=s;continue}if(s==="/"){let i=c[t+1];if(i==="*"){for(t+=2;t<c.length&&(c[t]!=="*"||c[t+1]!=="/");)++t;++t;continue}if(i==="/"){for(++t;t<c.length&&c[++t]!==`
`;);r[r.length-1]!==`
`&&(r+=`
`);continue}}if(s===";"||s===`
`){r[r.length-1]!==`
`&&(r+=`
`);continue}if(s==="\r"){c[t+1]===`
`&&++t,r[r.length-1]!==`
`&&(r+=`
`);continue}r+=s}return r[r.length-1]===`
`?r:r+`
`}function xl(c,r){function e(){this.constructor=c}e.prototype=r.prototype,c.prototype=new e}function Je(c,r,e,t){this.message=c,this.expected=r,this.found=e,this.location=t,this.name="SyntaxError",typeof Error.captureStackTrace=="function"&&Error.captureStackTrace(this,Je)}xl(Je,Error);Je.buildMessage=function(c,r){var e={literal:function(u){return'"'+s(u.text)+'"'},class:function(u){var g="",b;for(b=0;b<u.parts.length;b++)g+=u.parts[b]instanceof Array?i(u.parts[b][0])+"-"+i(u.parts[b][1]):i(u.parts[b]);return"["+(u.inverted?"^":"")+g+"]"},any:function(u){return"any character"},end:function(u){return"end of input"},other:function(u){return u.description}};function t(u){return u.charCodeAt(0).toString(16).toUpperCase()}function s(u){return u.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(g){return"\\x0"+t(g)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(g){return"\\x"+t(g)})}function i(u){return u.replace(/\\/g,"\\\\").replace(/\]/g,"\\]").replace(/\^/g,"\\^").replace(/-/g,"\\-").replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(g){return"\\x0"+t(g)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(g){return"\\x"+t(g)})}function o(u){return e[u.type](u)}function a(u){var g=new Array(u.length),b,w;for(b=0;b<u.length;b++)g[b]=o(u[b]);if(g.sort(),g.length>0){for(b=1,w=1;b<g.length;b++)g[b-1]!==g[b]&&(g[w]=g[b],w++);g.length=w}switch(g.length){case 1:return g[0];case 2:return g[0]+" or "+g[1];default:return g.slice(0,-1).join(", ")+", or "+g[g.length-1]}}function h(u){return u?'"'+s(u)+'"':"end of input"}return"Expected "+a(c)+" but "+h(r)+" found."};function vl(c,r){r=r!==void 0?r:{};var e={},t={Code:bs},s=bs,i=function(l){return l},o=function(l){return l.filter(f=>f)},a=Z("variable name"),h=function(l){return{type:"var",name:l}},u=",",g=j(",",!1),b=function(l){return l},w=Z("function call"),D="(",v=j("(",!1),P=")",k=j(")",!1),E=function(l,f){return{type:"call",name:l,args:f}},A="-",U=j("-",!1),q="!",ce=j("!",!1),Te=Z("!<operand> or -<operand>"),ie=function(l,f){return{type:l,op:f}},xi=Z("(<expression>)"),vi=function(l){return{type:"subexpr",expr:l}},Di=Z("operand"),_i="~",Pi=j("~",!1),Ii=function(l,f){return R(N({},f),{isNew:!!l})},Ai="^",Ni=j("^",!1),Ri="*",Gi=j("*",!1),ki="/",Mi=j("/",!1),Li="%",Bi=j("%",!1),Vi="+",Ui=j("+",!1),Vr=">=",ji=j(">=",!1),Fi=">",Hi=j(">",!1),Ur="<=",Ci=j("<=",!1),Ki="<",qi=j("<",!1),jr="==",Xi=j("==",!1),Fr="!=",Yi=j("!=",!1),Hr="&&",zi=j("&&",!1),Ji="&",Zi=j("&",!1),Cr="||",Qi=j("||",!1),en="|",tn=j("|",!1),rn=Z("expression"),Kr=function(l,f,S){return{action:f,operand:S}},sn=function(l,f){return{first:l,rest:f}},qr=function(l,f){return f},nn=function(l,f){return[l].concat(f)},Xr=function(l,f){return f},on=function(l,f,S){return{type:"varsDec",datatype:l,modifiers:f,names:S}},an=Z("assignment operator"),Yr=":=",ln=j(":=",!1),zr="::=",cn=j("::=",!1),un=function(l,f,S){return{type:f,to:l,expr:S}},hn=Z("equality operator"),Jr="=",Zr=j("=",!1),pn=function(l,f,S){return{type:f,lhs:l,rhs:S}},dn=Z("immediately equation result"),Ue=function(l,f){return f},Qr="?",es=j("?",!1),mn=function(l,f){return{type:"eqResult",deferred:!1,vars:[l].concat(f)}},fn=Z("deferred equation result"),gn=function(l,f){return{type:"eqResult",deferred:!0,vars:[l].concat(f)}},bn=Z("function call chain"),yn=function(l,f){return{type:"callChain",functions:[l].concat(f)}},ts=Z("( <expression> )"),rs=function(l){return l},Sn=Z("if(<condition>)"),wn="if",Tn=j("if",!0),Wn=function(l){return{type:"if",expr:l}},En=Z("while(<condition>)"),$n="while",On=j("while",!0),xn=function(l){return{type:"while",expr:l}},vn=Z("until(<condition>)"),Dn="until",_n=j("until",!0),Pn=function(l){return{type:"until",expr:l}},In=Z("case(<condition>)"),An="case",Nn=j("case",!0),Rn=function(l,f){return{type:"case",expr:l,then:f}},Gn="else",kn=j("else",!0),Mn=function(l){return{type:"else",then:l}},Ln="endif",Bn=j("endif",!0),Vn=function(l){return{type:"endif",then:l}},Un="break",jn=j("break",!0),Fn=function(){return{type:"break"}},Hn="endwhile",Cn=j("endwhile",!0),Kn=function(){return{type:"endwhile"}},qn="do",Xn=j("do",!0),Yn=function(){return{type:"do"}},zn="endswitch",Jn=j("endswitch",!0),Zn=function(){return{type:"endswitch"}},Qn="switch",eo=j("switch",!0),to=function(){return{type:"switch"}},ro="default",so=j("default",!0),io=function(l){return{type:"default",then:l}},no="function",oo=j("function",!0),ao=function(){return{type:"function"}},lo=Z("return <var name>"),co="return",uo=j("return",!0),ho=function(l){return{type:"return",to:l}},po="handle",mo=j("HANDLE",!0),fo=function(){return"HANDLE"},go="string",bo=j("STRING",!0),yo=function(){return"STRING"},So="float",wo=j("FLOAT",!0),To=function(){return"FLOAT"},Wo="colorref",Eo=j("COLORREF",!0),$o=function(){return"COLORREF"},Oo="integer",xo=j("INTEGER",!0),vo=function(){return"INTEGER"},Do="local",_o=j("LOCAL",!0),Po=function(){return"LOCAL"},Io="nosave",Ao=j("NOSAVE",!0),No=function(){return"NOSAVE"},Ro="parameter",Go=j("PARAMETER",!0),ko=function(){return"PARAMETER"},ss=/^[_a-z\u0430-\u044F0-9]/i,is=Ae(["_",["a","z"],["\u0430","\u044F"],["0","9"]],!1,!0),Mo=Z("function name"),lt=/^[0-9]/,ct=Ae([["0","9"]],!1,!1),Lo=".",Bo=j(".",!1),Vo=/^[eE]/,Uo=Ae(["e","E"],!1,!1),jo=/^[+\-]/,Fo=Ae(["+","-"],!1,!1),Ho=Z("float"),Co=function(l){return{type:"float",value:l}},Ko=Z("handle"),qo="#",Xo=j("#",!1),Yo=function(l){return{type:"handle",value:l.length>0?l:"0"}},ns="'",os=j("'",!1),as=/^[^']/,ls=Ae(["'"],!0,!1),cs='"',us=j('"',!1),hs=/^[^"]/,ps=Ae(['"'],!0,!1),zo=function(l){return{type:"string",value:l[1]}},Jo=Z("space or tab"),Zo=/^[ \t]/,Qo=Ae([" ","	"],!1,!1),ea=Z("new line"),ta=`
`,ra=j(`
`,!1),sa=Z("whitespace"),ds=/^[ \t\n\r]/,ms=Ae([" ","	",`
`,"\r"],!1,!1),d=0,B=0,ut=[{line:1,column:1}],Oe=0,dr=[],$=0,ht;if("startRule"in r){if(!(r.startRule in t))throw new Error(`Can't start parsing from rule "`+r.startRule+'".');s=t[r.startRule]}function Pl(){return c.substring(B,d)}function Il(){return rt(B,d)}function Al(l,f){throw f=f!==void 0?f:rt(B,d),gs([Z(l)],c.substring(B,d),f)}function Nl(l,f){throw f=f!==void 0?f:rt(B,d),na(l,f)}function j(l,f){return{type:"literal",text:l,ignoreCase:f}}function Ae(l,f,S){return{type:"class",parts:l,inverted:f,ignoreCase:S}}function Rl(){return{type:"any"}}function ia(){return{type:"end"}}function Z(l){return{type:"other",description:l}}function fs(l){var f=ut[l],S;if(f)return f;for(S=l-1;!ut[S];)S--;for(f=ut[S],f={line:f.line,column:f.column};S<l;)c.charCodeAt(S)===10?(f.line++,f.column=1):f.column++,S++;return ut[l]=f,f}function rt(l,f){var S=fs(l),y=fs(f);return{start:{offset:l,line:S.line,column:S.column},end:{offset:f,line:y.line,column:y.column}}}function _(l){d<Oe||(d>Oe&&(Oe=d,dr=[]),dr.push(l))}function na(l,f){return new Je(l,null,null,f)}function gs(l,f,S){return new Je(Je.buildMessage(l,f),l,f,S)}function bs(){var l,f,S,y,O,W,M;for(l=d,f=[],S=d,y=[],O=G();O!==e;)y.push(O),O=G();if(y!==e)if(O=mr(),O===e&&(O=null),O!==e){for(W=[],M=G();M!==e;)W.push(M),M=G();W!==e?(M=Ts(),M!==e?(B=S,y=i(O),S=y):(d=S,S=e)):(d=S,S=e)}else d=S,S=e;else d=S,S=e;for(;S!==e;){for(f.push(S),S=d,y=[],O=G();O!==e;)y.push(O),O=G();if(y!==e)if(O=mr(),O===e&&(O=null),O!==e){for(W=[],M=G();M!==e;)W.push(M),M=G();W!==e?(M=Ts(),M!==e?(B=S,y=i(O),S=y):(d=S,S=e)):(d=S,S=e)}else d=S,S=e;else d=S,S=e}return f!==e&&(B=l,f=o(f)),l=f,l}function oa(){var l,f;return $++,l=d,f=be(),f!==e&&(B=l,f=h(f)),l=f,$--,l===e&&(f=e,$===0&&_(a)),l}function ys(){var l,f,S,y,O;for(l=d,f=[],S=G();S!==e;)f.push(S),S=G();if(f!==e)if(S=ke(),S!==e){for(y=[],O=G();O!==e;)y.push(O),O=G();y!==e?(c.charCodeAt(d)===44?(O=u,d++):(O=e,$===0&&_(g)),O===e&&(O=null),O!==e?(B=l,f=b(S),l=f):(d=l,l=e)):(d=l,l=e)}else d=l,l=e;else d=l,l=e;return l}function pt(){var l,f,S,y,O,W,M,V;if($++,l=d,f=Ra(),f!==e){for(S=[],y=G();y!==e;)S.push(y),y=G();if(S!==e)if(c.charCodeAt(d)===40?(y=D,d++):(y=e,$===0&&_(v)),y!==e){for(O=[],W=G();W!==e;)O.push(W),W=G();if(O!==e){for(W=[],M=ys();M!==e;)W.push(M),M=ys();if(W!==e){for(M=[],V=G();V!==e;)M.push(V),V=G();M!==e?(c.charCodeAt(d)===41?(V=P,d++):(V=e,$===0&&_(k)),V!==e?(B=l,f=E(f,W),l=f):(d=l,l=e)):(d=l,l=e)}else d=l,l=e}else d=l,l=e}else d=l,l=e;else d=l,l=e}else d=l,l=e;return $--,l===e&&(f=e,$===0&&_(w)),l}function aa(){var l;return c.charCodeAt(d)===45?(l=A,d++):(l=e,$===0&&_(U)),l===e&&(c.charCodeAt(d)===33?(l=q,d++):(l=e,$===0&&_(ce))),l}function la(){var l,f,S,y;if($++,l=d,f=aa(),f!==e){for(S=[],y=G();y!==e;)S.push(y),y=G();S!==e?(y=dt(),y!==e?(B=l,f=ie(f,y),l=f):(d=l,l=e)):(d=l,l=e)}else d=l,l=e;return $--,l===e&&(f=e,$===0&&_(Te)),l}function ca(){var l,f,S,y,O,W;if($++,l=d,c.charCodeAt(d)===40?(f=D,d++):(f=e,$===0&&_(v)),f!==e){for(S=[],y=G();y!==e;)S.push(y),y=G();if(S!==e)if(y=ke(),y!==e){for(O=[],W=G();W!==e;)O.push(W),W=G();O!==e?(c.charCodeAt(d)===41?(W=P,d++):(W=e,$===0&&_(k)),W!==e?(B=l,f=vi(y),l=f):(d=l,l=e)):(d=l,l=e)}else d=l,l=e;else d=l,l=e}else d=l,l=e;return $--,l===e&&(f=e,$===0&&_(xi)),l}function dt(){var l,f,S,y;if($++,l=d,c.charCodeAt(d)===126?(f=_i,d++):(f=e,$===0&&_(Pi)),f===e&&(f=null),f!==e){for(S=[],y=G();y!==e;)S.push(y),y=G();S!==e?(y=la(),y===e&&(y=Ma(),y===e&&(y=La(),y===e&&(y=Ba(),y===e&&(y=pt(),y===e&&(y=oa(),y===e&&(y=ca())))))),y!==e?(B=l,f=Ii(f,y),l=f):(d=l,l=e)):(d=l,l=e)}else d=l,l=e;return $--,l===e&&(f=e,$===0&&_(Di)),l}function Ss(){var l;return c.charCodeAt(d)===94?(l=Ai,d++):(l=e,$===0&&_(Ni)),l===e&&(c.charCodeAt(d)===42?(l=Ri,d++):(l=e,$===0&&_(Gi)),l===e&&(c.charCodeAt(d)===47?(l=ki,d++):(l=e,$===0&&_(Mi)),l===e&&(c.charCodeAt(d)===37?(l=Li,d++):(l=e,$===0&&_(Bi)),l===e&&(c.charCodeAt(d)===43?(l=Vi,d++):(l=e,$===0&&_(Ui)),l===e&&(c.charCodeAt(d)===45?(l=A,d++):(l=e,$===0&&_(U)),l===e&&(c.substr(d,2)===Vr?(l=Vr,d+=2):(l=e,$===0&&_(ji)),l===e&&(c.charCodeAt(d)===62?(l=Fi,d++):(l=e,$===0&&_(Hi)),l===e&&(c.substr(d,2)===Ur?(l=Ur,d+=2):(l=e,$===0&&_(Ci)),l===e&&(c.charCodeAt(d)===60?(l=Ki,d++):(l=e,$===0&&_(qi)),l===e&&(c.substr(d,2)===jr?(l=jr,d+=2):(l=e,$===0&&_(Xi)),l===e&&(c.substr(d,2)===Fr?(l=Fr,d+=2):(l=e,$===0&&_(Yi)),l===e&&(c.substr(d,2)===Hr?(l=Hr,d+=2):(l=e,$===0&&_(zi)),l===e&&(c.charCodeAt(d)===38?(l=Ji,d++):(l=e,$===0&&_(Zi)),l===e&&(c.substr(d,2)===Cr?(l=Cr,d+=2):(l=e,$===0&&_(Qi)),l===e&&(c.charCodeAt(d)===124?(l=en,d++):(l=e,$===0&&_(tn))))))))))))))))),l}function ke(){var l,f,S,y,O,W,M,V;if($++,l=d,f=dt(),f!==e){for(S=[],y=d,O=[],W=G();W!==e;)O.push(W),W=G();if(O!==e)if(W=Ss(),W!==e){for(M=[],V=G();V!==e;)M.push(V),V=G();M!==e?(V=dt(),V!==e?(B=y,O=Kr(f,W,V),y=O):(d=y,y=e)):(d=y,y=e)}else d=y,y=e;else d=y,y=e;for(;y!==e;){for(S.push(y),y=d,O=[],W=G();W!==e;)O.push(W),W=G();if(O!==e)if(W=Ss(),W!==e){for(M=[],V=G();V!==e;)M.push(V),V=G();M!==e?(V=dt(),V!==e?(B=y,O=Kr(f,W,V),y=O):(d=y,y=e)):(d=y,y=e)}else d=y,y=e;else d=y,y=e}S!==e?(B=l,f=sn(f,S),l=f):(d=l,l=e)}else d=l,l=e;return $--,l===e&&(f=e,$===0&&_(rn)),l}function ua(){var l,f,S,y,O,W,M,V;if(l=d,f=be(),f!==e){for(S=[],y=d,O=ue(),O!==e?(c.charCodeAt(d)===44?(W=u,d++):(W=e,$===0&&_(g)),W!==e?(M=ue(),M!==e?(V=be(),V!==e?(B=y,O=qr(f,V),y=O):(d=y,y=e)):(d=y,y=e)):(d=y,y=e)):(d=y,y=e);y!==e;)S.push(y),y=d,O=ue(),O!==e?(c.charCodeAt(d)===44?(W=u,d++):(W=e,$===0&&_(g)),W!==e?(M=ue(),M!==e?(V=be(),V!==e?(B=y,O=qr(f,V),y=O):(d=y,y=e)):(d=y,y=e)):(d=y,y=e)):(d=y,y=e);S!==e?(B=l,f=nn(f,S),l=f):(d=l,l=e)}else d=l,l=e;return l}function ha(){var l,f,S,y,O,W,M,V,de;if(l=d,f=Na(),f!==e){if(S=[],y=G(),y!==e)for(;y!==e;)S.push(y),y=G();else S=e;if(S!==e)if(y=ue(),y!==e){if(O=[],W=d,M=ws(),M!==e){if(V=[],de=G(),de!==e)for(;de!==e;)V.push(de),de=G();else V=e;V!==e?(B=W,M=Xr(f,M),W=M):(d=W,W=e)}else d=W,W=e;for(;W!==e;)if(O.push(W),W=d,M=ws(),M!==e){if(V=[],de=G(),de!==e)for(;de!==e;)V.push(de),de=G();else V=e;V!==e?(B=W,M=Xr(f,M),W=M):(d=W,W=e)}else d=W,W=e;O!==e?(W=ua(),W!==e?(B=l,f=on(f,O,W),l=f):(d=l,l=e)):(d=l,l=e)}else d=l,l=e;else d=l,l=e}else d=l,l=e;return l}function pa(){var l,f,S,y,O,W;if($++,l=d,f=be(),f!==e)if(S=ue(),S!==e)if(c.substr(d,2)===Yr?(y=Yr,d+=2):(y=e,$===0&&_(ln)),y===e&&(c.substr(d,3)===zr?(y=zr,d+=3):(y=e,$===0&&_(cn))),y!==e){for(O=[],W=G();W!==e;)O.push(W),W=G();O!==e?(W=ke(),W!==e?(B=l,f=un(f,y,W),l=f):(d=l,l=e)):(d=l,l=e)}else d=l,l=e;else d=l,l=e;else d=l,l=e;return $--,l===e&&(f=e,$===0&&_(an)),l}function da(){var l,f,S,y,O,W;if($++,l=d,f=ke(),f!==e)if(S=ue(),S!==e)if(c.charCodeAt(d)===61?(y=Jr,d++):(y=e,$===0&&_(Zr)),y!==e){for(O=[],W=G();W!==e;)O.push(W),W=G();O!==e?(W=ke(),W!==e?(B=l,f=pn(f,y,W),l=f):(d=l,l=e)):(d=l,l=e)}else d=l,l=e;else d=l,l=e;else d=l,l=e;return $--,l===e&&(f=e,$===0&&_(hn)),l}function ma(){var l,f,S,y,O,W,M,V;if($++,l=d,f=be(),f!==e){for(S=[],y=d,O=[],W=G();W!==e;)O.push(W),W=G();if(O!==e)if(c.charCodeAt(d)===44?(W=u,d++):(W=e,$===0&&_(g)),W!==e){for(M=[],V=G();V!==e;)M.push(V),V=G();M!==e?(V=be(),V!==e?(B=y,O=Ue(f,V),y=O):(d=y,y=e)):(d=y,y=e)}else d=y,y=e;else d=y,y=e;for(;y!==e;){for(S.push(y),y=d,O=[],W=G();W!==e;)O.push(W),W=G();if(O!==e)if(c.charCodeAt(d)===44?(W=u,d++):(W=e,$===0&&_(g)),W!==e){for(M=[],V=G();V!==e;)M.push(V),V=G();M!==e?(V=be(),V!==e?(B=y,O=Ue(f,V),y=O):(d=y,y=e)):(d=y,y=e)}else d=y,y=e;else d=y,y=e}if(S!==e){for(y=[],O=G();O!==e;)y.push(O),O=G();if(y!==e)if(c.charCodeAt(d)===61?(O=Jr,d++):(O=e,$===0&&_(Zr)),O!==e){for(W=[],M=G();M!==e;)W.push(M),M=G();W!==e?(c.charCodeAt(d)===63?(M=Qr,d++):(M=e,$===0&&_(es)),M!==e?(B=l,f=mn(f,S),l=f):(d=l,l=e)):(d=l,l=e)}else d=l,l=e;else d=l,l=e}else d=l,l=e}else d=l,l=e;return $--,l===e&&(f=e,$===0&&_(dn)),l}function fa(){var l,f,S,y,O,W,M,V,de,je;if($++,l=d,c.charCodeAt(d)===63?(f=Qr,d++):(f=e,$===0&&_(es)),f!==e)if(S=ue(),S!==e)if(y=be(),y!==e){for(O=[],W=d,M=ue(),M!==e?(c.charCodeAt(d)===44?(V=u,d++):(V=e,$===0&&_(g)),V!==e?(de=ue(),de!==e?(je=be(),je!==e?(B=W,M=Ue(y,je),W=M):(d=W,W=e)):(d=W,W=e)):(d=W,W=e)):(d=W,W=e);W!==e;)O.push(W),W=d,M=ue(),M!==e?(c.charCodeAt(d)===44?(V=u,d++):(V=e,$===0&&_(g)),V!==e?(de=ue(),de!==e?(je=be(),je!==e?(B=W,M=Ue(y,je),W=M):(d=W,W=e)):(d=W,W=e)):(d=W,W=e)):(d=W,W=e);O!==e?(B=l,f=gn(y,O),l=f):(d=l,l=e)}else d=l,l=e;else d=l,l=e;else d=l,l=e;return $--,l===e&&(f=e,$===0&&_(fn)),l}function ga(){var l,f,S,y,O,W;if($++,l=d,f=pt(),f!==e){if(S=[],y=d,O=[],W=G(),W!==e)for(;W!==e;)O.push(W),W=G();else O=e;for(O!==e?(W=pt(),W!==e?(B=y,O=Ue(f,W),y=O):(d=y,y=e)):(d=y,y=e);y!==e;){if(S.push(y),y=d,O=[],W=G(),W!==e)for(;W!==e;)O.push(W),W=G();else O=e;O!==e?(W=pt(),W!==e?(B=y,O=Ue(f,W),y=O):(d=y,y=e)):(d=y,y=e)}S!==e?(B=l,f=yn(f,S),l=f):(d=l,l=e)}else d=l,l=e;return $--,l===e&&(f=e,$===0&&_(bn)),l}function ba(){var l,f,S,y,O,W;if($++,l=d,c.charCodeAt(d)===40?(f=D,d++):(f=e,$===0&&_(v)),f!==e){for(S=[],y=G();y!==e;)S.push(y),y=G();if(S!==e)if(y=ke(),y!==e){for(O=[],W=G();W!==e;)O.push(W),W=G();O!==e?(c.charCodeAt(d)===41?(W=P,d++):(W=e,$===0&&_(k)),W!==e?(B=l,f=rs(y),l=f):(d=l,l=e)):(d=l,l=e)}else d=l,l=e;else d=l,l=e}else d=l,l=e;return $--,l===e&&(f=e,$===0&&_(ts)),l}function ya(){var l,f,S,y,O;for($++,l=d,f=[],S=G();S!==e;)f.push(S),S=G();if(f!==e)if(S=ke(),S!==e){for(y=[],O=G();O!==e;)y.push(O),O=G();y!==e?(c.charCodeAt(d)===41?(O=P,d++):(O=e,$===0&&_(k)),O!==e?(B=l,f=rs(S),l=f):(d=l,l=e)):(d=l,l=e)}else d=l,l=e;else d=l,l=e;return $--,l===e&&(f=e,$===0&&_(ts)),l}function mt(){var l;return l=ba(),l===e&&(l=ya()),l}function ft(){var l,f,S;if(l=d,f=[],S=G(),S!==e)for(;S!==e;)f.push(S),S=G();else f=e;return f!==e?(S=mr(),S!==e?(B=l,f=b(S),l=f):(d=l,l=e)):(d=l,l=e),l}function Sa(){var l,f,S,y;return $++,l=d,c.substr(d,2).toLowerCase()===wn?(f=c.substr(d,2),d+=2):(f=e,$===0&&_(Tn)),f!==e?(S=ue(),S!==e?(y=mt(),y!==e?(B=l,f=Wn(y),l=f):(d=l,l=e)):(d=l,l=e)):(d=l,l=e),$--,l===e&&(f=e,$===0&&_(Sn)),l}function wa(){var l,f,S,y;return $++,l=d,c.substr(d,5).toLowerCase()===$n?(f=c.substr(d,5),d+=5):(f=e,$===0&&_(On)),f!==e?(S=ue(),S!==e?(y=mt(),y!==e?(B=l,f=xn(y),l=f):(d=l,l=e)):(d=l,l=e)):(d=l,l=e),$--,l===e&&(f=e,$===0&&_(En)),l}function Ta(){var l,f,S,y;return $++,l=d,c.substr(d,5).toLowerCase()===Dn?(f=c.substr(d,5),d+=5):(f=e,$===0&&_(_n)),f!==e?(S=ue(),S!==e?(y=mt(),y!==e?(B=l,f=Pn(y),l=f):(d=l,l=e)):(d=l,l=e)):(d=l,l=e),$--,l===e&&(f=e,$===0&&_(vn)),l}function Wa(){var l,f,S,y,O;return $++,l=d,c.substr(d,4).toLowerCase()===An?(f=c.substr(d,4),d+=4):(f=e,$===0&&_(Nn)),f!==e?(S=ue(),S!==e?(y=mt(),y!==e?(O=ft(),O===e&&(O=null),O!==e?(B=l,f=Rn(y,O),l=f):(d=l,l=e)):(d=l,l=e)):(d=l,l=e)):(d=l,l=e),$--,l===e&&(f=e,$===0&&_(In)),l}function Ea(){var l,f,S;return l=d,c.substr(d,4).toLowerCase()===Gn?(f=c.substr(d,4),d+=4):(f=e,$===0&&_(kn)),f!==e?(S=ft(),S===e&&(S=null),S!==e?(B=l,f=Mn(S),l=f):(d=l,l=e)):(d=l,l=e),l}function $a(){var l,f,S;return l=d,c.substr(d,5).toLowerCase()===Ln?(f=c.substr(d,5),d+=5):(f=e,$===0&&_(Bn)),f!==e?(S=ft(),S===e&&(S=null),S!==e?(B=l,f=Vn(S),l=f):(d=l,l=e)):(d=l,l=e),l}function Oa(){var l,f;return l=d,c.substr(d,5).toLowerCase()===Un?(f=c.substr(d,5),d+=5):(f=e,$===0&&_(jn)),f!==e&&(B=l,f=Fn()),l=f,l}function xa(){var l,f;return l=d,c.substr(d,8).toLowerCase()===Hn?(f=c.substr(d,8),d+=8):(f=e,$===0&&_(Cn)),f!==e&&(B=l,f=Kn()),l=f,l}function va(){var l,f;return l=d,c.substr(d,2).toLowerCase()===qn?(f=c.substr(d,2),d+=2):(f=e,$===0&&_(Xn)),f!==e&&(B=l,f=Yn()),l=f,l}function Da(){var l,f;return l=d,c.substr(d,9).toLowerCase()===zn?(f=c.substr(d,9),d+=9):(f=e,$===0&&_(Jn)),f!==e&&(B=l,f=Zn()),l=f,l}function _a(){var l,f;return l=d,c.substr(d,6).toLowerCase()===Qn?(f=c.substr(d,6),d+=6):(f=e,$===0&&_(eo)),f!==e&&(B=l,f=to()),l=f,l}function Pa(){var l,f,S;return l=d,c.substr(d,7).toLowerCase()===ro?(f=c.substr(d,7),d+=7):(f=e,$===0&&_(so)),f!==e?(S=ft(),S===e&&(S=null),S!==e?(B=l,f=io(S),l=f):(d=l,l=e)):(d=l,l=e),l}function Ia(){var l,f;return l=d,c.substr(d,8).toLowerCase()===no?(f=c.substr(d,8),d+=8):(f=e,$===0&&_(oo)),f!==e&&(B=l,f=ao()),l=f,l}function Aa(){var l,f,S,y;return $++,l=d,c.substr(d,6).toLowerCase()===co?(f=c.substr(d,6),d+=6):(f=e,$===0&&_(uo)),f!==e?(S=ue(),S!==e?(y=be(),y!==e?(B=l,f=ho(y),l=f):(d=l,l=e)):(d=l,l=e)):(d=l,l=e),$--,l===e&&(f=e,$===0&&_(lo)),l}function mr(){var l;return l=ha(),l===e&&(l=pa(),l===e&&(l=da(),l===e&&(l=ma(),l===e&&(l=fa(),l===e&&(l=Sa(),l===e&&(l=Ea(),l===e&&(l=$a(),l===e&&(l=Oa(),l===e&&(l=wa(),l===e&&(l=xa(),l===e&&(l=va(),l===e&&(l=Ta(),l===e&&(l=Da(),l===e&&(l=_a(),l===e&&(l=Wa(),l===e&&(l=Pa(),l===e&&(l=ga(),l===e&&(l=Ia(),l===e&&(l=Aa()))))))))))))))))))),l}function Na(){var l,f;return l=d,c.substr(d,6).toLowerCase()===po?(f=c.substr(d,6),d+=6):(f=e,$===0&&_(mo)),f!==e&&(B=l,f=fo()),l=f,l===e&&(l=d,c.substr(d,6).toLowerCase()===go?(f=c.substr(d,6),d+=6):(f=e,$===0&&_(bo)),f!==e&&(B=l,f=yo()),l=f,l===e&&(l=d,c.substr(d,5).toLowerCase()===So?(f=c.substr(d,5),d+=5):(f=e,$===0&&_(wo)),f!==e&&(B=l,f=To()),l=f,l===e&&(l=d,c.substr(d,8).toLowerCase()===Wo?(f=c.substr(d,8),d+=8):(f=e,$===0&&_(Eo)),f!==e&&(B=l,f=$o()),l=f,l===e&&(l=d,c.substr(d,7).toLowerCase()===Oo?(f=c.substr(d,7),d+=7):(f=e,$===0&&_(xo)),f!==e&&(B=l,f=vo()),l=f)))),l}function ws(){var l,f;return l=d,c.substr(d,5).toLowerCase()===Do?(f=c.substr(d,5),d+=5):(f=e,$===0&&_(_o)),f!==e&&(B=l,f=Po()),l=f,l===e&&(l=d,c.substr(d,6).toLowerCase()===Io?(f=c.substr(d,6),d+=6):(f=e,$===0&&_(Ao)),f!==e&&(B=l,f=No()),l=f,l===e&&(l=d,c.substr(d,9).toLowerCase()===Ro?(f=c.substr(d,9),d+=9):(f=e,$===0&&_(Go)),f!==e&&(B=l,f=ko()),l=f)),l}function be(){var l,f,S;if($++,l=d,f=[],ss.test(c.charAt(d))?(S=c.charAt(d),d++):(S=e,$===0&&_(is)),S!==e)for(;S!==e;)f.push(S),ss.test(c.charAt(d))?(S=c.charAt(d),d++):(S=e,$===0&&_(is));else f=e;return f!==e?l=c.substring(l,d):l=f,$--,l===e&&(f=e,$===0&&_(a)),l}function Ra(){var l,f;return $++,l=be(),$--,l===e&&(f=e,$===0&&_(Mo)),l}function fr(){var l,f;if(l=[],lt.test(c.charAt(d))?(f=c.charAt(d),d++):(f=e,$===0&&_(ct)),f!==e)for(;f!==e;)l.push(f),lt.test(c.charAt(d))?(f=c.charAt(d),d++):(f=e,$===0&&_(ct));else l=e;return l}function Ga(){var l,f,S;return l=d,c.charCodeAt(d)===46?(f=Lo,d++):(f=e,$===0&&_(Bo)),f!==e?(S=fr(),S!==e?(f=[f,S],l=f):(d=l,l=e)):(d=l,l=e),l}function ka(){var l,f,S,y;return l=d,Vo.test(c.charAt(d))?(f=c.charAt(d),d++):(f=e,$===0&&_(Uo)),f!==e?(jo.test(c.charAt(d))?(S=c.charAt(d),d++):(S=e,$===0&&_(Fo)),S===e&&(S=null),S!==e?(y=fr(),y!==e?(f=[f,S,y],l=f):(d=l,l=e)):(d=l,l=e)):(d=l,l=e),l}function Ma(){var l,f,S,y,O,W;return $++,l=d,f=d,S=d,y=fr(),y!==e?(O=Ga(),O===e&&(O=null),O!==e?(W=ka(),W===e&&(W=null),W!==e?(y=[y,O,W],S=y):(d=S,S=e)):(d=S,S=e)):(d=S,S=e),S!==e?f=c.substring(f,d):f=S,f!==e&&(B=l,f=Co(f)),l=f,$--,l===e&&(f=e,$===0&&_(Ho)),l}function La(){var l,f,S,y,O;if($++,l=d,c.charCodeAt(d)===35?(f=qo,d++):(f=e,$===0&&_(Xo)),f!==e){for(S=d,y=[],lt.test(c.charAt(d))?(O=c.charAt(d),d++):(O=e,$===0&&_(ct));O!==e;)y.push(O),lt.test(c.charAt(d))?(O=c.charAt(d),d++):(O=e,$===0&&_(ct));y!==e?S=c.substring(S,d):S=y,S!==e?(B=l,f=Yo(S),l=f):(d=l,l=e)}else d=l,l=e;return $--,l===e&&(f=e,$===0&&_(Ko)),l}function Ba(){var l,f,S,y,O,W;if(l=d,f=d,c.charCodeAt(d)===39?(S=ns,d++):(S=e,$===0&&_(os)),S!==e){for(y=d,O=[],as.test(c.charAt(d))?(W=c.charAt(d),d++):(W=e,$===0&&_(ls));W!==e;)O.push(W),as.test(c.charAt(d))?(W=c.charAt(d),d++):(W=e,$===0&&_(ls));O!==e?y=c.substring(y,d):y=O,y!==e?(c.charCodeAt(d)===39?(O=ns,d++):(O=e,$===0&&_(os)),O!==e?(S=[S,y,O],f=S):(d=f,f=e)):(d=f,f=e)}else d=f,f=e;if(f===e)if(f=d,c.charCodeAt(d)===34?(S=cs,d++):(S=e,$===0&&_(us)),S!==e){for(y=d,O=[],hs.test(c.charAt(d))?(W=c.charAt(d),d++):(W=e,$===0&&_(ps));W!==e;)O.push(W),hs.test(c.charAt(d))?(W=c.charAt(d),d++):(W=e,$===0&&_(ps));O!==e?y=c.substring(y,d):y=O,y!==e?(c.charCodeAt(d)===34?(O=cs,d++):(O=e,$===0&&_(us)),O!==e?(S=[S,y,O],f=S):(d=f,f=e)):(d=f,f=e)}else d=f,f=e;return f!==e&&(B=l,f=zo(f)),l=f,l}function G(){var l,f;return $++,Zo.test(c.charAt(d))?(l=c.charAt(d),d++):(l=e,$===0&&_(Qo)),$--,l===e&&(f=e,$===0&&_(Jo)),l}function Ts(){var l,f;return $++,c.charCodeAt(d)===10?(l=ta,d++):(l=e,$===0&&_(ra)),$--,l===e&&(f=e,$===0&&_(ea)),l}function ue(){var l,f;for($++,l=[],ds.test(c.charAt(d))?(f=c.charAt(d),d++):(f=e,$===0&&_(ms));f!==e;)l.push(f),ds.test(c.charAt(d))?(f=c.charAt(d),d++):(f=e,$===0&&_(ms));return $--,l===e&&(f=e,$===0&&_(sa)),l}if(ht=s(),ht!==e&&d===c.length)return ht;throw ht!==e&&d<c.length&&_(ia()),gs(dr,Oe<c.length?c.charAt(Oe):null,Oe<c.length?rt(Oe,Oe+1):rt(Oe,Oe))}var fi=vl;var Be=class extends Error{constructor(e){super(e.join(`
`));this.errors=e}format(e=`
`){return this.errors.join(e)}};function Dl(c,r){let e;try{e=fi(c)}catch(t){if(!(t instanceof Error))throw t;let s=t.location.start,i=`\u0421\u0442\u0440\u043E\u043A\u0430 ${s.line} \u0441\u0442\u043E\u043B\u0431\u0435\u0446 ${s.column}: ${t.message}`;throw new Be([i])}try{return di(e,r)}catch(t){throw t instanceof Error?new Be([t.message]):t}}function gi(c,r){let e;try{e=mi(c)}catch(t){throw t instanceof Error?new Be([t.message]):t}return Dl(e,r)}var Rr=class{constructor(r,e){this.id=r;this.attrib=0;this.description="";this.defaultValue=null;this.inEquation=!1;this.parsed=null;this.name=e.name,this.type=e.type,this.set(e)}set({attrib:r=this.attrib,defaultValue:e=this.defaultValue,description:t=this.description,inEquation:s=this.inEquation}){return this.parsed=e!==null?qt(this.type,e):null,this.attrib=r,this.defaultValue=e,this.description=t,this.inEquation=s,this}},at=class{constructor(r){this._disable=null;this._enable=null;this.orgx=null;this.orgy=null;this._hobject=null;this._objname=null;this._classname=null;this.msg=null;this.xpos=null;this.ypos=null;this.fwkeys=null;this.wvkey=null;this.repeat=null;this.scancode=null;this.nwidth=null;this.nheight=null;this._hspace=null;this._windowName=null;this.iditem=null;this.wnotifycode=null;var t;let e=r==null?void 0:r.map((s,i)=>[s.name.toUpperCase(),new Rr(i,s)]);if(this.list=(t=e==null?void 0:e.map(s=>s[1]))!=null?t:[],this.m=new Map(e),!!e)for(let[s,i]of e){let o=i.type,{FLOAT:a,STRING:h,HANDLE:u}=Y;s==="_ENABLE"&&o===a?this._enable=i:s==="_DISABLE"&&o===a?this._disable=i:s==="MSG"&&o===a?this.msg=i:s==="_HOBJECT"&&o===u?this._hobject=i:s==="IDITEM"&&o===a?this.iditem=i:s==="WNOTIFYCODE"&&o===a?this.wnotifycode=i:s==="NWIDTH"&&o===a?this.nwidth=i:s==="NHEIGHT"&&o===a?this.nheight=i:s==="XPOS"&&o===a?this.xpos=i:s==="YPOS"&&o===a?this.ypos=i:s==="FWKEYS"&&o===a?this.fwkeys=i:s==="ORGX"&&o===a?this.orgx=i:s==="ORGY"&&o===a?this.orgy=i:s==="_OBJNAME"&&o===h?this._objname=i:s==="_CLASSNAME"&&o===h?this._classname=i:s==="WVKEY"&&o===a?this.wvkey=i:s==="REPEAT"&&o===a?this.repeat=i:s==="SCANCODE"&&o===a?this.scancode=i:s==="_HSPACE"&&o===u?this._hspace=i:s==="_WINDOWNAME"&&o===h&&(this._windowName=i)}}get(r){var e;return(e=this.m.get(r.toUpperCase()))!=null?e:null}};var rr=class{constructor(r,u,a,h){this.id=r;this.file=a;this.compiler=h;this.childrenChangedCallbacks=new Set;this._transpiled=null;this.compiled=!1;this.children=[];this.connections=[];this.scene=null;this.image=null;this.modelText="";this.isFunction=!1;this.main=null;this.defers=[];this.equations=[];var g=u,{name:e,uniqid:t,vars:s,transpiled:i}=g,o=ne(g,["name","uniqid","vars","transpiled"]);this.name=e,this.vars=new at(s),this.set(o),this._transpiled=i!=null?i:null,this.uniqid=t!=null?t:0}set({vars:r,children:e=this.children,connections:t=this.connections,scene:s=this.scene,image:i=this.image,modelText:o=this.modelText,isFunction:a=this.isFunction}){return r&&(this.vars=new at(r)),this.modelText!==o&&(this.compiled=!1),this.children!==e&&(this.children=e,this.childrenChangedCallbacks.forEach(h=>h(e))),this.connections=t,this.scene=s,this.image=i,this.modelText=o,this.isFunction=a,this}compile(){if(this.compiled)return;this.compiled=!0;let r;if(this._transpiled)J.debugCompiler&&console.log(`\u041A\u043E\u043C\u043F\u0438\u043B\u044F\u0446\u0438\u044F (\u043A\u0435\u0448\u0438\u0440\u043E\u0432\u0430\u043D\u043E) ${this.name} (${this.vars.list.length} \u043F\u0435\u0440\u0435\u043C\u0435\u043D\u043D\u044B\u0445)`),r=this._transpiled,this._transpiled=null;else{let e=this.file.path.toString().slice(3);J.debugCompiler&&console.log(`\u041A\u043E\u043C\u043F\u0438\u043B\u044F\u0446\u0438\u044F '${this.name}' ('${e}'): ${this.vars.list.length} \u043F\u0435\u0440\u0435\u043C\u0435\u043D\u043D\u044B\u0445`);try{let t=this.compiler.compile(this.modelText,this.name,e);J.debugCompiler&&t.bugs.length&&console.warn(`${this.name}:
${t.bugs.map(o=>` -${o}`).join(`
`)}`);let s=this.vars,i=t.vars.map(o=>{let a=s.get(o.name);if(!a)return o;let{defaultValue:h,description:u}=a;return R(N({},o),{defaultValue:h,description:u})});this.set({vars:i,isFunction:t.isFunction}),r=t}catch(t){throw t instanceof Be?Error(`\u041E\u0448\u0438\u0431\u043A\u0430 \u043A\u043E\u043C\u043F\u0438\u043B\u044F\u0446\u0438\u0438 '${this.name}' ('${e}'): '${t.message}'`):t}}this.main=r.mainText?ei(r.mainText):null,this.defers=r.defersTexts?ti(r.defersTexts):[],this.equations=r.equationsTexts?ri(r.equationsTexts):[]}on(r,e){this.childrenChangedCallbacks.add(e)}};var sr=class{constructor(){this.files=new WeakSet;this.m=new Map}hasFile(r){return this.files.has(r)}get(r){var e;return(e=this.m.get(r.toUpperCase()))!=null?e:null}add(r){let e=r.name.toUpperCase();if(this.m.has(e))throw Error(`\u041A\u043E\u043D\u0444\u043B\u0438\u043A\u0442 \u0438\u043C\u0435\u043D \u0438\u043C\u0438\u0434\u0436\u0435\u0439: ${r.name}`);return this.m.set(e,r),this.files.add(r.file),this}unload(r){this.m.forEach(e=>e.id===r&&this.files.delete(e.file)),this.m=new Map([...this.m].filter(e=>e[1].id!==r))}};var Ze=class{constructor(){this.float=0;this.int=0;this.string=0}alloc(r){switch(r.type){case 1:return this.float++;case 3:case 4:return this.int++;case 2:return this.string++}}createMemory(r){let e=new Float64Array(this.float),t=new Int32Array(this.int),s=new Array(this.string).fill("");return{newFloats:e,oldFloats:r?e:e.slice(),newInts:t,oldInts:r?t:t.slice(),newStrings:s,oldStrings:r?s:s.slice()}}},Qe=class{constructor(r){this.v=r;this._index=-1;this.connected=new Set}propagateIndex(r){this._index>=0||(this._index=r,this.connected.forEach(e=>e.propagateIndex(r)))}allocIndex(r){return this._index<0&&this.propagateIndex(r.alloc(this.v)),this._index}};var ir=class{constructor(r){this.k=r}inject(r){let e=r.namespace;if(!e)throw Error(`\u041F\u043B\u0430\u0433\u0438\u043D '${r.name}': \u043D\u0435 \u0443\u043A\u0430\u0437\u0430\u043D\u043E namespace`);if(this[e])throw Error(`Namespace '${e}' \u0443\u0436\u0435 \u043E\u043F\u0440\u0435\u0434\u0435\u043B\u0435\u043D`);this[e]=new r(this.k)}userFunc(r,e,t){var u;let s=this.k.classes.get(e);if(!s)throw Error(`\u0424\u0443\u043D\u043A\u0446\u0438\u044F \u043D\u0435 \u0441\u0443\u0449\u0435\u0441\u0442\u0432\u0443\u0435\u0442: ${e}`);if(!s.isFunction)throw Error(`\u0418\u043C\u0438\u0434\u0436 ${e} \u0441\u0443\u0449\u0435\u0441\u0442\u0432\u0443\u0435\u0442, \u043D\u043E \u043D\u0435 \u044F\u0432\u043B\u044F\u0435\u0442\u0441\u044F \u0444\u0443\u043D\u043A\u0446\u0438\u0435\u0439`);s.compile();let i=s.vars.list;if(t.length>i.length)throw Error(`${e}: ${t.length} \u0430\u0440\u0433\u0443\u043C\u0435\u043D\u0442\u043E\u0432, \u043D\u043E \u0444\u0443\u043D\u043A\u0446\u0438\u044F \u0438\u043C\u0435\u0435\u0442 ${i.length} \u043F\u0435\u0440\u0435\u043C\u0435\u043D\u043D\u044B\u0445`);let o=new Ze,a={map:i.map(g=>new Qe(g).allocIndex(o)),memory:o.createMemory(!0)};t.forEach((g,b)=>{let w=i[b];if(!z(a,w,g))throw Error(`\u0410\u0440\u0433\u0443\u043C\u0435\u043D\u0442 ${b} \u0438\u043C\u0435\u0435\u0442 \u0442\u0438\u043F ${typeof g}; \u043E\u0436\u0438\u0434\u0430\u043B\u043E\u0441\u044C ${w.type}`)}),(u=s.main)==null||u.call(s,r,a,this);let h=i.find(g=>g.attrib&1024);if(h)return Le(a,h)}solveEquationsFor({prj:{root:r}},e){let t=r.createLinearSystem(this,e),s;try{s=Gs(t)}catch(o){s=new Array(e.length).fill(0)}let i=r.vars.memory.newFloats;e.forEach((o,a)=>i[o]=s[a])}_notImplemented(r){throw Error(`${r} \u043D\u0435 \u0440\u0435\u0430\u043B\u0438\u0437\u043E\u0432\u0430\u043D\u0430`)}};var p=1,T=2,m=3,H=4,Q=9,Pe=10;var bi=.752812499999996,yi=1.3283520132835271,Si=new Date().getTime(),Re=new Date("1998-05-12"),Gr=13.204656862745098;function nr(c,r){let e=c.toUpperCase(),t=e.includes("WS_CHILD"),s=e.includes("WS_BYSPACE"),i=e.includes("WS_POPUP"),o=e.includes("WS_NORESIZE"),a=e.includes("WS_AUTOORG"),h=e.includes("WS_SPACESIZE"),u=e.includes("WS_VSCROLL"),g=e.includes("WS_HSCROLL"),b=s?N({},r):{};return t&&(b.child=!0),g&&(b.hscroll=!0),u&&(b.vscroll=!0),h&&(b.size={type:"content"}),o&&(b.fixed=!0),i&&(b.popup=!0),a&&(b.autoorg=!0),b}var te=class{constructor(r){this.k=r;this.arrays=r.arrays}$new(){let r=ee.freeKey(this.arrays);return this.arrays.set(r,new Xe),r}$delete(r){this.arrays.delete(r)}$vGetCount(r){var e,t;return(t=(e=this.arrays.get(r))==null?void 0:e.count())!=null?t:0}$vGetType(r,e){var t,s;return(s=(t=this.arrays.get(r))==null?void 0:t.type(e))!=null?s:""}$vInsert(r,e){let t=this.arrays.get(r);if(!t)return 0;let s=e.toUpperCase();if(s==="STRING"||s==="FLOAT"||s==="HANDLE")return t.insert(s);let i=this.k.classes.get(e);if(!i)return 0;let o=i.vars.list.map(a=>[a.name,a.type]);return t.insertClass(i.name,o)}$vDelete(r,e){var t,s;return(s=(t=this.arrays.get(r))==null?void 0:t.remove(e))!=null?s:0}$vClearAll(){return this.arrays.clear(),1}$vGetS(r,e,t){var s,i;return(i=(s=this.arrays.get(r))==null?void 0:s.getString(Math.floor(e),t))!=null?i:""}$vGetH(r,e,t){var s,i;return(i=(s=this.arrays.get(r))==null?void 0:s.getHandle(Math.floor(e),t))!=null?i:0}$vGetF(r,e,t){var s,i;return(i=(s=this.arrays.get(r))==null?void 0:s.getFloat(Math.floor(e),t))!=null?i:0}$vSet(r,e,t,s){var i;(i=this.arrays.get(r))==null||i.set(e,t,s)}$vSort$1(r,...e){let t=this.arrays.get(r);return t?t.sort(e.map(s=>({desc:!1,field:s}))):0}$vSort$2(r,e,...t){let s=this.arrays.get(r);if(!s)return 0;let i=!!e;return s.sort(t.map(o=>({desc:i,field:o})))}$vSort$3(r,...e){let t=this.arrays.get(r);if(!t)return 0;let s=[];for(let i=0;i<e.length;i+=2){let o=e[i],a=!!e[i+1];s.push({desc:a,field:o})}return t.sort(s)}};te.namespace="a",te.$new={r:m},te.$delete={a:[m]},te.$vGetCount={a:[m],r:p},te.$vGetType={a:[m,p],r:T},te.$vInsert={a:[m,T],r:p},te.$vDelete={a:[m,p],r:p},te.$vClearAll={},te.$vGetS={a:[m,p,T],r:T},te.$vGetH={a:[m,p,T],r:m},te.$vGetF={a:[m,p,T],r:p},te.$vSet$F={a:[m,p,T,p]},te.$vSet$S={a:[m,p,T,T]},te.$vSet$H={a:[m,p,T,m]},te.$vSort$1={a:[m,[T]],r:p},te.$vSort$2={a:[m,p,[T]],r:p},te.$vSort$3={a:[m,[T,p]],r:p};var C=class{constructor(r){this.k=r}$getClassName(r,e){var t,s;return(s=(t=r.resolve(e))==null?void 0:t.klass.name)!=null?s:""}$getObjectCount(r){var e,t;return(t=(e=this.k.classes.get(r))==null?void 0:e.children.length)!=null?t:0}$getHObject(r){var e,t;return(t=(e=r.ndata)==null?void 0:e.key)!=null?t:0}$getHObjectByName(r,e){var t,s,i;return(i=(s=(t=r.resolve(e))==null?void 0:t.ndata)==null?void 0:s.key)!=null?i:0}$getHObjectByNum(r,e){var s;if(e<0)return 0;let t=(s=this.k.classes.get(r))==null?void 0:s.children;return t&&e<t.length?t[e].key:0}$getObjectClass(r,e){var t,s,i;return(i=(s=(t=this.k.classes.get(r))==null?void 0:t.children.find(o=>o.key===e))==null?void 0:s.klass)!=null?i:""}$getLink(r,e,t){var s,i,o;return(o=(i=(s=this.k.classes.get(r))==null?void 0:s.connections.find(({nodes:[a,h]})=>a===e&&h===t||a===t&&h===e))==null?void 0:i.key)!=null?o:0}$getModelText(r,e){var o;let t=(o=this.k.classes.get(r))==null?void 0:o.modelText;if(!t)return 0;let s=this.k.streams.get(e);if(!s)return 0;let i=oe.encode(t);return s.write(i),i.length}$setModelText(r,e){var a;let t=this.k.classes.get(r);if(!t)return 0;let s=(a=this.k.streams.get(e))==null?void 0:a.buffer();if(!s)return 0;let i=oe.decode(new Uint8Array(s)),o=t.modelText;t.set({modelText:i});try{t.compile()}catch(h){if(!(h instanceof Error))throw h;return console.warn(h.message),t.set({modelText:o}),0}return 1}$getVarS(r,e,t){var o;let s=r.resolve(e);if(!s)return"";let i=s.klass.vars.get(t);return i&&(o=zs(s.vars,i))!=null?o:""}getVarValueN(r,e,t){var o;let s=r.resolve(e);if(!s)return 0;let i=s.klass.vars.get(t);return i&&(o=Ys(s.vars,i))!=null?o:0}$getVarF(r,e,t){return this.getVarValueN(r,e,t)}$getVarH(r,e,t){return this.getVarValueN(r,e,t)}$getVarC(r,e,t){return this.getVarValueN(r,e,t)}$setVar(r,e,t,s){let i=r.resolve(e);if(!i)return;let o=i.klass.vars.get(t);o&&z(i.vars,o,s)}$getVarInfo(r,e,t,s,i,o,a,h,u,g,b,w){var P,k,E;let D=(P=this.k.classes.get(r))==null?void 0:P.vars.list;if(e<0||!D||e>=D.length)return t[s]="",i[o]="",a[h]="",u[g]="",b&&(b[w]=0),0;let v=D[e];return t[s]=v.name,i[o]=Y[v.type],a[h]=(k=v.defaultValue)!=null?k:"",u[g]=(E=v.description)!=null?E:"",b&&(b[w]=v.attrib),1}$getVarCount(r){var e,t;return(t=(e=this.k.classes.get(r))==null?void 0:e.vars.list.length)!=null?t:0}$setObjectName(r,e,t){let s=this.k.classes.get(r);if(!s)return 0;let i=s.children.findIndex(a=>a.key===e);if(i<0)return 0;let o=s.children.slice();return o[i]=R(N({},o[i]),{name:t}),s.set({children:o}),1}$getNameByHandle(r,e){var t,s,i;return(i=(s=(t=this.k.classes.get(r))==null?void 0:t.children.find(o=>o.key===e))==null?void 0:s.name)!=null?i:""}$saveObjectState(r,e,t){let s=r.resolve(e);if(!s)return 0;let i=r.prj.dir.resolve(t).file();if(!i)return 0;let o=s.getValues();return i.set({stt:o}),1}$loadObjectState(r,e,t){var o;let s=r.resolve(e);if(!s)return 0;let i=(o=r.prj.dir.resolve(t).file())==null?void 0:o.stt;return i?(s.applyValues(i),1):0}$setVarsToDefault(r,e){var t;return(t=r.resolve(e))!=null&&t.initValues(!0)?1:0}$stop(r){this.k._functionNotImplemented("Stop",r)}$quit(r){r<=0||this.k.set({projects:[]})}$closeAll({prj:r}){this.k.set({projects:this.k.projects.filter(e=>e!==r)})}};C.namespace="cl",C.$getClassName={s:!0,a:[T],r:T},C.$getObjectCount={a:[T],r:p},C.$getHObject={s:!0,r:m},C.$getHObjectByName={s:!0,a:[T],r:m},C.$getHObjectByNum={a:[T,p],r:m},C.$getObjectClass={a:[T,m],r:T},C.$getLink={a:[T,m,m],r:m},C.$getModelText={a:[T,m],r:p},C.$setModelText={a:[T,m],r:p},C.$setModelText$2={a:[T,m,p],r:p},C.$getVarS={s:!0,a:[T,T],r:T},C.$getVarF={s:!0,a:[T,T],r:p},C.$getVarH={s:!0,a:[T,T],r:m},C.$getVarC={s:!0,a:[T,T],r:H},C.$setVar$F={s:!0,a:[T,T,p]},C.$setVar$S={s:!0,a:[T,T,T]},C.$setVar$H={s:!0,a:[T,T,m]},C.$setVar$C={s:!0,a:[T,T,H]},C.$getVarInfo={a:[T,p,Pe,Pe,Pe,Pe],r:p},C.$getVarInfo$2={a:[T,p,Pe,Pe,Pe,Pe,Q],r:p},C.$getVarCount={a:[T],r:p},C.$setObjectName={a:[T,m,T],r:p},C.$getNameByHandle={a:[T,m],r:T},C.$saveObjectState={s:!0,a:[T,T],r:p},C.$loadObjectState={s:!0,a:[T,T],r:p},C.$setVarsToDefault={s:!0,a:[T],r:p},C.$stop={s:!0,a:[p]},C.$quit={a:[p]},C.$closeAll={s:!0};var We=class{constructor(r){this.k=r}$createDir({prj:r},e){return r.dir.resolve(e).create("folder")?1:0}$fileExist({prj:r},e){let t=r.dir.resolve(e);return t.file()||this.k.projectLoader.exists(t)?1:0}$getClassDirectory(r){var e,t;return(t=(e=this.k.classes.get(r))==null?void 0:e.file.path.resolve("..").toString())!=null?t:""}$getProjectDirectory({prj:r}){return r.dir.toString()}$getWindowsDirectory(){return"C:\\Windows"}$getFileList({prj:r},e){let t=r.dir.resolve(e).resolveMany();if(!t.length)return 0;let s=t.map(o=>{let a=[["NAME",{type:"STRING",value:o.name}],["SIZE",{type:"FLOAT",value:o.size}],["ATTR",{type:"FLOAT",value:0}],["YEAR",{type:"FLOAT",value:Re.getFullYear()}],["MONTH",{type:"FLOAT",value:Re.getMonth()+1}],["DAY",{type:"FLOAT",value:Re.getDate()}],["DAYOFWEEK",{type:"FLOAT",value:Re.getDay()}],["HOUR",{type:"FLOAT",value:Re.getHours()}],["MINUTE",{type:"FLOAT",value:Re.getMinutes()}],["SECOND",{type:"FLOAT",value:Re.getSeconds()}]];return{type:"STRUCT",realType:"FILE_ATTRIBUTE",value:new Map(a)}}),i=ee.freeKey(this.k.arrays);return this.k.arrays.set(i,new Xe(s)),i}$addSlash(r){return r.length===0||r[r.length-1]==="\\"?r:r+"\\"}};We.namespace="fs",We.$createDir={s:!0,a:[T],r:p},We.$fileExist={s:!0,a:[T],r:p},We.$getClassDirectory={a:[T],r:T},We.$getProjectDirectory={s:!0,r:T},We.$getWindowsDirectory={r:T},We.$getFileList={s:!0,a:[T,p],r:m},We.$addSlash={a:[T],r:T};var x=class{constructor(r){this.k=r;this.s=r.scenes}$getSpaceOrg2dx(r){var e,t;return(t=(e=this.s.get(r))==null?void 0:e.scene.x)!=null?t:0}$getSpaceOrg2dy(r){var e,t;return(t=(e=this.s.get(r))==null?void 0:e.scene.y)!=null?t:0}$setSpaceOrg2d(r,e,t){var s;return(s=this.s.get(r))!=null&&s.scene.set({x:e,y:t})?1:0}$getScaleSpace2d(r){var e,t;return(t=(e=this.s.get(r))==null?void 0:e.scene.scale)!=null?t:0}$setScaleSpace2d(r,e){var t;return(t=this.s.get(r))!=null&&t.scene.set({scale:e})?1:0}$saveRectArea2d(r,e,t,s,i,o,a){var w;let h=(w=this.s.get(r))==null?void 0:w.scene.toDataURL({x:s,y:i,w:o,h:a});if(!h)return 0;let u=e.replace("\\","/"),g=u.slice(u.lastIndexOf("/")+1,u.lastIndexOf(".")),b=document.createElement("a");return b.setAttribute("href",h.url),b.setAttribute("download",`${g||"Screenshot"}.${h.ext}`),b.style.display="none",document.body.appendChild(b),b.click(),document.body.removeChild(b),1}$getBkBrush2d(r){var e,t,s;return(s=(t=(e=this.s.get(r))==null?void 0:e.scene.background)==null?void 0:t.key)!=null?s:0}$setBkBrush2d(r,e){var s,i;let t=(s=this.s.get(r))==null?void 0:s.scene;return t!=null&&t.set({background:(i=t.brushes.get(e))!=null?i:null})?1:0}$lockSpace2d(){return 0}$getSpaceLayers2d(r){var e,t;return(t=(e=this.s.get(r))==null?void 0:e.scene.hiddenLayers)!=null?t:0}$setSpaceLayers2d(r,e){var t;return(t=this.s.get(r))!=null&&t.scene.set({hiddenLayers:e})?1:0}$setSpaceRenderEngine2d(){return 1}$createPen2d(r,e,t,s,i){var o,a;return(a=(o=this.s.get(r))==null?void 0:o.scene.pen({color:s,rop:i,style:e,width:t}).key)!=null?a:0}$getPenColor2d(r,e){var t,s,i;return(i=(s=(t=this.s.get(r))==null?void 0:t.scene.pens.get(e))==null?void 0:s.color)!=null?i:0}$getPenRop2d(r,e){var t,s,i;return(i=(s=(t=this.s.get(r))==null?void 0:t.scene.pens.get(e))==null?void 0:s.rop)!=null?i:0}$getPenStyle2d(r,e){var t,s,i;return(i=(s=(t=this.s.get(r))==null?void 0:t.scene.pens.get(e))==null?void 0:s.style)!=null?i:0}$getPenWidth2d(r,e){var t,s,i;return(i=(s=(t=this.s.get(r))==null?void 0:t.scene.pens.get(e))==null?void 0:s.width)!=null?i:0}$setPenColor2d(r,e,t){var s,i;return(i=(s=this.s.get(r))==null?void 0:s.scene.pens.get(e))!=null&&i.set({color:t})?1:0}$setPenRop2d(r,e,t){var s,i;return(i=(s=this.s.get(r))==null?void 0:s.scene.pens.get(e))!=null&&i.set({rop:t})?1:0}$setPenStyle2d(r,e,t){var s,i;return(i=(s=this.s.get(r))==null?void 0:s.scene.pens.get(e))!=null&&i.set({style:t})?1:0}$setPenWidth2d(r,e,t){var s,i;return(i=(s=this.s.get(r))==null?void 0:s.scene.pens.get(e))!=null&&i.set({width:t})?1:0}$createBrush2d(r,e,t,s,i,o){var h,u;let a=(h=this.s.get(r))==null?void 0:h.scene;return(u=a==null?void 0:a.brush({color:s,hatch:t,rop:o,style:e,image:a.imagesOpaque.get(i)}).key)!=null?u:0}$getBrushColor2d(r,e){var t,s,i;return(i=(s=(t=this.s.get(r))==null?void 0:t.scene.brushes.get(e))==null?void 0:s.color)!=null?i:0}$getBrushRop2d(r,e){var t,s,i;return(i=(s=(t=this.s.get(r))==null?void 0:t.scene.brushes.get(e))==null?void 0:s.rop)!=null?i:0}$getBrushStyle2d(r,e){var t,s,i;return(i=(s=(t=this.s.get(r))==null?void 0:t.scene.brushes.get(e))==null?void 0:s.style)!=null?i:0}$getBrushHatch2d(r,e){var t,s,i;return(i=(s=(t=this.s.get(r))==null?void 0:t.scene.brushes.get(e))==null?void 0:s.hatch)!=null?i:0}$getBrushDib2d(r,e){var t,s,i,o;return(o=(i=(s=(t=this.s.get(r))==null?void 0:t.scene.brushes.get(e))==null?void 0:s.image)==null?void 0:i.key)!=null?o:0}$setBrushColor2d(r,e,t){var s,i;return(i=(s=this.s.get(r))==null?void 0:s.scene.brushes.get(e))!=null&&i.set({color:t})?1:0}$setBrushRop2d(r,e,t){var s,i;return(i=(s=this.s.get(r))==null?void 0:s.scene.brushes.get(e))!=null&&i.set({rop:t})?1:0}$setBrushStyle2d(r,e,t){var s,i;return(i=(s=this.s.get(r))==null?void 0:s.scene.brushes.get(e))!=null&&i.set({style:t})?1:0}$setBrushHatch2d(r,e,t){var s,i;return(i=(s=this.s.get(r))==null?void 0:s.scene.brushes.get(e))!=null&&i.set({hatch:t})?1:0}$setBrushDib2d(r,e,t){var i,o,a;let s=(i=this.s.get(r))==null?void 0:i.scene;return(a=s==null?void 0:s.brushes.get(e))!=null&&a.set({image:(o=s.imagesOpaque.get(t))!=null?o:null})?1:0}createFont(r,e,t,s){var i,o;return(o=(i=this.s.get(r))==null?void 0:i.scene.font({name:e,size:t,style:s}).key)!=null?o:0}$createFont2d(r,e,t,s){return this.createFont(r,e,t,s)}$createFont2dpt(r,e,t,s){return this.createFont(r,e,t*yi,s)}$getFontName2d(r,e){var t,s,i;return(i=(s=(t=this.s.get(r))==null?void 0:t.scene.fonts.get(e))==null?void 0:s.name)!=null?i:""}$getFontSize2d(r,e){var t,s,i;return((i=(s=(t=this.s.get(r))==null?void 0:t.scene.fonts.get(e))==null?void 0:s.size)!=null?i:0)*bi}$getFontStyle2d(r,e){var t,s,i;return(i=(s=(t=this.s.get(r))==null?void 0:t.scene.fonts.get(e))==null?void 0:s.style)!=null?i:0}$setFontName2d(r,e,t){var s,i;return(i=(s=this.s.get(r))==null?void 0:s.scene.fonts.get(e))!=null&&i.set({name:t})?1:0}$setFontSize2d(r,e,t){var s,i;return(i=(s=this.s.get(r))==null?void 0:s.scene.fonts.get(e))!=null&&i.set({size:t})?1:0}$setFontStyle2d(r,e,t){var s,i;return(i=(s=this.s.get(r))==null?void 0:s.scene.fonts.get(e))!=null&&i.set({style:t})?1:0}$createString2d(r,e){var t,s;return(s=(t=this.s.get(r))==null?void 0:t.scene.string(e).key)!=null?s:0}$getString2d(r,e){var t,s,i;return(i=(s=(t=this.s.get(r))==null?void 0:t.scene.strings.get(e))==null?void 0:s.text)!=null?i:""}$setString2d(r,e,t){var s,i;return(i=(s=this.s.get(r))==null?void 0:s.scene.strings.get(e))!=null&&i.set({text:t})?1:0}$createText2d(r,e,t,s,i){var u;let o=(u=this.s.get(r))==null?void 0:u.scene;if(!o)return 0;let a=o.strings.get(t);if(!a)return 0;let h=o.fonts.get(e);return h?o.text([{string:a,font:h,fgcolor:s,bgcolor:i}]).key:0}$getTextCount2d(r,e){var t,s,i;return(i=(s=(t=this.s.get(r))==null?void 0:t.scene.texts.get(e))==null?void 0:s.parts.length)!=null?i:0}getTextPart(r,e,t){var i,o;if(t<0)return null;let s=(o=(i=this.s.get(r))==null?void 0:i.scene.texts.get(e))==null?void 0:o.parts;return s&&t<s.length?s[t]:null}$getTextFont2d(r,e,t=0){var s,i;return(i=(s=this.getTextPart(r,e,t))==null?void 0:s.font.key)!=null?i:0}$getTextString2d(r,e,t=0){var s,i;return(i=(s=this.getTextPart(r,e,t))==null?void 0:s.string.key)!=null?i:0}$getTextFgColor2d(r,e,t=0){var s,i;return(i=(s=this.getTextPart(r,e,t))==null?void 0:s.fgcolor)!=null?i:0}$getTextBkColor2d(r,e,t=0){var s,i;return(i=(s=this.getTextPart(r,e,t))==null?void 0:s.bgcolor)!=null?i:0}$setText2d(r,e,t,s,i,o){return this.$setText2d$idx(r,e,0,t,s,i,o)}$setText2d$idx(r,e,t,s,i,o,a){var b,w,D,v;if(t<0)return 0;let h=(b=this.s.get(r))==null?void 0:b.scene;if(!h)return 0;let u=(w=h.texts.get(e))==null?void 0:w.parts;if(!u||t>=u.length)return 0;let g=u[t];return g.string=(D=h.strings.get(i))!=null?D:g.string,g.font=(v=h.fonts.get(s))!=null?v:g.font,g.fgcolor=o,g.bgcolor=a,1}$setTextFont2d(r,e,t,s){var u,g;if(t<0)return 0;let i=(u=this.s.get(r))==null?void 0:u.scene;if(!i)return 0;let o=(g=i.texts.get(e))==null?void 0:g.parts;if(!o||t>=o.length)return 0;let a=o[t],h=i.fonts.get(s);return h?(a.font=h,1):0}$setTextString2d(r,e,t,s){var u,g;if(t<0)return 0;let i=(u=this.s.get(r))==null?void 0:u.scene;if(!i)return 0;let o=(g=i.texts.get(e))==null?void 0:g.parts;if(!o||t>=o.length)return 0;let a=o[t],h=i.strings.get(s);return h?(a.string=h,1):0}$setTextFgColor2d(r,e,t,s){let i=this.getTextPart(r,e,t);return i?(i.fgcolor=s,1):0}$setTextBkColor2d(r,e,t,s){let i=this.getTextPart(r,e,t);return i?(i.bgcolor=s,1):0}$addText2d(r,e,t,s,i,o){return this.$addText2d$idx(r,e,0,t,s,i,o,!0)}$addText2d$idx(r,e,t,s,i,o,a,h=!1){var P;if(t<0)return 0;let u=(P=this.s.get(r))==null?void 0:P.scene;if(!u)return 0;let g=u.texts.get(e);if(!g)return 0;let b=h?g.parts.length:t;if(b>g.parts.length)return 0;let w=u.fonts.get(s);if(!w)return 0;let D=u.strings.get(i);if(!D)return 0;let v=g.parts.slice();return v.splice(b,0,{string:D,font:w,fgcolor:o,bgcolor:a}),g.set({parts:v}),1}$removeText2d(r,e,t){var a;if(t<0)return 0;let s=(a=this.s.get(r))==null?void 0:a.scene;if(!s)return 0;let i=s.texts.get(e);if(!i||t>=i.parts.length)return 0;let o=i.parts.slice();return o.splice(t,1),i.set({parts:o}),1}createImage({prj:r},e,t,s){var a,h;let i=(a=this.s.get(e))==null?void 0:a.scene;if(!i)return 0;let o=(h=r.dir.resolve(t).file())==null?void 0:h.image;return o?i.image(o,{opaque:s}).key:0}$createDIB2d(r,e,t){return this.createImage(r,e,t,!0)}$createDoubleDIB2d(r,e,t){return this.createImage(r,e,t)}$getDibPixel2d(r,e,t,s){var i,o,a;return(a=(o=(i=this.s.get(r))==null?void 0:i.scene.imagesOpaque.get(e))==null?void 0:o.pixel(t,s))!=null?a:0}$setDibPixel2d(r,e,t,s,i){var o,a;return(a=(o=this.s.get(r))==null?void 0:o.scene.imagesOpaque.get(e))!=null&&a.setPixel(t,s,i)?1:0}$deleteTool2d(r,e,t){var o,a;let s=(o=this.s.get(r))==null?void 0:o.scene;if(!s)return 0;let i;switch(e){case 1:i=s.pens;break;case 2:i=s.brushes;break;case 4:i=s.images;break;case 3:i=s.imagesOpaque;break;case 6:i=s.strings;break;case 5:i=s.fonts;break;case 7:i=s.texts;break;case 8:throw Error("\u041D\u0435 \u0440\u0435\u0430\u043B\u0438\u0437\u043E\u0432\u0430\u043D\u043E");default:return 0}return(a=i.get(t))!=null&&a.delete()?1:0}$getNextTool2d(r,e,t){var a;let s=(a=this.s.get(r))==null?void 0:a.scene;if(!s)return 0;let i;switch(e){case 1:i=s.pens;break;case 2:i=s.brushes;break;case 4:i=s.images;break;case 3:i=s.imagesOpaque;break;case 6:i=s.strings;break;case 5:i=s.fonts;break;case 7:i=s.texts;break;case 8:throw Error("\u041D\u0435 \u0440\u0435\u0430\u043B\u0438\u0437\u043E\u0432\u0430\u043D\u043E");default:return 0}let o=1/0;for(let h of i.keys())h>t&&h<o&&(o=h);return o===1/0?0:o}$getToolRef2d(r,e,t){var o,a,h;let s=(o=this.s.get(r))==null?void 0:o.scene;if(!s)return 0;let i;switch(e){case 1:i=s.pens;break;case 2:i=s.brushes;break;case 4:i=s.images;break;case 3:i=s.imagesOpaque;break;case 6:i=s.strings;break;case 5:i=s.fonts;break;case 7:i=s.texts;break;case 8:throw Error("\u041D\u0435 \u0440\u0435\u0430\u043B\u0438\u0437\u043E\u0432\u0430\u043D\u043E");default:return 0}return(h=(a=i.get(t))==null?void 0:a.refCount)!=null?h:0}$rgb(r,e,t){return br(r,e,t)}$rgbEx(r,e,t,s){return br(r,e,t,s===1?"transparent":s===2?"syscolor":"rgb")}$rgbf(r){return r&4294967295}$getRValue(r){return Is(r)}$getGValue(r){return As(r)}$getBValue(r){return Ns(r)}$createObjectFromFile2d({prj:r},e,t,s,i,o){var u,g,b,w;let a=this.s.get(e);if(!a)return 0;let h=(g=(u=r.dir.resolve(t).file())==null?void 0:u.scene)==null?void 0:g.data;return h&&(w=(b=a.paste(h,s,i,o))==null?void 0:b.key)!=null?w:0}$deleteObject2d(r,e){var t,s;return(s=(t=this.s.get(r))==null?void 0:t.scene.objects.get(e))!=null&&s.delete()?1:0}$getObjectType2d(r,e){var s;let t=(s=this.s.get(r))==null?void 0:s.scene.objects.get(e);if(!t)return 0;switch(t.type){case"group":return 3;case"line":return 20;case"imageView":return t.opaque?21:22;case"textView":return 23;case"videoView":return 0;case"input":return 26}}$getObjectName2d(r,e){var t,s,i,o;return(o=(i=(s=(t=this.s.get(r))==null?void 0:t.scene.objects.get(e))==null?void 0:s.data)==null?void 0:i.name)!=null?o:""}$setObjectName2d(r,e,t){var i;let s=(i=this.s.get(r))==null?void 0:i.scene.objects.get(e);return s?(s.data=R(N({},s.data),{name:t}),1):0}$getObject2dByName(r,e,t){var o,a,h;if(!t)return 0;let s=(o=this.s.get(r))==null?void 0:o.scene;if(!s)return 0;let i;if(!e)i=s.objects.values();else{let u=s.objects.get(e);if((u==null?void 0:u.type)!=="group")return 0;if(((a=u.data)==null?void 0:a.name)===t)return u.key;i=u.descendants()}for(let u of i)if(((h=u.data)==null?void 0:h.name)===t)return u.key;return 0}$getObjectOrg2dx(r,e){let t=this.s.get(r);if(!t)return 0;let s=t.scene.objects.get(e);if(!s)return 0;let i=t.invmatrix;if(!i)return s.x;let o=s.x,a=s.y,h=o*i[2]+a*i[5]+i[8];return(o*i[0]+a*i[3]+i[6])/h}$getObjectOrg2dy(r,e){let t=this.s.get(r);if(!t)return 0;let s=t.scene.objects.get(e);if(!s)return 0;let i=t.invmatrix;if(!i)return s.y;let o=s.x,a=s.y,h=o*i[2]+a*i[5]+i[8];return(o*i[1]+a*i[4]+i[7])/h}$setObjectOrg2d(r,e,t,s){let i=this.s.get(r);if(!i)return 0;let o=i.scene.objects.get(e);if(!o)return 0;let a=t,h=s,u=i.matrix;if(u){let g=t*u[2]+s*u[5]+u[8];a=(t*u[0]+s*u[3]+u[6])/g,h=(t*u[1]+s*u[4]+u[7])/g}return o.set({x:a,y:h}),1}$getObjectWidth2d(r,e){var t,s,i;return(i=(s=(t=this.s.get(r))==null?void 0:t.scene.objects.get(e))==null?void 0:s.width)!=null?i:0}$getObjectHeight2d(r,e){var t,s,i;return(i=(s=(t=this.s.get(r))==null?void 0:t.scene.objects.get(e))==null?void 0:s.height)!=null?i:0}$setObjectSize2d(r,e,t,s){var i,o;return(o=(i=this.s.get(r))==null?void 0:i.scene.objects.get(e))!=null&&o.set({width:t,height:s})?1:0}$getActualWidth2d(r,e){var s;let t=(s=this.s.get(r))==null?void 0:s.scene.objects.get(e);if(!t)return 0;switch(t.type){case"group":case"line":case"input":return t.width;case"imageView":return t.image.width;case"textView":return t.text.width;case"videoView":return t.video.width}}$getActualHeight2d(r,e){var s;let t=(s=this.s.get(r))==null?void 0:s.scene.objects.get(e);if(!t)return 0;switch(t.type){case"group":case"line":case"input":return t.height;case"imageView":return t.image.height;case"textView":return t.text.height;case"videoView":return t.video.height}}$getActualSize2d(r,e,t,s,i,o){var h;let a=(h=this.s.get(r))==null?void 0:h.scene.objects.get(e);if(!a)return t[s]=0,i[o]=0,0;switch(a.type){case"group":case"line":case"input":return t[s]=a.width,i[o]=a.height,1;case"imageView":return t[s]=a.image.width,i[o]=a.image.height,1;case"textView":return t[s]=a.text.width,i[o]=a.text.height,1;case"videoView":return t[s]=a.video.width,i[o]=a.video.height,1}}$getObjectAngle2d(r,e){var s;let t=(s=this.s.get(r))==null?void 0:s.scene.objects.get(e);return t&&t.type==="textView"?t.angle:0}$rotateObject2d(r,e,t,s,i){let o=this.s.get(r);if(!o)return 0;let a=o.scene.objects.get(e);if(!a)return 0;let h=t,u=s,g=o.matrix;if(g){let b=t*g[2]+s*g[5]+g[8];h=(t*g[0]+s*g[3]+g[6])/b,u=(t*g[1]+s*g[4]+g[7])/b}return a.rotate(i,{x:h,y:u}),1}setShow(r,e,t){var o;let s=(o=this.s.get(r))==null?void 0:o.scene.objects.get(e);if(!s)return 0;let i=t?s.attrib&-2:s.attrib|1;return s.set({attrib:i}),1}$setShowObject2d(r,e,t){return this.setShow(r,e,!!t)}$showObject2d(r,e){this.setShow(r,e,!0)}$hideObject2d(r,e){this.setShow(r,e,!1)}$getObjectFromPoint2d(r,e,t){var s,i,o;return(o=(i=(s=this.s.get(r))==null?void 0:s.pick(e,t,!0))==null?void 0:i.key)!=null?o:0}$getLastPrimary2d(){return this.k.lastPickedPrimaryKey}$copyToClipboard2d(r,e){var s;let t=(s=this.s.get(r))==null?void 0:s.scene.objects.get(e);return t?(this.k.set({clipboard:Fs([t])}),1):0}$pasteFromClipboard2d(r,e,t,s){var o,a,h;let i=this.k.clipboard;return i&&(h=(a=(o=this.s.get(r))==null?void 0:o.paste(i,e,t,s))==null?void 0:a.key)!=null?h:0}$lockObject2d(r,e,t){var o;let s=(o=this.s.get(r))==null?void 0:o.scene.objects.get(e);if(!s)return 0;let i=s.attrib;switch(t){case 0:i&=-13;break;case 1:i&=-5,i|=8;break;case 2:i&=-9,i|=4;break;default:return 0}return s.set({attrib:i}),1}$getObjectAttribute2d(r,e){var t,s,i;return(i=(s=(t=this.s.get(r))==null?void 0:t.scene.objects.get(e))==null?void 0:s.attrib)!=null?i:0}$setObjectAttribute2d(r,e,t,s){var a;let i=(a=this.s.get(r))==null?void 0:a.scene.objects.get(e);if(!i)return 0;let{attrib:o}=i;switch(s){case 1:o|=t;break;case 2:o&=~t;break;case 3:o=t;break;default:return 0}return i.set({attrib:o}),1}$getNextObject2d(r,e){var i;let t=(i=this.s.get(r))==null?void 0:i.scene;if(!t)return 0;let s=1/0;for(let o of t.objects.keys())o>e&&o<s&&(s=o);return s===1/0?0:s}$isObjectsIntersect2d(r,e,t){var a;let s=(a=this.s.get(r))==null?void 0:a.scene;if(!s)return 0;let i=s.objects.get(e);if(!i)return 0;let o=s.objects.get(t);return o&&i.x+i.width>=o.x&&o.x+o.width>=i.x&&i.y+i.height>=o.y&&o.y+o.height>=i.y?1:0}$getBottomObject2d(r){var t;let e=(t=this.s.get(r))==null?void 0:t.scene.order;return e&&e.length>0?e[0].key:0}$getTopObject2d(r){var t;let e=(t=this.s.get(r))==null?void 0:t.scene.order;return e&&e.length>0?e[e.length-1].key:0}$getLowerObject2d(r,e){var a;let t=(a=this.s.get(r))==null?void 0:a.scene;if(!t)return 0;let s=t.objects.get(e);if(!s||s.type==="group")return 0;let i=t.order,o=i.indexOf(s);return o<1?0:i[o-1].key}$getUpperObject2d(r,e){var a;let t=(a=this.s.get(r))==null?void 0:a.scene;if(!t)return 0;let s=t.objects.get(e);if(!s||s.type==="group")return 0;let i=t.order,o=i.indexOf(s);return o>-1&&o<i.length-1?i[o+1].key:0}$getObjectFromZOrder2d(r,e){var i;let t=e-1;if(t<0)return 0;let s=(i=this.s.get(r))==null?void 0:i.scene.order;return s&&t<s.length?s[t].key:0}$getZOrder2d(r,e){var a;let t=(a=this.s.get(r))==null?void 0:a.scene;if(!t)return 0;let s=t.objects.get(e);if(!s||s.type==="group")return 0;let o=t.order.indexOf(s);return o<0?0:o+1}$setZOrder2d(r,e,t){var u;let s=t-1;if(s<0)return 0;let i=(u=this.s.get(r))==null?void 0:u.scene;if(!i)return 0;let o=i.objects.get(e);if(!o||o.type==="group")return 0;let a=i.order,h=[];for(let g=0;g<a.length;++g){s===g&&h.push(o);let b=a[g];b!==o&&h.push(b)}return s>=a.length&&h.push(o),i.set({order:h}),1}$objectToBottom2d(r,e){var o;let t=(o=this.s.get(r))==null?void 0:o.scene;if(!t)return 0;let s=t.objects.get(e);if(!s||s.type==="group")return 0;let i=t.order.filter(a=>a!==s);return i.unshift(s),t.set({order:i}),1}$objectToTop2d(r,e){var o;let t=(o=this.s.get(r))==null?void 0:o.scene;if(!t)return 0;let s=t.objects.get(e);if(!s||s.type==="group")return 0;let i=t.order.filter(a=>a!==s);return i.push(s),t.set({order:i}),1}$swapObject2d(r,e,t){var b;let s=(b=this.s.get(r))==null?void 0:b.scene;if(!s)return 0;let i=s.objects.get(e);if(!i||i.type==="group")return 0;let o=s.objects.get(t);if(!o||o.type==="group")return 0;let a=s.order.slice(),h=a.indexOf(i);if(h<0)return 0;let u=a.indexOf(o);if(u<0)return 0;let g=a[h];return a[h]=a[u],a[u]=g,s.set({order:a}),1}createLine(r,e,t,s){let i=this.s.get(r);if(!i)return 0;let{matrix:o,scene:a}=i;if(o)for(let u=0;u<s.length;u+=2){let g=s[u+0],b=s[u+1],w=g*o[2]+b*o[5]+o[8];s[u+0]=(g*o[0]+b*o[3]+o[6])/w,s[u+1]=(g*o[1]+b*o[4]+o[7])/w}let h=a.line(s,{pen:a.pens.get(e),brush:a.brushes.get(t)});return a.set({order:a.order.concat(h)}),h.key}$createPolyLine2d(r,e,t,...s){return this.createLine(r,e,t,s)}$createLine2d(r,e,t,s,i){return this.createLine(r,e,t,[s,i])}$addPoint2d(r,e,t,s,i){let o=this.s.get(r);if(!o)return 0;let a=o.scene.objects.get(e);if((a==null?void 0:a.type)!=="line")return 0;let h=s,u=i,g=o.matrix;if(g){let b=s*g[2]+i*g[5]+g[8];h=(s*g[0]+i*g[3]+g[6])/b,u=(s*g[1]+i*g[4]+g[7])/b}return a.addPoint({x:h,y:u},t)?1:0}$setVectorPoint2d(r,e,t,s,i){let o=this.s.get(r);if(!o)return 0;let a=o.scene.objects.get(e);if((a==null?void 0:a.type)!=="line")return 0;let h=s,u=i,g=o.matrix;if(g){let b=s*g[2]+i*g[5]+g[8];h=(s*g[0]+i*g[3]+g[6])/b,u=(s*g[1]+i*g[4]+g[7])/b}return a.setPoint(t,{x:h,y:u})?1:0}$delPoint2d(r,e,t){var i;let s=(i=this.s.get(r))==null?void 0:i.scene.objects.get(e);return(s==null?void 0:s.type)==="line"&&s.delPoint(t)?1:0}$getPenObject2d(r,e){var s,i;let t=(s=this.s.get(r))==null?void 0:s.scene.objects.get(e);return(t==null?void 0:t.type)==="line"&&((i=t.pen)==null?void 0:i.key)||0}$getBrushObject2d(r,e){var s,i;let t=(s=this.s.get(r))==null?void 0:s.scene.objects.get(e);return(t==null?void 0:t.type)==="line"&&((i=t.brush)==null?void 0:i.key)||0}$getVectorNumPoints2d(r,e){var s;let t=(s=this.s.get(r))==null?void 0:s.scene.objects.get(e);return(t==null?void 0:t.type)==="line"?t.length:0}$getVectorPoint2dx(r,e,t){let s=this.s.get(r);if(!s)return 0;let i=s.scene.objects.get(e),o=(i==null?void 0:i.type)==="line"&&i.point(t);if(!o)return 0;let{x:a,y:h}=o,u=s.invmatrix;if(!u)return a;let g=a*u[2]+h*u[5]+u[8];return(a*u[0]+h*u[3]+u[6])/g}$getVectorPoint2dy(r,e,t){let s=this.s.get(r);if(!s)return 0;let i=s.scene.objects.get(e),o=(i==null?void 0:i.type)==="line"&&i.point(t);if(!o)return 0;let{x:a,y:h}=o,u=s.invmatrix;if(!u)return h;let g=a*u[2]+h*u[5]+u[8];return(a*u[1]+h*u[4]+u[7])/g}$setBrushObject2d(r,e,t){var o,a;let s=(o=this.s.get(r))==null?void 0:o.scene;if(!s)return 0;let i=s.objects.get(e);return(i==null?void 0:i.type)==="line"&&i.set({brush:(a=s.brushes.get(t))!=null?a:null})?1:0}$setPenObject2d(r,e,t){var o,a;let s=(o=this.s.get(r))==null?void 0:o.scene;if(!s)return 0;let i=s.objects.get(e);return(i==null?void 0:i.type)==="line"&&i.set({pen:(a=s.pens.get(t))!=null?a:null})?1:0}$setLineArrows2d(r,e,t,s,i,o,a,h){var w;let u=(w=this.s.get(r))==null?void 0:w.scene.objects.get(e);if((u==null?void 0:u.type)!=="line")return 0;let g={angle:t,length:s,fill:!!i},b={angle:o,length:a,fill:!!h};return u.set({start:g,end:b}),1}$createGroup2d(r,...e){var o;let t=(o=this.s.get(r))==null?void 0:o.scene;if(!t)return 0;let s=!0,i=e.map(a=>{let h=t.objects.get(a);return(!h||h.parent)&&(s=!1),h});return s?t.group(i).key:0}$deleteGroup2d(r,e){var s;let t=(s=this.s.get(r))==null?void 0:s.scene.objects.get(e);return(t==null?void 0:t.type)==="group"&&t.set({children:[]}).delete()?1:0}$addGroupItem2d(r,e,t){var a;if(e===t)return 0;let s=(a=this.s.get(r))==null?void 0:a.scene;if(!s)return 0;let i=s.objects.get(e);if((i==null?void 0:i.type)!=="group")return 0;let o=s.objects.get(t);if(!o||o.parent)return 0;if(o.type==="group"){let h=i;for(;h=h.parent;)if(h===o)return 0}return i.set({children:i.children.concat(o)}),1}$delGroupItem2d(r,e,t){var a;let s=(a=this.s.get(r))==null?void 0:a.scene;if(!s)return 0;let i=s.objects.get(e);if((i==null?void 0:i.type)!=="group")return 0;let o=s.objects.get(t);return(o==null?void 0:o.parent)!==i?0:(i.set({children:i.children.filter(h=>h!==o)}),1)}$getGroupItemsNum2d(r,e){var s;let t=(s=this.s.get(r))==null?void 0:s.scene.objects.get(e);return(t==null?void 0:t.type)==="group"?t.children.length:0}$getGroupItem2d(r,e,t){var o;if(t<0)return 0;let s=(o=this.s.get(r))==null?void 0:o.scene.objects.get(e);if((s==null?void 0:s.type)!=="group")return 0;let i=s.children;return t<i.length?i[t].key:0}$getObjectParent2d(r,e){var t,s,i,o;return(o=(i=(s=(t=this.s.get(r))==null?void 0:t.scene.objects.get(e))==null?void 0:s.parent)==null?void 0:i.key)!=null?o:0}$isGroupContainObject2d(r,e,t){var o;let s=(o=this.s.get(r))==null?void 0:o.scene;if(!s)return 0;let i=s.objects.get(e);if((i==null?void 0:i.type)!=="group")return 0;for(let a=0;a<i.children.length;++a){let h=i.children[a];if(h.key===t)return a+1;if(h.type==="group"){for(let u of h.descendants())if(u.key===t)return a+1}}return 0}createImageView(r,e,t,s,i){let o=this.s.get(r);if(!o)return 0;let a=o.scene,h=(i?a.imagesOpaque:a.images).get(e);if(!h)return 0;let u=t,g=s,b=o.matrix;if(b){let D=t*b[2]+s*b[5]+b[8];u=(t*b[0]+s*b[3]+b[6])/D,g=(t*b[1]+s*b[4]+b[7])/D}let w=a.imageView(h,{x:u,y:g,opaque:i});return a.set({order:a.order.concat(w)}),w.key}$createBitmap2d(r,e,t,s){return this.createImageView(r,e,t,s,!0)}$createDoubleBitmap2d(r,e,t,s){return this.createImageView(r,e,t,s)}$getBitmapSrcRect2d(r,e,t,s,i,o,a,h,u,g){var D,v,P,k,E;let b=(D=this.s.get(r))==null?void 0:D.scene.objects.get(e);if((b==null?void 0:b.type)!=="imageView")return t[s]=0,i[o]=0,a[h]=0,u[g]=0,0;let w=b.area;return t[s]=(v=w==null?void 0:w.x)!=null?v:0,i[o]=(P=w==null?void 0:w.y)!=null?P:0,a[h]=(k=w==null?void 0:w.w)!=null?k:b.image.width,u[g]=(E=w==null?void 0:w.h)!=null?E:b.image.height,1}$setBitmapSrcRect2d(r,e,t,s,i,o){var h;let a=(h=this.s.get(r))==null?void 0:h.scene.objects.get(e);return(a==null?void 0:a.type)==="imageView"&&a.set({area:{x:t,y:s,w:i,h:o}})?1:0}$getDibObject2d(r,e){var s;let t=(s=this.s.get(r))==null?void 0:s.scene.objects.get(e);return(t==null?void 0:t.type)==="imageView"&&t.opaque&&t.image.key||0}$getDDibObject2d(r,e){var s;let t=(s=this.s.get(r))==null?void 0:s.scene.objects.get(e);return(t==null?void 0:t.type)==="imageView"&&!t.opaque&&t.image.key||0}$setDibObject2d(r,e,t){var a;let s=(a=this.s.get(r))==null?void 0:a.scene;if(!s)return 0;let i=s.imagesOpaque.get(t);if(!i)return 0;let o=s.objects.get(e);return(o==null?void 0:o.type)==="imageView"&&o.opaque&&o.set({image:i})?1:0}$setDDibObject2d(r,e,t){var a;let s=(a=this.s.get(r))==null?void 0:a.scene;if(!s)return 0;let i=s.images.get(t);if(!i)return 0;let o=s.objects.get(e);return(o==null?void 0:o.type)==="imageView"&&!o.opaque&&o.set({image:i})?1:0}$createRasterText2d(r,e,t,s,i){let o=this.s.get(r);if(!o)return 0;let a=o.scene,h=a.texts.get(e);if(!h)return 0;let u=t,g=s,b=o.matrix;if(b){let D=t*b[2]+s*b[5]+b[8];u=(t*b[0]+s*b[3]+b[6])/D,g=(t*b[1]+s*b[4]+b[7])/D}let w=a.textView(h,{x:u,y:g,angle:i});return a.set({order:a.order.concat(w)}),w.key}$getTextObject2d(r,e){var s;let t=(s=this.s.get(r))==null?void 0:s.scene.objects.get(e);return(t==null?void 0:t.type)==="textView"&&t.text.key||0}};x.namespace="g",x.$getSpaceOrg2dx={a:[m],r:p},x.$getSpaceOrg2dy={a:[m],r:p},x.$setSpaceOrg2d={a:[m,p,p],r:p},x.$getScaleSpace2d={a:[m],r:p},x.$setScaleSpace2d={a:[m,p],r:p},x.$saveRectArea2d={a:[m,T,p,p,p,p,p],r:p},x.$getBkBrush2d={a:[m],r:m},x.$setBkBrush2d={a:[m,m],r:p},x.$lockSpace2d={a:[m,p],r:p},x.$getSpaceLayers2d={a:[m],r:p},x.$setSpaceLayers2d={a:[m,p],r:p},x.$setSpaceRenderEngine2d={a:[m,p],r:p},x.$createPen2d={a:[m,p,p,H,p],r:m},x.$getPenColor2d={a:[m,m],r:H},x.$getPenRop2d={a:[m,m],r:p},x.$getPenStyle2d={a:[m,m],r:p},x.$getPenWidth2d={a:[m,m],r:p},x.$setPenColor2d={a:[m,m,H],r:p},x.$setPenRop2d={a:[m,m,p],r:p},x.$setPenStyle2d={a:[m,m,p],r:p},x.$setPenWidth2d={a:[m,m,p],r:p},x.$createBrush2d={a:[m,p,p,H,m,p],r:m},x.$getBrushColor2d={a:[m,m],r:H},x.$getBrushRop2d={a:[m,m],r:p},x.$getBrushStyle2d={a:[m,m],r:p},x.$getBrushHatch2d={a:[m,m],r:p},x.$getBrushDib2d={a:[m,m],r:m},x.$setBrushColor2d={a:[m,m,H],r:p},x.$setBrushRop2d={a:[m,m,p],r:p},x.$setBrushStyle2d={a:[m,m,p],r:p},x.$setBrushHatch2d={a:[m,m,p],r:p},x.$setBrushDib2d={a:[m,m,m],r:p},x.$createFont2d={a:[m,T,p,p],r:m},x.$createFont2dpt={a:[m,T,p,p],r:m},x.$getFontName2d={a:[m,m],r:T},x.$getFontSize2d={a:[m,m],r:p},x.$getFontStyle2d={a:[m,m],r:p},x.$setFontName2d={a:[m,m,T],r:p},x.$setFontSize2d={a:[m,m,p],r:p},x.$setFontStyle2d={a:[m,m,p],r:p},x.$createString2d={a:[m,T],r:m},x.$getString2d={a:[m,m],r:T},x.$setString2d={a:[m,m,T],r:p},x.$createText2d={a:[m,m,m,H,H],r:m},x.$getTextCount2d={a:[m,m],r:p},x.$getTextFont2d={a:[m,m],r:m},x.$getTextFont2d$2={a:[m,m,p],r:m},x.$getTextString2d={a:[m,m],r:m},x.$getTextString2d$2={a:[m,m,p],r:m},x.$getTextFgColor2d={a:[m,m],r:H},x.$getTextFgColor2d$2={a:[m,m,p],r:H},x.$getTextBkColor2d={a:[m,m],r:H},x.$getTextBkColor2d$2={a:[m,m,p],r:H},x.$setText2d={a:[m,m,m,m,H,H],r:p},x.$setText2d$idx={a:[m,m,p,m,m,H,H],r:p},x.$setTextFont2d={a:[m,m,p,m],r:p},x.$setTextString2d={a:[m,m,p,m],r:p},x.$setTextFgColor2d={a:[m,m,p,H],r:p},x.$setTextBkColor2d={a:[m,m,p,H],r:p},x.$addText2d={a:[m,m,m,m,H,H],r:p},x.$addText2d$idx={a:[m,m,p,m,m,H,H],r:p},x.$removeText2d={a:[m,m,p],r:p},x.$createDIB2d={s:!0,a:[m,T],r:m},x.$createDoubleDIB2d={s:!0,a:[m,T],r:m},x.$getDibPixel2d={a:[m,m,p,p],r:H},x.$setDibPixel2d={a:[m,m,p,p,H],r:p},x.$deleteTool2d={a:[m,p,m],r:p},x.$getNextTool2d={a:[m,p,m],r:m},x.$getToolRef2d={a:[m,p,m],r:p},x.$rgb={a:[p,p,p],r:H},x.$rgbEx={a:[p,p,p,p],r:H},x.$rgbf={a:[p],r:H},x.$getRValue={a:[H],r:p},x.$getGValue={a:[H],r:p},x.$getBValue={a:[H],r:p},x.$createObjectFromFile2d={s:!0,a:[m,T,p,p,p],r:m},x.$deleteObject2d={a:[m,m],r:p},x.$getObjectType2d={a:[m,m],r:p},x.$getObjectName2d={a:[m,m],r:T},x.$setObjectName2d={a:[m,m,T],r:p},x.$getObject2dByName={a:[m,m,T],r:m},x.$getObjectOrg2dx={a:[m,m],r:p},x.$getObjectOrg2dy={a:[m,m],r:p},x.$setObjectOrg2d={a:[m,m,p,p],r:p},x.$getObjectWidth2d={a:[m,m],r:p},x.$getObjectHeight2d={a:[m,m],r:p},x.$setObjectSize2d={a:[m,m,p,p],r:p},x.$getActualWidth2d={a:[m,m],r:p},x.$getActualHeight2d={a:[m,m],r:p},x.$getActualSize2d={a:[m,m,Q,Q],r:p},x.$getObjectAngle2d={a:[m,m],r:p},x.$rotateObject2d={a:[m,m,p,p,p],r:p},x.$setShowObject2d={a:[m,m,p],r:p},x.$showObject2d={a:[m,m]},x.$hideObject2d={a:[m,m]},x.$getObjectFromPoint2d={a:[m,p,p],r:m},x.$getLastPrimary2d={r:m},x.$copyToClipboard2d={a:[m,m],r:p},x.$pasteFromClipboard2d={a:[m,p,p,p],r:m},x.$lockObject2d={a:[m,m,p],r:p},x.$getObjectAttribute2d={a:[m,m],r:p},x.$setObjectAttribute2d={a:[m,m,p,p],r:p},x.$getNextObject2d={a:[m,m],r:m},x.$isObjectsIntersect2d={a:[m,m,m,p],r:p},x.$getBottomObject2d={a:[m],r:m},x.$getTopObject2d={a:[m],r:m},x.$getLowerObject2d={a:[m,m],r:m},x.$getUpperObject2d={a:[m,m],r:m},x.$getObjectFromZOrder2d={a:[m,p],r:m},x.$getZOrder2d={a:[m,m],r:p},x.$setZOrder2d={a:[m,m,p],r:p},x.$objectToBottom2d={a:[m,m],r:p},x.$objectToTop2d={a:[m,m],r:p},x.$swapObject2d={a:[m,m,m],r:p},x.$createPolyLine2d={a:[m,m,m,[p,p]],r:m},x.$createLine2d={a:[m,m,m,p,p],r:m},x.$addPoint2d={a:[m,m,p,p,p],r:p},x.$setVectorPoint2d={a:[m,m,p,p,p],r:p},x.$delPoint2d={a:[m,m,p],r:p},x.$getPenObject2d={a:[m,m],r:m},x.$getBrushObject2d={a:[m,m],r:m},x.$getVectorNumPoints2d={a:[m,m],r:p},x.$getVectorPoint2dx={a:[m,m,p],r:p},x.$getVectorPoint2dy={a:[m,m,p],r:p},x.$setBrushObject2d={a:[m,m,m],r:m},x.$setPenObject2d={a:[m,m,m],r:m},x.$setLineArrows2d={a:[m,m,p,p,p,p,p,p],r:p},x.$createGroup2d={a:[m,[m]],r:m},x.$deleteGroup2d={a:[m,m],r:p},x.$addGroupItem2d={a:[m,m,m],r:p},x.$delGroupItem2d={a:[m,m,m],r:p},x.$getGroupItemsNum2d={a:[m,m],r:p},x.$getGroupItem2d={a:[m,m,p],r:m},x.$getObjectParent2d={a:[m,m],r:m},x.$isGroupContainObject2d={a:[m,m,m],r:p},x.$createBitmap2d={a:[m,m,p,p],r:m},x.$createDoubleBitmap2d={a:[m,m,p,p],r:m},x.$getBitmapSrcRect2d={a:[m,m,Q,Q,Q,Q],r:p},x.$setBitmapSrcRect2d={a:[m,m,p,p,p,p],r:p},x.$getDibObject2d={a:[m,m],r:m},x.$getDDibObject2d={a:[m,m],r:m},x.$setDibObject2d={a:[m,m,m],r:p},x.$setDDibObject2d={a:[m,m,m],r:p},x.$createRasterText2d={a:[m,m,p,p,p],r:m},x.$getTextObject2d={a:[m,m],r:m};var we=class{constructor(r){this.k=r;this.s=r.scenes}$createControlObject2d(r,e,t,s,i,o,a,h){let u;switch(e.toUpperCase()){case"EDIT":u="Edit";break;case"BUTTON":u="Button";break;case"COMBOBOX":u="ComboBox";break;case"LISTBOX":u="ListBox";break;default:return 0}let g=this.s.get(r);if(!g)return 0;let b=g.scene,w=i,D=o,v=g.matrix;if(v){let k=i*v[2]+o*v[5]+v[8];w=(i*v[0]+o*v[3]+v[6])/k,D=(i*v[1]+o*v[4]+v[7])/k}let P=b.input(u,{x:w,y:D,width:a,height:h,value:t,style:s});return b.set({order:b.order.concat(P)}),P.key}$getControlText2d(r,e,t,s){var a;let i=(a=this.s.get(r))==null?void 0:a.scene.objects.get(e);if((i==null?void 0:i.type)!=="input")return"";let{value:o}=i;return typeof t=="undefined"?o:o.slice(t,t+s)}$setControlText2d(r,e,t){var i;let s=(i=this.s.get(r))==null?void 0:i.scene.objects.get(e);return(s==null?void 0:s.type)==="input"&&s.set({value:t})?1:0}$setControlFont2d(r,e,t){var o,a;let s=(o=this.s.get(r))==null?void 0:o.scene;if(!s)return 0;let i=s.objects.get(e);return(i==null?void 0:i.type)==="input"&&i.set({font:(a=s.fonts.get(t))!=null?a:null})?1:0}$enableControl2d(){return this.k._functionNotImplemented("EnableControl2d"),0}$isDlgButtonChecked2d(){return this.k._functionNotImplemented("IsDlgButtonChecked"),0}$checkDlgButton2d(){return this.k._functionNotImplemented("CheckDlgButton2d"),1}};we.namespace="c",we.$createControlObject2d={a:[m,T,T,p,p,p,p,p,p],r:m},we.$getControlText2d={a:[m,m],r:T},we.$getControlText2d$2={a:[m,m,p,p],r:T},we.$setControlText2d={a:[m,m,T],r:p},we.$setControlFont2d={a:[m,m,m],r:p},we.$enableControl2d={a:[m,m,p],r:p},we.$isDlgButtonChecked2d={a:[m,m],r:p},we.$checkDlgButton2d={a:[m,m,p],r:p};var re=class{constructor(r){this.k=r;this.matrices=r.matrices}$mCreate(r,e,t,s,i,o){if(o<=0)return 0;let a=Math.floor(t)-Math.floor(e)+1,h=Math.floor(i)-Math.floor(s)+1;if(a<=0||h<=0)return 0;let u=r||ee.freeNegativeKey(this.matrices);return this.matrices.set(u,new ge({rows:a,cols:h,minV:e,minH:s})),u}$mDelete(r,e){return e<=0?0:this.matrices.delete(r)?1:0}$mFill(r,e,t){var s,i;return t<=0?0:(i=(s=this.matrices.get(r))==null?void 0:s.fill(e))!=null?i:0}$mGet(r,e,t,s){var i,o;return s<=0?0:(o=(i=this.matrices.get(r))==null?void 0:i.get(e,t))!=null?o:0}$mPut(r,e,t,s,i){var o,a;return i<=0?0:(a=(o=this.matrices.get(r))==null?void 0:o.set(e,t,s))!=null?a:0}$mEditor(r,e){if(e<=0)return 0;throw Error("MEditor: \u0440\u0435\u0434\u0430\u043A\u0442\u043E\u0440 \u043C\u0430\u0442\u0440\u0438\u0446 \u043D\u0435 \u0440\u0435\u0430\u043B\u0438\u0437\u043E\u0432\u0430\u043D")}$mDiag(r,e,t){var s,i;return t<=0?0:(i=(s=this.matrices.get(r))==null?void 0:s.diag(e))!=null?i:0}$mDet(r,e){if(e<=0)return 0;let t=this.matrices.get(r);return!t||!t.isSquare()?0:t.det()}$mSum(r,e){var t,s;return e<=0?0:(s=(t=this.matrices.get(r))==null?void 0:t.sum())!=null?s:0}$mMul(r,e,t,s){if(s<=0)return 0;let i=this.matrices.get(r),o=this.matrices.get(e);if(!i||!o)return 0;let a=ge.mul(i,o);if(!a)return 0;let h=t||ee.freeNegativeKey(this.matrices);return this.matrices.set(h,a),h}$mGlue(r,e,t,s,i,o){if(o<=0)return 0;let a=this.matrices.get(r),h=this.matrices.get(e);if(!a||!h)return 0;let u=t||ee.freeNegativeKey(this.matrices);return this.matrices.set(u,ge.glue(a,h,Math.floor(s),Math.floor(i))),u}$mObr(r,e,t){if(t<=0)return 0;let s=this.matrices.get(r);if(!s)return 0;let i=s.obr();if(!i)return 0;let o=e||ee.freeNegativeKey(this.matrices);return this.matrices.set(o,i),o}$mSaveAs({prj:r},e,t,s){if(s<=0)return 0;let i=this.matrices.get(e);if(!i)return 0;let o=r.dir.resolve(t).create("file");return o?(o.set({mat:i.data()}),1):0}$mLoad({prj:r},e,t,s){var a;if(s<=0)return 0;let i=(a=r.dir.resolve(t).file())==null?void 0:a.mat;if(!i)return 0;let o=e||ee.freeNegativeKey(this.matrices);return this.matrices.set(o,new ge(i)),o}$mSort(r,e,t,s){if(s<=0)return 0;let i=this.matrices.get(r);if(!i)return 0;switch(t){case 1:return i.sortByColumn(e,!1);case 2:return i.sortByColumn(e,!0);case 3:return i.sortByRow(e,!1);case 4:return i.sortByRow(e,!0);default:return 0}}};re.namespace="m",re.$mCreate={a:[p,p,p,p,p,p],r:p},re.$mDelete={a:[p,p],r:p},re.$mFill={a:[p,p,p],r:p},re.$mGet={a:[p,p,p,p],r:p},re.$mPut={a:[p,p,p,p,p],r:p},re.$mEditor={a:[p,p]},re.$mDiag={a:[p,p,p],r:p},re.$mDet={a:[p,p],r:p},re.$mSum={a:[p,p],r:p},re.$mMul={a:[p,p,p,p],r:p},re.$mGlue={a:[p,p,p,p,p,p],r:p},re.$mObr={a:[p,p,p],r:p},re.$mSaveAs={s:!0,a:[p,T,p],r:p},re.$mLoad={s:!0,a:[p,T,p],r:p},re.$mSort={a:[p,p,p,p],r:p};var Ee=class{constructor(r){this.k=r;this.lvl=0}$registerObject(r,e,t,s,i,o){let a=typeof e=="number"?this.k.scenes.get(e):this.k.windows.get(e);if(!a)return;let h=r.resolve(s);h!=null&&h.klass.vars.msg&&a.subscribe(h,i,t,o)}$unregisterObject(r,e,t,s){let i=typeof e=="number"?this.k.scenes.get(e):this.k.windows.get(e);if(!i)return;let o=r.resolve(t);o!=null&&o.klass.vars.msg&&i.unsubscribe(o,s)}$setCapture(r,e,t){let s=this.k.scenes.get(e);if(!s)return;let i=r.resolve(t);i!=null&&i.klass.vars.msg&&s.setCapture(i)}$releaseCapture(){this.k.releaseCapture()}$sendMessage(r,e,t,...s){if(this.lvl>58)return;let i=null;if(t&&(i=this.k.classes.get(t),!i))return;/[\*\?]/.test(e)&&this.k._functionNotImplemented("SendMessage \u0441 path \u0441\u043E\u0434\u0435\u0440\u0436\u0430\u0449\u0438\u043C '*'/'?'",r);let o=r.resolveMany(e,i);if(!o.length)return;let a=new Array(s.length),h=r.klass.vars,u=o[0].klass.vars;for(let g=0;g<s.length;g+=2){let b=h.get(s[g+0]);if(!b)continue;let w=u.get(s[g+1]);w&&(a[g+0]=b,a[g+1]=w)}o.forEach(g=>{if(g!==r){for(let b=0;b<a.length;b+=2){let w=a[b+0];if(!w)continue;let D=a[b+1];z(g.vars,D,Le(r.vars,w))}++this.lvl,g.computeSchema(this.k.ctx),--this.lvl;{let{map:b,memory:{newFloats:w,oldFloats:D,newInts:v,oldInts:P,newStrings:k,oldStrings:E}}=g.vars;for(let A=0;A<b.length;++A){let U=b[A];D[U]=w[U],P[U]=v[U],E[U]=k[U]}}for(let b=0;b<a.length;b+=2){let w=a[b+0];if(!w)continue;let D=a[b+1];Js(r.vars,w,Le(g.vars,D))}}})}};Ee.namespace="msg",Ee.$registerObject={s:!0,a:[m,m,T,p,p]},Ee.$registerObject$2={s:!0,a:[T,m,T,p,p]},Ee.$unregisterObject={s:!0,a:[m,T,p]},Ee.$unregisterObject$2={s:!0,a:[T,T,p]},Ee.$setCapture={s:!0,a:[m,T,p]},Ee.$releaseCapture={},Ee.$sendMessage={s:!0,a:[T,T,[T,T]]};var me=class{constructor(r){this.k=r}$ascii(r){if(!r)return 0;let e=oe.table.indexOf(r[0]);return e<0?0:e}$chr(r){return r<0||r>255?"":oe.table[r]}$messageBox(){return this.k._functionNotImplemented("MessageBox"),1}$inc(r,e,t=1){r[e]+=t}$dec(r,e,t=1){r[e]-=t}$randomize(){}$floatToString(r){return r.toString()}$convertToAscii(r){return r<0||r>255?"":oe.table[r]}};me.namespace="misc",me.$ascii={a:[T],r:p},me.$chr={a:[p],r:T},me.$messageBox={a:[T,T,p],r:p},me.$inc={a:[Q]},me.$inc$2={a:[Q,p]},me.$dec={a:[Q]},me.$dec$2={a:[Q,p]},me.$randomize={a:[p]},me.$floatToString={a:[p],r:T},me.$convertToAscii={a:[p,p],r:T};var pe=class{constructor(r){this.k=r;this.s=r.scenes}$openVideo({prj:r},e){var s;let t=(s=r.dir.resolve(e).file())==null?void 0:s.video;return t?(this.k.videos.set(ee.freeKey(this.k.videos),t),1):0}$createVideoFrame2d(r,e,t,s,i,o){let a=this.k.videos.get(e);if(!a)return 0;let h=this.s.get(r);if(!h)return 0;let u=h.scene,g=t,b=s,w=h.matrix;if(w){let P=t*w[2]+s*w[5]+w[8];g=(t*w[0]+s*w[3]+w[6])/P,b=(t*w[1]+s*w[4]+w[7])/P}let D=i>=0||o>=0,v=u.video(a.src,{x:g,y:b,width:Math.max(0,i),height:Math.max(0,o),fixed:D});return u.set({order:u.order.concat(v)}),v.key}$frameGetPos2d(r,e){var s;let t=(s=this.s.get(r))==null?void 0:s.scene.objects.get(e);return(t==null?void 0:t.type)==="videoView"?t.position*Gr:0}$frameSetPos2d(r,e,t){var i;let s=(i=this.s.get(r))==null?void 0:i.scene.objects.get(e);return(s==null?void 0:s.type)==="videoView"&&s.set({position:t/Gr})?1:0}$videoPlay2d(r,e){var s;let t=(s=this.s.get(r))==null?void 0:s.scene.objects.get(e);return(t==null?void 0:t.type)==="videoView"&&t.set({state:"play"})?1:0}$videoPause2d(r,e){var s;let t=(s=this.s.get(r))==null?void 0:s.scene.objects.get(e);return(t==null?void 0:t.type)==="videoView"&&t.set({state:"pause"})?1:0}$videoResume2d(r,e){var s;let t=(s=this.s.get(r))==null?void 0:s.scene.objects.get(e);return(t==null?void 0:t.type)==="videoView"&&t.set({state:"play"})?1:0}$videoStop2d(r,e){var s;let t=(s=this.s.get(r))==null?void 0:s.scene.objects.get(e);return(t==null?void 0:t.type)==="videoView"&&t.set({state:"stop"})?1:0}$mciSendString(){return 263}$mciSendStringStr(){return""}$sndPlaySound(){return 0}};pe.namespace="media",pe.$openVideo={s:!0,a:[T,p],r:m},pe.$createVideoFrame2d={a:[m,m,p,p,p,p,p],r:m},pe.$frameGetPos2d={a:[m,m],r:p},pe.$frameSetPos2d={a:[m,m,p],r:p},pe.$videoPlay2d={a:[m,m,p,p,p,p],r:p},pe.$videoPause2d={a:[m,m],r:p},pe.$videoResume2d={a:[m,m],r:p},pe.$videoStop2d={a:[m,m],r:p},pe.$mciSendString={a:[T],r:p},pe.$mciSendStringStr={a:[T],r:T},pe.$sndPlaySound={a:[T,p],r:p};var le=class{constructor(r){this.k=r;this.streams=r.streams}$createStream({prj:r},e,t,s){let i=e.toUpperCase(),o=s.toUpperCase(),a=o.includes("CREATE"),h=o.includes("READONLY"),u=ee.freeKey(this.streams);if(i==="FILE"){let g=r.dir.resolve(t),b,w;if(a){if(!(b=g.create("file")))return 0;b.set({base64:w=""})}else if(!(b=g.file())||(w=b.base64)===null)return 0;return this.streams.set(u,new Ge(w,h?null:b)),u}return i==="MEMORY"?(this.streams.set(u,new Ge),u):(console.warn(`\u041F\u043E\u0442\u043E\u043A \u0442\u0438\u043F\u0430 ${i} \u043D\u0435 \u043F\u043E\u0434\u0434\u0435\u0440\u0436\u0438\u0432\u0430\u0435\u0442\u0441\u044F`),0)}$closeStream(r){let e=this.streams.get(r);if(!e)return 0;if(this.streams.delete(r),!e.file)return 1;let t=new Uint8Array(e.buffer());return e.file.set({base64:vs(t)}),this.k.handleWrite(e.file,t),1}$seek(r,e){var t,s;return(s=(t=this.streams.get(r))==null?void 0:t.seek(e))!=null?s:0}$eof(r){var e,t;return(t=(e=this.streams.get(r))==null?void 0:e.eof())!=null?t:0}$getPos(r){var e,t;return(t=(e=this.streams.get(r))==null?void 0:e.pos())!=null?t:0}$getSize(r){var e,t;return(t=(e=this.streams.get(r))==null?void 0:e.size())!=null?t:0}$setWidth(r,e){var t,s;return(s=(t=this.streams.get(r))==null?void 0:t.setWidth(e))!=null?s:0}$read(r){var e,t;return(t=(e=this.streams.get(r))==null?void 0:e.widthNumber())!=null?t:0}$readLn(r){var e,t;return(t=(e=this.streams.get(r))==null?void 0:e.line())!=null?t:""}$write(r,e){var t,s;return(s=(t=this.streams.get(r))==null?void 0:t.writeWidthNumber(e))!=null?s:0}$writeLn(r,e){var t,s;return(s=(t=this.streams.get(r))==null?void 0:t.writeLine(e))!=null?s:0}$getLine(r,e,t){var s,i;return(i=(s=this.streams.get(r))==null?void 0:s.getLine(e,t))!=null?i:""}$copyBlock(r,e,t,s){let i=this.streams.get(r);if(!i)return 0;let o=this.streams.get(e);return o?i.copyTo(o,t,s):0}};le.namespace="s",le.$createStream={s:!0,a:[T,T,T],r:m},le.$closeStream={a:[m],r:p},le.$seek={a:[m,p],r:p},le.$eof={a:[m],r:p},le.$getPos={a:[m],r:p},le.$getSize={a:[m],r:p},le.$setWidth={a:[m,p],r:p},le.$read={a:[m],r:p},le.$readLn={a:[m],r:T},le.$write={a:[m,p],r:p},le.$writeLn={a:[m,T],r:p},le.$getLine={a:[m,p,T],r:T},le.$copyBlock={a:[m,m,p,p],r:p};var X=class{constructor(r){this.k=r}$system(){return this.k._functionNotImplemented("System"),0}$getAsyncKeyState(r){return Xs(r)?1:0}$getMousePos(r,e,t,s,i){let o=this.k.windows.get(r);if(!o)return e[t]=0,s[i]=0,0;let{x:a,y:h}=o.scene.mouse(),u=o.invmatrix;if(!u)return e[t]=a,s[i]=h,1;let g=a*u[2]+h*u[5]+u[8];return e[t]=(a*u[0]+h*u[3]+u[6])/g,s[i]=(a*u[1]+h*u[4]+u[7])/g,1}$showCursor(r){this.k.showCursor(r>0)}$loadCursor({prj:r},e,t){var o;let s=typeof e=="number"?this.k.scenes.get(e):this.k.windows.get(e);if(!s)return;let i=(o=r.dir.resolve(t).file())==null?void 0:o.cursor;s.setCursor(i?`url(${Ke(i.src)}), auto`:"default")}$getTickCount(){return new Date().getTime()-Si}$getTime(r,e,t,s,i,o,a,h){let u=new Date;r[e]=u.getHours(),t[s]=u.getMinutes(),i[o]=u.getSeconds(),a[h]=u.getMilliseconds()*.1}$getDate(r,e,t,s,i,o){let a=new Date;r[e]=a.getFullYear(),t[s]=a.getMonth()+1,i[o]=a.getDate()}$setHyperJump2d(r,e,t,...[s,i,o,a,h]){var b;if(t<-1||t>4)return 0;let u=(b=this.k.scenes.get(r))==null?void 0:b.scene.objects.get(e);if(!u)return 0;let g=t===-1?null:{mode:t,target:s,object:i,effect:o,window:a,params:h};return u.data=R(N({},u.data),{hyper:g}),1}$stdHyperJump(r,e,t,s){var a,h,u;let i=this.k.scenes.get(r);if(!i)return;let o=(u=(h=(a=i.scene.objects.get(s))!=null?a:i.pick(e,t))==null?void 0:h.data)==null?void 0:u.hyper;o&&i.hyperClick(o,{x:e,y:t})}$getScreenWidth(){return this.k.screenWidth}$getScreenHeight(){return this.k.screenHeight}$getWorkAreaX(){return 0}$getWorkAreaY(){return 0}$getWorkAreaWidth(){return this.k.screenWidth}$getWorkAreaHeight(){return this.k.screenHeight}$getTitleHeight(){return 0}$getSmallTitleHeight(){return 0}$getFixedFrameWidth(){return 0}$getFixedFrameHeight(){return 0}$getSizeFrameWidth(){return 0}$getSizeFrameHeight(){return 0}$winExecute(r,e){return this.k.handleExe(r,e)?1:0}$shell(r,e,t,s){return this.k.handleShell(r,e,t,s)?1:0}$logMessage(r,e){this.k.log(e,r)}};X.namespace="sys",X.$system={a:[p,[p]],r:p},X.$getAsyncKeyState={a:[p],r:p},X.$getMousePos={a:[T,Q,Q],r:p},X.$showCursor={a:[p]},X.$loadCursor={s:!0,a:[m,T]},X.$loadCursor$2={s:!0,a:[T,T]},X.$getTickCount={r:p},X.$getTime={a:[Q,Q,Q,Q]},X.$getDate={a:[Q,Q,Q]},X.$setHyperJump2d={a:[m,m,p,[T]],r:p},X.$stdHyperJump={a:[m,p,p,m,p]},X.$getScreenWidth={r:p},X.$getScreenHeight={r:p},X.$getWorkAreaX={r:p},X.$getWorkAreaY={r:p},X.$getWorkAreaWidth={r:p},X.$getWorkAreaHeight={r:p},X.$getTitleHeight={r:p},X.$getSmallTitleHeight={r:p},X.$getFixedFrameWidth={r:p},X.$getFixedFrameHeight={r:p},X.$getSizeFrameWidth={r:p},X.$getSizeFrameHeight={r:p},X.$winExecute={a:[T,p],r:p},X.$shell={a:[T,T,T,p],r:p},X.$logMessage={s:!0,a:[T]};var F=class{constructor(r){this.k=r;this.w=r.windows}$createWindowEx({prj:r},e,t,s,i,o,a,h,u){var A;let g=this.w.get(e);if(g)return g.key;let b=null,w=null,D=null;if(s){let U=this.k.classes.get(s),q=U==null?void 0:U.scene;if(q)b=q,w={type:"classname",data:U.name},D=U.children;else{let ce=r.dir.resolve(s),Te=(A=ce.file())==null?void 0:A.scene;Te&&(b=Te,w={type:"filename",data:ce.toString()})}}let v=nr(u,b==null?void 0:b.options);!v.size&&a&&h&&(v.size={type:"fixed",width:a,height:h});let P={coords:{x:i,y:o},wname:e,data:R(N({},b),{options:v}),prj:r,source:w},k=v.child&&this.w.get(t),E=k?k.subwindow(P):this.k.window(P);return D&&ot(E.scene,D,this.k.classes),E.key}$getClientWidth(r){var e,t;return(t=(e=this.w.get(r))==null?void 0:e.window.clientWidth)!=null?t:0}$getClientHeight(r){var e,t;return(t=(e=this.w.get(r))==null?void 0:e.window.clientHeight)!=null?t:0}$getWindowName(r){var e,t;return(t=(e=this.k.scenes.get(r))==null?void 0:e.name)!=null?t:""}$getWindowOrgX(r){var e,t;return(t=(e=this.w.get(r))==null?void 0:e.window.x)!=null?t:0}$getWindowOrgY(r){var e,t;return(t=(e=this.w.get(r))==null?void 0:e.window.y)!=null?t:0}$getWindowSpace(r){var e,t;return(t=(e=this.w.get(r))==null?void 0:e.key)!=null?t:0}$getWindowWidth(r){var e,t;return(t=(e=this.w.get(r))==null?void 0:e.window.width)!=null?t:0}$getWindowHeight(r){var e,t;return(t=(e=this.w.get(r))==null?void 0:e.window.height)!=null?t:0}$getWindowTitle(r){var e,t;return(t=(e=this.w.get(r))==null?void 0:e.window.title)!=null?t:""}$setClientSize(r,e,t){var s;return(s=this.w.get(r))!=null&&s.window.set({clientWidth:e,clientHeight:t})?1:0}$setScrollRange(){return this.k._functionNotImplemented("SetScrollRange"),1}$setWindowOrg(r,e,t){var s;return(s=this.w.get(r))!=null&&s.window.set({x:e,y:t})?1:0}$setWindowPos(r,e,t,s,i){var o;return(o=this.w.get(r))!=null&&o.window.set({x:e,y:t,width:s,height:i})?1:0}$setWindowSize(r,e,t){var s;return(s=this.w.get(r))!=null&&s.window.set({width:e,height:t})?1:0}$setWindowTitle(r,e){var t;return(t=this.w.get(r))!=null&&t.window.set({title:e})?1:0}$setWindowTransparent(){return this.k._functionNotImplemented("SetWindowTransparent"),1}$setWindowTransparentColor(){return this.k._functionNotImplemented("SetWindowTransparentColor"),1}$setWindowRegion(){return this.k._functionNotImplemented("SetWindowRegion"),1}$setWindowOwner(){return this.k._functionNotImplemented("SetWindowOwner"),1}$showWindow(r,e){var s;let t=(s=this.w.get(r))==null?void 0:s.window;if(!t)return 0;switch(e){case 0:t.set({visible:!1});break;case 5:case 1:t.set({visible:!0});break}return 1}$bringWindowToTop(){return this.k._functionNotImplemented("BringWindowToTop"),1}$closeWindow(r){var e;return(e=this.w.get(r))!=null&&e.remove()?1:0}$isIconic(){return 0}$isWindowExist(r){return this.w.has(r)?1:0}$isWindowVisible(r){var e;return(e=this.w.get(r))!=null&&e.window.visible?1:0}$loadSpaceWindow({prj:r},e,t,s){var g,b;let i=this.w.get(e);if(i)return i.key;let o=r.dir.resolve(t),a=(b=(g=o.file())==null?void 0:g.scene)!=null?b:null,h=nr(s,a==null?void 0:a.options);return this.k.window({wname:e,data:R(N({},a),{options:h}),prj:r,source:a?{type:"filename",data:o.toString()}:null}).key}$openSchemeWindow({prj:r},e,t,s){let i=this.w.get(e);if(i)return i.key;let o=this.k.classes.get(t),a=o==null?void 0:o.scene,h=nr(s,a==null?void 0:a.options),u=this.k.window({wname:e,data:R(N({},a),{options:h}),prj:r,source:o?{type:"classname",data:o.name}:null});return a&&ot(u.scene,o.children,this.k.classes),u.key}$openClassScheme(){return this.k._functionNotImplemented("OpenClassScheme"),1}$closeClassScheme(){return this.k._functionNotImplemented("CloseClassScheme"),1}$cascadeWindows(){}$tile(){}$arrangeIcons(){}$getWindowProp(r,e){var s;let t=(s=this.w.get(r))==null?void 0:s.source;return t&&t.type===e.toLowerCase()&&t.data||""}};F.namespace="w",F.$createWindowEx={s:!0,a:[T,T,T,p,p,p,p,T],r:m},F.$getClientWidth={a:[T],r:p},F.$getClientHeight={a:[T],r:p},F.$getWindowName={a:[m],r:T},F.$getWindowOrgX={a:[T],r:p},F.$getWindowOrgY={a:[T],r:p},F.$getWindowSpace={a:[T],r:m},F.$getWindowWidth={a:[T],r:p},F.$getWindowHeight={a:[T],r:p},F.$getWindowTitle={a:[T],r:T},F.$setClientSize={a:[T,p,p],r:p},F.$setScrollRange={a:[T,p,p,p],r:p},F.$setWindowOrg={a:[T,p,p],r:p},F.$setWindowPos={a:[T,p,p,p,p],r:p},F.$setWindowSize={a:[T,p,p],r:p},F.$setWindowTitle={a:[T,T],r:p},F.$setWindowTransparent={a:[T,p],r:p},F.$setWindowTransparent$2={a:[m,p],r:p},F.$setWindowTransparentColor={a:[T,H],r:p},F.$setWindowTransparentColor$2={a:[m,H],r:p},F.$setWindowRegion={a:[T,m],r:p},F.$setWindowRegion$2={a:[m,m],r:p},F.$setWindowOwner={a:[m,m],r:p},F.$showWindow={a:[T,p],r:p},F.$bringWindowToTop={a:[T],r:p},F.$closeWindow={a:[T],r:p},F.$isIconic={a:[T],r:p},F.$isWindowExist={a:[T],r:p},F.$isWindowVisible={a:[T],r:p},F.$loadSpaceWindow={s:!0,a:[T,T,T],r:m},F.$openSchemeWindow={s:!0,a:[T,T,T],r:m},F.$openClassScheme={a:[T,p],r:m},F.$closeClassScheme={a:[T],r:p},F.$cascadeWindows={},F.$tile={a:[p]},F.$arrangeIcons={},F.$getWindowProp={a:[T,T],r:T};var wi=[re,te,X,We,le,C,x,F,Ee,we,pe,me];function _l(c,r){let{children:e}=c;r.forEach(({nodes:[t,s],vars:i,attrib:o=0})=>{if(o&1)return;let a=`\u0418\u043C\u0438\u0434\u0436 ${c.klass.name}: \u0441\u0432\u044F\u0437\u044C #${t}-#${s}: `,h=t>0?e.find(g=>g.ndata.key===t):c;if(!h){console.warn(a+`\u0414\u043E\u0447\u0435\u0440\u043D\u0438\u0439 \u0438\u043C\u0438\u0434\u0436 #${t} \u043D\u0435 \u0441\u0443\u0449\u0435\u0441\u0442\u0432\u0443\u0435\u0442`);return}let u=s>0?e.find(g=>g.ndata.key===s):c;if(!u){console.warn(a+`\u0414\u043E\u0447\u0435\u0440\u043D\u0438\u0439 \u0438\u043C\u0438\u0434\u0436 #${s} \u043D\u0435 \u0441\u0443\u0449\u0435\u0441\u0442\u0432\u0443\u0435\u0442`);return}a=`\u0418\u043C\u0438\u0434\u0436 ${c.klass.name}: \u0441\u0432\u044F\u0437\u044C #${t} (${h.klass.name}) - #${s} (${u.klass.name}): `,i.forEach(([g,b])=>{let w=h.klass.vars.get(g);if(!w){console.warn(a+`\u041F\u0435\u0440\u0435\u043C\u0435\u043D\u043D\u0430\u044F ${h.klass.name}:${g} \u043D\u0435 \u0441\u0443\u0449\u0435\u0441\u0442\u0432\u0443\u0435\u0442`);return}let D=u.klass.vars.get(b);if(!D){console.warn(a+`\u041F\u0435\u0440\u0435\u043C\u0435\u043D\u043D\u0430\u044F ${u.klass.name}:${b} \u043D\u0435 \u0441\u0443\u0449\u0435\u0441\u0442\u0432\u0443\u0435\u0442`);return}if(w.type!==D.type){console.warn(a+`\u0422\u0438\u043F\u044B \u043F\u0435\u0440\u0435\u043C\u0435\u043D\u043D\u044B\u0445 ${h.klass.name}:${g} \u0438 ${u.klass.name}:${b} \u043D\u0435 \u0441\u043E\u0432\u043F\u0430\u0434\u0430\u044E\u0442`);return}let v=h.vars[w.id],P=u.vars[D.id];v.connected.add(P),P.connected.add(v)})})}function kr(c,r,e=null){var o;c.compile();let t=(o=c.vars.list.map(a=>new Qe(a)))!=null?o:[],s=c.children.map(a=>{let h=r.get(a.klass);if(!h)throw Error(`\u041F\u043E\u0434\u0438\u043C\u0438\u0434\u0436 ${a.klass} #${a.key} \u0438\u043C\u0438\u0434\u0436\u0430 ${c.name} \u043D\u0435 \u0441\u0443\u0449\u0435\u0441\u0442\u0432\u0443\u0435\u0442`);return kr(h,r,a)}),i={klass:c,ndata:e,vars:t,children:s};return c.connections&&_l(i,c.connections),i}function Mr(c,r,e){let t=c.vars.map(i=>i.allocIndex(r));c.klass.vars.list.forEach(i=>i.inEquation&&e.add(t[i.id]));let s=c.children.map(i=>Mr(i,r,e));return R(N({},c),{map:t,children:s})}function Lr(c,r,e){let t=c.children.map(s=>Lr(s,r,e));return r.schema(R(N({},c),{vars:{map:c.map,memory:e},children:t}))}function Ti(c,r,{a:e,b:t},s,i){let{oldFloats:o,newFloats:a}=s.vars.memory,h=!1,u=c(s,s.vars,i),g=r.map(b=>{a[b]=o[b]=1;let w=u-c(s,s.vars,i);return a[b]=o[b]=0,w&&(h=!0),w});h&&(e.push(g),t.push(u))}function Wi(c,r,e){return c[r[e]]>0}function Ei(c,r,e){return c[r[e]]<=0}function $i(){return!1}var Ie=class extends Error{constructor(e,t){super(e);this.original=t}};var or=class{constructor(r,{klass:e,ndata:t,vars:s,children:i}){this.prj=r;this.isDisabled=$i;this.klass=e,this.ndata=t,this.vars=s,this.children=i;let{_disable:o,_enable:a}=e.vars;o&&(!a||o.id<a.id)?this.isDisabled=Wi.bind(null,this.vars.memory.newFloats,this.vars.map,o.id):a&&(!o||a.id<o.id)&&(this.isDisabled=Ei.bind(null,this.vars.memory.newFloats,this.vars.map,a.id)),this.resolveMap=new Map([["",this]]),i.forEach(h=>{h.resolveMap.set("..",this);let{key:u,name:g}=h.ndata;this.resolveMap.set("#"+u,h),g&&this.resolveMap.set(g.toUpperCase(),h)}),e.on("childrenChanged",this.updateChildNodeData.bind(this))}updateChildNodeData(r){r.length===this.children.length&&r.forEach((e,t)=>{let s=this.children[t],i=s.ndata;i.key!==e.key||i.klass!==e.klass||(i.name&&this.resolveMap.delete(i.name),e.name&&this.resolveMap.set(e.name.toUpperCase(),s),s.ndata=e)})}resolve(r){if(r.length===0)return this;let e=r.toUpperCase().split("\\"),t=r[0]==="\\"?this.prj.root:this;for(let s of e){let i=t.resolveMap.get(s);if(!i)return null;t=i}return t}resolveMany(r,e){if(r){let t=this.resolve(r);return!t||e&&t.klass!==e?[]:[t]}return e?this.prj.classSchemas(e):[]}initValues(r){this.children.forEach(t=>t.initValues());let{vars:e}=this.klass;return e.list.forEach(t=>{var i,o,a,h,u,g,b,w;let s;if(t.parsed!==null)s=t.parsed;else switch(t){case e.orgx:s=(o=(i=this.ndata)==null?void 0:i.x)!=null?o:0;break;case e.orgy:s=(h=(a=this.ndata)==null?void 0:a.y)!=null?h:0;break;case e._hobject:s=(g=(u=this.ndata)==null?void 0:u.key)!=null?g:0;break;case e._objname:s=(w=(b=this.ndata)==null?void 0:b.name)!=null?w:"";break;case e._classname:s=this.klass.name;break;default:if(!r)return;s=t.type===2?"":0;break}z(this.vars,t,s)}),this}applyValues({values:r,klass:e,klassID:t,children:s}){let i=this.klass.uniqid;if(!i&&e.toUpperCase()===this.klass.name.toUpperCase()||i===t){let{vars:o}=this.klass;r==null||r.forEach(({name:a,value:h})=>{let u=o.get(a);u&&z(this.vars,u,qt(u.type,h))})}return s==null||s.forEach(o=>{var a;return(a=this.children.find(h=>h.ndata.key===o.key))==null?void 0:a.applyValues(o)}),this}getValues(){var o;let{klass:r,vars:e,ndata:t}=this,s=this.children.map(a=>a.getValues()),i=r.vars.list.map(a=>{let h=Ks(a.type,Le(e,a));return{name:a.name,value:h}});return{key:(o=t==null?void 0:t.key)!=null?o:0,klass:r.name,klassID:r.uniqid,values:i,children:s}}computeEquationVectors(r,e,t){this.children.forEach(s=>s.computeEquationVectors(r,e,t)),this.klass.equations.forEach(s=>Ti(s,r,e,this,t))}computeSchemaDefers(r){this.children.forEach(e=>!e.isDisabled()&&e.computeSchemaDefers(r)),this.klass.defers.forEach(e=>e(this,this.vars,r))}computeSchema(r){var e,t;this.children.forEach(s=>!s.isDisabled()&&s.computeSchema(r)),J.debugExecution&&console.log(`\u0412\u044B\u043F\u043E\u043B\u043D\u044F\u0435\u0442\u0441\u044F ${this.path()}`);try{(t=(e=this.klass).main)==null||t.call(e,this,this.vars,r)}catch(s){throw s instanceof Error?new Ie(`${this.path()}: ${s.message}`,s):s}return this}compute(r,e){if(!e&&this.isDisabled())return this;this.computeSchema(r);let t=this.prj.equationVars;t.length>0&&r.solveEquationsFor(this,t),this.computeSchemaDefers(r);let{newFloats:s,oldFloats:i,newInts:o,oldInts:a,newStrings:h,oldStrings:u}=this.vars.memory;i.set(s),a.set(o);for(let g=0;g<h.length;++g)u[g]=h[g];return this}createLinearSystem(r,e){let{oldFloats:t,newFloats:s}=this.vars.memory,i=e.map(a=>{let h=t[a];return s[a]=t[a]=0,h}),o={a:[],b:[]};return this.computeEquationVectors(e,o,r),e.forEach((a,h)=>t[a]=i[h]),o}path(){if(this===this.prj.root)return this.klass.name;let r=[this];for(;;){let e=r[0].resolveMap.get("..");if(e===this.prj.root)break;r.unshift(e)}return r.map(e=>`${e.klass.name} (#${e.ndata.key})`).join(" - ")}};var ar=class{constructor({id:r,dir:e,klass:t,state:s},i){this.classTypes=new WeakMap;this.id=r,this.dir=e;let o=kr(t,i),a=new Ze,h=new Set,u=Mr(o,a,h);this.equationVars=[...h];let g=a.createMemory();this.root=Lr(u,this,g).initValues(),s&&this.root.applyValues(s)}schema(r){let e=new or(this,r),t=this.classTypes.get(e.klass);return t?t.push(e):this.classTypes.set(e.klass,[e]),e}classSchemas(r){var e;return(e=this.classTypes.get(r))!=null?e:[]}};var lr=class{constructor(){this.m=new Map}loadPlugin(r){let e=r.namespace;if(!e)throw Error(`\u041F\u043B\u0430\u0433\u0438\u043D '${r.name}': \u043D\u0435 \u0443\u043A\u0430\u0437\u0430\u043D\u043E namespace`);Object.keys(r).forEach(t=>{var g,b;if(!t.startsWith("$"))return;let s=r[t];if(typeof s!="object")return;let i=t.split("$")[1],o;if(typeof(r.prototype[o=t]||r.prototype[o="$"+i])!="function")throw Error(`\u041F\u043B\u0430\u0433\u0438\u043D '${r.name}': \u043D\u0435\u0442 \u043E\u043F\u0440\u0435\u0434\u0435\u043B\u0435\u043D\u0438\u044F '${i}' ('${t}')`);let h=i.toUpperCase(),u=this.m.get(h);(u==null?void 0:u.type)!=="method"&&this.m.set(h,u={type:"method",overloads:[]}),u.overloads.push({argTypes:(g=s.a)!=null?g:[],retType:(b=s.r)!=null?b:null,path:`${e}.${o}`,passState:!!s.s})})}addUserFunc(r){let e=r.name.toUpperCase();this.m.has(e)||this.m.set(e,r)}removeUserFunc(r){let e=r.toUpperCase(),t=this.m.get(e);(t==null?void 0:t.type)==="user"&&this.m.delete(e)}compile(r,e,t){return gi(r,{funcTable:this.m,sourceURL:e,comment:t})}};var cr=class{constructor({projectLoader:r,swgBackend:e,windowFactory:t}){this.handlers={closed:new Set,error:new Set,shell:new Set,write:new Set};this.prevProjects=[];this.classes=new sr;this.scenes=new Map;this.windows=new Map;this.arrays=new Map;this.matrices=new Map;this.streams=new Map;this.videos=new Map;this.cursorVisible=!0;this.captureTarget=null;this.lastPickedPrimaryKey=0;this.clipboard=null;this.projects=[];this.openedPopups=new Set;this.showed=new Set;this.projectLoader=r,this.swgBackend=e,this.windowFactory=t,this.screenWidth=t.screenWidth,this.screenHeight=t.screenHeight;let s=this.ctx=new ir(this),i=this.compiler=new lr;wi.forEach(o=>{i.loadPlugin(o),s.inject(o)})}project({filepath:r,searchDirs:e,nonRecursive:t,rootClass:s,matrices:i,dir:o,stt:a},h){J.debugProject&&console.log(`\u041E\u0442\u043A\u0440\u044B\u0432\u0430\u0435\u0442\u0441\u044F ${r}`);let u=Symbol(r.toString()),g;try{e.forEach(w=>{let D=!t||w===this.projectLoader.stdlibDir;w.forEach(v=>{if(!v.cls||this.classes.hasFile(v))return;let P=new rr(u,v.cls,v,this.compiler);P.isFunction&&this.compiler.addUserFunc(qs(P)),this.classes.add(P)},D)});let b=this.classes.get(s);if(!b)throw Error(`${r}: \u041A\u043E\u0440\u043D\u0435\u0432\u043E\u0439 \u0438\u043C\u0438\u0434\u0436 ${s} \u043D\u0435 \u0441\u0443\u0449\u0435\u0441\u0442\u0432\u0443\u0435\u0442.`);g=new ar({id:u,filepath:r,dir:o,klass:b,state:a},this.classes)}catch(b){throw this.classes.unload(u),b}return i==null||i.forEach(([b,w])=>!this.matrices.has(b)&&this.matrices.set(b,new ge(w))),h||this.set({projects:this.projects.concat(g)}),g}compute(){if(this.prevProjects!==this.projects){let e=this.prevProjects.filter(t=>!this.projects.includes(t));this.prevProjects=this.projects,e.forEach(t=>{J.debugProject&&console.log(`\u0417\u0430\u043A\u0440\u044B\u0432\u0430\u0435\u0442\u0441\u044F ${t.id.description}`),this.classes.unload(t.id),this.closeProjectWindows(t),this.restorePrevProjectWindows(t)})}if(!this.projects.length)return this.clearAll(),!1;let r=this.projects[this.projects.length-1];try{r.root.compute(this.ctx)}catch(e){throw e instanceof Ie?new Ie(`\u041F\u0440\u043E\u0435\u043A\u0442 ${r.id.description}, ${e.message}`,e.original):e}return!0}set({projects:r=this.projects,clipboard:e=this.clipboard}){return this.projects=r,this.clipboard=e,this}window({data:{data:r,matrix:e,options:t},prj:s,wname:i,coords:o,source:a}){let h=Ft(this.swgBackend,r),u=R(N({},o),{title:i,popup:t==null?void 0:t.popup}),g=t==null?void 0:t.size,b=(g==null?void 0:g.type)==="content"||!g&&u.popup;if(t!=null&&t.autoorg||b){let P=Ct(h.objects);t!=null&&t.autoorg&&h.set({x:P.x,y:P.y}),b&&(u.width=P.w,u.height=P.h)}(g==null?void 0:g.type)==="fixed"&&(u.width=g.width,u.height=g.height);let w=this.windowFactory.window(h.view,u),D=ee.freeKey(this.scenes),v=new ze(this,{key:D,name:i,prj:s,scene:h,window:w,matrix:e,source:a});return t!=null&&t.popup&&this.openedPopups.add(v),this.scenes.set(D,v),this.windows.set(i,v),v}releaseCapture(){var r;(r=this.captureTarget)==null||r.w.scene.stopCapturingMouseEvents(),this.captureTarget=null}showCursor(r){this.cursorVisible=r,this.windows.forEach(e=>e.updateCursor())}log(r,e){J.logMessage&&console.info(e?`${e.path()}: ${r}`:r)}handleExe(r,e){let t=r.lastIndexOf(".exe"),s=t<0?r:r.substring(0,t);return this.handlers.shell.forEach(i=>i(s,"","",e!=null?e:0)),!0}handleShell(r,e,t,s){return this.handlers.shell.forEach(i=>i(r,e,t,s)),!0}handleWrite(r,e){this.handlers.write.forEach(t=>t(r.path.toString(),e))}closeWindows(r){this.scenes.forEach(e=>{var i;if(!r.has(e))return;e===((i=this.captureTarget)==null?void 0:i.w)&&(this.captureTarget=null);let{key:t,name:s}=e;setTimeout(()=>{let o=1539;e.spaceDoneSubs.forEach(a=>{let{msg:h,_hspace:u,_windowName:g}=a.klass.vars;z(a.vars,h,o),u&&z(a.vars,u,t),g&&z(a.vars,g,s),a.compute(this.ctx,!0)})}),e.scene.dispose(),e.window.close(),this.scenes.delete(e.key),this.windows.delete(e.name),this.openedPopups.delete(e)})}closePopups(r){let e=new Set;this.openedPopups.forEach(t=>{t!==r&&t.all.forEach(s=>e.add(s))}),this.closeWindows(e)}hideProjectWindows(r,e){this.windows.forEach(t=>{t.prj===r&&(t.window.set({visible:!1}),t.hiddenBy=e)})}clearAll(){this.prevProjects=[],this.scenes.clear(),this.windows.clear(),this.arrays.clear(),this.matrices.clear(),this.streams.clear(),this.cursorVisible=!0,this.lastPickedPrimaryKey=0}closeProjectWindows(r){let e=new Set([...this.windows.values()].filter(t=>t.prj===r));this.closeWindows(e)}restorePrevProjectWindows(r){this.windows.forEach(e=>{e.hiddenBy===r&&(e.window.set({visible:!0}),e.hiddenBy=null)})}_functionNotImplemented(r,e){if(this.showed.size===this.showed.add(r.toUpperCase()).size)return;let t=`${r} \u043D\u0435 \u0440\u0435\u0430\u043B\u0438\u0437\u043E\u0432\u0430\u043D\u0430`;console.warn(e?`${e.path()}: ${t}`:t)}};var Ve=class{constructor(r,e){this.file=e;if(r){let t=Ds(r);this.v=new DataView(t.buffer)}else this.v=new DataView(new ArrayBuffer(0));this.p=0,this.width=8}static widthToSize(r){return r<0||r>9?0:Ve.widthTable[r]}copyTo(r,e,t){return e<0||e+t>this.v.byteLength?0:(r.v.byteLength<t?r.v=new DataView(this.v.buffer.slice(e,t)):new Uint8Array(r.v.buffer).set(new Uint8Array(this.v.buffer,e,t)),1)}seek(r){return this.p=r}eof(){return this.p>=this.size()?1:0}pos(){return this.p}size(){return this.v.byteLength}setWidth(r){return this.width=r,1}widthNumber(){let r=Ve.widthToSize(this.width);if(r===0)return 0;let e=this.p,t=e+r;if(t>this.size())return 0;switch(this.p=t,this.width){case 0:return this.v.getUint8(e);case 1:return this.v.getInt8(e);case 2:return this.v.getUint16(e,!0);case 3:return this.v.getInt16(e,!0);case 4:return this.v.getUint32(e,!0);case 5:return this.v.getInt32(e,!0);case 6:return this.v.getFloat32(e,!0);case 7:throw Error("\u0427\u0442\u0435\u043D\u0438\u0435 FLOAT40 \u043D\u0435 \u043F\u043E\u0434\u0434\u0435\u0440\u0436\u0438\u0432\u0430\u0435\u0442\u0441\u044F");case 8:return this.v.getFloat64(e,!0);case 9:throw Error("\u0427\u0442\u0435\u043D\u0438\u0435 FLOAT80 \u043D\u0435 \u043F\u043E\u0434\u0434\u0435\u0440\u0436\u0438\u0432\u0430\u0435\u0442\u0441\u044F");default:return 0}}resize(r){let e=new Uint8Array(new ArrayBuffer(r));e.set(new Uint8Array(this.v.buffer)),this.v=new DataView(e.buffer)}writeWidthNumber(r){let e=Ve.widthToSize(this.width);if(e===0)return 0;let t=this.p,s=t+e;switch(s>this.size()&&this.resize(s),this.p=s,this.width){case 0:return this.v.setUint8(t,r),1;case 1:return this.v.setInt8(t,r),1;case 2:return this.v.setUint16(t,r,!0),2;case 3:return this.v.setInt16(t,r,!0),2;case 4:return this.v.setUint32(t,r,!0),4;case 5:return this.v.setInt32(t,r,!0),4;case 6:return this.v.setFloat32(t,r,!0),4;case 7:throw Error("FLOAT40 \u043D\u0435 \u043F\u043E\u0434\u0434\u0435\u0440\u0436\u0438\u0432\u0430\u0435\u0442\u0441\u044F");case 8:return this.v.setFloat64(t,r,!0),8;case 9:throw Error("FLOAT80 \u043D\u0435 \u043F\u043E\u0434\u0434\u0435\u0440\u0436\u0438\u0432\u0430\u0435\u0442\u0441\u044F");default:return 0}}getLine(r,e){let t=this.p,s=Math.min(r,this.size()-t);if(s<=0)return"";let i=0,o="";for(;i<s;){let a=this.v.getUint8(t+i);i++;let h=oe.table[a];if(o+=h,h===e)break}return this.p+=i,o}line(){let r=this.p,e=this.size()-r;if(e<=0)return"";let t=0,s=0;for(;t<e;){let o=this.v.getUint8(r+t);if(o===0){s=1;break}if(o===Ve.slashR&&t+1<e&&this.v.getUint8(r+t+1)===Ve.slashN){s=2;break}t+=1}let i=oe.decode(new Uint8Array(this.v.buffer,r,t));return this.p=r+t+s,i}writeLine(r){let e=r+`\r
`,t=this.p,s=t+e.length;return s>this.size()&&this.resize(s),this.p=s,oe.encode(e).forEach((o,a)=>this.v.setUint8(t+a,o)),e.length}write(r){let e=this.p,t=e+r.length;t>this.size()&&this.resize(t),this.p=t,r.forEach((s,i)=>this.v.setUint8(e+i,s))}buffer(){return this.v.buffer}},Ge=Ve;Ge.slashR="\r".charCodeAt(0),Ge.slashN=`
`.charCodeAt(0),Ge.widthTable=[1,1,2,2,4,4,4,5,8,10];var ur=class{constructor(r,e={}){this.path=r;this.type="file";this.size=null;this.cls=null;this.image=null;this.scene=null;this.video=null;this.audio=null;this.ttf=null;this.cursor=null;this.stt=null;this.mat=null;this.base64=null;this.set(e)}set({size:r=this.size,cls:e=this.cls,image:t=this.image,scene:s=this.scene,video:i=this.video,audio:o=this.audio,ttf:a=this.ttf,cursor:h=this.cursor,stt:u=this.stt,mat:g=this.mat,base64:b=this.base64}){return this.size=r,this.cls=e,this.image=t,this.scene=s,this.video=i,this.audio=o,this.ttf=a,this.cursor=h,this.stt=u,this.mat=g,this.base64=b,this}},et=class{constructor(r=""){this.name=r;this.type="folder";this.items=new Map}},$e=class{constructor(r,e,t){this.fs=r;this.parts=e;this.str=null;if(e[0].length!==2&&e[0][1]!==":")throw Error("\u041D\u0435\u043F\u0440\u0430\u0432\u0438\u043B\u044C\u043D\u043E\u0435 \u0438\u043C\u044F \u0442\u043E\u043C\u0430 \u0434\u0438\u0441\u043A\u0430");this.partsUC=t!=null?t:e.map(s=>s.toUpperCase())}static splitPath(r){return r.split(/[/\\]/).map(e=>e.trim()).filter(e=>e.length>0)}resolve(r){let e=$e.splitPath(r);if(!e.length)return this;let t=e[0].length===2&&e[0][1]===":",s=t?[e[0]]:this.parts.slice(),i=t?[e[0].toUpperCase()]:this.partsUC.slice();for(let o=t?1:0;o<e.length;++o){let a=e[o];a===".."?s.length>1&&(s.pop(),i.pop()):a!=="."&&(s.push(a),i.push(a.toUpperCase()))}return new $e(this.fs,s,i)}toString(){return this.str?this.str:this.str=this.parts.join("\\")}basename(){return this.parts[this.parts.length-1]}equals(r){let e=this.partsUC,t=r.partsUC;if(e.length!==t.length)return!1;for(let s=0;s<e.length;++s)if(e[s]!==t[s])return!1;return!0}startsWith(r){let e=this.partsUC,t=r.partsUC;if(e.length<t.length)return!1;for(let s=0;s<t.length;++s)if(e[s]!==t[s])return!1;return!0}static getFolder(r,e,t){let s=r;for(let i=0;i<e.length-(t?0:1);++i){let o=s.items.get(e[i]);if(!o||o.type!=="folder")return null;s=o}return s}create(r,e){let{partsUC:t}=this,s=$e.getFolder(this.fs,t);if(!s)return null;let i=t[t.length-1],o=s.items.has(i);if(r==="folder")return o||s.items.set(i,new et),this;if(o)return null;let a=new ur(this,e);return s.items.set(i,a),a}createWithDirs(r){let{parts:e,partsUC:t}=this,s=this.fs;for(let h=0;h<e.length-1;++h){let u=s.items.get(t[h]);if(!u)u=new et(e[h]),s.items.set(t[h],u);else if(u.type==="file")throw Error(`\u041D\u0435\u0432\u043E\u0437\u043C\u043E\u0436\u043D\u043E \u0441\u043E\u0437\u0434\u0430\u0442\u044C \u0434\u0438\u0440\u0435\u043A\u0442\u043E\u0440\u0438\u044E ${this}: \u0444\u0430\u0439\u043B ${u.path} \u0443\u0436\u0435 \u0441\u0443\u0449\u0435\u0441\u0442\u0432\u0443\u0435\u0442.`);s=u}let i=t[t.length-1];if(s.items.has(i))throw Error(`\u041D\u0435\u0432\u043E\u0437\u043C\u043E\u0436\u043D\u043E \u0441\u043E\u0437\u0434\u0430\u0442\u044C \u0434\u0438\u0440\u0435\u043A\u0442\u043E\u0440\u0438\u044E ${this}: \u0444\u0430\u0439\u043B \u0443\u0436\u0435 \u0441\u0443\u0449\u0435\u0441\u0442\u0432\u0443\u0435\u0442.`);let a=new ur(this,r);return s.items.set(i,a),a}file(){let{partsUC:r}=this,e=$e.getFolder(this.fs,r);if(!e)return J.debugFile&&console.warn(`${this.toString()} \u043D\u0435 \u0441\u0443\u0449\u0435\u0441\u0442\u0432\u0443\u0435\u0442`),null;let t=r[r.length-1],s=e.items.get(t);return s?s.type!=="file"?(J.debugFile&&console.warn(`${this.toString()} \u044F\u0432\u043B\u044F\u0435\u0442\u0441\u044F \u0434\u0438\u0440\u0435\u043A\u0442\u043E\u0440\u0438\u0435\u0439`),null):s:(J.debugFile&&console.warn(`${this.toString()} \u043D\u0435 \u0441\u0443\u0449\u0435\u0441\u0442\u0432\u0443\u0435\u0442`),null)}forEach(r,e=!0){let{partsUC:t}=this,s=$e.getFolder(this.fs,t,!0);s&&s.items.forEach(function i(o){o.type==="folder"?e&&o.items.forEach(i):r(o)})}resolveMany(){var o;let{partsUC:r}=this,e=$e.getFolder(this.fs,r);if(!e)return[];let t=r[r.length-1];if(t.includes("*")){let[a,h]=t.split("*"),u;return!a&&!h?u=[".","..",...e.items]:u=[...e.items].filter(([g])=>g.startsWith(a)&&g.endsWith(h)),u.map(g=>{var w;if(typeof g=="string")return{name:g,size:0};let b=g[1];return b.type==="folder"?{name:b.name,size:0}:{name:b.path.basename(),size:(w=b.size)!=null?w:0}})}let s=e.items.get(t);return s?[s.type==="folder"?{name:s.name,size:0}:{name:s.path.basename(),size:(o=s.size)!=null?o:0}]:[]}};var hr=class{constructor(r){this.stdlib={id:J.libraryURL,mount:"library"};this.loadedLibs=new Set;this.fs=new et;this.stdlibDir=new $e(this.fs,["D:",this.stdlib.mount]);this.projects=r.map(e=>[this.path(e.filepath),e])}path(r,e="C:"){return new $e(this.fs,[e].concat(r.split("/")))}exists(r){return this.projects.some(([e])=>e.equals(r))}open(r){return st(this,null,function*(){var k,E;let e=this.projects.find(([A])=>A.equals(r));if(!e)return null;let[t,{data:s,libs:i}]=e,o=i.concat(this.stdlib).map(q=>st(this,[q],function*({mount:A,id:U}){if(this.loadedLibs.size===this.loadedLibs.add(U).size)return;let ce;try{let ie=yield fetch(`${Ke(U)}/index.json`,{cache:J.cache});if(ce=yield ie.json(),!ie.ok)throw Error(ce.message||"\u041D\u0435\u0438\u0437\u0432\u0435\u0441\u0442\u043D\u0430\u044F \u043E\u0448\u0438\u0431\u043A\u0430")}catch(ie){throw ie instanceof Error?Error(`\u041E\u0448\u0438\u0431\u043A\u0430 \u0437\u0430\u0433\u0440\u0443\u0437\u043A\u0438 \u0431\u0438\u0431\u043B\u0438\u043E\u0442\u0435\u043A\u0438 '${A}' ('${U}'): ${ie.message}`):ie}let Te=U===this.stdlib.id?"D:":"C:";ce.files.forEach(ie=>this.path(A?`${A}/${ie.path}`:ie.path,Te).createWithDirs(ie))}));yield Promise.all(o);let P=s,{searchDirs:a,stt:h}=P,u=ne(P,["searchDirs","stt"]),g=t.resolve(".."),b=[this.stdlibDir,g].concat((k=a==null?void 0:a.map(A=>this.path(A)))!=null?k:[]),w=h?this.path(h):g.resolve("_preload.stt"),D=(E=w.file())==null?void 0:E.stt;D||console.warn(`\u0424\u0430\u0439\u043B \u0441\u043E\u0441\u0442\u043E\u044F\u043D\u0438\u044F ${w} \u043D\u0435 \u0441\u0443\u0449\u0435\u0441\u0442\u0432\u0443\u0435\u0442`);let v=[];return g.forEach(A=>{if(!A.mat)return;let U=A.path.basename(),q=parseInt(U.substring(0,U.length-5));isNaN(q)||!q||v.push([q,A.mat])},!1),N({filepath:t,dir:g,searchDirs:b,stt:D,matrices:v},u)})}};var Br=class{constructor(r,e,o){this.root=r;this.view=e;this.x=0;this.y=0;this.width=0;this.height=0;this.clientWidth=0;this.clientHeight=0;this.visible=!0;this.hideTimeout=0;var a=o,{popup:t,title:s}=a,i=ne(a,["popup","title"]);this.origTitle=document.title,!t&&s&&(document.title=this.origTitle?`${this.origTitle} - ${s}`:s),this.title=s!=null?s:"",this.popup=t||!1,r.appendChild(e),this.set(i),this.width=i.width||e.clientWidth,this.height=i.height||e.clientHeight,this.clientWidth=i.clientWidth||e.clientWidth,this.clientHeight=i.clientHeight||e.clientHeight}set({x:r=this.x,y:e=this.y,width:t=this.width,height:s=this.height,clientWidth:i=this.clientWidth,clientHeight:o=this.clientHeight,title:a=this.title,visible:h=this.visible}){return this.popup&&(this.x!==r&&this.view.style.setProperty("left",r+"px"),this.y!==e&&this.view.style.setProperty("top",e+"px")),this.clientWidth!==i&&this.view.style.setProperty("width",i+"px"),this.clientHeight!==o&&this.view.style.setProperty("height",o+"px"),this.title!==a&&(document.title=a),this.visible!==h&&(this.view.style.opacity=h?"1":"0",this.hideTimeout&&window.clearTimeout(this.hideTimeout),this.hideTimeout=window.setTimeout(()=>this.view.style.setProperty("display",h?"block":"none"),h?0:250)),this.x=r,this.y=e,this.width=t,this.height=s,this.clientWidth=i,this.clientHeight=o,this.title=a,this.visible=h,this}close(){this.popup?(this.view.style.opacity="0",setTimeout(()=>this.view.remove(),250)):(this.view.style.opacity="0",setTimeout(()=>this.view.remove(),250),document.title=this.origTitle)}},pr=class{constructor(r){this.root=(typeof r=="string"?document.getElementById(r):r)||document.body,this.root.style.setProperty("position","relative")}get screenWidth(){var r;return((r=this.root)==null?void 0:r.clientWidth)||window.innerWidth}get screenHeight(){var r;return((r=this.root)==null?void 0:r.clientHeight)||window.innerHeight}window(r,e){let t=document.createElement("div"),{x:s,y:i}=e;if(e.popup?(s=Math.max(e.x||0,0),i=Math.max(e.y||0,0),e.height&&(i=Math.min(i,this.screenHeight-e.height-11)),t.style.setProperty("position","absolute"),t.style.setProperty("left",s+"px"),t.style.setProperty("top",i+"px"),t.style.setProperty("box-shadow","13px 11px 6px 0px rgb(0 0 0 / 50%)")):(t.style.setProperty("position","absolute"),t.setAttribute("class","stratum-window")),t.style.setProperty("opacity","0"),t.style.setProperty("transition","opacity 250ms linear"),setTimeout(()=>t.style.setProperty("opacity","1")),t.style.setProperty("width",e.width?e.width+"px":"100%"),t.style.setProperty("height",e.height?e.height+"px":"100%"),t.appendChild(r),this.root)return new Br(this.root,t,R(N({},e),{x:s,y:i}));throw Error(`\u041D\u0435 \u0443\u0434\u0430\u043B\u043E\u0441\u044C \u043E\u0442\u043A\u0440\u044B\u0442\u044C \u043E\u043A\u043D\u043E ${e.title}`)}};var tt=class{constructor(r,e){this.kernel=r;this.initial=e;this._diag={iterations:0,missingCommands:[]};this._status="closed";this.computer=new Me;this.loop=null;this.speed="smooth"}static create(r,e){return st(this,null,function*(){var a;if(!r.length)throw Error("\u0421\u043F\u0438\u0441\u043E\u043A \u043F\u0440\u043E\u0435\u043A\u0442\u043E\u0432 \u043F\u0443\u0441\u0442");let t=new hr(r),s=t.path(e||r[0].filepath),i=yield t.open(s);if(!i)throw Error(`\u041F\u0440\u043E\u0435\u043A\u0442 ${s} \u043D\u0435 \u0441\u0443\u0449\u0435\u0441\u0442\u0432\u0443\u0435\u0442`);let o=new cr({projectLoader:t,swgBackend:Hs,windowFactory:(a=J.windowFactory)!=null?a:new pr(J.root)});return new tt(o,i)})}set({speed:r=this.speed}){if(this.speed!==r){let e=r==="smooth"?new Me:new yt(typeof r=="number"?r:void 0);this.computer.running&&(this.computer.stop(),this.loop&&e.run(this.loop)),this.computer=e}return this.speed=r,this}get status(){return this._status}get diag(){return this._diag}play(){return this.loop?this:(this.kernel.project(this.initial),this._diag.iterations=0,this.loop=()=>{let r;try{r=this.kernel.compute()}catch(e){if(!(e instanceof Ie))throw e;console.error(e.message),console.error(e.original);let t=e.message;return this._status="error",this.kernel.handlers.error.forEach(s=>s(t)),!1}return r?++this._diag.iterations:(this.loop=null,this._status="closed",this.kernel.handlers.closed.forEach(e=>e())),r},this.computer.run(this.loop),this._status="playing",this)}close(){return this._status==="error"?(this.kernel.set({projects:[]}).compute(),this.loop=null,this._status="closed",this):(this.kernel.set({projects:[]}),this.step())}pause(){return this.computer.running&&(this.computer.stop(),this._status="paused"),this}continue(){return!this.computer.running&&this.loop&&(this.computer.run(this.loop),this._status="playing"),this}step(){return!this.computer.running&&this.loop&&this.loop(),this}on(r,e){return this.kernel.handlers[r].add(e),this}off(r,e){return e?this.kernel.handlers[r].delete(e):this.kernel.handlers[r].clear(),this}};var Oi=tt.create;Oi.options=J;(window.stratum||(window.stratum={})).player=Oi;})();
/**
 * Gauss-Jordan elimination by lovasoa (https://github.com/lovasoa) @license (MIT)
 */
;stratum.info = { commit: '84cd3a2 Merge ac6ce82e19b88f69cc9481d20cfaf5a902f8db08 into 035d17e99251884442deeafedf5ab56adbfd0b4d', title: 'Добавлен редактор', url: 'https://github.com/Stratum-IIT/stratum-iit/pull/6' };
