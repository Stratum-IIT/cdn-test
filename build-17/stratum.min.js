"use strict";(()=>{var Vo=Object.defineProperty,xm=Object.defineProperties;var Pm=Object.getOwnPropertyDescriptors;var ot=Object.getOwnPropertySymbols;var Co=Object.prototype.hasOwnProperty,Ko=Object.prototype.propertyIsEnumerable;var ei=(e,t)=>(t=Symbol[e])?t:Symbol.for("Symbol."+e),Dr=Math.pow,Bo=(e,t,r)=>t in e?Vo(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,J=(e,t)=>{for(var r in t||(t={}))Co.call(t,r)&&Bo(e,r,t[r]);if(ot)for(var r of ot(t))Ko.call(t,r)&&Bo(e,r,t[r]);return e},X=(e,t)=>xm(e,Pm(t));var we=(e,t)=>{var r={};for(var n in e)Co.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(e!=null&&ot)for(var n of ot(e))t.indexOf(n)<0&&Ko.call(e,n)&&(r[n]=e[n]);return r};var ur=(e,t)=>{for(var r in t)Vo(e,r,{get:t[r],enumerable:!0})};var mr=(e,t,r)=>new Promise((n,i)=>{var o=c=>{try{a(r.next(c))}catch(h){i(h)}},s=c=>{try{a(r.throw(c))}catch(h){i(h)}},a=c=>c.done?n(c.value):Promise.resolve(c.value).then(o,s);a((r=r.apply(e,t)).next())}),Sm=function(e,t){this[0]=e,this[1]=t};var kr=e=>{var t=e[ei("asyncIterator")],r=!1,n,i={};return t==null?(t=e[ei("iterator")](),n=o=>i[o]=s=>t[o](s)):(t=t.call(e),n=o=>i[o]=s=>{if(r){if(r=!1,o==="throw")throw s;return s}return r=!0,{done:!1,value:new Sm(new Promise(a=>{var c=t[o](s);if(!(c instanceof Object))throw TypeError("Object expected");a(c)}),1)}}),i[ei("iterator")]=()=>i,n("next"),"throw"in t?n("throw"):i.throw=o=>{throw o},"return"in t&&n("return"),i};var ri=document.createElement("a");function Uo(e,t){let r=URL.createObjectURL(e);ri.href=r,ri.download=t,ri.click(),setTimeout(()=>URL.revokeObjectURL(r),1e3)}function ti(e){e.preventDefault()}var We=class{constructor(){this.frameId=0}get running(){return this.frameId!==0}run(t){if(this.running)return;let r=()=>{this.frameId=t()?requestAnimationFrame(r):0};this.frameId=requestAnimationFrame(r)}stop(){this.running&&(cancelAnimationFrame(this.frameId),this.frameId=0)}},st=class{constructor(t=1){this.cycles=t;this.frameId=0}get running(){return this.frameId!==0}run(t){if(this.running)return;let r=()=>{for(let n=0;n<this.cycles;++n)if(!t()){this.frameId=0;return}this.frameId=setTimeout(r,0)};this.frameId=setTimeout(r)}stop(){this.running&&(clearTimeout(this.frameId),this.frameId=0)}};var at={};function Te(e){return at.baseURL?`${at.baseURL}/${e}`:e}var lt=at;var ct=["Arial","Verdana","Tahoma","Times New Roman","Georgia","Courier New","cursive"];var ze=["A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","0","1","2","3","4","5","6","7","8","9","+","/"],Jo=[255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,62,255,255,255,63,52,53,54,55,56,57,58,59,60,61,255,255,255,0,255,255,255,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,255,255,255,255,255,255,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51];function ut(e){if(e>=Jo.length)throw new Error("Unable to parse base64 string.");let t=Jo[e];if(t===255)throw new Error("Unable to parse base64 string.");return t}function jo(e){let t="",r,n=e.length;for(r=2;r<n;r+=3)t+=ze[e[r-2]>>2],t+=ze[(e[r-2]&3)<<4|e[r-1]>>4],t+=ze[(e[r-1]&15)<<2|e[r]>>6],t+=ze[e[r]&63];return r===n+1&&(t+=ze[e[r-2]>>2],t+=ze[(e[r-2]&3)<<4],t+="=="),r===n&&(t+=ze[e[r-2]>>2],t+=ze[(e[r-2]&3)<<4|e[r-1]>>4],t+=ze[(e[r-1]&15)<<2],t+="="),t}function mt(e){if(e.length%4!==0)throw new Error("Unable to parse base64 string.");let t=e.indexOf("=");if(t!==-1&&t<e.length-2)throw new Error("Unable to parse base64 string.");let r=e.endsWith("==")?2:e.endsWith("=")?1:0,n=e.length,i=new Uint8Array(3*(n/4)),o;for(let s=0,a=0;s<n;s+=4,a+=3)o=ut(e.charCodeAt(s))<<18|ut(e.charCodeAt(s+1))<<12|ut(e.charCodeAt(s+2))<<6|ut(e.charCodeAt(s+3)),i[a]=o>>16,i[a+1]=o>>8&255,i[a+2]=o&255;return i.subarray(0,i.length-r)}var me={};ur(me,{NEWLINE_CHAR:()=>Tm,SPACE_CHAR:()=>Ho,decode:()=>$o,encode:()=>Mm,table:()=>Gr});var Gr=[...Array.from({length:128},(e,t)=>String.fromCharCode(t)),"\u0402","\u0403","\u201A","\u0453","\u201E","\u2026","\u2020","\u2021","\u20AC","\u2030","\u0409","\u2039","\u040A","\u040C","\u040B","\u040F","\u0452","\u2018","\u2019","\u201C","\u201D","\u2022","\u2013","\u2014","","\u2122","\u0459","\u203A","\u045A","\u045C","\u045B","\u045F"," ","\u040E","\u045E","\u040B","\xA4","\u0490","\xA6","\xA7","\u0401","\xA9","\u0404","\xAB","\xAC","","\xAE","\u0407","\xB0","\xB1","\u0406","\u0456","\u0491","\xB5","\xB6","\xB7","\u0451","\u2116","\u0454","\xBB","\u0458","\u0405","\u0455","\u0457","\u0410","\u0411","\u0412","\u0413","\u0414","\u0415","\u0416","\u0417","\u0418","\u0419","\u041A","\u041B","\u041C","\u041D","\u041E","\u041F","\u0420","\u0421","\u0422","\u0423","\u0424","\u0425","\u0426","\u0427","\u0428","\u0429","\u042A","\u042B","\u042C","\u042D","\u042E","\u042F","\u0430","\u0431","\u0432","\u0433","\u0434","\u0435","\u0436","\u0437","\u0438","\u0439","\u043A","\u043B","\u043C","\u043D","\u043E","\u043F","\u0440","\u0441","\u0442","\u0443","\u0444","\u0445","\u0446","\u0447","\u0448","\u0449","\u044A","\u044B","\u044C","\u044D","\u044E","\u044F"];function $o(e){return Array.from(e).map(t=>Gr[t]).join("")}var Ho=32,Tm=10;function Mm(e){return new Uint8Array([...e].map(t=>{let r=Gr.indexOf(t);return r>-1?r:Ho}))}var qS=new Intl.Collator(void 0,{numeric:!0,sensitivity:"base"}).compare;var ni=class e{constructor(t,r){this.data=new Array(t.length);for(var n=0,i=t[0].length;n<t.length;n++){this.data[n]=new Array(i);for(var o=0;o<i;o++)this.data[n][o]=t[n][o]}if(r){if(typeof r[0]!="object")for(var n=0;n<r.length;n++)r[n]=[r[n]];this.mirror=new e(r)}}swap(t,r){this.mirror&&this.mirror.swap(t,r);var n=this.data[t];this.data[t]=this.data[r],this.data[r]=n}multline(t,r){this.mirror&&this.mirror.multline(t,r);for(var n=this.data[t],i=n.length-1;i>=0;i--)n[i]*=r}addmul(t,r,n){this.mirror&&this.mirror.addmul(t,r,n);for(var i=this.data[t],o=this.data[r],s=i.length-1;s>=0;s--)i[s]=i[s]+n*o[s]}hasNullLine(t){for(var r=0;r<this.data[t].length;r++)if(this.data[t][r]!==0)return!1;return!0}gauss(){for(var t=0,r=this.data.length,n=this.data[0].length,i=[],o=0;o<n;o++){for(var s=0,a=0,c=t;c<r;c++){var h=this.data[c][o];Math.abs(h)>Math.abs(s)&&(a=c,s=h)}if(s===0)i.push(t);else{this.multline(a,1/s),this.swap(a,t);for(var d=0;d<r;d++)d!==t&&this.addmul(d,t,-this.data[d][o])}t++}for(var d=0;d<i.length;d++)if(!this.mirror.hasNullLine(i[d]))throw new Error("singular matrix");return this.mirror.data}};function zo({a:e,b:t}){var r=new ni(e,t).gauss();if(r.length>0&&r[0].length===1)for(var n=0;n<r.length;n++)r[n]=r[n][0];return r}function qo(e,t,r,n){let i=r-e,o=n-t;return Math.sqrt(i*i+o*o)}function Yo(e,t,r,n,i){for(let o=t?0:2,s=t?e.length-2:0;o<e.length;s=o,o+=2){let a=e[o],c=e[o+1],h=e[s],d=e[s+1],g=a-h,y=c-d,E=g*g+y*y;if(E===0&&qo(n,i,h,d)<=r)return!0;let v=((n-h)*g+(i-d)*y)/E;if(v=Math.max(0,Math.min(1,v)),qo(n,i,h+v*g,d+v*y)<=r)return!0}return!1}function Xo(e,t,r){let n=!1;for(let i=0,o=e.length-2;i<e.length;o=i,i+=2){let s=e[i],a=e[i+1],c=e[o],h=e[o+1];(a<=r&&r<h||h<=r&&r<a)&&h-a!==0&&t>(c-s)*(r-a)/(h-a)+s&&(n=!n)}return n}function Qo(e){let t=e[0]*(e[4]*e[8]-e[7]*e[5])-e[1]*(e[3]*e[8]-e[5]*e[6])+e[2]*(e[3]*e[7]-e[4]*e[6]);return[(e[4]*e[8]-e[7]*e[5])/t,(e[2]*e[7]-e[1]*e[8])/t,(e[1]*e[5]-e[2]*e[4])/t,(e[5]*e[6]-e[3]*e[8])/t,(e[0]*e[8]-e[2]*e[6])/t,(e[3]*e[2]-e[0]*e[5])/t,(e[3]*e[7]-e[6]*e[4])/t,(e[6]*e[1]-e[0]*e[7])/t,(e[0]*e[4]-e[3]*e[1])/t]}var Ae=class{constructor(t){this.m=new Map;t==null||t.forEach(([r,n])=>this.set(r,n))}set(t,r){let n=this.m.get(t);return n?n.add(r):this.m.set(t,new Set([r])),this}get(t){var r;return(r=this.m.get(t))!=null?r:null}delete(t){return this.m.delete(t)}forEach(t){return this.m.forEach(t)}[Symbol.iterator](){return this.m.entries()}values(){return this.m.values()}};var Lr={};ur(Lr,{convert:()=>Om,table:()=>Zo});var Zo=[" "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," ","!","\u2200","#","\u2203","%","&","\u220D","(",")","*","+",",","\u2212",".","/","0","1","2","3","4","5","6","7","8","9",":",";","<","=",">","?","\u2245","\u0391","\u0392","\u03A7","\u0394","\u0395","\u03A6","\u0393","\u0397","\u0399","\u03D1","\u039A","\u039B","\u039C","\u039D","\u039F","\u03A0","\u0398","\u03A1","\u03A3","\u03A4","\u03A5","\u03C2","\u03A9","\u039E","\u03A8","\u0396","[","\u2234","]","\u22A5","_","\u203E","\u03B1","\u03B2","\u03C7","\u03B4","\u03B5","\u03C6","\u03B3","\u03B7","\u03B9","\u03D5","\u03BA","\u03BB","\u03BC","\u03BD","\u03BF","\u03C0","\u03B8","\u03C1","\u03C3","\u03C4","\u03C5","\u03D6","\u03C9","\u03BE","\u03C8","\u03B6","{","|","}","~"," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," ","\u20AC","\u03D2","\u2032","\u2264","\u2044","\u221E","\u0192","\u2663","\u2666","\u2665","\u2660","\u2194","\u2190","\u2191","\u2192","\u2193","\xB0","\xB1","\u2033","\u2265","\xD7","\u221D","\u2202","\u2022","\xF7","\u2260","\u2261","\u2248","\u2026","\u23D0","\u23AF","\u21B5","\u2135","\u2111","\u211C","\u2118","\u2297","\u2295","\u2205","\u2229","\u222A","\u2283","\u2287","\u2284","\u2282","\u2286","\u2208","\u2209","\u2220","\u2207","\xAE","\xA9","\u2122","\u220F","\u221A","\u22C5","\xAC","\u2227","\u2228","\u21D4","\u21D0","\u21D1","\u21D2","\u21D3","\u25CA","\u3008","\xAE","\xA9","\u2122","\u2211","\u239B","\u239C","\u239D","\u23A1","\u23A2","\u23A3","\u23A7","\u23A8","\u23A9","\u23AA"," ","\u3009","\u222B","\u2320","\u23AE","\u2321","\u239E","\u239F","\u23A0","\u23A4","\u23A5","\u23A6","\u23AB","\u23AC","\u23AD"," "];function Om(e){let t="";for(let r=0;r<e.length;++r){let n=Gr.indexOf(e[r]);n===142?n=163:n<0&&(n=0),t+=Zo[n]}return t}var ge=class extends Map{static freeKey(t,r){let n=r||0;for(;t.has(++n););return n}static freeNegativeKey(t){let r=0;for(;t.has(--r););return r}};function ii(e){return(e&e-1)===0}function ht(e){return new Array().concat(...e)}function es(e,t){let r=[];for(let n of e)t(n)&&r.push(n);return r}function er(e,t){let r=[];for(let n of e)r.push(t(n));return r}function rs(e,t){let r=[];for(let n of e){let i=t(n);i&&r.push(i)}return r}var oi=class{constructor(t){this.pens=new Set;this.brushes=new Set;this.images=new Set;this.imagesOpaque=new Set;this.strings=new Set;this.fonts=new Set;this.texts=new Set;if(t)if(t.type==="group")for(let r of ts(t))r.type!=="group"&&this.add(r);else this.add(t)}add(t){switch(t.type){case"line":t.pen&&this.pens.add(t.pen),t.brush&&(this.add(t.brush),this.brushes.add(t.brush));break;case"imageView":(t.opaque?this.imagesOpaque:this.images).add(t.image);break;case"textView":this.add(t.text),this.texts.add(t.text);break;case"input":t.font&&this.fonts.add(t.font);break;case"brush":t.image&&this.imagesOpaque.add(t.image);break;case"text":t.parts.forEach(r=>{this.strings.add(r.string),this.fonts.add(r.font)});break;case"scene":t.background&&(this.add(t.background),this.brushes.add(t.background));break}return this}};function*ts(e,t){e.type==="group"&&(yield*kr(e.descendants(t))),yield e}function*Wm(e,t){for(let r of e)r.type==="group"&&(yield*kr(r.descendants(t))),yield r}function ns(e,t){let r=[],n=new oi,i=new WeakSet,o=null,s=Symbol.iterator in e?Wm(e,!0):ts(e,!0);for(let a of s)o=a.scene,r.push(a.toJSON()),a.type!=="group"&&(n.add(a),i.add(a));return{pens:er(n.pens,a=>a.toJSON()),brushes:er(n.brushes,a=>a.toJSON()),images:er(n.images,a=>a.toJSON()),imagesOpaque:er(n.imagesOpaque,a=>a.toJSON()),strings:er(n.strings,a=>a.toJSON()),fonts:er(n.fonts,a=>a.toJSON()),texts:er(n.texts,a=>a.toJSON()),objects:r,order:o&&!t?rs(o.order,a=>i.has(a)&&a.key):[]}}function Am(e){return es(e.values(),t=>!t.parent)}function dt(e,t,r){let{objects:n}=e.merge(t,r),i=Am(n);return i.length>1?e.group(i,{key:r==="unused"?-1:0}):i[0]}var Nm={x:0,y:0,w:0,h:0};function pt(e){let t=1/0,r=1/0,n=-1/0,i=-1/0;for(let o of e)o.x<t&&(t=o.x),o.y<r&&(r=o.y),o.x+o.width>n&&(n=o.x+o.width),o.y+o.height>i&&(i=o.y+o.height);return t===1/0?Nm:{x:t,y:r,w:n-t,h:i-r}}var pe=lt;var Rm=["gray","blue","navy","gray","#b5b5b5","white","black","black","black","white","gray","gray","gray","navy","white","#b5b5b5","gray","gray","black","gray","white"];function is(e){let t=parseInt(e);if(!isNaN(t))return t;let r=e.toLowerCase().trim();if(r.startsWith("rgb")){let n=r.split("(")[1].split(")")[0].split(",").map(i=>parseInt(i));return n[0]|n[1]<<8|n[2]<<16}return r.startsWith("transparent")?16777216:r.startsWith("syscolor")?33554432|parseInt(r.split("(")[1].split(")")[0]):0}function vr(e){if(e&16777216)return null;let t=e&255;if(e&33554432)return Rm[t]||"black";let r=e>>8&255,n=e>>16&255;return e&67108864?`rgba(${t},${r},${n}, 0.5)`:`rgb(${t},${r},${n})`}function si(e,t,r,n){let i=n==="transparent"?16777216:n==="syscolor"?33554432:n==="editor"?67108864:0;return e&255|(t&255)<<8|(r&255)<<16|i}function os(e){return e&255}function ss(e){return e>>8&255}function as(e){return e>>16&255}function ls(e){if(e&16777216)return"Transparent";let t=e&255;if(e&33554432)return`SysColor(${t})`;let r=e>>8&255,n=e>>16&255;return`rgb(${t},${r},${n})`}var Ie=1,_r=2,cs=4,us=8;function Fe(e){return e>>8&31}var xe=class{constructor(t,r,{key:n,data:i}){this.scene=t;this.m=r;this.subs=new Set;this.key=n||ge.freeKey(r),this.key>0&&this.m.set(this.key,this),this.data=i?J({},i):{}}delete(){return this.subs.size?!1:(this.key>0&&this.m.delete(this.key),this.key=0,!0)}toJSON(){let{key:t,data:r}=this,n;for(let i in r)typeof r[i]!="undefined"&&((n||(n={}))[i]=r[i]);return n?{key:t,data:n}:{key:t}}};var Me=class extends xe{constructor(r,n){super(r,r.objects,n);this.parent=null;this._deletedByParent=!1;let{x:i,y:o,width:s,height:a,attrib:c}=n;this.x=i!=null?i:0,this.y=o!=null?o:0,this.width=s!=null?s:0,this.height=a!=null?a:0,this.attrib=c!=null?c:0}delete(){if(super.delete(),this._deletedByParent)return!0;let{parent:r,scene:n}=this;return r==null||r.set({children:r.children.filter(i=>i.key)}),n.set({order:n.order.filter(i=>i.key)}),!0}set(r){var h;let{attrib:n,x:i,y:o,width:s,height:a}=r;this.attrib=n!=null?n:this.attrib;let c=!1;{let d=(i!=null?i:this.x)-this.x,g=(o!=null?o:this.y)-this.y;(d!==0||g!==0)&&(this._virtualMoved(d,g),c=!0)}if(s||a){let d=this.width||1,g=this.height||1,y=s&&s>0?s:d,E=a&&a>0?a:g,v=y/d,P=E/g;(v!==1||P!==1)&&(this._virtualResized(this.x,this.y,v,P),c=!0)}return c&&((h=this.parent)==null||h._childChanged()),this.scene._dirty=!0,this}rotate(r,{x:n,y:i}={x:this.x,y:this.y}){var o;return r===0?this:(this._virtualRotated(n,i,r),(o=this.parent)==null||o._childChanged(),this)}_virtualUpdateBBox(r,n,i,o){this.x=r,this.y=n,this.width=i,this.height=o}_virtualMoved(r,n){this._virtualUpdateBBox(this.x+r,this.y+n,this.width,this.height)}_virtualResized(r,n,i,o){let s=r+(this.x-r)*i,a=n+(this.y-n)*o,c=(this.width||1)*i,h=(this.height||1)*o;this._virtualUpdateBBox(s,a,c,h)}_virtualRotated(r,n,i){let o=Math.sin(i),s=Math.cos(i),a=this.x-r,c=this.y-n,h=a*s-c*o+r,d=a*o+c*s+n;this._virtualUpdateBBox(h,d,this.width,this.height)}toJSON(){let{attrib:r,height:n,width:i,x:o,y:s}=this;return X(J({},super.toJSON()),{attrib:r,height:n,width:i,x:o,y:s})}toString(){return"\u0413\u0440\u0430\u0444\u0438\u0447\u0435\u0441\u043A\u0438\u0439 \u044D\u043B\u0435\u043C\u0435\u043D\u0442"}};var gt=class extends Me{constructor(r,n,i){super(r,i);this.type="group";this.children=[];this.set(X(J({},i),{children:n}))}delete(r){return this.children.forEach(n=>{n._deletedByParent=!0,n.delete(r)}),super.delete()}set(r,n){var o;typeof r.children!="undefined"&&(this.children.forEach(s=>s.parent=null),this.children=r.children,this.children.forEach(s=>s.parent=this),this.children.length>0?this._childChanged():(this._virtualUpdateBBox(this.x,this.y,0,0),(o=this.parent)==null||o._childChanged()));let{attrib:i}=r;return typeof i!="undefined"&&!n&&this.children.forEach(s=>s.set({attrib:i})),super.set(r)}_childChanged(){var s;let r=1/0,n=-1/0,i=1/0,o=-1/0;this.children.forEach(a=>{r=Math.min(r,a.x),i=Math.min(i,a.y),n=Math.max(n,a.x+a.width),o=Math.max(o,a.y+a.height)}),this._virtualUpdateBBox(r,i,n-r,o-i),(s=this.parent)==null||s._childChanged()}_virtualMoved(r,n){if(this.children.length===0){super._virtualMoved(r,n);return}this.children.forEach(i=>i._virtualMoved(r,n)),this._virtualUpdateBBox(this.x+r,this.y+n,this.width,this.height)}_virtualResized(r,n,i,o){if(this.children.length===0){super._virtualResized(r,n,i,o);return}let s=1/0,a=-1/0,c=1/0,h=-1/0;this.children.forEach(d=>{d._virtualResized(r,n,i,o),s=Math.min(s,d.x),c=Math.min(c,d.y),a=Math.max(a,d.x+d.width),h=Math.max(h,d.y+d.height)}),this._virtualUpdateBBox(s,c,a-s,h-c)}_virtualRotated(r,n,i){if(this.children.length===0){super._virtualRotated(r,n,i);return}let o=1/0,s=-1/0,a=1/0,c=-1/0;this.children.forEach(h=>{h._virtualRotated(r,n,i),o=Math.min(o,h.x),a=Math.min(a,h.y),s=Math.max(s,h.x+h.width),c=Math.max(c,h.y+h.height)}),this._virtualUpdateBBox(o,a,s-o,c-a)}*descendants(r){for(let n of this.children)r&&n.key<=0||(n.type==="group"&&(yield*kr(n.descendants(r))),yield n)}toJSON(){let{type:r}=this,h=super.toJSON(),{x:n,y:i,width:o,height:s}=h,a=we(h,["x","y","width","height"]),c=this.children.filter(d=>d.key>0).map(d=>d.key);return X(J({},a),{type:r,children:c})}toString(){return"\u0413\u0440\u0443\u043F\u043F\u0430"}};var bt=class{constructor(){this.type="scene";this._dirty=!0;this.x=0;this.y=0;this.order=[];this.background=null;this.hiddenLayers=0;this.grid=null;this.cursor=null;this.selectUnselectable=!1;this.disableInputs=!1;this.objects=new Map;this.pens=new Map;this.brushes=new Map;this.images=new Map;this.imagesOpaque=new Map;this.strings=new Map;this.fonts=new Map;this.texts=new Map;this.oninputchanged=null}set({x:t=this.x,y:r=this.y,order:n=this.order,hiddenLayers:i=this.hiddenLayers,selectUnselectable:o=this.selectUnselectable,disableInputs:s=this.disableInputs,grid:a=this.grid,background:c=this.background,cursor:h=this.cursor}){var d,g;if(this.background!==c&&((d=this.background)==null||d.subs.delete(this),this.background=c,(g=this.background)==null||g.subs.add(this)),this.disableInputs!==s){let y=s?"none":"auto";this.objects.forEach(E=>{E.type==="input"&&(E._html.style.pointerEvents=y)})}return this.x=Math.round(t),this.y=Math.round(r),this.order=n,this.hiddenLayers=i,this.selectUnselectable=o,this.disableInputs=s,this.grid=a,this.cursor=h,this}pick(t,r){let{order:n,hiddenLayers:i,selectUnselectable:o}=this;for(let s=n.length-1;s>=0;--s){let a=n[s],c=a.attrib,h=c&Ie,d=c&_r,g=c&cs,y=c&us,E=Fe(c);if(h||y&&!o||!d&&1<<E&i||g)continue;let v=t-a.x,P=r-a.y,w=0;if(a.type==="line"){if(a.pen)w=a.pen.width/2||.5;else if(!a.brush)continue;w=Math.max(w,4)}else if(a.type==="textView"){let O=Math.sin(-a.angle),R=Math.cos(-a.angle),D=v*R-P*O,B=v*O+P*R;v=D,P=B}if(!(v<-w||v>a.width+w||P<-w||P>a.height+w)&&!(a.type==="line"&&!a.inside(v,P,w)))return a}return null}fromJSON(t){this.set(X(J({},t),{background:void 0,order:void 0})).merge(t,"exact");let r=t.background&&this.brushes.get(t.background);r&&this.set({background:r})}toJSON(){let{background:t,x:r,y:n,hiddenLayers:i,selectUnselectable:o,grid:s,pens:a,brushes:c,images:h,imagesOpaque:d,fonts:g,strings:y,texts:E,objects:v,order:P}=this;return{background:t==null?void 0:t.key,x:r,y:n,hiddenLayers:i,selectUnselectable:o,grid:s,pens:[...a.values()].map(w=>w.toJSON()),brushes:[...c.values()].map(w=>w.toJSON()),images:[...h.values()].map(w=>w.toJSON()),imagesOpaque:[...d.values()].map(w=>w.toJSON()),fonts:[...g.values()].map(w=>w.toJSON()),strings:[...y.values()].map(w=>w.toJSON()),texts:[...E.values()].map(w=>w.toJSON()),objects:[...v.values()].map(w=>w.toJSON()),order:P.filter(w=>w.key>0).map(w=>w.key)}}merge(t,r="free",n){var K,z,k,Q,Z,re,C,se,ye;let i=r==="free"?0:-1;function o(L,ae){return r==="exact"?ae?J(J({},L),ae):L:X(J(J({},L),ae),{key:i})}let s=(K=t.pens)==null?void 0:K.map(L=>[L.key,this.pen(o(L))]),a=(z=t.images)==null?void 0:z.map(L=>[L.key,this.image(L,o(L))]),c=(k=t.imagesOpaque)==null?void 0:k.map(L=>[L.key,this.image(L,o(L,{opaque:!0}))]),h=(Q=t.fonts)==null?void 0:Q.map(L=>[L.key,this.font(o(L))]),d=(Z=t.strings)==null?void 0:Z.map(L=>[L.key,this.string(L.text||"",o(L))]),g=s?new Map(s):this.pens,y=a?new Map(a):this.images,E=c?new Map(c):this.imagesOpaque,v=h?new Map(h):this.fonts,P=d?new Map(d):this.strings,w=(re=t.brushes)==null?void 0:re.map(L=>{let ae=L.image&&E.get(L.image)||null;return[L.key,this.brush(o(L,{image:ae}))]}),O=w?new Map(w):this.brushes,R=(C=t.texts)==null?void 0:C.map(L=>{let ae=L.parts.map((be,Be)=>{let He=v.get(be.font)||rr(`\u0422\u0435\u043A\u0441\u0442 #${L.key}[${Be}]: \u0428\u0440\u0438\u0444\u0442 #${be.font} \u043D\u0435 \u0441\u0443\u0449\u0435\u0441\u0442\u0432\u0443\u0435\u0442`),Qe=P.get(be.string)||rr(`\u0422\u0435\u043A\u0441\u0442 #${L.key}[${Be}]: \u0421\u0442\u0440\u043E\u043A\u0430 #${be.string} \u043D\u0435 \u0441\u0443\u0449\u0435\u0441\u0442\u0432\u0443\u0435\u0442`);return X(J({},be),{font:He,string:Qe})});return[L.key,this.text(ae,o(L))]}),D=R?new Map(R):this.texts,B=[],V=(se=t.objects)==null?void 0:se.map(L=>{switch(L.type){case"line":{let ae=L.pen&&g.get(L.pen)||null,be=L.brush&&O.get(L.brush)||null;return[L.key,this.line(L.coords,o(L,{pen:ae,brush:be}))]}case"imageView":{let be=(L.opaque?E:y).get(L.image)||rr(`ImageView (opaque: ${L.opaque}) #${L.key}: \u0418\u0437\u043E\u0431\u0440\u0430\u0436\u0435\u043D\u0438\u0435 #${L.image} \u043D\u0435 \u0441\u0443\u0449\u0435\u0441\u0442\u0432\u0443\u0435\u0442`);return[L.key,this.imageView(be,o(L))]}case"textView":{let ae=D.get(L.text)||rr(`TextView #${L.key}: \u0422\u0435\u043A\u0441\u0442 #${L.text} \u043D\u0435 \u0441\u0443\u0449\u0435\u0441\u0442\u0432\u0443\u0435\u0442`);return[L.key,this.textView(ae,o(L))]}case"input":{let ae=L.font&&v.get(L.font)||null;return[L.key,this.input(L.inputType,o(L,{font:ae}))]}case"videoView":return[L.key,this.video(Te(L.src),o(L))];case"group":{let ae=this.group([],o(L));return B.push({g:ae,o:L}),[L.key,ae]}case"3dView":throw Error(`\u041E\u0431\u044A\u0435\u043A\u0442 #${L.key} \u044F\u0432\u043B\u044F\u0435\u0442\u0441\u044F 3D \u043F\u0440\u043E\u0435\u043A\u0446\u0438\u0435\u0439. \u041E\u043D\u0438 \u0435\u0449\u0435 \u043D\u0435 \u0440\u0435\u0430\u043B\u0438\u0437\u043E\u0432\u0430\u043D\u044B.`)}}),F=new Map(V);for(let{g:L,o:ae}of B){let be=ae.children.map(Be=>F.get(Be)||rr(`\u0413\u0440\u0443\u043F\u043F\u0430 #${L.key}: \u041E\u0431\u044A\u0435\u043A\u0442 #${Be} \u043D\u0435 \u0441\u0443\u0449\u0435\u0441\u0442\u0432\u0443\u0435\u0442.`));L.set({children:be})}let Y=(ye=t.order)==null?void 0:ye.map(L=>{let ae=F.get(L)||rr(`\u041E\u0431\u044A\u0435\u043A\u0442 #${L} \u043D\u0435 \u0441\u0443\u0449\u0435\u0441\u0442\u0432\u0443\u0435\u0442 \u0438 \u043D\u0435 \u043C\u043E\u0436\u0435\u0442 \u0431\u044B\u0442\u044C \u043E\u0442\u043E\u0431\u0440\u0430\u0436\u0435\u043D.`);return ae.type==="group"&&rr(`\u041E\u0431\u044A\u0435\u043A\u0442 #${L} \u044F\u0432\u043B\u044F\u0435\u0442\u0441\u044F \u0433\u0440\u0443\u043F\u043F\u043E\u0439 \u0438 \u043D\u0435 \u043C\u043E\u0436\u0435\u0442 \u0431\u044B\u0442\u044C \u043E\u0442\u043E\u0431\u0440\u0430\u0436\u0435\u043D.`),ae});return!n&&(Y!=null&&Y.length)&&this.set({order:this.order.concat(Y)}),{objects:F,brushes:O,fonts:v,images:y,imagesOpaque:E,pens:g,strings:P,texts:D,order:Y||[]}}_exist(t,r){return r&&r.key&&r.key>0&&t.get(r.key)}_not(t,r){return r&&r.key&&r.key>0&&t.get(r.key)&&rr(`\u041E\u0431\u044A\u0435\u043A\u0442 #${r.key} \u0443\u0436\u0435 \u0441\u0443\u0449\u0435\u0441\u0442\u0432\u0443\u0435\u0442`),!0}group(t,r={}){return this._not(this.objects,r)&&new gt(this,t,r)}line(t,r){return this._not(this.objects,r)&&this._line(t,r)}imageView(t,r){return this._not(this.objects,r)&&this._imageView(t,r)}textView(t,r){return this._not(this.objects,r)&&this._textView(t,r)}input(t,r){return this._not(this.objects,r)&&this._input(t,r)}video(t,r){return this._not(this.objects,r)&&this._video(t,r)}pen(t){return this._exist(this.pens,t)||this._pen(t)}brush(t){return this._exist(this.brushes,t)||this._brush(t)}image(t,r){return this._exist(r!=null&&r.opaque?this.imagesOpaque:this.images,r)||this._image(t,r)}string(t,r){return this._exist(this.strings,r)||this._string(t,r)}font(t){return this._exist(this.fonts,t)||this._font(t)}text(t,r){return this._exist(this.texts,r)||this._text(t,r)}};function rr(e){throw Error(e)}var ft=class extends Me{constructor(r,n,i){var s,a,c;let o=X(J({},i),{width:(s=i.width)!=null?s:n.width,height:(a=i.height)!=null?a:n.height,image:n});super(r,o);this.image=n;this.type="imageView";this.area=null;this.opaque=(c=i.opaque)!=null?c:!1,n.subs.add(this),this.set(o)}set(o){var s=o,{area:r=this.area,image:n=this.image}=s,i=we(s,["area","image"]);return this.image!==n&&(this.image.subs.delete(this),this.image=n,this.image.subs.add(this)),this.area=r,super.set(i)}toJSON(){let{image:r,area:n,opaque:i,type:o}=this;return X(J({},super.toJSON()),{type:o,image:r.key,area:n,opaque:i})}delete(r){let{image:n}=this;return n.subs.delete(this),r||n.delete(),super.delete()}toString(){return"\u041A\u0430\u0440\u0442\u0438\u043D\u043A\u0430"}};var yt=class extends ft{constructor(r,n,i){super(r,n,i);this._svg=document.createElementNS("http://www.w3.org/2000/svg","svg");this._visible=!0;this._src=null;this._area=null;this._x=0;this._y=0;this._w=0;this._h=0;this._svg.setAttribute("preserveAspectRatio","none"),this._svg.appendChild(this.img=document.createElementNS("http://www.w3.org/2000/svg","image"))}_render(){let r=this.attrib,n=r&Ie,i=Fe(r),o=!(n||1<<i&this.scene.hiddenLayers);if(this._visible!==o&&(this._visible=o,o?this._svg.removeAttribute("display"):this._svg.setAttribute("display","none")),!o)return;let s=this.image,a=this._src!==s.realSrc;a&&this.img.setAttribute("href",this._src=s.realSrc);let c=this.area;if(this._area!==c||a){this._area=c;let E=s.width,v=s.height;if(c){let P=Math.min(Math.max(c.x,0),E),w=Math.min(Math.max(c.y,0),v),O=Math.min(Math.max(c.w,0),E-P),R=Math.min(Math.max(c.h,0),v-w);this._svg.setAttribute("viewBox",`${P} ${w} ${O} ${R}`)}else this._svg.setAttribute("viewBox",`0 0 ${E} ${v}`)}let h=this.x-this.scene.x,d=this.y-this.scene.y,g=this.width,y=this.height;this._x!==h&&this._svg.setAttribute("x",(this._x=h).toString()),this._y!==d&&this._svg.setAttribute("y",(this._y=d).toString()),this._w!==g&&this._svg.setAttribute("width",(this._w=g).toString()),this._h!==y&&this._svg.setAttribute("height",(this._h=y).toString())}};var Et=class extends Me{constructor(r,n,i){super(r,i);this.inputType=n;this.type="input";this.value="";this.style=0;this.font=null;this.set(i)}set(s){var a=s,{value:r=this.value,style:n=this.style,font:i=this.font}=a,o=we(a,["value","style","font"]);var c,h;return this.value=r,this.style=n,this.font!==i&&((c=this.font)==null||c.subs.delete(this),this.font=i,(h=this.font)==null||h.subs.add(this)),super.set(o)}toJSON(){let{inputType:r,style:n,font:i,type:o,value:s}=this;return X(J({},super.toJSON()),{type:o,inputType:r,exStyle:0,font:i==null?void 0:i.key,style:n,value:s})}delete(r){let{font:n}=this;return n&&(n.subs.delete(this),r||n.delete()),super.delete()}toString(){return`\u042D\u043B\u0435\u043C\u0435\u043D\u0442 \u0438\u043D\u0442\u0435\u0440\u0444\u0435\u0439\u0441\u0430 '${this.inputType}'`}};var vt=class extends Et{constructor(r,n,i){super(r,n,i);this._svg=!1;this._html=document.createElement("input");this.st=this._html.style;this._visible=!0;this._css=null;this._value="";this._x=0;this._y=0;this._w=0;this._h=0;let o=this._html;n==="Button"?(o.setAttribute("type","button"),o.setAttribute("class","swg-input swg-button"),o.addEventListener("click",this)):(o.setAttribute("type","text"),o.setAttribute("class","swg-input swg-textbox"),o.setAttribute("spellcheck","false"),o.addEventListener("input",this)),this.st.setProperty("position","absolute"),this.st.pointerEvents=r.disableInputs?"none":"auto",o.addEventListener("focus",this),o.addEventListener("blur",this)}handleEvent(r){var s;let n=this,{scene:i,_html:o}=this;this.value=this._value=o.value,(s=i.oninputchanged)==null||s.call(i,{type:r.type,scene:i,target:n})}_render(){var g;let r=this.attrib,n=r&Ie,i=Fe(r),o=!(n||1<<i&this.scene.hiddenLayers);if(this._visible!==o&&(this._visible=o,o?this.st.removeProperty("display"):this.st.setProperty("display","none")),!o)return;let s=((g=this.font)==null?void 0:g.css())||null;if(this._css!==s)if(this._css=s,s){let E=`${s.fontWeight} ${s.fontStyle} ${s.fontSize*.566726660156244}px ${s.fontFamily}`;this.st.setProperty("font",E)}else this.st.removeProperty("font");this._value!==this.value&&(this._html.value=this._value=this.value);let a=this.x-this.scene.x,c=this.y-this.scene.y,h=this.width,d=this.height;this._x!==a&&this.st.setProperty("left",(this._x=a).toString()+"px"),this._y!==c&&this.st.setProperty("top",(this._y=c).toString()+"px"),this._w!==h&&this.st.setProperty("width",(this._w=h).toString()+"px"),this._h!==d&&this.st.setProperty("height",(this._h=d).toString()+"px")}};var _t=class extends Me{constructor(r,n,i){super(r,i);this.type="line";this._coordsDirty=!0;this.pen=null;this.brush=null;this.start=null;this.end=null;this.setCoords(n).set(i)}get length(){return this.coords.length/2}set(a){var c=a,{pen:r=this.pen,brush:n=this.brush,start:i=this.start,end:o=this.end}=c,s=we(c,["pen","brush","start","end"]);var h,d,g,y;return this.pen!==r&&((h=this.pen)==null||h.subs.delete(this),this.pen=r,(d=this.pen)==null||d.subs.add(this)),this.brush!==n&&((g=this.brush)==null||g.subs.delete(this),this.brush=n,(y=this.brush)==null||y.subs.add(this)),this.start=i,this.end=o,super.set(s)}addPoint({x:r,y:n},i=this.length){let o=i*2,s=this.coords,a=r-this.x,c=n-this.y;return o<0||o>=s.length?s.push(a,c):s.splice(o,0,a,c),this._pointCountChanged(),!0}point(r){let n=r*2,i=this.coords;return n>=0&&n<i.length?{x:i[n]+this.x,y:i[n+1]+this.y}:null}setPoint(r,{x:n,y:i}){let o=r*2,s=this.coords;return o<0||o>=s.length?!1:(s[o+0]=n-this.x,s[o+1]=i-this.y,this._pointCountChanged(),!0)}delPoint(r){let n=r*2,i=this.coords;return i.length<=2||n<0||n>=i.length?!1:(i.splice(n,2),this._pointCountChanged(),!0)}setCoords(r){if(!r.length||r.length%2)throw Error("\u041A\u043E\u043B\u0438\u0447\u0435\u0441\u0442\u0432\u043E \u043A\u043E\u043E\u0440\u0434\u0438\u043D\u0430\u0442 \u0434\u043E\u043B\u0436\u043D\u043E \u0431\u044B\u0442\u044C \u0447\u0435\u0442\u043D\u044B\u043C.");return this.x=0,this.y=0,this.coords=r.slice(),this._pointCountChanged(),this}inside(r,n,i){let{coords:o,brush:s}=this;return s&&Xo(o,r,n)||Yo(o,!!s,i,r,n)}_pointCountChanged(){var a;let r=this.coords,n=r[0],i=r[1],o=n,s=i;for(let c=2;c<r.length;c+=2){let h=r[c+0],d=r[c+1];h<n&&(n=h),h>o&&(o=h),d<i&&(i=d),d>s&&(s=d)}if(n!==0||i!==0)for(let c=0;c<r.length;c+=2)r[c+0]-=n,r[c+1]-=i;this._virtualUpdateBBox(this.x+n,this.y+i,o-n,s-i),(a=this.parent)==null||a._childChanged(),this._coordsDirty=this.scene._dirty=!0}_virtualResized(r,n,i,o){let s=this.coords;for(let h=0;h<s.length;h+=2)s[h+0]*=i,s[h+1]*=o;let a=r+(this.x-r)*i,c=n+(this.y-n)*o;this._virtualUpdateBBox(a,c,this.width*i,this.height*o),this._coordsDirty=!0}_virtualRotated(r,n,i){let o=this.coords,s=r-this.x,a=n-this.y,c=Math.sin(i),h=Math.cos(i),d=1/0,g=-1/0,y=1/0,E=-1/0;for(let v=0;v<o.length;v+=2){let P=o[v+0]-s,w=o[v+1]-a,O=P*h-w*c+s,R=P*c+w*h+a;o[v+0]=O,o[v+1]=R,O<d&&(d=O),O>g&&(g=O),R<y&&(y=R),R>E&&(E=R)}if(d!==0||y!==0)for(let v=0;v<o.length;v+=2)o[v+0]-=d,o[v+1]-=y;this._virtualUpdateBBox(this.x+d,this.y+y,g-d,E-y),this._coordsDirty=!0}toJSON(){let{coords:r,brush:n,end:i,pen:o,start:s,type:a}=this;return X(J({},super.toJSON()),{type:a,coords:r.slice(),brush:n==null?void 0:n.key,end:i,pen:o==null?void 0:o.key,start:s})}delete(r){let{pen:n,brush:i}=this;return n&&(n.subs.delete(this),r||n.delete()),i&&(i.subs.delete(this),r||i.delete(r)),super.delete()}toString(){return"\u041F\u043E\u043B\u0438\u043B\u0438\u043D\u0438\u044F"}};var Im=0;function ms(){let e=`mark_${++Im}`,t=document.createElementNS("http://www.w3.org/2000/svg","marker");t.setAttribute("id",e),t.setAttribute("orient","auto"),t.setAttribute("refX","0");let r=document.createElementNS("http://www.w3.org/2000/svg","polyline");return t.appendChild(r),{shape:r,marker:t,id:e}}function ai(e,t,r,n){let i=r.width||1,o=r.stroke(),s=t.fill?o:null,a=t.fill?null:o;e.marker.setAttribute("markerWidth",(t.width+i).toString()),e.marker.setAttribute("markerHeight",(t.oy*2+i).toString()),n&&e.marker.setAttribute("refX",t.width.toString()),e.marker.setAttribute("refY",t.oy.toString()),e.marker.setAttribute("markerUnits","userSpaceOnUse"),e.shape.setAttribute("points",t.coords),e.shape.setAttribute("stroke-width",i.toString()),a?e.shape.setAttribute("stroke",a):e.shape.removeAttribute("stroke"),e.shape.setAttribute("fill",s||"none")}function li(e,t){var o;if(e.angle===0||e.length===0)return null;let r=Math.abs(e.length*Math.sin(e.angle)),n=Math.abs(e.length*Math.cos(e.angle)),i=t?[0,0,n,r,0,r*2]:[n,0,0,r,n,r*2];return{coords:ci(i),fill:(o=e.fill)!=null?o:!1,width:n,oy:r}}function ci(e){let t="";for(let r=0;r<e.length;r+=2)t+=e[r]+","+e[r+1]+" ";return t}function hs(e){let t=document.createElementNS("http://www.w3.org/2000/svg",e);return t.setAttribute("fill-rule","evenodd"),t.setAttribute("stroke-linecap","round"),t.setAttribute("stroke-linejoin","round"),t}var wt=class extends _t{constructor(r,n,i){super(r,n,i);this._visible=!0;this._width=0;this._stroke=null;this._dash=null;this._fill=null;this._blend=null;this._start=null;this._startMark=null;this._end=null;this._endMark=null;this._x=0;this._y=0;this._svg=hs(this._svgType=i.brush&&n.length>4?"polygon":"polyline")}createMarker(r){let n=ms();return this.scene.defs.appendChild(n.marker),this._svg.setAttribute(r?"marker-end":"marker-start",`url(#${n.id})`),n}_render(){var D,B,V,F,Y,K;let r=this.attrib,n=r&Ie,i=r&_r,o=Fe(r),s=this.pen,a=this.brush,c=!n&&!!(s||a)&&(!!i||!(1<<o&this.scene.hiddenLayers));if(this._visible!==c&&(this._visible=c,c?this._svg.removeAttribute("display"):this._svg.setAttribute("display","none")),!c)return;let h=this.brush&&this.length>2?"polygon":"polyline";if(this._svgType!==h){this._svgType=h,this._coordsDirty=!0,this._width=0,this._stroke=null,this._dash=null,this._fill=null,this._blend=null,this._start=null,this._startMark=null,this._end=null,this._endMark=null,this._x=0,this._y=0;let z=hs(h);this._svg.parentElement&&this._svg.replaceWith(z),this._svg=z}this._coordsDirty&&(this._coordsDirty=!1,this._svg.setAttribute("points",ci(this.coords)));let d=(s==null?void 0:s.width)||1,g=(s==null?void 0:s.stroke())||null,y=(s==null?void 0:s.dash())||null;if(this._width!==d){this._width=d;let z=d.toString();this._svg.setAttribute("stroke-width",z),(D=this._startMark)==null||D.shape.setAttribute("stroke-width",z),(B=this._endMark)==null||B.shape.setAttribute("stroke-width",z)}this._stroke!==g&&(this._stroke=g,g?(this._svg.setAttribute("stroke",g),(V=this._startMark)==null||V.shape.setAttribute("stroke",g),(F=this._endMark)==null||F.shape.setAttribute("stroke",g)):this._svg.removeAttribute("stroke")),this._dash!==y&&(this._dash=y,y?this._svg.setAttribute("stroke-dasharray",y):this._svg.removeAttribute("stroke-dasharray"));let E=this.length>2&&(a==null?void 0:a.fill())||"none";this._fill!==E&&(this._fill=E,this._svg.setAttribute("fill",E));let v=(a==null?void 0:a.blend())||(s==null?void 0:s.blend())||null;this._blend!==v&&(this._blend=v,v?this._svg.style.setProperty("mix-blend-mode",v):this._svg.style.removeProperty("mix-blend-mode"));let P=s&&(a?null:this.start),w=s&&(a?null:this.end);if(this._start!==P){this._start=P;let z=P&&li(P,!0);z?ai(this._startMark||(this._startMark=this.createMarker(!0)),z,s,!0):((Y=this._startMark)==null||Y.marker.remove(),this._startMark=null)}if(this._end!==w){this._end=w;let z=w&&li(w,!1);z?ai(this._endMark||(this._endMark=this.createMarker(!1)),z,s,!1):((K=this._endMark)==null||K.marker.remove(),this._endMark=null)}let O=this.x-this.scene.x,R=this.y-this.scene.y;(O!==this._x||R!==this._y)&&(this._x=O,this._y=R,this._svg.setAttribute("transform",`translate(${O}, ${R})`))}};var xt=class extends Me{constructor(r,n,i){var s,a,c;let o=X(J({},i),{width:(s=i.width)!=null?s:n.width,height:(a=i.height)!=null?a:n.height,text:n});super(r,o);this.text=n;this.type="textView";n.subs.add(this),this.angle=(c=i.angle)!=null?c:0,this.set(X(J({},i),{text:n}))}set(i){var o=i,{text:r=this.text}=o,n=we(o,["text"]);return this.text!==r&&(this.text.subs.delete(this),this.text=r,this.text.subs.add(this)),super.set(n)}_virtualRotated(r,n,i){super._virtualRotated(r,n,i),this.angle+=i}toJSON(){let{text:r,angle:n,type:i}=this;return X(J({},super.toJSON()),{type:i,text:r.key,angle:n})}delete(r){let{text:n}=this;return n.subs.delete(this),r||n.delete(r),super.delete()}toString(){return"\u0422\u0435\u043A\u0441\u0442"}};function ds(e){let t=document.createElementNS("http://www.w3.org/2000/svg","tspan");return e&&(t.setAttribute("x","0px"),t.setAttribute("dy","1.15em")),t}var Pt=class{constructor(t,r){this.owner=t;this.part=r;this._strs=[];this._css=null;this._fgcolor=NaN;this.spans=r.string.split().map((n,i)=>ds(i>0))}update(){var s,a;let t=!1,{part:r,spans:n}=this,i=r.string.split(),o=r.font.css();if(this._strs!==i){this._strs=i,t=!0,n.length!==i.length&&(this._fgcolor=NaN);let c;for(let h=0;h<i.length;++h){if(h<n.length)c=n[h];else{let g=ds(!0);n.push(g),c.after(g),c=g,this._css=null}let d=i[h];o.isSymbolFont&&(d=Lr.convert(d)),c.textContent=d||"\u200B"}for(;n.length>i.length;)(s=n.pop())==null||s.remove()}if(this._css!==o&&(this._css=o,t=!0,n.forEach(c=>{c.setAttribute("font-family",o.fontFamily),c.setAttribute("font-size",o.fontSize.toString()),c.setAttribute("font-style",o.fontStyle),c.setAttribute("text-decoration",o.textDecoration),c.setAttribute("font-weight",o.fontWeight)})),this._fgcolor!==r.fgcolor){this._fgcolor=r.fgcolor;let c=(a=vr(r.fgcolor))!=null?a:"transparent";n.forEach(h=>h.setAttribute("fill",c))}return t}};var St=class extends xt{constructor(r,n,i){var o,s;super(r,n,i);this._svg=document.createElementNS("http://www.w3.org/2000/svg","text");this._visible=!0;this._parts=[];this._partsSVG=[];this._sizes={w:0,h:0};this._angle=0;this._x=0;this._y=0;if(this._svg.setAttribute("dominant-baseline","text-before-edge"),this._svg.setAttribute("alignment-baseline","text-before-edge"),this._svg.setAttribute("letter-spacing","-0.07"),this._svg.style.setProperty("white-space","pre"),this._svg.style.setProperty("user-select","none"),n._textCalc=this._calcSizes.bind(this),!i.width||!i.height){let a=(o=i.width)!=null?o:n.width,c=(s=i.height)!=null?s:n.height;this._virtualUpdateBBox(this.x,this.y,a,c)}}_calcSizes(){var a;let r=(a=this.text)==null?void 0:a.parts;if(!r||!this.updateParts(r))return this._sizes;let n=this._svg.parentElement;n||this.scene.root.appendChild(this._svg);let{y:i=0,width:o,height:s}=this._svg.getBBox();return n||this._svg.remove(),this._sizes={w:o,h:i+s}}updateParts(r){if(this._parts!==r){this._parts=r;let n=[];this._partsSVG=r.map(i=>{let o=new Pt(this,i);return n.push(...o.spans),o}),this._svg.replaceChildren(...n)}return this._partsSVG.reduce((n,i)=>i.update()||n,!1)}_render(){var g;let r=this.attrib,n=r&Ie,i=r&_r,o=Fe(r),s=(g=this.text)==null?void 0:g.parts,a=(!!i||!(n||1<<o&this.scene.hiddenLayers))&&!!s;if(this._visible!==a&&(this._visible=a,a?this._svg.removeAttribute("display"):this._svg.setAttribute("display","none")),!a)return;this.updateParts(s);let c=this.x-this.scene.x,h=this.y-this.scene.y,d=this.angle;(c!==this._x||h!==this._y||this._angle!==d)&&(this._x=c,this._y=h,this._angle=d,this._svg.setAttribute("transform",`translate(${c}, ${h}), rotate(${d*180/Math.PI})`))}};var Tt=class extends Me{constructor(r,n){var i;super(r,n);this.type="videoView";this.fixed=!1;this.fixed=(i=n.fixed)!=null?i:this.fixed}set(r){var n;return this.fixed=(n=r.fixed)!=null?n:this.fixed,super.set(r)}toJSON(){throw new Error("Method not implemented.")}toString(){return"\u0412\u0438\u0434\u0435\u043E"}};var ui=class{constructor(t){this.e=t}get width(){return this.e.videoWidth}get height(){return this.e.videoHeight}},Mt=class extends Tt{constructor(r,n,i){super(r,i);this._svg=!1;this._html=document.createElement("video");this.st=this._html.style;this._visible=!0;this._x=0;this._y=0;this._w=0;this._h=0;let o=this._html;o.src=n,this.video=new ui(o),this.st.setProperty("position","absolute"),this.st.setProperty("background","black"),lt.hideVideoControls?this.st.setProperty("pointer-events","none"):(o.setAttribute("controls","true"),this.st.setProperty("pointer-events","auto"))}getState(){let r=this._html;return r.paused?r.currentTime?"pause":"stop":"play"}setPosition(r){let n=this._html;return r!==n.currentTime&&(n.currentTime=r),this}getPosition(){return this._html.currentTime}play(){let r=this._html;return r.paused&&r.play(),this}stop(){let r=this._html;return r.paused||r.pause(),this}pause(){let r=this._html;return r.paused||r.pause(),r.currentTime&&(r.currentTime=0),this}_render(){let r=this.attrib,n=r&Ie,i=Fe(r),o=!(n||1<<i&this.scene.hiddenLayers);if(this._visible!==o&&(this._visible=o,o?this.st.removeProperty("display"):this.st.setProperty("display","none")),!o)return;let s=this.x-this.scene.x,a=this.y-this.scene.y;if(this._x!==s&&this.st.setProperty("left",(this._x=s).toString()+"px"),this._y!==a&&this.st.setProperty("top",(this._y=a).toString()+"px"),this.fixed){let c=this.width,h=this.height;this._w!==c&&this.st.setProperty("width",(this._w=c).toString()+"px"),this._h!==h&&this.st.setProperty("height",(this._h=h).toString()+"px")}}};var Ot=class extends xe{constructor(r,n){super(r,r.brushes,n);this.type="brush";this.color=0;this.style=0;this.rop=0;this.hatch=0;this.image=null;this.set(n)}set({color:r=this.color,hatch:n=this.hatch,image:i=this.image,rop:o=this.rop,style:s=this.style}){var a,c;return this.image!==i&&((a=this.image)==null||a.subs.delete(this),this.image=i,(c=this.image)==null||c.subs.add(this)),this.color=r,this.style=s,this.rop=o,this.hatch=n,this}toJSON(){let{color:r,hatch:n,image:i,rop:o,style:s}=this;return X(J({},super.toJSON()),{color:r,hatch:n,image:i==null?void 0:i.key,rop:o,style:s})}delete(r){if(!super.delete())return!1;let{image:n}=this;return n&&(n.subs.delete(this),r||n.delete()),!0}};var Fm=9,Dm=10,km=0,Gm=1,Lm=3,Wt=class extends Ot{constructor(){super(...arguments);this._color=NaN;this._cssColor=null}cssColor(){return this._color!==this.color?this._cssColor=vr(this._color=this.color):this._cssColor}blend(){switch(this.rop){case Fm:return"multiply";case Dm:return"multiply";default:return null}}fill(){var r,n;switch(this.style){case km:return this.cssColor();case Gm:return null;case Lm:return(n=(r=this.image)==null?void 0:r.pattern())!=null?n:"black";default:return"white"}}};var Bm=ct.map(e=>e.toUpperCase());function Vm(e){if(!e)return ct[0];if(e==="Symbol")return"Times New Roman";let t=e.toUpperCase(),r=t.endsWith(" CYR")?t.slice(0,t.length-4):t;return ct[Math.max(Bm.indexOf(r),0)]}var At=class extends xe{constructor(r,n){super(r,r.fonts,n);this.name="";this.size=0;this.style=0;this._renderedFont=null;this.set(n)}get actualName(){return this._renderedFont||(this._renderedFont=Vm(this.name))}set({name:r=this.name,size:n=this.size,style:i=this.style}){return this.name!==r&&(this.name=r,this._renderedFont=null),this.size=n,this.style=i,this}toJSON(){let{name:r,size:n,style:i}=this;return X(J({},super.toJSON()),{name:r,size:n,style:i})}};var Nt=class extends At{constructor(){super(...arguments);this._size=NaN;this._style=NaN;this._family="";this._decoration="";this._fstyle="";this._weight="";this._css=this.css()}css(){let{actualName:r,size:n,style:i}=this,o=!1;if(this._style!==i){this._style=i,o=!0;let s=i&1,a=i&2,c=i&4,h=i&8;this._decoration=`${a?"underline":""} ${c?"line-through":""}`,this._fstyle=s?"italic":"normal",this._weight=h?"bold":"normal"}return this._family!==r&&(this._family=r,o=!0),this._size!==n&&(this._size=n,o=!0),o?this._css={isSymbolFont:this.name==="Symbol",fontFamily:this._family,textDecoration:this._decoration,fontSize:n||15.940224159402327,fontStyle:this._fstyle,fontWeight:this._weight}:this._css}};var Rt=class extends xe{constructor(t,{width:r,height:n,src:i},o){super(t,o.opaque?t.imagesOpaque:t.images,o),this.width=r,this.height=n,this.src=i,this.realSrc=Te(i)}toJSON(){let{height:t,src:r,width:n}=this;return X(J({},super.toJSON()),{height:t,src:r,width:n})}};var Cm=0,It=class extends Rt{constructor(){super(...arguments);this._pattern=null}pixel(){return 0}setPixel(){return!0}pattern(){if(this._pattern)return this._pattern.url;let r=document.createElementNS("http://www.w3.org/2000/svg","pattern"),n=`patt_${++Cm}`;r.setAttribute("id",n),r.setAttribute("patternUnits","userSpaceOnUse"),r.setAttribute("width",this.width.toString()),r.setAttribute("height",this.height.toString());let i=document.createElementNS("http://www.w3.org/2000/svg","image");i.setAttribute("href",this.realSrc),r.appendChild(i),this.scene.defs.appendChild(r);let o=`url(#${n})`;return this._pattern={e:r,url:o},o}};var Ft=class extends xe{constructor(r,n){super(r,r.pens,n);this.color=0;this.style=0;this.rop=0;this.width=0;this.set(n)}set({color:r,rop:n,style:i,width:o}){return this.color=r!=null?r:this.color,this.style=i!=null?i:this.style,this.rop=n!=null?n:this.rop,this.width=o!=null?o:this.width,this}toJSON(){let{color:r,rop:n,style:i,width:o}=this;return X(J({},super.toJSON()),{color:r,rop:n,style:i,width:o})}};var Km=0,Um=1,Jm=2,jm=3,$m=4,Hm=5,zm=9,qm=10,Dt=class extends Ft{constructor(){super(...arguments);this._color=NaN;this._cssColor=null}cssColor(){return this._color!==this.color?this._cssColor=vr(this._color=this.color):this._cssColor}blend(){switch(this.rop){case zm:return"multiply";case qm:return"multiply";default:return null}}stroke(){return this.style===Hm?null:this.cssColor()}dash(){switch(this.style){case Km:return null;case Um:return"16 4";case Jm:return"2 4";case jm:return"16 4 2 4";case $m:return"16 4 2 4 2 4";default:return null}}};var kt=class extends xe{constructor(r,n,i){super(r,r.strings,i);this.text=n;this.set(X(J({},i),{text:n}))}set({text:r}){return this.text=r!=null?r:this.text,this}toJSON(){let{text:r}=this;return X(J({},super.toJSON()),{text:r})}};var Gt=class extends kt{constructor(){super(...arguments);this._text="";this._parts=[""]}split(){return this._text!==this.text?this._parts=(this._text=this.text).split(`\r
`).join(`
`).split(`
`):this._parts}};var mi=class{constructor(t,{font:r,string:n,fgcolor:i,bgcolor:o}){this.text=t;this.font=r,this.string=n,this.fgcolor=i||0,this.bgcolor=o!=null?o:16777216,r.subs.add(this),n.subs.add(this)}set({font:t=this.font,string:r=this.string,fgcolor:n=this.fgcolor,bgcolor:i=this.bgcolor}){return this.font!==t&&(this.font.subs.delete(this),this.font=t,t.subs.add(this)),this.string!==r&&(this.string.subs.delete(this),this.string=r,r.subs.add(this)),this.fgcolor=n,this.bgcolor=i,this}delete(t){this.font.subs.delete(this),this.string.subs.delete(this),t||(this.font.delete(),this.string.delete())}toJSON(){let{font:t,string:r,fgcolor:n,bgcolor:i}=this;return{font:t.key,string:r.key,fgcolor:n,bgcolor:i}}},Lt=class extends xe{constructor(r,n,i){super(r,r.texts,i);this.type="text";this.parts=[];this.parts=n.map(o=>this.part(o,!0))}set({parts:r=this.parts},n){return this.parts!==r&&(this.parts.forEach(i=>!r.includes(i)&&i.delete(n)),this.parts=r),this}part(r,n){let i=new mi(this,r);return n||(this.parts=this.parts.concat(i)),i}toJSON(){let r=this.parts.map(n=>n.toJSON());return X(J({},super.toJSON()),{parts:r})}delete(r){return super.delete()?(this.parts.forEach(n=>n.delete(r)),!0):!1}};var Bt=class extends Lt{constructor(){super(...arguments);this._textCalc=null}get width(){var r,n;return(n=(r=this._textCalc)==null?void 0:r.call(this).w)!=null?n:0}get height(){var r,n;return(n=(r=this._textCalc)==null?void 0:r.call(this).h)!=null?n:0}};function hi(e,t,r){let n=new Set(r),i=0,o=null;t.forEach(s=>{if(n.delete(s),i<r.length&&s===r[i])++i;else{let a=o?o.nextElementSibling:e.firstElementChild;e.insertBefore(s._svg||s._html,a)}o=s._svg||s._html}),n.forEach(s=>(s._svg||s._html).remove())}var Xm=new We,Vt=new Set,Ct=class e extends bt{constructor(r){super();this._cursor=null;this.prevOrder=[];this.svgOrder=[];this.htmlOrder=[];this.bgRect=null;this._bg=null;let n=this.root=document.createElementNS("http://www.w3.org/2000/svg","svg");n.setAttribute("class","swg-root-svg"),n.style.setProperty("position","absolute"),n.style.setProperty("top","0px"),n.style.setProperty("left","0px"),n.style.setProperty("width","100%"),n.style.setProperty("height","100%"),n.style.setProperty("pointer-events","none");let i=this.defs=document.createElementNS("http://www.w3.org/2000/svg","defs");n.appendChild(i);let o=this.htmlRoot=document.createElement("div");o.setAttribute("class","swg-root-html"),o.style.setProperty("position","absolute"),o.style.setProperty("top","0px"),o.style.setProperty("left","0px"),o.style.setProperty("width","100%"),o.style.setProperty("height","100%"),o.style.setProperty("pointer-events","none");let s=this.view=document.createElement("div");s.style.setProperty("position","relative"),s.style.setProperty("width","100%"),s.style.setProperty("height","100%"),s.style.setProperty("overflow","hidden"),s.style.setProperty("background-color","white"),s.addEventListener("selectstart",ti),s.addEventListener("contextmenu",ti),s.appendChild(n),s.appendChild(o),r&&this.fromJSON(r),Vt.add(this),Xm.run(e.redrawAll)}static redrawAll(){return Vt.forEach(r=>r._render()),Vt.size>0}dispose(){Vt.delete(this)}_render(r=!1){var E,v;if(!r&&!this.view.parentElement)return;let{background:n,prevOrder:i,svgOrder:o,root:s,htmlOrder:a,htmlRoot:c,cursor:h}=this;this._cursor!==h&&(this._cursor=h,this.view.style.cursor=h||"auto");let d=(E=n==null?void 0:n.fill())!=null?E:null,g=!1;if(g=this._bg!==d)if(this._bg=d,d){if(!this.bgRect){let P=document.createElementNS("http://www.w3.org/2000/svg","rect");P.setAttribute("width","100%"),P.setAttribute("height","100%"),this.bgRect={_svg:P,_render:()=>{}}}this.bgRect._svg.setAttribute("fill",d)}else(v=this.bgRect)==null||v._svg.remove(),this.bgRect=null;let y=this.order;if(i!==y||g){let P=this.bgRect?[this.bgRect]:[],w=[];y.forEach(O=>{O._svg?P.push(O):w.push(O)}),o.length>0?hi(s,P,o):s.append(...P.map(O=>O._svg)),a.length>0?hi(c,w,a):w.length>0&&c.append(...w.map(O=>O._html)),this.svgOrder=P,this.htmlOrder=w,this.prevOrder=y}y.forEach(P=>P._render())}toSVG(r,n){let{x:i,y:o,hiddenLayers:s}=this;this.set({x:r.x,y:r.y,hiddenLayers:0}),this._render(!0);let a;return n?(a=this.root,this.dispose()):(a=this.root.cloneNode(!0),this.set({x:i,y:o,hiddenLayers:s}),r&&this._render(!0)),a.removeAttribute("style"),a.removeAttribute("class"),a.setAttribute("viewBox",`0 0 ${r.w} ${r.h}`),a}toBlob(r){let n=this.toSVG(r);n.setAttribute("xmlns:xlink","http://www.w3.org/1999/xlink"),n.setAttribute("width",r.w+"px"),n.setAttribute("height",r.h+"px"),n.setAttribute("preserveAspectRatio","xMidYMid slice");let o=`<?xml version="1.0"?>\r
`+new XMLSerializer().serializeToString(n);return Promise.resolve(new Blob([o],{type:"image/svg+xml"}))}_line(r,n={}){return new wt(this,r,n)}_imageView(r,n={}){return new yt(this,r,n)}_textView(r,n={}){return new St(this,r,n)}_input(r,n={}){return new vt(this,r,n)}_video(r,n={}){return new Mt(this,r,n)}_pen(r={}){return new Dt(this,r)}_brush(r={}){return new Wt(this,r)}_image(r,n={}){return new It(this,r,n)}_string(r,n={}){return new Gt(this,r,n)}_font(r={}){return new Nt(this,r)}_text(r,n={}){return new Bt(this,r,n)}};var ps=Ct;var Se=(l=>(l[l.PI=3.1415926536]="PI",l[l.WORD8=0]="WORD8",l[l.INT8=1]="INT8",l[l.WORD16=2]="WORD16",l[l.INT16=3]="INT16",l[l.WORD32=4]="WORD32",l[l.INT32=5]="INT32",l[l.FLOAT32=6]="FLOAT32",l[l.FLOAT40=7]="FLOAT40",l[l.FLOAT64=8]="FLOAT64",l[l.FLOAT80=9]="FLOAT80",l[l.PEN2D=1]="PEN2D",l[l.BRUSH2D=2]="BRUSH2D",l[l.DIB2D=3]="DIB2D",l[l.DOUBLEDIB2D=4]="DOUBLEDIB2D",l[l.FONT2D=5]="FONT2D",l[l.STRING2D=6]="STRING2D",l[l.TEXT2D=7]="TEXT2D",l[l.SPACE3D=8]="SPACE3D",l[l.TEXTURE3D=9]="TEXTURE3D",l[l.WM_DESTROY=2]="WM_DESTROY",l[l.WM_MOVE=3]="WM_MOVE",l[l.WM_SIZE=5]="WM_SIZE",l[l.WM_CLOSE=16]="WM_CLOSE",l[l.WM_GETMINMAXINFO=36]="WM_GETMINMAXINFO",l[l.WM_COMMAND=273]="WM_COMMAND",l[l.WM_MOUSEMOVE=512]="WM_MOUSEMOVE",l[l.WM_LBUTTONDOWN=513]="WM_LBUTTONDOWN",l[l.WM_LBUTTONUP=514]="WM_LBUTTONUP",l[l.WM_LBUTTONDBLCLK=515]="WM_LBUTTONDBLCLK",l[l.WM_RBUTTONDOWN=516]="WM_RBUTTONDOWN",l[l.WM_RBUTTONUP=517]="WM_RBUTTONUP",l[l.WM_RBUTTONDBLCLK=518]="WM_RBUTTONDBLCLK",l[l.WM_MBUTTONDOWN=519]="WM_MBUTTONDOWN",l[l.WM_MBUTTONUP=520]="WM_MBUTTONUP",l[l.WM_MBUTTONDBLCLK=521]="WM_MBUTTONDBLCLK",l[l.WM_ALLMOUSEMESSAGE=1536]="WM_ALLMOUSEMESSAGE",l[l.WM_ALLKEYMESSAGE=1537]="WM_ALLKEYMESSAGE",l[l.WM_KEYDOWN=256]="WM_KEYDOWN",l[l.WM_KEYUP=257]="WM_KEYUP",l[l.WM_CANCLOSE=1538]="WM_CANCLOSE",l[l.WM_SPACEDONE=1539]="WM_SPACEDONE",l[l.WM_SPACEINIT=1540]="WM_SPACEINIT",l[l.WM_CONTROLNOTIFY=1544]="WM_CONTROLNOTIFY",l[l.WM_HYPERJUMP=1546]="WM_HYPERJUMP",l[l.SIZE_RESTORED=0]="SIZE_RESTORED",l[l.SIZE_MINIMIZED=1]="SIZE_MINIMIZED",l[l.SIZE_MAXIMIZED=2]="SIZE_MAXIMIZED",l[l.SIZE_MAXSHOW=3]="SIZE_MAXSHOW",l[l.SIZE_MAXHIDE=4]="SIZE_MAXHIDE",l[l.OTGROUP2D=3]="OTGROUP2D",l[l.OTRGROUP2D=4]="OTRGROUP2D",l[l.OTGROUP3D=5]="OTGROUP3D",l[l.OTOBJECT3D=10]="OTOBJECT3D",l[l.OTLINE_2D=20]="OTLINE_2D",l[l.OTBITMAP_2D=21]="OTBITMAP_2D",l[l.OTDOUBLEBITMAP_2D=22]="OTDOUBLEBITMAP_2D",l[l.OTTEXT_2D=23]="OTTEXT_2D",l[l.OTVIEW3D_2D=24]="OTVIEW3D_2D",l[l.OTEDITFRAME=50]="OTEDITFRAME",l[l.OTROTATECENTER=51]="OTROTATECENTER",l[l.OTFRAME3D=52]="OTFRAME3D",l[l.OTAXIS3D=53]="OTAXIS3D",l[l.OTPEN2D=101]="OTPEN2D",l[l.OTBRUSH2D=102]="OTBRUSH2D",l[l.OTDIB2D=103]="OTDIB2D",l[l.OTDOUBLEDIB2D=104]="OTDOUBLEDIB2D",l[l.OTFONT2D=105]="OTFONT2D",l[l.OTSTRING2D=106]="OTSTRING2D",l[l.OTTEXT2D=107]="OTTEXT2D",l[l.OTREFTODIB2D=110]="OTREFTODIB2D",l[l.OTREFTODOUBLEDIB2D=111]="OTREFTODOUBLEDIB2D",l[l.ATTRSET=1]="ATTRSET",l[l.ATTRRESET=2]="ATTRRESET",l[l.ATTRPUT=3]="ATTRPUT",l[l.PFC_MOVEOBJECT=32768]="PFC_MOVEOBJECT",l[l.PFC_SETCURRENT=16384]="PFC_SETCURRENT",l[l.PFC_SETFRAME=8192]="PFC_SETFRAME",l[l.PFC_PENS=1]="PFC_PENS",l[l.PFC_BRUHS=2]="PFC_BRUHS",l[l.PFC_DIBS=4]="PFC_DIBS",l[l.PFC_DDIBS=8]="PFC_DDIBS",l[l.PFC_STRINGS=16]="PFC_STRINGS",l[l.PFC_FONTS=32]="PFC_FONTS",l[l.PFC_TEXTS=64]="PFC_TEXTS",l[l.PFC_3D=128]="PFC_3D",l[l.PFC_ALL=255]="PFC_ALL",l[l.OID_RESERVED=32e3]="OID_RESERVED",l[l.OID_RCENTER=32001]="OID_RCENTER",l[l.OID_FRAME2D1=32002]="OID_FRAME2D1",l[l.OID_FRAME2D2=32003]="OID_FRAME2D2",l[l.OID_FRAME2D3=32004]="OID_FRAME2D3",l[l.OID_FRAME2D4=32005]="OID_FRAME2D4",l[l.OID_FRAME2D5=32006]="OID_FRAME2D5",l[l.OID_FRAME2D6=32007]="OID_FRAME2D6",l[l.OID_FRAME2D7=32008]="OID_FRAME2D7",l[l.OID_FRAME2D8=32009]="OID_FRAME2D8",l[l.OID_FRAME2D=32010]="OID_FRAME2D",l[l.OID_AXIS3D=32100]="OID_AXIS3D",l[l.OID_FRAME3D1=32102]="OID_FRAME3D1",l[l.OID_FRAME3D2=32103]="OID_FRAME3D2",l[l.OID_FRAME3D3=32104]="OID_FRAME3D3",l[l.OID_FRAME3D4=32105]="OID_FRAME3D4",l[l.OID_FRAME3D5=32106]="OID_FRAME3D5",l[l.OID_FRAME3D6=32107]="OID_FRAME3D6",l[l.OID_FRAME3D7=32108]="OID_FRAME3D7",l[l.OID_FRAME3D8=32109]="OID_FRAME3D8",l[l.OID_FRAME3D=32110]="OID_FRAME3D",l[l.MB_OK=0]="MB_OK",l[l.MB_OKCANCEL=1]="MB_OKCANCEL",l[l.MB_ABORTRETRYIGNORE=2]="MB_ABORTRETRYIGNORE",l[l.MB_YESNOCANCEL=3]="MB_YESNOCANCEL",l[l.MB_YESNO=4]="MB_YESNO",l[l.MB_RETRYCANCEL=5]="MB_RETRYCANCEL",l[l.MB_TYPEMASK=15]="MB_TYPEMASK",l[l.MB_ICONHAND=16]="MB_ICONHAND",l[l.MB_ICONQUESTION=32]="MB_ICONQUESTION",l[l.MB_ICONEXCLAMATION=48]="MB_ICONEXCLAMATION",l[l.MB_ICONASTERISK=64]="MB_ICONASTERISK",l[l.MB_ICONMASK=240]="MB_ICONMASK",l[l.MB_ICONINFORMATION=64]="MB_ICONINFORMATION",l[l.MB_ICONSTOP=16]="MB_ICONSTOP",l[l.MB_DEFBUTTON1=0]="MB_DEFBUTTON1",l[l.MB_DEFBUTTON2=256]="MB_DEFBUTTON2",l[l.MB_DEFBUTTON3=512]="MB_DEFBUTTON3",l[l.MB_DEFMASK=3840]="MB_DEFMASK",l[l.MB_APPLMODAL=0]="MB_APPLMODAL",l[l.MB_SYSTEMMODAL=4096]="MB_SYSTEMMODAL",l[l.MB_TASKMODAL=8192]="MB_TASKMODAL",l[l.MB_NOFOCUS=32768]="MB_NOFOCUS",l[l.SW_HIDE=0]="SW_HIDE",l[l.SW_SHOWNORMAL=1]="SW_SHOWNORMAL",l[l.SW_NORMAL=1]="SW_NORMAL",l[l.SW_SHOWMINIMIZED=2]="SW_SHOWMINIMIZED",l[l.SW_SHOWMAXIMIZED=3]="SW_SHOWMAXIMIZED",l[l.SW_MAXIMIZE=3]="SW_MAXIMIZE",l[l.SW_SHOWNOACTIVATE=4]="SW_SHOWNOACTIVATE",l[l.SW_SHOW=5]="SW_SHOW",l[l.SW_MINIMIZE=6]="SW_MINIMIZE",l[l.SW_SHOWMINNOACTIVE=7]="SW_SHOWMINNOACTIVE",l[l.SW_SHOWNA=8]="SW_SHOWNA",l[l.SW_RESTORE=9]="SW_RESTORE",l[l.MCIERR_INVALID_DEVICE_ID=257]="MCIERR_INVALID_DEVICE_ID",l[l.MCIERR_UNRECOGNIZED_KEYWORD=259]="MCIERR_UNRECOGNIZED_KEYWORD",l[l.MCIERR_UNRECOGNIZED_COMMAND=261]="MCIERR_UNRECOGNIZED_COMMAND",l[l.MCIERR_HARDWARE=262]="MCIERR_HARDWARE",l[l.MCIERR_INVALID_DEVICE_NAME=263]="MCIERR_INVALID_DEVICE_NAME",l[l.MCIERR_OUT_OF_MEMORY=264]="MCIERR_OUT_OF_MEMORY",l[l.MCIERR_DEVICE_OPEN=265]="MCIERR_DEVICE_OPEN",l[l.MCIERR_CANNOT_LOAD_DRIVER=266]="MCIERR_CANNOT_LOAD_DRIVER",l[l.MCIERR_MISSING_COMMAND_STRING=267]="MCIERR_MISSING_COMMAND_STRING",l[l.MCIERR_PARAM_OVERFLOW=268]="MCIERR_PARAM_OVERFLOW",l[l.MCIERR_MISSING_STRING_ARGUMENT=269]="MCIERR_MISSING_STRING_ARGUMENT",l[l.MCIERR_BAD_INTEGER=270]="MCIERR_BAD_INTEGER",l[l.MCIERR_PARSER_INTERNAL=271]="MCIERR_PARSER_INTERNAL",l[l.MCIERR_DRIVER_INTERNAL=272]="MCIERR_DRIVER_INTERNAL",l[l.MCIERR_MISSING_PARAMETER=273]="MCIERR_MISSING_PARAMETER",l[l.MCIERR_UNSUPPORTED_FUNCTION=274]="MCIERR_UNSUPPORTED_FUNCTION",l[l.MCIERR_FILE_NOT_FOUND=275]="MCIERR_FILE_NOT_FOUND",l[l.MCIERR_DEVICE_NOT_READY=276]="MCIERR_DEVICE_NOT_READY",l[l.MCIERR_INTERNAL=277]="MCIERR_INTERNAL",l[l.MCIERR_DRIVER=278]="MCIERR_DRIVER",l[l.MCIERR_CANNOT_USE_ALL=279]="MCIERR_CANNOT_USE_ALL",l[l.MCIERR_MULTIPLE=280]="MCIERR_MULTIPLE",l[l.MCIERR_EXTENSION_NOT_FOUND=281]="MCIERR_EXTENSION_NOT_FOUND",l[l.MCIERR_OUTOFRANGE=282]="MCIERR_OUTOFRANGE",l[l.MCIERR_FLAGS_NOT_COMPATIBLE=284]="MCIERR_FLAGS_NOT_COMPATIBLE",l[l.MCIERR_FILE_NOT_SAVED=286]="MCIERR_FILE_NOT_SAVED",l[l.MCIERR_DEVICE_TYPE_REQUIRED=287]="MCIERR_DEVICE_TYPE_REQUIRED",l[l.MCIERR_DEVICE_LOCKED=288]="MCIERR_DEVICE_LOCKED",l[l.MCIERR_DUPLICATE_ALIAS=289]="MCIERR_DUPLICATE_ALIAS",l[l.MCIERR_BAD_CONSTANT=290]="MCIERR_BAD_CONSTANT",l[l.MCIERR_MUST_USE_SHAREABLE=291]="MCIERR_MUST_USE_SHAREABLE",l[l.MCIERR_MISSING_DEVICE_NAME=292]="MCIERR_MISSING_DEVICE_NAME",l[l.MCIERR_BAD_TIME_FORMAT=293]="MCIERR_BAD_TIME_FORMAT",l[l.MCIERR_NO_CLOSING_QUOTE=294]="MCIERR_NO_CLOSING_QUOTE",l[l.MCIERR_DUPLICATE_FLAGS=295]="MCIERR_DUPLICATE_FLAGS",l[l.MCIERR_INVALID_FILE=296]="MCIERR_INVALID_FILE",l[l.MCIERR_NULL_PARAMETER_BLOCK=297]="MCIERR_NULL_PARAMETER_BLOCK",l[l.MCIERR_UNNAMED_RESOURCE=298]="MCIERR_UNNAMED_RESOURCE",l[l.MCIERR_NEW_REQUIRES_ALIAS=299]="MCIERR_NEW_REQUIRES_ALIAS",l[l.MCIERR_NOTIFY_ON_AUTO_OPEN=300]="MCIERR_NOTIFY_ON_AUTO_OPEN",l[l.MCIERR_NO_ELEMENT_ALLOWED=301]="MCIERR_NO_ELEMENT_ALLOWED",l[l.MCIERR_NONAPPLICABLE_FUNCTION=302]="MCIERR_NONAPPLICABLE_FUNCTION",l[l.MCIERR_ILLEGAL_FOR_AUTO_OPEN=303]="MCIERR_ILLEGAL_FOR_AUTO_OPEN",l[l.MCIERR_FILENAME_REQUIRED=304]="MCIERR_FILENAME_REQUIRED",l[l.MCIERR_EXTRA_CHARACTERS=305]="MCIERR_EXTRA_CHARACTERS",l[l.MCIERR_DEVICE_NOT_INSTALLED=306]="MCIERR_DEVICE_NOT_INSTALLED",l[l.MCIERR_GET_CD=307]="MCIERR_GET_CD",l[l.MCIERR_SET_CD=308]="MCIERR_SET_CD",l[l.MCIERR_SET_DRIVE=309]="MCIERR_SET_DRIVE",l[l.MCIERR_DEVICE_LENGTH=310]="MCIERR_DEVICE_LENGTH",l[l.MCIERR_DEVICE_ORD_LENGTH=311]="MCIERR_DEVICE_ORD_LENGTH",l[l.MCIERR_NO_INTEGER=312]="MCIERR_NO_INTEGER",l[l.MCIERR_WAVE_OUTPUTSINUSE=320]="MCIERR_WAVE_OUTPUTSINUSE",l[l.MCIERR_WAVE_SETOUTPUTINUSE=321]="MCIERR_WAVE_SETOUTPUTINUSE",l[l.MCIERR_WAVE_INPUTSINUSE=322]="MCIERR_WAVE_INPUTSINUSE",l[l.MCIERR_WAVE_SETINPUTINUSE=323]="MCIERR_WAVE_SETINPUTINUSE",l[l.MCIERR_WAVE_OUTPUTUNSPECIFIED=324]="MCIERR_WAVE_OUTPUTUNSPECIFIED",l[l.MCIERR_WAVE_INPUTUNSPECIFIED=325]="MCIERR_WAVE_INPUTUNSPECIFIED",l[l.MCIERR_WAVE_OUTPUTSUNSUITABLE=326]="MCIERR_WAVE_OUTPUTSUNSUITABLE",l[l.MCIERR_WAVE_SETOUTPUTUNSUITABLE=327]="MCIERR_WAVE_SETOUTPUTUNSUITABLE",l[l.MCIERR_WAVE_INPUTSUNSUITABLE=328]="MCIERR_WAVE_INPUTSUNSUITABLE",l[l.MCIERR_WAVE_SETINPUTUNSUITABLE=329]="MCIERR_WAVE_SETINPUTUNSUITABLE",l[l.MCIERR_SEQ_DIV_INCOMPATIBLE=336]="MCIERR_SEQ_DIV_INCOMPATIBLE",l[l.MCIERR_SEQ_PORT_INUSE=337]="MCIERR_SEQ_PORT_INUSE",l[l.MCIERR_SEQ_PORT_NONEXISTENT=338]="MCIERR_SEQ_PORT_NONEXISTENT",l[l.MCIERR_SEQ_PORT_MAPNODEVICE=339]="MCIERR_SEQ_PORT_MAPNODEVICE",l[l.MCIERR_SEQ_PORT_MISCERROR=340]="MCIERR_SEQ_PORT_MISCERROR",l[l.MCIERR_SEQ_TIMER=341]="MCIERR_SEQ_TIMER",l[l.MCIERR_SEQ_PORTUNSPECIFIED=342]="MCIERR_SEQ_PORTUNSPECIFIED",l[l.MCIERR_SEQ_NOMIDIPRESENT=343]="MCIERR_SEQ_NOMIDIPRESENT",l[l.MCIERR_NO_WINDOW=346]="MCIERR_NO_WINDOW",l[l.MCIERR_CREATEWINDOW=347]="MCIERR_CREATEWINDOW",l[l.MCIERR_FILE_READ=348]="MCIERR_FILE_READ",l[l.MCIERR_FILE_WRITE=349]="MCIERR_FILE_WRITE",l[l.WS_VISIBLE=268435456]="WS_VISIBLE",l[l.WS_DISABLED=134217728]="WS_DISABLED",l[l.WS_CAPTION=12582912]="WS_CAPTION",l[l.WS_BORDER=8388608]="WS_BORDER",l[l.WS_DLGFRAME=4194304]="WS_DLGFRAME",l[l.WS_VSCROLL=2097152]="WS_VSCROLL",l[l.WS_HSCROLL=1048576]="WS_HSCROLL",l[l.WS_SYSMENU=524288]="WS_SYSMENU",l[l.WS_THICKFRAME=262144]="WS_THICKFRAME",l[l.WS_MINIMIZEBOX=131072]="WS_MINIMIZEBOX",l[l.WS_MAXIMIZEBOX=65536]="WS_MAXIMIZEBOX",l[l.WS_GROUP=131072]="WS_GROUP",l[l.WS_TABSTOP=65536]="WS_TABSTOP",l[l.WS_OVERLAPPED=0]="WS_OVERLAPPED",l[l.WS_POPUP=2147483648]="WS_POPUP",l[l.WS_CHILD=1073741824]="WS_CHILD",l[l.IDX_PRIMARY=1]="IDX_PRIMARY",l[l.IDX_UNIQUE=2]="IDX_UNIQUE",l[l.IDX_DESCENDING=4]="IDX_DESCENDING",l[l.IDX_MAINTAINED=8]="IDX_MAINTAINED",l[l.IDX_SUBSET=16]="IDX_SUBSET",l[l.IDX_EXPR=32]="IDX_EXPR",l[l.IDX_IDXOOD=64]="IDX_IDXOOD",l[l.IDX_CASEINSENS=128]="IDX_CASEINSENS",l[l.FLDDBCHAR=513]="FLDDBCHAR",l[l.FLDDBNUM=514]="FLDDBNUM",l[l.FLDDBMEMO=515]="FLDDBMEMO",l[l.FLDDBBOOL=516]="FLDDBBOOL",l[l.FLDDBDATE=517]="FLDDBDATE",l[l.FLDDBFLOAT=518]="FLDDBFLOAT",l[l.FLDDBLOCK=519]="FLDDBLOCK",l[l.FLDDBOLEBLOB=520]="FLDDBOLEBLOB",l[l.FLDDBBINARY=521]="FLDDBBINARY",l[l.FLDDBBYTES=522]="FLDDBBYTES",l[l.BS_PUSHBUTTON=0]="BS_PUSHBUTTON",l[l.BS_DEFPUSHBUTTON=1]="BS_DEFPUSHBUTTON",l[l.BS_CHECKBOX=2]="BS_CHECKBOX",l[l.BS_AUTOCHECKBOX=3]="BS_AUTOCHECKBOX",l[l.BS_RADIOBUTTON=4]="BS_RADIOBUTTON",l[l.BS_3STATE=5]="BS_3STATE",l[l.BS_AUTO3STATE=6]="BS_AUTO3STATE",l[l.BS_GROUPBOX=7]="BS_GROUPBOX",l[l.BS_USERBUTTON=8]="BS_USERBUTTON",l[l.BS_AUTORADIOBUTTON=9]="BS_AUTORADIOBUTTON",l[l.BS_OWNERDRAW=11]="BS_OWNERDRAW",l[l.BS_LEFTTEXT=32]="BS_LEFTTEXT",l[l.ES_LEFT=0]="ES_LEFT",l[l.ES_CENTER=1]="ES_CENTER",l[l.ES_RIGHT=2]="ES_RIGHT",l[l.ES_MULTILINE=4]="ES_MULTILINE",l[l.ES_UPPERCASE=8]="ES_UPPERCASE",l[l.ES_LOWERCASE=16]="ES_LOWERCASE",l[l.ES_PASSWORD=32]="ES_PASSWORD",l[l.ES_AUTOVSCROLL=64]="ES_AUTOVSCROLL",l[l.ES_AUTOHSCROLL=128]="ES_AUTOHSCROLL",l[l.ES_NOHIDESEL=256]="ES_NOHIDESEL",l[l.SBS_HORZ=0]="SBS_HORZ",l[l.SBS_VERT=1]="SBS_VERT",l[l.SBS_TOPALIGN=2]="SBS_TOPALIGN",l[l.SBS_LEFTALIGN=2]="SBS_LEFTALIGN",l[l.SBS_BOTTOMALIGN=4]="SBS_BOTTOMALIGN",l[l.SBS_RIGHTALIGN=4]="SBS_RIGHTALIGN",l[l.SBS_SIZEBOXTOPLEFTALIGN=2]="SBS_SIZEBOXTOPLEFTALIGN",l[l.SBS_SIZEBOXBOTTOMRIGHTALIGN=4]="SBS_SIZEBOXBOTTOMRIGHTALIGN",l[l.SBS_SIZEBOX=8]="SBS_SIZEBOX",l[l.LBS_NOTIFY=1]="LBS_NOTIFY",l[l.LBS_SORT=2]="LBS_SORT",l[l.LBS_NOREDRAW=4]="LBS_NOREDRAW",l[l.LBS_MULTIPLESEL=8]="LBS_MULTIPLESEL",l[l.LBS_OWNERDRAWFIXED=16]="LBS_OWNERDRAWFIXED",l[l.LBS_OWNERDRAWVARIABLE=32]="LBS_OWNERDRAWVARIABLE",l[l.LBS_HASSTRINGS=64]="LBS_HASSTRINGS",l[l.LBS_USETABSTOPS=128]="LBS_USETABSTOPS",l[l.LBS_NOINTEGRALHEIGHT=256]="LBS_NOINTEGRALHEIGHT",l[l.LBS_MULTICOLUMN=512]="LBS_MULTICOLUMN",l[l.LBS_WANTKEYBOARDINPUT=1024]="LBS_WANTKEYBOARDINPUT",l[l.LBS_EXTENDEDSEL=2048]="LBS_EXTENDEDSEL",l[l.CBS_SIMPLE=1]="CBS_SIMPLE",l[l.CBS_DROPDOWN=2]="CBS_DROPDOWN",l[l.CBS_DROPDOWNLIST=3]="CBS_DROPDOWNLIST",l[l.CBS_OWNERDRAWFIXED=16]="CBS_OWNERDRAWFIXED",l[l.CBS_OWNERDRAWVARIABLE=32]="CBS_OWNERDRAWVARIABLE",l[l.CBS_AUTOHSCROLL=64]="CBS_AUTOHSCROLL",l[l.CBS_OEMCONVERT=128]="CBS_OEMCONVERT",l[l.CBS_SORT=256]="CBS_SORT",l[l.CBS_HASSTRINGS=512]="CBS_HASSTRINGS",l[l.CBS_NOINTEGRALHEIGHT=1024]="CBS_NOINTEGRALHEIGHT",l[l.BS_SOLID=0]="BS_SOLID",l[l.BS_NULL=1]="BS_NULL",l[l.BS_HATCHED=2]="BS_HATCHED",l[l.BS_PATTERN=3]="BS_PATTERN",l[l.BS_GRADIENT_LINEAR=10]="BS_GRADIENT_LINEAR",l[l.HS_HORIZONTAL=0]="HS_HORIZONTAL",l[l.HS_VERTICAL=1]="HS_VERTICAL",l[l.HS_FDIAGONAL=2]="HS_FDIAGONAL",l[l.HS_BDIAGONAL=3]="HS_BDIAGONAL",l[l.HS_CROSS=4]="HS_CROSS",l[l.HS_DIAGCROSS=5]="HS_DIAGCROSS",l[l.PS_SOLID=0]="PS_SOLID",l[l.PS_DASH=1]="PS_DASH",l[l.PS_DOT=2]="PS_DOT",l[l.PS_DASHDOT=3]="PS_DASHDOT",l[l.PS_DASHDOTDOT=4]="PS_DASHDOTDOT",l[l.PS_NULL=5]="PS_NULL",l[l.PS_INSIDEFRAME=6]="PS_INSIDEFRAME",l[l.R2_BLACK=1]="R2_BLACK",l[l.R2_NOTMERGEPEN=2]="R2_NOTMERGEPEN",l[l.R2_MASKNOTPEN=3]="R2_MASKNOTPEN",l[l.R2_NOTCOPYPEN=4]="R2_NOTCOPYPEN",l[l.R2_MASKPENNOT=5]="R2_MASKPENNOT",l[l.R2_NOT=6]="R2_NOT",l[l.R2_XORPEN=7]="R2_XORPEN",l[l.R2_NOTMASKPEN=8]="R2_NOTMASKPEN",l[l.R2_MASKPEN=9]="R2_MASKPEN",l[l.R2_NOTXORPEN=10]="R2_NOTXORPEN",l[l.R2_NOP=11]="R2_NOP",l[l.R2_MERGENOTPEN=12]="R2_MERGENOTPEN",l[l.R2_COPYPEN=13]="R2_COPYPEN",l[l.R2_MERGEPENNOT=14]="R2_MERGEPENNOT",l[l.R2_MERGEPEN=15]="R2_MERGEPEN",l[l.R2_WHITE=16]="R2_WHITE",l[l.FILE_ATTRIBUTE_ARCHIVE=32]="FILE_ATTRIBUTE_ARCHIVE",l[l.FILE_ATTRIBUTE_COMPRESSED=2048]="FILE_ATTRIBUTE_COMPRESSED",l[l.FILE_ATTRIBUTE_DIRECTORY=16]="FILE_ATTRIBUTE_DIRECTORY",l[l.FILE_ATTRIBUTE_HIDDEN=2]="FILE_ATTRIBUTE_HIDDEN",l[l.FILE_ATTRIBUTE_NORMAL=128]="FILE_ATTRIBUTE_NORMAL",l[l.FILE_ATTRIBUTE_OFFLINE=4096]="FILE_ATTRIBUTE_OFFLINE",l[l.FILE_ATTRIBUTE_READONLY=1]="FILE_ATTRIBUTE_READONLY",l[l.FILE_ATTRIBUTE_SYSTEM=4]="FILE_ATTRIBUTE_SYSTEM",l[l.FILE_ATTRIBUTE_TEMPORARY=256]="FILE_ATTRIBUTE_TEMPORARY",l[l.VF_LOCAL=2]="VF_LOCAL",l[l.VF_EQVAR=256]="VF_EQVAR",l[l.VF_ARGUMENT=512]="VF_ARGUMENT",l[l.VF_RETURN=1024]="VF_RETURN",l[l.CUR_ARROW=0]="CUR_ARROW",l[l.CUR_CROSS=1]="CUR_CROSS",l[l.CUR_TEXT=2]="CUR_TEXT",l[l.CUR_NO=3]="CUR_NO",l[l.CUR_SIZE=4]="CUR_SIZE",l[l.CUR_SIZENESW=5]="CUR_SIZENESW",l[l.CUR_SIZENS=6]="CUR_SIZENS",l[l.CUR_SIZENWSE=7]="CUR_SIZENWSE",l[l.CUR_SIZEWE=8]="CUR_SIZEWE",l[l.CUR_UPARROW=9]="CUR_UPARROW",l[l.CUR_WAIT=10]="CUR_WAIT",l[l.CUR_LINK=11]="CUR_LINK",l[l.CUR_HELP=12]="CUR_HELP",l[l.SHADOWTYPE_STENCIL_MODULATIVE=18]="SHADOWTYPE_STENCIL_MODULATIVE",l[l.SHADOWTYPE_STENCIL_ADDITIVE=17]="SHADOWTYPE_STENCIL_ADDITIVE",l[l.SHADOWTYPE_TEXTURE_MODULATIVE=34]="SHADOWTYPE_TEXTURE_MODULATIVE",l[l.SHADOWTYPE_TEXTURE_ADDITIVE=33]="SHADOWTYPE_TEXTURE_ADDITIVE",l[l.FOG_NONE=0]="FOG_NONE",l[l.FOG_EXP=1]="FOG_EXP",l[l.FOG_EXP2=2]="FOG_EXP2",l[l.FOG_LINEAR=3]="FOG_LINEAR",l[l.TEX_TYPE_1D=1]="TEX_TYPE_1D",l[l.TEX_TYPE_2D=2]="TEX_TYPE_2D",l[l.TEX_TYPE_3D=3]="TEX_TYPE_3D",l[l.TEX_TYPE_CUBE_MAP=4]="TEX_TYPE_CUBE_MAP",l[l.SBF_ONE=0]="SBF_ONE",l[l.SBF_ZERO=1]="SBF_ZERO",l[l.SBF_DEST_COLOUR=2]="SBF_DEST_COLOUR",l[l.SBF_SOURCE_COLOUR=3]="SBF_SOURCE_COLOUR",l[l.SBF_ONE_MINUS_DEST_COLOUR=4]="SBF_ONE_MINUS_DEST_COLOUR",l[l.SBF_ONE_MINUS_SOURCE_COLOUR=5]="SBF_ONE_MINUS_SOURCE_COLOUR",l[l.SBF_DEST_ALPHA=6]="SBF_DEST_ALPHA",l[l.SBF_SOURCE_ALPHA=7]="SBF_SOURCE_ALPHA",l[l.SBF_ONE_MINUS_DEST_ALPHA=8]="SBF_ONE_MINUS_DEST_ALPHA",l[l.SBF_ONE_MINUS_SOURCE_ALPHA=9]="SBF_ONE_MINUS_SOURCE_ALPHA",l[l.CMPF_ALWAYS_FAIL=0]="CMPF_ALWAYS_FAIL",l[l.CMPF_ALWAYS_PASS=1]="CMPF_ALWAYS_PASS",l[l.CMPF_LESS=2]="CMPF_LESS",l[l.CMPF_LESS_EQUAL=3]="CMPF_LESS_EQUAL",l[l.CMPF_EQUAL=4]="CMPF_EQUAL",l[l.CMPF_NOT_EQUAL=5]="CMPF_NOT_EQUAL",l[l.CMPF_GREATER_EQUAL=6]="CMPF_GREATER_EQUAL",l[l.CMPF_GREATER=7]="CMPF_GREATER",l[l.CULL_NONE=1]="CULL_NONE",l[l.CULL_CLOCKWISE=2]="CULL_CLOCKWISE",l[l.CULL_ANTICLOCKWISE=3]="CULL_ANTICLOCKWISE",l[l.SO_FLAT=0]="SO_FLAT",l[l.SO_GOURAUD=1]="SO_GOURAUD",l[l.SO_PHONG=2]="SO_PHONG",l[l.PM_POINTS=1]="PM_POINTS",l[l.PM_WIREFRAME=2]="PM_WIREFRAME",l[l.PM_SOLID=3]="PM_SOLID",l[l.LT_POINT=0]="LT_POINT",l[l.LT_DIRECTIONAL=1]="LT_DIRECTIONAL",l[l.LT_SPOTLIGHT=2]="LT_SPOTLIGHT",l[l.PT_ORTHOGRAPHIC=0]="PT_ORTHOGRAPHIC",l[l.PT_PERSPECTIVE=1]="PT_PERSPECTIVE",l[l.OT_POINT_LIST=1]="OT_POINT_LIST",l[l.OT_LINE_LIST=2]="OT_LINE_LIST",l[l.OT_LINE_STRIP=3]="OT_LINE_STRIP",l[l.OT_TRIANGLE_LIST=4]="OT_TRIANGLE_LIST",l[l.OT_TRIANGLE_STRIP=5]="OT_TRIANGLE_STRIP",l[l.OT_TRIANGLE_FAN=6]="OT_TRIANGLE_FAN",l[l.BBT_POINT=0]="BBT_POINT",l[l.BBT_ORIENTED_COMMON=1]="BBT_ORIENTED_COMMON",l[l.BBT_ORIENTED_SELF=2]="BBT_ORIENTED_SELF",l[l.BBT_PERPENDICULAR_COMMON=3]="BBT_PERPENDICULAR_COMMON",l[l.BBT_PERPENDICULAR_SELF=4]="BBT_PERPENDICULAR_SELF",l[l.GMM_RELATIVE=0]="GMM_RELATIVE",l[l.GMM_PIXELS=1]="GMM_PIXELS",l[l.GMM_RELATIVE_ASPECT_ADJUSTED=2]="GMM_RELATIVE_ASPECT_ADJUSTED",l[l.GHA_LEFT=0]="GHA_LEFT",l[l.GHA_CENTER=1]="GHA_CENTER",l[l.GHA_RIGHT=2]="GHA_RIGHT",l[l.GVA_TOP=0]="GVA_TOP",l[l.GVA_CENTER=1]="GVA_CENTER",l[l.GVA_BOTTOM=2]="GVA_BOTTOM",l[l.MTHA_LEFT=0]="MTHA_LEFT",l[l.MTHA_CENTER=1]="MTHA_CENTER",l[l.MTVA_BELOW=0]="MTVA_BELOW",l[l.MTVA_ABOVE=1]="MTVA_ABOVE",l[l.MTVA_CENTER=2]="MTVA_CENTER",l[l.PT_BOOL=0]="PT_BOOL",l[l.PT_REAL=1]="PT_REAL",l[l.PT_INT=2]="PT_INT",l[l.PT_UNSIGNED_INT=3]="PT_UNSIGNED_INT",l[l.PT_SHORT=4]="PT_SHORT",l[l.PT_UNSIGNED_SHORT=5]="PT_UNSIGNED_SHORT",l[l.PT_LONG=6]="PT_LONG",l[l.PT_UNSIGNED_LONG=7]="PT_UNSIGNED_LONG",l[l.PT_STRING=8]="PT_STRING",l[l.PT_VECTOR3=9]="PT_VECTOR3",l[l.PT_MATRIX3=10]="PT_MATRIX3",l[l.PT_MATRIX4=11]="PT_MATRIX4",l[l.PT_QUATERNION=12]="PT_QUATERNION",l[l.PT_COLOURVALUE=13]="PT_COLOURVALUE",l[l.NUI_SP_HIP_CENTER=0]="NUI_SP_HIP_CENTER",l[l.NUI_SP_SPINE=1]="NUI_SP_SPINE",l[l.NUI_SP_SHOULDER_CENTER=2]="NUI_SP_SHOULDER_CENTER",l[l.NUI_SP_HEAD=3]="NUI_SP_HEAD",l[l.NUI_SP_SHOULDER_LEFT=4]="NUI_SP_SHOULDER_LEFT",l[l.NUI_SP_ELBOW_LEFT=5]="NUI_SP_ELBOW_LEFT",l[l.NUI_SP_WRIST_LEFT=6]="NUI_SP_WRIST_LEFT",l[l.NUI_SP_HAND_LEFT=7]="NUI_SP_HAND_LEFT",l[l.NUI_SP_SHOULDER_RIGHT=8]="NUI_SP_SHOULDER_RIGHT",l[l.NUI_SP_ELBOW_RIGHT=9]="NUI_SP_ELBOW_RIGHT",l[l.NUI_SP_WRIST_RIGHT=10]="NUI_SP_WRIST_RIGHT",l[l.NUI_SP_HAND_RIGHT=11]="NUI_SP_HAND_RIGHT",l[l.NUI_SP_HIP_LEFT=12]="NUI_SP_HIP_LEFT",l[l.NUI_SP_KNEE_LEFT=13]="NUI_SP_KNEE_LEFT",l[l.NUI_SP_ANKLE_LEFT=14]="NUI_SP_ANKLE_LEFT",l[l.NUI_SP_FOOT_LEFT=15]="NUI_SP_FOOT_LEFT",l[l.NUI_SP_HIP_RIGHT=16]="NUI_SP_HIP_RIGHT",l[l.NUI_SP_KNEE_RIGHT=17]="NUI_SP_KNEE_RIGHT",l[l.NUI_SP_ANKLE_RIGHT=18]="NUI_SP_ANKLE_RIGHT",l[l.NUI_SP_FOOT_RIGHT=19]="NUI_SP_FOOT_RIGHT",l[l.NUI_SP_COUNT=20]="NUI_SP_COUNT",l))(Se||{});var ce=(i=>(i[i.FLOAT=1]="FLOAT",i[i.STRING=2]="STRING",i[i.HANDLE=3]="HANDLE",i[i.COLORREF=4]="COLORREF",i))(ce||{});function gs(e,t,r,n){let{children:i}=e,o=i.length?i[0]:null,s=dt(e.scene,t,n).set({x:e.x,y:e.y,attrib:e.attrib});if(o){let a=e.attrib|1;r?(o.set({attrib:a}),s.set({width:o.width,height:o.height})):o.set({attrib:a,width:1,height:1})}return e.set({children:i.concat(s)}),s}function Qm(e){return(e.startsWith("#")?parseInt(e.slice(1)):parseInt(e))||0}function Kt(e,t){switch(e){case 1:{let r=parseFloat(t.replace(",","."));if(!isNaN(r))return r;let n=Se[t.toUpperCase()];return typeof n=="number"?n:null}case 3:return Qm(t);case 2:return t;case 4:return is(t)}}function bs(e,t){switch(e){case 1:case 2:return t.toString();case 3:return"#"+t;case 4:return ls(t)}}function di(e){return new Function("s","m","c",e)}function fs(e){return di(e)}function ys(e){return e.map(t=>di(t))}function Es(e){return e.map(t=>di(t))}var De=8,Ve=(i=>(i[i.FLOAT_REF=1|De]="FLOAT_REF",i[i.STRING_REF=2|De]="STRING_REF",i[i.HANDLE_REF=3|De]="HANDLE_REF",i[i.COLORREF_REF=4|De]="COLORREF_REF",i))(Ve||{});var Ut=class{constructor(){this.blocks=[]}pushBlock(t){return this.blocks.push(t),t}popBlock(t){let r=this.blocks.pop();if((r==null?void 0:r.expect)!==t)throw Error(`\u041E\u0436\u0438\u0434\u0430\u043B\u043E\u0441\u044C ${t}`);return r}lastBlock(){return this.blocks.length>0?this.blocks[this.blocks.length-1]:null}haveABreakHaveAKitKat(){for(let t=this.blocks.length-1;t>=0;--t)if(this.blocks[t].canBreak)return"break;";return"return;"}};var Zm=`function arccos(a) {
    if (a > 1) return 0;
    if (a < -1) return Math.PI;
    return Math.acos(a) || 0;
}`,eh=`function arcsin(a) {
    if (a > 1) return Math.PI / 2;
    if (a < -1) return -Math.PI / 2;
    return Math.asin(a) || 0;
}`,rh=`function change(s1, s2, s3) {
    return s1.split(s2).join(s3);
}`,th=`function compareI(s1, s2, n) {
    return s1.substring(0, n) === s2.substring(0, n) ? 1 : 0;
}`,nh=`function getAngleByXY(x, y) {
    if (y === 0) return x >= 0 ? 0 : Math.PI;
    if (y > 0) return -Math.atan(x / y) + Math.PI / 2;
    return -Math.atan(x / y) + Math.PI * 1.5;
}`,ih=`function lg(a) {
    return a > 0 ? (Math.log(a) || 0) / Math.LN10 : -(10 ** 100);
}`,oh=`function ln(a) {
    return a > 0 ? Math.log(a) || 0 : -(10 ** 100);
}`,sh=`function log(a, b) {
    return a > 0 && b > 0 ? Math.log(b) / Math.log(a) || 0 : -(10 ** 100);
}`,ah=`function pos(s1, s2, n) {
    if (s2 === "") return -1;
    var idx = -1;
    var search = 0;
    for (var i = 0; i < n; ++i) {
        idx = s1.indexOf(s2, search);
        if (idx < 0) return -1;
        search = idx + s2.length;
    }
    return idx;
}`,lh=`function right(a, n) {
    return a.substring(a.length - n);
}`,ch=`function round(a, b) {
    var pw = Math.ceil(10 ** b);
    return Math.round(a * pw - Number.EPSILON) / pw || 0;
}`,uh=`function substr(src, from, length) {
    return src.substring(from, Math.max(from, 0) + length);
}`,mh=`function string(value) {
    return (Math.round(value * 100000) / 100000).toString();
}`,{FLOAT:G,STRING:oe,HANDLE:Jt,COLORREF:hh}=ce,pi={argTypes:[G],retType:oe,type:"header",path:"string",body:mh},dh=[["ABS",{argTypes:[G],retType:G,type:"template",template:"Math.abs(#0) || 0"}],["ALLTRIM",{argTypes:[oe],retType:oe,type:"template",template:"(#0).trim()"}],["AND",{argTypes:[G,G],retType:G,type:"template",template:"(#0) && (#1) ? 1 : 0"}],["ARCCOS",{argTypes:[G],retType:G,type:"header",path:"arccos",body:Zm}],["ARCSIN",{argTypes:[G],retType:G,type:"header",path:"arcsin",body:eh}],["ARCTAN",{argTypes:[G],retType:G,type:"template",template:"Math.atan(#0)||0"}],["AVERAGE",{argTypes:[G,G],retType:G,type:"template",template:"(#0) / 2 + (#1) / 2"}],["CHANGE",{argTypes:[oe,oe,oe],retType:oe,type:"header",path:"change",body:rh}],["COMPARE",{argTypes:[oe,oe],retType:G,type:"template",template:"(#0) == (#1) ? 1 : 0"}],["COMPAREI",{argTypes:[oe,oe,G],retType:G,type:"header",path:"compareI",body:th}],["COS",{argTypes:[G],retType:G,type:"template",template:"Math.cos(#0) || 0"}],["DEG",{argTypes:[G],retType:G,type:"template",template:"180 * (#0) / Math.PI || 0"}],["DELTA",{argTypes:[G],retType:G,type:"template",template:"(#0) ? 0 : 1"}],["ED",{argTypes:[G],retType:G,type:"template",template:"(#0) > 0 ? 1 : 0"}],["ED",{argTypes:[Jt],retType:G,type:"template",template:"(#0) > 0 ? 1 : 0"}],["EXP",{argTypes:[G],retType:G,type:"template",template:"Math.exp(#0) || 0"}],["FLOAT",{argTypes:[G],retType:G,type:"template",template:"parseFloat(#0) || 0"}],["FLOAT",{argTypes:[oe],retType:G,type:"template",template:"parseFloat(#0) || 0"}],["FLOAT",{argTypes:[Jt],retType:G,type:"template",template:"parseFloat(#0) || 0"}],["FLOAT",{argTypes:[hh],retType:G,type:"template",template:"parseFloat(#0) || 0"}],["GETANGLEBYXY",{argTypes:[G,G],retType:G,type:"header",path:"getAngleByXY",body:nh}],["HANDLE",{argTypes:[G],retType:Jt,type:"template",template:"parseInt(#0) || 0"}],["LEFT",{argTypes:[oe,G],retType:oe,type:"template",template:"(#0).substring(0, #1)"}],["LENGTH",{argTypes:[oe],retType:G,type:"template",template:"(#0).length"}],["LG",{argTypes:[G],retType:G,type:"header",path:"lg",body:ih}],["LIMIT",{argTypes:[G,G,G],retType:G,type:"template",template:"Math.max(#1, Math.min(#2, #0))||0"}],["LN",{argTypes:[G],retType:G,type:"header",path:"ln",body:oh}],["LOG",{argTypes:[G,G],retType:G,type:"header",path:"log",body:sh}],["LOWER",{argTypes:[oe],retType:oe,type:"template",template:"(#0).toLowerCase()"}],["LTRIM",{argTypes:[oe],retType:oe,type:"template",template:'(#0).replace(/^\\s+/, "")'}],["MAX",{argTypes:[G,G],retType:G,type:"template",template:"Math.max(#0, #1) || 0"}],["MIN",{argTypes:[G,G],retType:G,type:"template",template:"Math.min(#0, #1) || 0"}],["NOT",{argTypes:[G],retType:G,type:"template",template:"(#0) ? 0 : 1"}],["NOT",{argTypes:[Jt],retType:G,type:"template",template:"(#0) ? 0 : 1"}],["NOTBIN",{argTypes:[G],retType:G,type:"template",template:"#0"}],["OR",{argTypes:[G,G],retType:G,type:"template",template:"(#0) || (#1) ? 1 : 0"}],["POS",{argTypes:[oe,oe,G],retType:G,type:"header",path:"pos",body:ah}],["RAD",{argTypes:[G],retType:G,type:"template",template:"Math.PI * (#0) / 180 || 0"}],["REPLICATE",{argTypes:[oe,G],retType:oe,type:"template",template:"(#0).repeat(#1)"}],["RIGHT",{argTypes:[oe,G],retType:oe,type:"header",path:"right",body:lh}],["RND",{argTypes:[G],retType:G,type:"template",template:"(#0) * Math.random()"}],["ROUND",{argTypes:[G,G],retType:G,type:"header",path:"round",body:ch}],["RTRIM",{argTypes:[oe],retType:oe,type:"template",template:'(#0).replace(/\\s+$/, "")'}],["SGN",{argTypes:[G],retType:G,type:"template",template:"Math.sign(#0) || 0"}],["SIN",{argTypes:[G],retType:G,type:"template",template:"Math.sin(#0) || 0"}],["SQR",{argTypes:[G],retType:G,type:"template",template:"(#0) ** 2"}],["SQRT",{argTypes:[G],retType:G,type:"template",template:"Math.sqrt(#0) || 0"}],["STRING",pi],["SUBSTR",{argTypes:[oe,G,G],retType:oe,type:"header",path:"substr",body:uh}],["SUBSTR",{argTypes:[oe,G],retType:oe,type:"template",template:"(#0).substring(#1)"}],["TAN",{argTypes:[G],retType:G,type:"template",template:"Math.tan(#0) || 0"}],["TRUNC",{argTypes:[G],retType:G,type:"template",template:"Math.trunc(#0) || 0"}],["UPPER",{argTypes:[oe],retType:oe,type:"template",template:"(#0).toUpperCase()"}],["XOR",{argTypes:[G,G],retType:G,type:"template",template:"(#0) !== 0 ^ (#1) !== 0"}],["XORBIN",{argTypes:[G,G],retType:G,type:"template",template:"(#0) ^ (#1)"}]],vs=(()=>{let e=new Map;return dh.forEach(([t,r])=>{let n=e.get(t);n||e.set(t,n=[]),n.push(r)}),e})();var _s="k",ws="v",jt="c",$t="s",gi="n",bi="o",fi={1:"f",3:"i",4:"i",2:"s"},xs=`
var k = c.kernel;
var v = m.map;
var mem = m.memory;
var of = mem.oldFloats;
var nf = mem.newFloats;
var oi = mem.oldInts;
var ni = mem.newInts;
var os = mem.oldStrings;
var ns = mem.newStrings;
`,Ps="userFunc",Ss="solveEquationsFor";var{FLOAT:$,STRING:ve,HANDLE:Je,COLORREF:Ht}=ce,yi=[{name:"^",arg:[$,$],ret:$,text:"#0 ** #1",prior:13},{name:"*",arg:[$,$],ret:$,text:"#0 * #1",prior:12},{name:"/",arg:[$,$],ret:$,text:"#0 / (#1 || Infinity)",prior:12},{name:"%",arg:[$,$],ret:$,text:"#0 % #1",prior:12},{name:"+",arg:[$,$],ret:$,text:"#0 + #1",prior:11},{name:"+",arg:[ve,ve],ret:ve,text:"#0 + #1",prior:11},{name:"+",arg:[ve,$],ret:ve,text:"#0 + string(#1)",prior:11},{name:"+",arg:[$,ve],ret:ve,text:"string(#0) + #1",prior:11},{name:"-",arg:[$,$],ret:$,text:"#0 - #1",prior:11},{name:"<<",arg:[$,$],ret:$,text:"#0 << #1",prior:10},{name:">>",arg:[$,$],ret:$,text:"#0 >> #1",prior:10},{name:">",arg:[$,$],ret:$,text:"+(#0 > #1)",prior:9},{name:">=",arg:[$,$],ret:$,text:"+(#0 >= #1)",prior:9},{name:"<",arg:[$,$],ret:$,text:"+(#0 < #1)",prior:9},{name:"<=",arg:[$,$],ret:$,text:"+(#0 <= #1)",prior:9},{name:">",arg:[ve,ve],ret:$,text:"+(#0 > #1)",prior:9},{name:">=",arg:[ve,ve],ret:$,text:"+(#0 >= #1)",prior:9},{name:"<",arg:[ve,ve],ret:$,text:"+(#0 < #1)",prior:9},{name:"<=",arg:[ve,ve],ret:$,text:"+(#0 <= #1)",prior:9},{name:"==",arg:[$,$],ret:$,text:"+(#0 == #1)",prior:8},{name:"==",arg:[ve,ve],ret:$,text:"+(#0 == #1)",prior:8},{name:"==",arg:[Je,Je],ret:$,text:"+(#0 == #1)",prior:8},{name:"==",arg:[Ht,Ht],ret:$,text:"+(#0 == #1)",prior:8},{name:"!=",arg:[$,$],ret:$,text:"+(#0 != #1)",prior:8},{name:"!=",arg:[ve,ve],ret:$,text:"+(#0 != #1)",prior:8},{name:"!=",arg:[Je,Je],ret:$,text:"+(#0 != #1)",prior:8},{name:"!=",arg:[Ht,Ht],ret:$,text:"+(#0 != #1)",prior:8},{name:"&",arg:[$,$],ret:$,text:"#0 & #1",prior:7},{name:"|",arg:[$,$],ret:$,text:"#0 | #1",prior:5},{name:"&&",arg:[$,$],ret:$,text:"+Boolean(#0 && #1)",prior:4},{name:"&&",arg:[Je,Je],ret:Je,text:"+Boolean(#0 && #1)",prior:4},{name:"||",arg:[$,$],ret:$,text:"+Boolean(#0 || #1)",prior:3},{name:"||",arg:[Je,Je],ret:Je,text:"+Boolean(#0 || #1)",prior:3}],Ts=Array.from(new Ae(yi.map(e=>[e.prior,e.name]))).sort((e,t)=>t[0]-e[0]).map(e=>Array.from(e[1]));var zt=class{constructor(){this.m=new Map}createVar(t,r,n){let i=t.toLowerCase(),o=this.m.get(i);if(o&&o[0].type!==r)throw Error(`\u041F\u0435\u0440\u0435\u043C\u0435\u043D\u043D\u0430\u044F \u0443\u0436\u0435 \u043E\u0431\u044A\u044F\u0432\u043B\u0435\u043D\u0430: ${t}`);let s={name:t,type:r,attrib:n||void 0};this.m.set(i,[s,this.m.size])}makeInEquation(t){let r=t.toLowerCase(),n=this.m.get(r);if(!n)throw Error(`\u041D\u0435\u0438\u0437\u0432\u0435\u0441\u0442\u043D\u0430\u044F \u043F\u0435\u0440\u0435\u043C\u0435\u043D\u043D\u0430\u044F: ${t}`);if(n[0].type!==1)throw Error(`\u041F\u0435\u0440\u0435\u043C\u0435\u043D\u043D\u0430\u044F \u0443\u0440\u0430\u0432\u043D\u0435\u043D\u0438\u044F ${t} \u043D\u0435 \u0438\u043C\u0435\u0435\u0442 \u0442\u0438\u043F FLOAT`);n[0].inEquation=!0}setAsReturn(t){var i;let r=t.toLowerCase(),n=this.m.get(r);if(!n)throw Error(`\u041D\u0435\u0438\u0437\u0432\u0435\u0441\u0442\u043D\u0430\u044F \u043F\u0435\u0440\u0435\u043C\u0435\u043D\u043D\u0430\u044F: ${t}`);n[0].attrib=((i=n[0].attrib)!=null?i:0)|1024}getFloatVar(t){let r=t.toLowerCase(),n=this.m.get(r);if(!n)throw Error(`\u041D\u0435\u0438\u0437\u0432\u0435\u0441\u0442\u043D\u0430\u044F \u043F\u0435\u0440\u0435\u043C\u0435\u043D\u043D\u0430\u044F: ${t}`);if(n[0].type!==1)throw Error(`\u041F\u0435\u0440\u0435\u043C\u0435\u043D\u043D\u0430\u044F \u0443\u0440\u0430\u0432\u043D\u0435\u043D\u0438\u044F ${t} \u043D\u0435 \u0438\u043C\u0435\u0435\u0442 \u0442\u0438\u043F FLOAT`);return`$${r}`}_getOrCreateVar(t,r){let n=t.toLowerCase(),i=this.m.get(n);if(i)return[n,i[0]];let o={name:t,type:r};return this.m.set(n,[o,this.m.size]),[n,o]}getOrCreateVar(t,r,n=1){let[i,{type:o}]=this._getOrCreateVar(r,n),s=`${t?gi:bi}${fi[o]}`,a=`$${i}`;return{text:`${s}[${a}]`,type:o}}derefer(t,r=1){let n=t.first;if(n.type!=="var"||t.rest.length>0)throw Error("\u0414\u043E\u043B\u0436\u043D\u043E \u0431\u044B\u0442\u044C \u0438\u043C\u044F \u043F\u0435\u0440\u0435\u043C\u0435\u043D\u043D\u043E\u0439");let[i,{type:o}]=this._getOrCreateVar(n.name,r),s=`${n.isNew?gi:bi}${fi[o]}`,a=`$${i}`;return[s,a]}result(){return[...this.m.values()].sort((t,r)=>t[1]-r[1]).map(t=>t[0])}};function As(e,t){var a;let r=t.args.map(c=>je(e,c)),n=t.name.toUpperCase(),i=vs.get(n);if(i){let c=i.find(({argTypes:g})=>g.length===r.length&&g.every((y,E)=>y===r[E].type));if(!c)throw Error(`\u041D\u0435\u043A\u043E\u0440\u0440\u0435\u043A\u0442\u043D\u0430\u044F \u0441\u0438\u0433\u043D\u0430\u0442\u0443\u0440\u0430 \u0444\u0443\u043D\u043A\u0446\u0438\u0438 ${t.name}(${r.map(g=>ce[g.type])}).
\u0412\u043E\u0437\u043C\u043E\u0436\u043D\u044B\u0435 \u0432\u0430\u0440\u0438\u0430\u043D\u0442\u044B:
`+i.map(g=>`${t.name}(${g.argTypes.map(y=>ce[y])})`).join(`
`));let h=r.map(g=>g.text),d;return c.type==="header"?(e.headerFuncs.add(c),d=`${c.path}(${h})`):d=c.template.replace(/#(\d)/g,(g,y)=>h[y]),{text:d,type:c.retType}}if(n==="EXIT"){if(r.length>0)throw Error(`${t.name}: \u043E\u0436\u0438\u0434\u0430\u043B\u043E\u0441\u044C 0 \u0430\u0440\u0433\u0443\u043C\u0435\u043D\u0442\u043E\u0432, \u043F\u043E\u043B\u0443\u0447\u0435\u043D\u043E ${r.length}`);return{text:"return",type:null}}let o=(a=e.funcTable)==null?void 0:a.get(n);if(!o)throw Error(`\u0424\u0443\u043D\u043A\u0446\u0438\u044F \u043D\u0435 \u0441\u0443\u0449\u0435\u0441\u0442\u0432\u0443\u0435\u0442: "${t.name}"`);let s=o.find(c=>{if(!c.argTypes.every((y,E)=>{if(E>=r.length)return!1;let v=y&De-1;return r[E].type===v}))return!1;let d=r.length-c.argTypes.length;if(!d)return!0;if(c.type==="user")return!1;let{restArgsTypes:g}=c;return d%g.length!==0?!1:r.slice(-d).every((y,E)=>y.type===g[E%g.length])});if(!s){let c=`${t.name}(${r.map(d=>ce[d.type])})`,h=o.map(d=>{let g=d.argTypes.map(y=>(y&De?"&":"")+ce[y&De-1]);return d.type==="plugin"&&d.restArgsTypes.length&&g.push(`[${d.restArgsTypes.map(y=>ce[y])}]`),` - ${t.name}(${g.concat()})`});throw Error(`\u041D\u0435\u043A\u043E\u0440\u0440\u0435\u043A\u0442\u043D\u0430\u044F \u0441\u0438\u0433\u043D\u0430\u0442\u0443\u0440\u0430 \u0444\u0443\u043D\u043A\u0446\u0438\u0438 ${c}.
\u0412\u043E\u0437\u043C\u043E\u0436\u043D\u044B\u0435 \u0432\u0430\u0440\u0438\u0430\u043D\u0442\u044B:
${h.join(`;
`)}`)}if(s.type==="plugin"){let c=r.map((h,d)=>s.argTypes[d]&De?e.vars.derefer(t.args[d]):h.text);return{text:`${jt}.${s.path}.call(${[$t,_s,...c]})`,type:s.retType}}else{let c=r.map(h=>h.text);return{text:`${jt}.${Ps}(${[$t,`"${s.name}"`,`[${c}]`]})`,type:s.retType}}}function ph(e){return`t${e.tmpVarCount++}`}function qt(e,t){var r;switch(t.isNew&&t.type!=="var"&&e.bugs.push(["\u041F\u0440\u0438\u043C\u0435\u043D\u0435\u043D\u0438\u0435 \u043E\u043F\u0435\u0440\u0430\u0442\u043E\u0440\u0430 '~' \u043D\u0435 \u043A \u043F\u0435\u0440\u0435\u043C\u0435\u043D\u043D\u043E\u0439",t]),t.type){case"float":return{text:t.value,type:1};case"handle":return{text:t.value,type:3};case"string":return{text:"`"+t.value.replace(/[`$\\]/g,"\\$&")+"`",type:2};case"var":{let n=(r=Se[t.name.toUpperCase()])==null?void 0:r.toString();return n?{text:n,type:1}:e.vars.getOrCreateVar(t.isNew,t.name)}case"call":{let n=t;if(t.isNew&&t.args.length){let s=X(J({},t.args[0].first),{isNew:!0}),a=[X(J({},t.args[0]),{first:s}),...t.args.slice(1)];n=X(J({},t),{args:a})}let i=ph(e),o=As(e,n);if(!o.type)throw Error(`\u0424\u0443\u043D\u043A\u0446\u0438\u044F ${t.name} \u043D\u0435 \u0432\u043E\u0437\u0432\u0440\u0430\u0449\u0430\u0435\u0442 \u0437\u043D\u0430\u0447\u0435\u043D\u0438\u044F`);return e.lines.push(`var ${i}=${o.text};`),{text:i,type:o.type}}case"-":case"!":{let n=t.op;t.isNew&&(n=X(J({},n),{isNew:!0}));let i=qt(e,n);if(i.type!==1)throw Error(`\u041E\u043F\u0435\u0440\u0430\u0442\u043E\u0440 "${t.type}" \u043D\u0435 \u043F\u0440\u0438\u043C\u0435\u043D\u0438\u043C \u043A ${ce[i.type]}`);return{text:`(${t.type}${i.text})`,type:i.type}}case"subexpr":{let n=je(e,t.expr);return{text:`(${n.text})`,type:n.type}}}}function je(e,{first:t,rest:r}){if(!r.length)return qt(e,t);let n=[{type:"decl",op:t},...ht(r.map(o=>[o.action,{type:"decl",op:o.operand}]))];Ts.forEach(o=>{for(;;){let s=n.findIndex(v=>typeof v=="string"&&o.includes(v));if(s<0)break;let a=n[s],c=n[s-1],h=n[s+1],d=c.type==="decl"?qt(e,c.op):c.res,g=h.type==="decl"?qt(e,h.op):h.res,y=yi.find(({name:v,arg:P})=>v===a&&P[0]===d.type&&P[1]===g.type);if(!y)throw Error(`\u041E\u043F\u0435\u0440\u0430\u0442\u043E\u0440 '${a}' \u043D\u0435\u043F\u0440\u0438\u043C\u0435\u043D\u0438\u043C \u043A '${ce[d.type]}', '${ce[g.type]}'`);let E={text:y.text.replace(/#\d/g,v=>(v==="#0"?d:g).text),type:y.ret};n.splice(s-1,3,{type:"parsed",res:E})}});let i=n[0];if(typeof i!="object"||i.type!=="parsed")throw Error("\u041E\u0448\u0438\u0431\u043A\u0430 \u0440\u0430\u0437\u0431\u043E\u0440\u0430 \u0432\u044B\u0440\u0430\u0436\u0435\u043D\u0438\u044F");return i.res}function Ms(e){e.tmpVarCount=0}function Os(e,t,r){if(t!==r)throw Error(`"${e}" \u0438\u043C\u0435\u0435\u0442 \u0442\u0438\u043F ${ce[t]}, \u043D\u043E \u043F\u0440\u0430\u0432\u043E\u0435 \u0432\u044B\u0440\u0430\u0436\u0435\u043D\u0438\u0435 \u0432\u043E\u0437\u0432\u0440\u0430\u0449\u0430\u0435\u0442 ${ce[r]}`)}function Ws(e,t){switch(Ms(e),t.type){case":=":{let n=je(e,t.expr),i=e.vars.getOrCreateVar(!0,t.to,n.type);Os(t.to,i.type,n.type),e.lines.push(`${i.text} = ${n.text};`);break}case"callChain":{t.functions.forEach(n=>{Ms(e);let i=As(e,n);e.lines.push(`${i.text};`)});break}case"if":{e.b.pushBlock({canBreak:!1,expect:"endif",hasElse:!1});let n=je(e,t.expr);e.lines.push(`if (${n.text}) {`);break}case"else":{let n=e.b.lastBlock();if((n==null?void 0:n.expect)!=="endif"||n.hasElse)throw Error("else \u0434\u043E\u043B\u0436\u0435\u043D \u043D\u0430\u0445\u043E\u0434\u0438\u0442\u044C\u0441\u044F \u043F\u043E\u0441\u043B\u0435 if");n.hasElse=!0,e.lines.push("} else {");break}case"endif":{e.b.popBlock("endif"),e.lines.push("}");break}case"varsDec":{let{datatype:n,modifiers:i,names:o}=t,s;switch(n){case"FLOAT":case"INTEGER":s=1;break;case"HANDLE":s=3;break;case"STRING":s=2;break;case"COLORREF":s=4;break}let a=(i.includes("LOCAL")?2:0)|(i.includes("PARAMETER")?512:0);o.forEach(c=>e.vars.createVar(c,s,a));break}case"while":{e.b.pushBlock({expect:"endwhile",canBreak:!0});let n=`g${++e.whileGuardCount}`;e.lines.push(`var ${n} = 0;`),e.lines.push("while (true) {"),e.lines.push(`if (++${n} > 100000) throw Error("\u0411\u0435\u0441\u043A\u043E\u043D\u0435\u0447\u043D\u044B\u0439 \u0446\u0438\u043A\u043B (100000 \u0438\u0442\u0435\u0440\u0430\u0446\u0438\u0439)");`);let i=je(e,t.expr);e.lines.push(`if (!(${i.text})) break;`);break}case"endwhile":{e.b.popBlock("endwhile"),e.lines.push("}");break}case"do":{e.b.pushBlock({expect:"until",canBreak:!0}),e.lines.push("do {");break}case"until":{e.b.popBlock("until");let n=je(e,t.expr);e.lines.push(`} while (${n.text});`);break}case"switch":{e.b.pushBlock({expect:"endswitch",canBreak:!0,caseCount:0}),e.lines.push("do { //switch");break}case"endswitch":{let n=e.b.popBlock("endswitch");if(!n.caseCount)throw Error("\u041E\u0436\u0438\u0434\u0430\u043B\u043E\u0441\u044C case");for(let i=0;i<n.caseCount;++i)e.lines.push("}");e.lines.push("} while (false); //endswitch");break}case"case":{let n=e.b.lastBlock();if((n==null?void 0:n.expect)!=="endswitch")throw Error("case \u0434\u043E\u043B\u0436\u0435\u043D \u043D\u0430\u0445\u043E\u0434\u0438\u0442\u044C\u0441\u044F \u0432\u043D\u0443\u0442\u0440\u0438 \u0431\u043B\u043E\u043A\u0430 switch");n.caseCount&&e.lines.push("} else {"),++n.caseCount;let i=je(e,t.expr);e.lines.push(`if (${i.text}) { //case`);break}case"default":{let n=e.b.lastBlock();if((n==null?void 0:n.expect)!=="endswitch")throw Error("default \u0434\u043E\u043B\u0436\u0435\u043D \u043D\u0430\u0445\u043E\u0434\u0438\u0442\u044C\u0441\u044F \u0432\u043D\u0443\u0442\u0440\u0438 \u0431\u043B\u043E\u043A\u0430 switch");e.lines.push("} else { //default");break}case"break":e.lines.push(e.b.haveABreakHaveAKitKat());break;case"=":{let n=X(J({},e),{lines:[]}),i=je(n,t.lhs);if(i.type!==1)throw Error("\u041B\u0435\u0432\u0430\u044F \u0447\u0430\u0441\u0442\u044C \u0432\u044B\u0440\u0430\u0436\u0435\u043D\u0438\u044F \u043D\u0435 \u0432\u043E\u0437\u0432\u0440\u0430\u0449\u0430\u0435\u0442 FLOAT");let o=je(n,t.rhs);if(o.type!==1)throw Error("\u041F\u0440\u0430\u0432\u0430\u044F \u0447\u0430\u0441\u0442\u044C \u0432\u044B\u0440\u0430\u0436\u0435\u043D\u0438\u044F \u043D\u0435 \u0432\u043E\u0437\u0432\u0440\u0430\u0449\u0430\u0435\u0442 FLOAT");n.lines.push(`return ${o.text} - (${i.text});`),e.equations.push(n.lines);break}case"::=":{let n=X(J({},e),{lines:[]}),i=je(n,t.expr),o=e.vars.getOrCreateVar(!0,t.to,i.type);Os(t.to,o.type,i.type),n.lines.push(`${o.text} = ${i.text};`),e.defers.push(n.lines);break}case"eqResult":{if(t.deferred)t.vars.forEach(n=>e.vars.makeInEquation(n));else{let n=t.vars.map(o=>e.vars.getFloatVar(o)),i=[$t,`[${n}]`];e.lines.push(`${jt}.${Ss}(${i});`)}break}case"function":{e.isFunction=!0;break}case"return":{e.vars.setAsReturn(t.to);break}default:throw Error(`\u041D\u0435\u0438\u0437\u0432\u0435\u0441\u0442\u043D\u044B\u0439 \u043E\u043F\u0435\u0440\u0430\u0442\u043E\u0440: "${t.type}"`)}}function gh(e,t,r){var O;let n=e.vars.result(),{lines:i,bugs:o,equations:s,defers:a,isFunction:c}=e;if(i.length===0&&s.length===0&&a.length===0)return{bugs:o,vars:n,isFunction:c,mainText:"",equationsTexts:[],defersTexts:[]};let h=[...e.headerFuncs].map(R=>R.body).join(`
`),d=n.map((R,D)=>`var $${R.name.toLowerCase()} = ${ws}[${D}];`).join(`
`),g=xs+`
`+h+`
`+d+`

`,y=t?`//# sourceURL=_transpiled/${t}`:"",E=(O=r==null?void 0:r.split(`
`).map(R=>"// "+R).join(`
`))!=null?O:"",v=i.length?E+g+i.join(`
`)+y:"",P=s.map((R,D)=>g+R.join(`
`)+(y&&`${y}_eq_${D}`)),w=a.map((R,D)=>g+R.join(`
`)+(y&&`${y}_defer_${D}`));return{bugs:o,vars:n,isFunction:c,mainText:v,equationsTexts:P,defersTexts:w}}function Ns(e,{funcTable:t,sourceURL:r,comment:n}={}){let i={funcTable:t,vars:new zt,b:new Ut,lines:[],defers:[],equations:[],isFunction:!1,bugs:[],tmpVarCount:0,whileGuardCount:0,headerFuncs:new Set([pi])};e.forEach((s,a)=>{try{Ws(i,s);let c=s.then;for(;c;)Ws(i,c),c=c.then}catch(c){throw c instanceof Error?Error(`\u0421\u0442\u0440\u043E\u043A\u0430 ${a+1}: ${c.message}`):c}});let o=i.b.lastBlock();if(o)throw Error(`\u0421\u0442\u0440\u043E\u043A\u0430 ${e.length}: \u043E\u0436\u0438\u0434\u0430\u043B\u043E\u0441\u044C ${o.expect}`);return gh(i,r,n)}var Ei="'",vi='"';function Rs(e){let t="",r=null;for(let n=0;n<e.length;++n){let i=e[n];if(i===Ei&&r!==vi?r=r?null:Ei:i===vi&&r!==Ei&&(r=r?null:vi),r){t+=i;continue}if(i==="/"){let o=e[n+1];if(o==="*"){for(n+=2;n<e.length&&(e[n]!=="*"||e[n+1]!=="/");)++n;++n;continue}if(o==="/"){for(++n;n<e.length&&e[++n]!==`
`;);t[t.length-1]!==`
`&&(t+=`
`);continue}}if(i===";"||i===`
`){t[t.length-1]!==`
`&&(t+=`
`);continue}if(i==="\r"){e[n+1]===`
`&&++n,t[t.length-1]!==`
`&&(t+=`
`);continue}t+=i}return t[t.length-1]===`
`?t:t+`
`}function bh(e,t){function r(){this.constructor=e}r.prototype=t.prototype,e.prototype=new r}function wr(e,t,r,n){this.message=e,this.expected=t,this.found=r,this.location=n,this.name="SyntaxError",typeof Error.captureStackTrace=="function"&&Error.captureStackTrace(this,wr)}bh(wr,Error);wr.buildMessage=function(e,t){var r={literal:function(h){return'"'+i(h.text)+'"'},class:function(h){var d="",g;for(g=0;g<h.parts.length;g++)d+=h.parts[g]instanceof Array?o(h.parts[g][0])+"-"+o(h.parts[g][1]):o(h.parts[g]);return"["+(h.inverted?"^":"")+d+"]"},any:function(h){return"any character"},end:function(h){return"end of input"},other:function(h){return h.description}};function n(h){return h.charCodeAt(0).toString(16).toUpperCase()}function i(h){return h.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(d){return"\\x0"+n(d)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(d){return"\\x"+n(d)})}function o(h){return h.replace(/\\/g,"\\\\").replace(/\]/g,"\\]").replace(/\^/g,"\\^").replace(/-/g,"\\-").replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(d){return"\\x0"+n(d)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(d){return"\\x"+n(d)})}function s(h){return r[h.type](h)}function a(h){var d=new Array(h.length),g,y;for(g=0;g<h.length;g++)d[g]=s(h[g]);if(d.sort(),d.length>0){for(g=1,y=1;g<d.length;g++)d[g-1]!==d[g]&&(d[y]=d[g],y++);d.length=y}switch(d.length){case 1:return d[0];case 2:return d[0]+" or "+d[1];default:return d.slice(0,-1).join(", ")+", or "+d[d.length-1]}}function c(h){return h?'"'+i(h)+'"':"end of input"}return"Expected "+a(e)+" but "+c(t)+" found."};function fh(e,t){t=t!==void 0?t:{};var r={},n={Code:Fo},i=Fo,o=function(p){return p},s=function(p){return p.filter(f=>f)},a=de("variable name"),c=function(p){return{type:"var",name:p}},h=",",d=ee(",",!1),g=function(p){return p},y=de("function call"),E="(",v=ee("(",!1),P=")",w=ee(")",!1),O=function(p,f){return{type:"call",name:p,args:f}},R="-",D=ee("-",!1),B="!",V=ee("!",!1),F=de("!<operand> or -<operand>"),Y=function(p,f){return{type:p,op:f}},K=de("(<expression>)"),z=function(p){return{type:"subexpr",expr:p}},k=de("operand"),Q="~",Z=ee("~",!1),re=function(p,f){return X(J({},f),{isNew:!!p})},C="^",se=ee("^",!1),ye="*",L=ee("*",!1),ae="/",be=ee("/",!1),Be="%",He=ee("%",!1),Qe="+",fr=ee("+",!1),lr=">=",qn=ee(">=",!1),Yn=">",Wl=ee(">",!1),no="<=",Al=ee("<=",!1),Nl="<",Rl=ee("<",!1),io="==",Il=ee("==",!1),oo="!=",Fl=ee("!=",!1),so="&&",Dl=ee("&&",!1),kl="&",Gl=ee("&",!1),ao="||",Ll=ee("||",!1),Bl="|",Vl=ee("|",!1),Cl=de("expression"),lo=function(p,f,S){return{action:f,operand:S}},Kl=function(p,f){return{first:p,rest:f}},co=function(p,f){return f},Ul=function(p,f){return[p].concat(f)},uo=function(p,f){return f},Jl=function(p,f,S){return{type:"varsDec",datatype:p,modifiers:f,names:S}},jl=de("assignment operator"),mo=":=",$l=ee(":=",!1),ho="::=",Hl=ee("::=",!1),zl=function(p,f,S){return{type:f,to:p,expr:S}},ql=de("equality operator"),po="=",go=ee("=",!1),Yl=function(p,f,S){return{type:f,lhs:p,rhs:S}},Xl=de("immediately equation result"),yr=function(p,f){return f},bo="?",fo=ee("?",!1),Ql=function(p,f){return{type:"eqResult",deferred:!1,vars:[p].concat(f)}},Zl=de("deferred equation result"),ec=function(p,f){return{type:"eqResult",deferred:!0,vars:[p].concat(f)}},rc=de("function call chain"),tc=function(p,f){return{type:"callChain",functions:[p].concat(f)}},yo=de("( <expression> )"),Eo=function(p){return p},nc=de("if(<condition>)"),ic="if",oc=ee("if",!0),sc=function(p){return{type:"if",expr:p}},ac=de("while(<condition>)"),lc="while",cc=ee("while",!0),uc=function(p){return{type:"while",expr:p}},mc=de("until(<condition>)"),hc="until",dc=ee("until",!0),pc=function(p){return{type:"until",expr:p}},gc=de("case(<condition>)"),bc="case",fc=ee("case",!0),yc=function(p,f){return{type:"case",expr:p,then:f}},Ec="else",vc=ee("else",!0),_c=function(p){return{type:"else",then:p}},wc="endif",xc=ee("endif",!0),Pc=function(p){return{type:"endif",then:p}},Sc="break",Tc=ee("break",!0),Mc=function(){return{type:"break"}},Oc="endwhile",Wc=ee("endwhile",!0),Ac=function(){return{type:"endwhile"}},Nc="do",Rc=ee("do",!0),Ic=function(){return{type:"do"}},Fc="endswitch",Dc=ee("endswitch",!0),kc=function(){return{type:"endswitch"}},Gc="switch",Lc=ee("switch",!0),Bc=function(){return{type:"switch"}},Vc="default",Cc=ee("default",!0),Kc=function(p){return{type:"default",then:p}},Uc="function",Jc=ee("function",!0),jc=function(){return{type:"function"}},$c=de("return <var name>"),Hc="return",zc=ee("return",!0),qc=function(p){return{type:"return",to:p}},Yc="handle",Xc=ee("HANDLE",!0),Qc=function(){return"HANDLE"},Zc="string",eu=ee("STRING",!0),ru=function(){return"STRING"},tu="float",nu=ee("FLOAT",!0),iu=function(){return"FLOAT"},ou="colorref",su=ee("COLORREF",!0),au=function(){return"COLORREF"},lu="integer",cu=ee("INTEGER",!0),uu=function(){return"INTEGER"},mu="local",hu=ee("LOCAL",!0),du=function(){return"LOCAL"},pu="nosave",gu=ee("NOSAVE",!0),bu=function(){return"NOSAVE"},fu="parameter",yu=ee("PARAMETER",!0),Eu=function(){return"PARAMETER"},vo=/^[_a-z\u0430-\u044F0-9]/i,_o=Ze(["_",["a","z"],["\u0430","\u044F"],["0","9"]],!1,!0),vu=de("function name"),Xr=/^[0-9]/,Qr=Ze([["0","9"]],!1,!1),_u=".",wu=ee(".",!1),xu=/^[eE]/,Pu=Ze(["e","E"],!1,!1),Su=/^[+\-]/,Tu=Ze(["+","-"],!1,!1),Mu=de("float"),Ou=function(p){return{type:"float",value:p}},Wu=de("handle"),Au="#",Nu=ee("#",!1),Ru=function(p){return{type:"handle",value:p.length>0?p:"0"}},wo="'",xo=ee("'",!1),Po=/^[^']/,So=Ze(["'"],!0,!1),To='"',Mo=ee('"',!1),Oo=/^[^"]/,Wo=Ze(['"'],!0,!1),Iu=function(p){return{type:"string",value:p[1]}},Fu=de("space or tab"),Du=/^[ \t]/,ku=Ze([" ","	"],!1,!1),Gu=de("new line"),Lu=`
`,Bu=ee(`
`,!1),Vu=de("whitespace"),Ao=/^[ \t\n\r]/,No=Ze([" ","	",`
`,"\r"],!1,!1),b=0,H=0,Zr=[{line:1,column:1}],Ue=0,Xn=[],W=0,et;if("startRule"in t){if(!(t.startRule in n))throw new Error(`Can't start parsing from rule "`+t.startRule+'".');i=n[t.startRule]}function wS(){return e.substring(H,b)}function xS(){return Fr(H,b)}function PS(p,f){throw f=f!==void 0?f:Fr(H,b),Io([de(p)],e.substring(H,b),f)}function SS(p,f){throw f=f!==void 0?f:Fr(H,b),Ku(p,f)}function ee(p,f){return{type:"literal",text:p,ignoreCase:f}}function Ze(p,f,S){return{type:"class",parts:p,inverted:f,ignoreCase:S}}function TS(){return{type:"any"}}function Cu(){return{type:"end"}}function de(p){return{type:"other",description:p}}function Ro(p){var f=Zr[p],S;if(f)return f;for(S=p-1;!Zr[S];)S--;for(f=Zr[S],f={line:f.line,column:f.column};S<p;)e.charCodeAt(S)===10?(f.line++,f.column=1):f.column++,S++;return Zr[p]=f,f}function Fr(p,f){var S=Ro(p),x=Ro(f);return{start:{offset:p,line:S.line,column:S.column},end:{offset:f,line:x.line,column:x.column}}}function I(p){b<Ue||(b>Ue&&(Ue=b,Xn=[]),Xn.push(p))}function Ku(p,f){return new wr(p,null,null,f)}function Io(p,f,S){return new wr(wr.buildMessage(p,f),p,f,S)}function Fo(){var p,f,S,x,A,M,j;for(p=b,f=[],S=b,x=[],A=U();A!==r;)x.push(A),A=U();if(x!==r)if(A=Qn(),A===r&&(A=null),A!==r){for(M=[],j=U();j!==r;)M.push(j),j=U();M!==r?(j=Lo(),j!==r?(H=S,x=o(A),S=x):(b=S,S=r)):(b=S,S=r)}else b=S,S=r;else b=S,S=r;for(;S!==r;){for(f.push(S),S=b,x=[],A=U();A!==r;)x.push(A),A=U();if(x!==r)if(A=Qn(),A===r&&(A=null),A!==r){for(M=[],j=U();j!==r;)M.push(j),j=U();M!==r?(j=Lo(),j!==r?(H=S,x=o(A),S=x):(b=S,S=r)):(b=S,S=r)}else b=S,S=r;else b=S,S=r}return f!==r&&(H=p,f=s(f)),p=f,p}function Uu(){var p,f;return W++,p=b,f=Oe(),f!==r&&(H=p,f=c(f)),p=f,W--,p===r&&(f=r,W===0&&I(a)),p}function Do(){var p,f,S,x,A;for(p=b,f=[],S=U();S!==r;)f.push(S),S=U();if(f!==r)if(S=cr(),S!==r){for(x=[],A=U();A!==r;)x.push(A),A=U();x!==r?(e.charCodeAt(b)===44?(A=h,b++):(A=r,W===0&&I(d)),A===r&&(A=null),A!==r?(H=p,f=g(S),p=f):(b=p,p=r)):(b=p,p=r)}else b=p,p=r;else b=p,p=r;return p}function rt(){var p,f,S,x,A,M,j,q;if(W++,p=b,f=fm(),f!==r){for(S=[],x=U();x!==r;)S.push(x),x=U();if(S!==r)if(e.charCodeAt(b)===40?(x=E,b++):(x=r,W===0&&I(v)),x!==r){for(A=[],M=U();M!==r;)A.push(M),M=U();if(A!==r){for(M=[],j=Do();j!==r;)M.push(j),j=Do();if(M!==r){for(j=[],q=U();q!==r;)j.push(q),q=U();j!==r?(e.charCodeAt(b)===41?(q=P,b++):(q=r,W===0&&I(w)),q!==r?(H=p,f=O(f,M),p=f):(b=p,p=r)):(b=p,p=r)}else b=p,p=r}else b=p,p=r}else b=p,p=r;else b=p,p=r}else b=p,p=r;return W--,p===r&&(f=r,W===0&&I(y)),p}function Ju(){var p;return e.charCodeAt(b)===45?(p=R,b++):(p=r,W===0&&I(D)),p===r&&(e.charCodeAt(b)===33?(p=B,b++):(p=r,W===0&&I(V))),p}function ju(){var p,f,S,x;if(W++,p=b,f=Ju(),f!==r){for(S=[],x=U();x!==r;)S.push(x),x=U();S!==r?(x=tt(),x!==r?(H=p,f=Y(f,x),p=f):(b=p,p=r)):(b=p,p=r)}else b=p,p=r;return W--,p===r&&(f=r,W===0&&I(F)),p}function $u(){var p,f,S,x,A,M;if(W++,p=b,e.charCodeAt(b)===40?(f=E,b++):(f=r,W===0&&I(v)),f!==r){for(S=[],x=U();x!==r;)S.push(x),x=U();if(S!==r)if(x=cr(),x!==r){for(A=[],M=U();M!==r;)A.push(M),M=U();A!==r?(e.charCodeAt(b)===41?(M=P,b++):(M=r,W===0&&I(w)),M!==r?(H=p,f=z(x),p=f):(b=p,p=r)):(b=p,p=r)}else b=p,p=r;else b=p,p=r}else b=p,p=r;return W--,p===r&&(f=r,W===0&&I(K)),p}function tt(){var p,f,S,x;if(W++,p=b,e.charCodeAt(b)===126?(f=Q,b++):(f=r,W===0&&I(Z)),f===r&&(f=null),f!==r){for(S=[],x=U();x!==r;)S.push(x),x=U();S!==r?(x=ju(),x===r&&(x=vm(),x===r&&(x=_m(),x===r&&(x=wm(),x===r&&(x=rt(),x===r&&(x=Uu(),x===r&&(x=$u())))))),x!==r?(H=p,f=re(f,x),p=f):(b=p,p=r)):(b=p,p=r)}else b=p,p=r;return W--,p===r&&(f=r,W===0&&I(k)),p}function ko(){var p;return e.charCodeAt(b)===94?(p=C,b++):(p=r,W===0&&I(se)),p===r&&(e.charCodeAt(b)===42?(p=ye,b++):(p=r,W===0&&I(L)),p===r&&(e.charCodeAt(b)===47?(p=ae,b++):(p=r,W===0&&I(be)),p===r&&(e.charCodeAt(b)===37?(p=Be,b++):(p=r,W===0&&I(He)),p===r&&(e.charCodeAt(b)===43?(p=Qe,b++):(p=r,W===0&&I(fr)),p===r&&(e.charCodeAt(b)===45?(p=R,b++):(p=r,W===0&&I(D)),p===r&&(e.substr(b,2)===lr?(p=lr,b+=2):(p=r,W===0&&I(qn)),p===r&&(e.charCodeAt(b)===62?(p=Yn,b++):(p=r,W===0&&I(Wl)),p===r&&(e.substr(b,2)===no?(p=no,b+=2):(p=r,W===0&&I(Al)),p===r&&(e.charCodeAt(b)===60?(p=Nl,b++):(p=r,W===0&&I(Rl)),p===r&&(e.substr(b,2)===io?(p=io,b+=2):(p=r,W===0&&I(Il)),p===r&&(e.substr(b,2)===oo?(p=oo,b+=2):(p=r,W===0&&I(Fl)),p===r&&(e.substr(b,2)===so?(p=so,b+=2):(p=r,W===0&&I(Dl)),p===r&&(e.charCodeAt(b)===38?(p=kl,b++):(p=r,W===0&&I(Gl)),p===r&&(e.substr(b,2)===ao?(p=ao,b+=2):(p=r,W===0&&I(Ll)),p===r&&(e.charCodeAt(b)===124?(p=Bl,b++):(p=r,W===0&&I(Vl))))))))))))))))),p}function cr(){var p,f,S,x,A,M,j,q;if(W++,p=b,f=tt(),f!==r){for(S=[],x=b,A=[],M=U();M!==r;)A.push(M),M=U();if(A!==r)if(M=ko(),M!==r){for(j=[],q=U();q!==r;)j.push(q),q=U();j!==r?(q=tt(),q!==r?(H=x,A=lo(f,M,q),x=A):(b=x,x=r)):(b=x,x=r)}else b=x,x=r;else b=x,x=r;for(;x!==r;){for(S.push(x),x=b,A=[],M=U();M!==r;)A.push(M),M=U();if(A!==r)if(M=ko(),M!==r){for(j=[],q=U();q!==r;)j.push(q),q=U();j!==r?(q=tt(),q!==r?(H=x,A=lo(f,M,q),x=A):(b=x,x=r)):(b=x,x=r)}else b=x,x=r;else b=x,x=r}S!==r?(H=p,f=Kl(f,S),p=f):(b=p,p=r)}else b=p,p=r;return W--,p===r&&(f=r,W===0&&I(Cl)),p}function Hu(){var p,f,S,x,A,M,j,q;if(p=b,f=Oe(),f!==r){for(S=[],x=b,A=_e(),A!==r?(e.charCodeAt(b)===44?(M=h,b++):(M=r,W===0&&I(d)),M!==r?(j=_e(),j!==r?(q=Oe(),q!==r?(H=x,A=co(f,q),x=A):(b=x,x=r)):(b=x,x=r)):(b=x,x=r)):(b=x,x=r);x!==r;)S.push(x),x=b,A=_e(),A!==r?(e.charCodeAt(b)===44?(M=h,b++):(M=r,W===0&&I(d)),M!==r?(j=_e(),j!==r?(q=Oe(),q!==r?(H=x,A=co(f,q),x=A):(b=x,x=r)):(b=x,x=r)):(b=x,x=r)):(b=x,x=r);S!==r?(H=p,f=Ul(f,S),p=f):(b=p,p=r)}else b=p,p=r;return p}function zu(){var p,f,S,x,A,M,j,q,Pe;if(p=b,f=bm(),f!==r){if(S=[],x=U(),x!==r)for(;x!==r;)S.push(x),x=U();else S=r;if(S!==r)if(x=_e(),x!==r){if(A=[],M=b,j=Go(),j!==r){if(q=[],Pe=U(),Pe!==r)for(;Pe!==r;)q.push(Pe),Pe=U();else q=r;q!==r?(H=M,j=uo(f,j),M=j):(b=M,M=r)}else b=M,M=r;for(;M!==r;)if(A.push(M),M=b,j=Go(),j!==r){if(q=[],Pe=U(),Pe!==r)for(;Pe!==r;)q.push(Pe),Pe=U();else q=r;q!==r?(H=M,j=uo(f,j),M=j):(b=M,M=r)}else b=M,M=r;A!==r?(M=Hu(),M!==r?(H=p,f=Jl(f,A,M),p=f):(b=p,p=r)):(b=p,p=r)}else b=p,p=r;else b=p,p=r}else b=p,p=r;return p}function qu(){var p,f,S,x,A,M;if(W++,p=b,f=Oe(),f!==r)if(S=_e(),S!==r)if(e.substr(b,2)===mo?(x=mo,b+=2):(x=r,W===0&&I($l)),x===r&&(e.substr(b,3)===ho?(x=ho,b+=3):(x=r,W===0&&I(Hl))),x!==r){for(A=[],M=U();M!==r;)A.push(M),M=U();A!==r?(M=cr(),M!==r?(H=p,f=zl(f,x,M),p=f):(b=p,p=r)):(b=p,p=r)}else b=p,p=r;else b=p,p=r;else b=p,p=r;return W--,p===r&&(f=r,W===0&&I(jl)),p}function Yu(){var p,f,S,x,A,M;if(W++,p=b,f=cr(),f!==r)if(S=_e(),S!==r)if(e.charCodeAt(b)===61?(x=po,b++):(x=r,W===0&&I(go)),x!==r){for(A=[],M=U();M!==r;)A.push(M),M=U();A!==r?(M=cr(),M!==r?(H=p,f=Yl(f,x,M),p=f):(b=p,p=r)):(b=p,p=r)}else b=p,p=r;else b=p,p=r;else b=p,p=r;return W--,p===r&&(f=r,W===0&&I(ql)),p}function Xu(){var p,f,S,x,A,M,j,q;if(W++,p=b,f=Oe(),f!==r){for(S=[],x=b,A=[],M=U();M!==r;)A.push(M),M=U();if(A!==r)if(e.charCodeAt(b)===44?(M=h,b++):(M=r,W===0&&I(d)),M!==r){for(j=[],q=U();q!==r;)j.push(q),q=U();j!==r?(q=Oe(),q!==r?(H=x,A=yr(f,q),x=A):(b=x,x=r)):(b=x,x=r)}else b=x,x=r;else b=x,x=r;for(;x!==r;){for(S.push(x),x=b,A=[],M=U();M!==r;)A.push(M),M=U();if(A!==r)if(e.charCodeAt(b)===44?(M=h,b++):(M=r,W===0&&I(d)),M!==r){for(j=[],q=U();q!==r;)j.push(q),q=U();j!==r?(q=Oe(),q!==r?(H=x,A=yr(f,q),x=A):(b=x,x=r)):(b=x,x=r)}else b=x,x=r;else b=x,x=r}if(S!==r){for(x=[],A=U();A!==r;)x.push(A),A=U();if(x!==r)if(e.charCodeAt(b)===61?(A=po,b++):(A=r,W===0&&I(go)),A!==r){for(M=[],j=U();j!==r;)M.push(j),j=U();M!==r?(e.charCodeAt(b)===63?(j=bo,b++):(j=r,W===0&&I(fo)),j!==r?(H=p,f=Ql(f,S),p=f):(b=p,p=r)):(b=p,p=r)}else b=p,p=r;else b=p,p=r}else b=p,p=r}else b=p,p=r;return W--,p===r&&(f=r,W===0&&I(Xl)),p}function Qu(){var p,f,S,x,A,M,j,q,Pe,Er;if(W++,p=b,e.charCodeAt(b)===63?(f=bo,b++):(f=r,W===0&&I(fo)),f!==r)if(S=_e(),S!==r)if(x=Oe(),x!==r){for(A=[],M=b,j=_e(),j!==r?(e.charCodeAt(b)===44?(q=h,b++):(q=r,W===0&&I(d)),q!==r?(Pe=_e(),Pe!==r?(Er=Oe(),Er!==r?(H=M,j=yr(x,Er),M=j):(b=M,M=r)):(b=M,M=r)):(b=M,M=r)):(b=M,M=r);M!==r;)A.push(M),M=b,j=_e(),j!==r?(e.charCodeAt(b)===44?(q=h,b++):(q=r,W===0&&I(d)),q!==r?(Pe=_e(),Pe!==r?(Er=Oe(),Er!==r?(H=M,j=yr(x,Er),M=j):(b=M,M=r)):(b=M,M=r)):(b=M,M=r)):(b=M,M=r);A!==r?(H=p,f=ec(x,A),p=f):(b=p,p=r)}else b=p,p=r;else b=p,p=r;else b=p,p=r;return W--,p===r&&(f=r,W===0&&I(Zl)),p}function Zu(){var p,f,S,x,A,M;if(W++,p=b,f=rt(),f!==r){if(S=[],x=b,A=[],M=U(),M!==r)for(;M!==r;)A.push(M),M=U();else A=r;for(A!==r?(M=rt(),M!==r?(H=x,A=yr(f,M),x=A):(b=x,x=r)):(b=x,x=r);x!==r;){if(S.push(x),x=b,A=[],M=U(),M!==r)for(;M!==r;)A.push(M),M=U();else A=r;A!==r?(M=rt(),M!==r?(H=x,A=yr(f,M),x=A):(b=x,x=r)):(b=x,x=r)}S!==r?(H=p,f=tc(f,S),p=f):(b=p,p=r)}else b=p,p=r;return W--,p===r&&(f=r,W===0&&I(rc)),p}function em(){var p,f,S,x,A,M;if(W++,p=b,e.charCodeAt(b)===40?(f=E,b++):(f=r,W===0&&I(v)),f!==r){for(S=[],x=U();x!==r;)S.push(x),x=U();if(S!==r)if(x=cr(),x!==r){for(A=[],M=U();M!==r;)A.push(M),M=U();A!==r?(e.charCodeAt(b)===41?(M=P,b++):(M=r,W===0&&I(w)),M!==r?(H=p,f=Eo(x),p=f):(b=p,p=r)):(b=p,p=r)}else b=p,p=r;else b=p,p=r}else b=p,p=r;return W--,p===r&&(f=r,W===0&&I(yo)),p}function rm(){var p,f,S,x,A;for(W++,p=b,f=[],S=U();S!==r;)f.push(S),S=U();if(f!==r)if(S=cr(),S!==r){for(x=[],A=U();A!==r;)x.push(A),A=U();x!==r?(e.charCodeAt(b)===41?(A=P,b++):(A=r,W===0&&I(w)),A!==r?(H=p,f=Eo(S),p=f):(b=p,p=r)):(b=p,p=r)}else b=p,p=r;else b=p,p=r;return W--,p===r&&(f=r,W===0&&I(yo)),p}function nt(){var p;return p=em(),p===r&&(p=rm()),p}function it(){var p,f,S;if(p=b,f=[],S=U(),S!==r)for(;S!==r;)f.push(S),S=U();else f=r;return f!==r?(S=Qn(),S!==r?(H=p,f=g(S),p=f):(b=p,p=r)):(b=p,p=r),p}function tm(){var p,f,S,x;return W++,p=b,e.substr(b,2).toLowerCase()===ic?(f=e.substr(b,2),b+=2):(f=r,W===0&&I(oc)),f!==r?(S=_e(),S!==r?(x=nt(),x!==r?(H=p,f=sc(x),p=f):(b=p,p=r)):(b=p,p=r)):(b=p,p=r),W--,p===r&&(f=r,W===0&&I(nc)),p}function nm(){var p,f,S,x;return W++,p=b,e.substr(b,5).toLowerCase()===lc?(f=e.substr(b,5),b+=5):(f=r,W===0&&I(cc)),f!==r?(S=_e(),S!==r?(x=nt(),x!==r?(H=p,f=uc(x),p=f):(b=p,p=r)):(b=p,p=r)):(b=p,p=r),W--,p===r&&(f=r,W===0&&I(ac)),p}function im(){var p,f,S,x;return W++,p=b,e.substr(b,5).toLowerCase()===hc?(f=e.substr(b,5),b+=5):(f=r,W===0&&I(dc)),f!==r?(S=_e(),S!==r?(x=nt(),x!==r?(H=p,f=pc(x),p=f):(b=p,p=r)):(b=p,p=r)):(b=p,p=r),W--,p===r&&(f=r,W===0&&I(mc)),p}function om(){var p,f,S,x,A;return W++,p=b,e.substr(b,4).toLowerCase()===bc?(f=e.substr(b,4),b+=4):(f=r,W===0&&I(fc)),f!==r?(S=_e(),S!==r?(x=nt(),x!==r?(A=it(),A===r&&(A=null),A!==r?(H=p,f=yc(x,A),p=f):(b=p,p=r)):(b=p,p=r)):(b=p,p=r)):(b=p,p=r),W--,p===r&&(f=r,W===0&&I(gc)),p}function sm(){var p,f,S;return p=b,e.substr(b,4).toLowerCase()===Ec?(f=e.substr(b,4),b+=4):(f=r,W===0&&I(vc)),f!==r?(S=it(),S===r&&(S=null),S!==r?(H=p,f=_c(S),p=f):(b=p,p=r)):(b=p,p=r),p}function am(){var p,f,S;return p=b,e.substr(b,5).toLowerCase()===wc?(f=e.substr(b,5),b+=5):(f=r,W===0&&I(xc)),f!==r?(S=it(),S===r&&(S=null),S!==r?(H=p,f=Pc(S),p=f):(b=p,p=r)):(b=p,p=r),p}function lm(){var p,f;return p=b,e.substr(b,5).toLowerCase()===Sc?(f=e.substr(b,5),b+=5):(f=r,W===0&&I(Tc)),f!==r&&(H=p,f=Mc()),p=f,p}function cm(){var p,f;return p=b,e.substr(b,8).toLowerCase()===Oc?(f=e.substr(b,8),b+=8):(f=r,W===0&&I(Wc)),f!==r&&(H=p,f=Ac()),p=f,p}function um(){var p,f;return p=b,e.substr(b,2).toLowerCase()===Nc?(f=e.substr(b,2),b+=2):(f=r,W===0&&I(Rc)),f!==r&&(H=p,f=Ic()),p=f,p}function mm(){var p,f;return p=b,e.substr(b,9).toLowerCase()===Fc?(f=e.substr(b,9),b+=9):(f=r,W===0&&I(Dc)),f!==r&&(H=p,f=kc()),p=f,p}function hm(){var p,f;return p=b,e.substr(b,6).toLowerCase()===Gc?(f=e.substr(b,6),b+=6):(f=r,W===0&&I(Lc)),f!==r&&(H=p,f=Bc()),p=f,p}function dm(){var p,f,S;return p=b,e.substr(b,7).toLowerCase()===Vc?(f=e.substr(b,7),b+=7):(f=r,W===0&&I(Cc)),f!==r?(S=it(),S===r&&(S=null),S!==r?(H=p,f=Kc(S),p=f):(b=p,p=r)):(b=p,p=r),p}function pm(){var p,f;return p=b,e.substr(b,8).toLowerCase()===Uc?(f=e.substr(b,8),b+=8):(f=r,W===0&&I(Jc)),f!==r&&(H=p,f=jc()),p=f,p}function gm(){var p,f,S,x;return W++,p=b,e.substr(b,6).toLowerCase()===Hc?(f=e.substr(b,6),b+=6):(f=r,W===0&&I(zc)),f!==r?(S=_e(),S!==r?(x=Oe(),x!==r?(H=p,f=qc(x),p=f):(b=p,p=r)):(b=p,p=r)):(b=p,p=r),W--,p===r&&(f=r,W===0&&I($c)),p}function Qn(){var p;return p=zu(),p===r&&(p=qu(),p===r&&(p=Yu(),p===r&&(p=Xu(),p===r&&(p=Qu(),p===r&&(p=tm(),p===r&&(p=sm(),p===r&&(p=am(),p===r&&(p=lm(),p===r&&(p=nm(),p===r&&(p=cm(),p===r&&(p=um(),p===r&&(p=im(),p===r&&(p=mm(),p===r&&(p=hm(),p===r&&(p=om(),p===r&&(p=dm(),p===r&&(p=Zu(),p===r&&(p=pm(),p===r&&(p=gm()))))))))))))))))))),p}function bm(){var p,f;return p=b,e.substr(b,6).toLowerCase()===Yc?(f=e.substr(b,6),b+=6):(f=r,W===0&&I(Xc)),f!==r&&(H=p,f=Qc()),p=f,p===r&&(p=b,e.substr(b,6).toLowerCase()===Zc?(f=e.substr(b,6),b+=6):(f=r,W===0&&I(eu)),f!==r&&(H=p,f=ru()),p=f,p===r&&(p=b,e.substr(b,5).toLowerCase()===tu?(f=e.substr(b,5),b+=5):(f=r,W===0&&I(nu)),f!==r&&(H=p,f=iu()),p=f,p===r&&(p=b,e.substr(b,8).toLowerCase()===ou?(f=e.substr(b,8),b+=8):(f=r,W===0&&I(su)),f!==r&&(H=p,f=au()),p=f,p===r&&(p=b,e.substr(b,7).toLowerCase()===lu?(f=e.substr(b,7),b+=7):(f=r,W===0&&I(cu)),f!==r&&(H=p,f=uu()),p=f)))),p}function Go(){var p,f;return p=b,e.substr(b,5).toLowerCase()===mu?(f=e.substr(b,5),b+=5):(f=r,W===0&&I(hu)),f!==r&&(H=p,f=du()),p=f,p===r&&(p=b,e.substr(b,6).toLowerCase()===pu?(f=e.substr(b,6),b+=6):(f=r,W===0&&I(gu)),f!==r&&(H=p,f=bu()),p=f,p===r&&(p=b,e.substr(b,9).toLowerCase()===fu?(f=e.substr(b,9),b+=9):(f=r,W===0&&I(yu)),f!==r&&(H=p,f=Eu()),p=f)),p}function Oe(){var p,f,S;if(W++,p=b,f=[],vo.test(e.charAt(b))?(S=e.charAt(b),b++):(S=r,W===0&&I(_o)),S!==r)for(;S!==r;)f.push(S),vo.test(e.charAt(b))?(S=e.charAt(b),b++):(S=r,W===0&&I(_o));else f=r;return f!==r?p=e.substring(p,b):p=f,W--,p===r&&(f=r,W===0&&I(a)),p}function fm(){var p,f;return W++,p=Oe(),W--,p===r&&(f=r,W===0&&I(vu)),p}function Zn(){var p,f;if(p=[],Xr.test(e.charAt(b))?(f=e.charAt(b),b++):(f=r,W===0&&I(Qr)),f!==r)for(;f!==r;)p.push(f),Xr.test(e.charAt(b))?(f=e.charAt(b),b++):(f=r,W===0&&I(Qr));else p=r;return p}function ym(){var p,f,S;return p=b,e.charCodeAt(b)===46?(f=_u,b++):(f=r,W===0&&I(wu)),f!==r?(S=Zn(),S!==r?(f=[f,S],p=f):(b=p,p=r)):(b=p,p=r),p}function Em(){var p,f,S,x;return p=b,xu.test(e.charAt(b))?(f=e.charAt(b),b++):(f=r,W===0&&I(Pu)),f!==r?(Su.test(e.charAt(b))?(S=e.charAt(b),b++):(S=r,W===0&&I(Tu)),S===r&&(S=null),S!==r?(x=Zn(),x!==r?(f=[f,S,x],p=f):(b=p,p=r)):(b=p,p=r)):(b=p,p=r),p}function vm(){var p,f,S,x,A,M;return W++,p=b,f=b,S=b,x=Zn(),x!==r?(A=ym(),A===r&&(A=null),A!==r?(M=Em(),M===r&&(M=null),M!==r?(x=[x,A,M],S=x):(b=S,S=r)):(b=S,S=r)):(b=S,S=r),S!==r?f=e.substring(f,b):f=S,f!==r&&(H=p,f=Ou(f)),p=f,W--,p===r&&(f=r,W===0&&I(Mu)),p}function _m(){var p,f,S,x,A;if(W++,p=b,e.charCodeAt(b)===35?(f=Au,b++):(f=r,W===0&&I(Nu)),f!==r){for(S=b,x=[],Xr.test(e.charAt(b))?(A=e.charAt(b),b++):(A=r,W===0&&I(Qr));A!==r;)x.push(A),Xr.test(e.charAt(b))?(A=e.charAt(b),b++):(A=r,W===0&&I(Qr));x!==r?S=e.substring(S,b):S=x,S!==r?(H=p,f=Ru(S),p=f):(b=p,p=r)}else b=p,p=r;return W--,p===r&&(f=r,W===0&&I(Wu)),p}function wm(){var p,f,S,x,A,M;if(p=b,f=b,e.charCodeAt(b)===39?(S=wo,b++):(S=r,W===0&&I(xo)),S!==r){for(x=b,A=[],Po.test(e.charAt(b))?(M=e.charAt(b),b++):(M=r,W===0&&I(So));M!==r;)A.push(M),Po.test(e.charAt(b))?(M=e.charAt(b),b++):(M=r,W===0&&I(So));A!==r?x=e.substring(x,b):x=A,x!==r?(e.charCodeAt(b)===39?(A=wo,b++):(A=r,W===0&&I(xo)),A!==r?(S=[S,x,A],f=S):(b=f,f=r)):(b=f,f=r)}else b=f,f=r;if(f===r)if(f=b,e.charCodeAt(b)===34?(S=To,b++):(S=r,W===0&&I(Mo)),S!==r){for(x=b,A=[],Oo.test(e.charAt(b))?(M=e.charAt(b),b++):(M=r,W===0&&I(Wo));M!==r;)A.push(M),Oo.test(e.charAt(b))?(M=e.charAt(b),b++):(M=r,W===0&&I(Wo));A!==r?x=e.substring(x,b):x=A,x!==r?(e.charCodeAt(b)===34?(A=To,b++):(A=r,W===0&&I(Mo)),A!==r?(S=[S,x,A],f=S):(b=f,f=r)):(b=f,f=r)}else b=f,f=r;return f!==r&&(H=p,f=Iu(f)),p=f,p}function U(){var p,f;return W++,Du.test(e.charAt(b))?(p=e.charAt(b),b++):(p=r,W===0&&I(ku)),W--,p===r&&(f=r,W===0&&I(Fu)),p}function Lo(){var p,f;return W++,e.charCodeAt(b)===10?(p=Lu,b++):(p=r,W===0&&I(Bu)),W--,p===r&&(f=r,W===0&&I(Gu)),p}function _e(){var p,f;for(W++,p=[],Ao.test(e.charAt(b))?(f=e.charAt(b),b++):(f=r,W===0&&I(No));f!==r;)p.push(f),Ao.test(e.charAt(b))?(f=e.charAt(b),b++):(f=r,W===0&&I(No));return W--,p===r&&(f=r,W===0&&I(Vu)),p}if(et=i(),et!==r&&b===e.length)return et;throw et!==r&&b<e.length&&I(Cu()),Io(Xn,Ue<e.length?e.charAt(Ue):null,Ue<e.length?Fr(Ue,Ue+1):Fr(Ue,Ue))}var Is=fh;var hr=class extends Error{constructor(r){super(r.join(`
`));this.errors=r}format(r=`
`){return this.errors.join(r)}};function yh(e,t){let r;try{r=Is(e)}catch(n){if(!(n instanceof Error))throw n;let i=n.location.start,o=`\u0421\u0442\u0440\u043E\u043A\u0430 ${i.line} \u0441\u0442\u043E\u043B\u0431\u0435\u0446 ${i.column}: ${n.message}`;throw new hr([o])}try{return Ns(r,t)}catch(n){throw n instanceof Error?new hr([n.message]):n}}function Fs(e,t){let r;try{r=Rs(e)}catch(n){throw n instanceof Error?new hr([n.message]):n}return yh(r,t)}var Eh={1:"F",2:"S",3:"H",4:"C",[Ve.FLOAT_REF]:"G",[Ve.STRING_REF]:"T",[Ve.HANDLE_REF]:"I",[Ve.COLORREF_REF]:"D"};function vh(e){return e.map(t=>Eh[t]).join("")}var _i=[],Yt=class{constructor(){this.m=new Map}addPlugin({register:t},r){t((n,i,o)=>{let s=i.a||_i,a=i.rest||_i,c=s.concat(a),h=n.toUpperCase(),d=this.m.get(h);if(!d)this.m.set(h,d=[]);else{let y=De-1;if(d.some(E=>{let v=E.argTypes.concat(E.type==="plugin"?E.restArgsTypes:_i);return v.length===c.length&&v.every((P,w)=>(P&y)===(c[w]&y))}))throw Error(`\u0424\u0443\u043D\u043A\u0446\u0438\u044F '${n}' \u0441 \u0430\u0440\u0433\u0443\u043C\u0435\u043D\u0442\u0430\u043C\u0438 '${s}' \u0443\u0436\u0435 \u0441\u0443\u0449\u0435\u0441\u0442\u0432\u0443\u0435\u0442`)}let g=n+(s.length?"$"+vh(c):"");if(r){if(r[g])throw Error(`\u0421\u0432\u043E\u0439\u0441\u0442\u0432\u043E '${g}' \u0443\u0436\u0435 \u0441\u0443\u0449\u0435\u0441\u0442\u0432\u0443\u0435\u0442 \u043D\u0430 \u043E\u0431\u044A\u0435\u043A\u0442\u0435 \u043A\u043E\u043D\u0442\u0435\u043A\u0441\u0442\u0430`);r[g]=o}d.push({type:"plugin",path:g,argTypes:s,restArgsTypes:a,retType:i.r||null})})}addUserFunc(t){let r=t.name.toUpperCase(),n=this.m.get(r);if(!n)return this.m.set(r,[t]),!0;let i=De-1;return n.some(o=>o.argTypes.length===t.argTypes.length&&o.argTypes.every((s,a)=>(s&i)===t.argTypes[a]))?!1:(n.push(t),!0)}compile(t,r,n){return Fs(t,{funcTable:this.m,sourceURL:r,comment:n})}};var Xt={id:"library",mount:"library"};function Ds(i,o){return mr(this,arguments,function*({id:e,hash:t,mount:r},n){let s;try{let a=yield fetch(`${Te(e)}/index.json${t?"?"+t:""}`,n);if(a.status===404)throw Error("\u0411\u0438\u0431\u043B\u0438\u043E\u0442\u0435\u043A\u0430 \u043D\u0435 \u0441\u0443\u0449\u0435\u0441\u0442\u0432\u0443\u0435\u0442");if(s=yield a.json(),!a.ok)throw Error(s.message||"\u041D\u0435\u0438\u0437\u0432\u0435\u0441\u0442\u043D\u0430\u044F \u043E\u0448\u0438\u0431\u043A\u0430")}catch(a){if(!(a instanceof Error))throw a;let c=a.message==="Failed to fetch"?"\u0421\u0435\u0440\u0432\u0435\u0440 \u043D\u0435 \u043E\u0442\u0432\u0435\u0447\u0430\u0435\u0442":a.message;throw Error(`\u041E\u0448\u0438\u0431\u043A\u0430 \u0437\u0430\u0433\u0440\u0443\u0437\u043A\u0438 \u0431\u0438\u0431\u043B\u0438\u043E\u0442\u0435\u043A\u0438 '${r||""}' ('${e}'): ${c}`)}return s})}var wi=class{constructor(t,r){this.id=t;this.attrib=0;this.description="";this.defaultValue=null;this.inEquation=!1;this.parsed=null;this.name=r.name,this.type=r.type,this.set(r)}set({attrib:t=this.attrib,defaultValue:r=this.defaultValue,description:n=this.description,inEquation:i=this.inEquation}){return this.parsed=r!==null?Kt(this.type,r):null,this.attrib=t,this.defaultValue=r,this.description=n,this.inEquation=i,this}},Qt=class{constructor(t){this._disable=null;this._enable=null;this.orgx=null;this.orgy=null;this._hobject=null;this._objname=null;this._classname=null;this.msg=null;this.xpos=null;this.ypos=null;this.fwkeys=null;this.wvkey=null;this.repeat=null;this.scancode=null;this.nwidth=null;this.nheight=null;this._hspace=null;this._windowName=null;this.iditem=null;this.wnotifycode=null;var n;let r=t==null?void 0:t.map((i,o)=>[i.name.toUpperCase(),new wi(o,i)]);if(this.list=(n=r==null?void 0:r.map(i=>i[1]))!=null?n:[],this.m=new Map(r),!!r)for(let[i,o]of r){let s=o.type,{FLOAT:a,STRING:c,HANDLE:h}=ce;i==="_ENABLE"&&s===a?this._enable=o:i==="_DISABLE"&&s===a?this._disable=o:i==="MSG"&&s===a?this.msg=o:i==="_HOBJECT"&&s===h?this._hobject=o:i==="IDITEM"&&s===a?this.iditem=o:i==="WNOTIFYCODE"&&s===a?this.wnotifycode=o:i==="NWIDTH"&&s===a?this.nwidth=o:i==="NHEIGHT"&&s===a?this.nheight=o:i==="XPOS"&&s===a?this.xpos=o:i==="YPOS"&&s===a?this.ypos=o:i==="FWKEYS"&&s===a?this.fwkeys=o:i==="ORGX"&&s===a?this.orgx=o:i==="ORGY"&&s===a?this.orgy=o:i==="_OBJNAME"&&s===c?this._objname=o:i==="_CLASSNAME"&&s===c?this._classname=o:i==="WVKEY"&&s===a?this.wvkey=o:i==="REPEAT"&&s===a?this.repeat=o:i==="SCANCODE"&&s===a?this.scancode=o:i==="_HSPACE"&&s===h?this._hspace=o:i==="_WINDOWNAME"&&s===c&&(this._windowName=o)}}get(t){var r;return(r=this.m.get(t.toUpperCase()))!=null?r:null}};var xi=Qt;var Zt=class{constructor(t,h,a,c){this.id=t;this.file=a;this.compiler=c;this.childrenChangedCallbacks=new Set;this._transpiled=null;this.compiled=!1;this.children=[];this.connections=[];this.scene=null;this.image=null;this.modelText="";this.isFunction=!1;this.main=null;this.defers=[];this.equations=[];var d=h,{name:r,uniqid:n,vars:i,transpiled:o}=d,s=we(d,["name","uniqid","vars","transpiled"]);this.name=r,this.vars=new xi(i),this.set(s),this._transpiled=o!=null?o:null,this.uniqid=n!=null?n:0}set({vars:t,children:r=this.children,connections:n=this.connections,scene:i=this.scene,image:o=this.image,modelText:s=this.modelText,isFunction:a=this.isFunction}){return t&&(this.vars=new xi(t)),this.modelText!==s&&(this.compiled=!1),this.children!==r&&(this.children=r,this.childrenChangedCallbacks.forEach(c=>c(r))),this.connections=n,this.scene=i,this.image=o,this.modelText=s,this.isFunction=a,this}compile(){if(this.compiled)return;this.compiled=!0;let t;if(this._transpiled)pe.debugCompiler&&console.log(`\u041A\u043E\u043C\u043F\u0438\u043B\u044F\u0446\u0438\u044F (\u043A\u0435\u0448\u0438\u0440\u043E\u0432\u0430\u043D\u043E) ${this.name} (${this.vars.list.length} \u043F\u0435\u0440\u0435\u043C\u0435\u043D\u043D\u044B\u0445)`),t=this._transpiled,this._transpiled=null;else{let r=this.file.path.toString().slice(3);pe.debugCompiler&&console.log(`\u041A\u043E\u043C\u043F\u0438\u043B\u044F\u0446\u0438\u044F '${this.name}' ('${r}'): ${this.vars.list.length} \u043F\u0435\u0440\u0435\u043C\u0435\u043D\u043D\u044B\u0445`);try{let n=this.compiler.compile(this.modelText,this.name,r);pe.debugCompiler&&n.bugs.length&&console.warn(`${this.name}:
${n.bugs.map(([s])=>` -${s}`).join(`
`)}`);let i=this.vars,o=n.vars.map(s=>{let a=i.get(s.name);if(!a)return s;let{defaultValue:c,description:h}=a;return X(J({},s),{defaultValue:c,description:h})});this.set({vars:o,isFunction:n.isFunction}),t=n}catch(n){throw n instanceof hr?Error(`\u041E\u0448\u0438\u0431\u043A\u0430 \u043A\u043E\u043C\u043F\u0438\u043B\u044F\u0446\u0438\u0438 '${this.name}' ('${r}'): '${n.message}'`):n}}this.main=t.mainText?fs(t.mainText):null,this.defers=t.defersTexts?ys(t.defersTexts):[],this.equations=t.equationsTexts?Es(t.equationsTexts):[]}on(t,r){this.childrenChangedCallbacks.add(r)}};var en=class{constructor(){this.files=new WeakSet;this.m=new Map}hasFile(t){return this.files.has(t)}get(t){var r;return(r=this.m.get(t.toUpperCase()))!=null?r:null}add(t){let r=t.name.toUpperCase(),n=this.m.get(r);if(n)throw Error(`\u041A\u043E\u043D\u0444\u043B\u0438\u043A\u0442 \u0438\u043C\u0435\u043D \u0438\u043C\u0438\u0434\u0436\u0435\u0439: '${t.name}' ('${t.file.path}') \u0443\u0436\u0435 \u0441\u0443\u0449\u0435\u0441\u0442\u0432\u0443\u0435\u0442 \u0432 \u0444\u0430\u0439\u043B\u0435 '${n.file.path}'`);return this.m.set(r,t),this.files.add(t.file),this}unload(t){this.m.forEach(r=>r.id===t&&this.files.delete(r.file)),this.m=new Map([...this.m].filter(r=>r[1].id!==t))}};function ks({map:e,memory:t},r){let{newFloats:n,newInts:i}=t,o=e[r.id];switch(r.type){case 1:return n[o];case 3:case 4:return i[o];default:return null}}function Gs({map:e,memory:t},r){return r.type===2?t.newStrings[e[r.id]]:null}function dr({map:e,memory:t},r){let{newFloats:n,newInts:i,newStrings:o}=t,s=e[r.id];switch(r.type){case 1:return n[s];case 3:case 4:return i[s];case 2:return o[s]}}function ue({map:e,memory:t},r,n){let{newFloats:i,oldFloats:o,newInts:s,oldInts:a,newStrings:c,oldStrings:h}=t,d=e[r.id];switch(r.type){case 1:if(typeof n!="number")return!1;i[d]=o[d]=n;break;case 3:case 4:if(typeof n!="number")return!1;s[d]=a[d]=n;break;case 2:if(typeof n!="string")return!1;c[d]=h[d]=n;break}return!0}function Ls({map:e,memory:t},r,n){let{newFloats:i,newInts:o,newStrings:s}=t,a=e[r.id];switch(r.type){case 1:if(typeof n!="number")return!1;i[a]=n;break;case 3:case 4:if(typeof n!="number")return!1;o[a]=n;break;case 2:if(typeof n!="string")return!1;s[a]=n;break}return!0}function Br(e,t,r){t.forEach(({key:n,klass:i})=>{var a,c,h,d;let o=(a=r.get(i))==null?void 0:a.image;if(!o||o.prior==="icon"||!((d=(h=(c=o.scene)==null?void 0:c.data)==null?void 0:h.objects)!=null&&d.length))return;let s=e.objects.get(n);(s==null?void 0:s.type)==="group"&&gs(s,o.scene.data,o.resizable)})}function Bs(e){var i,o;let t=e.vars.list,r=t.filter(s=>s.attrib&512).map(s=>s.type),n=(o=(i=t.find(s=>s.attrib&1024))==null?void 0:i.type)!=null?o:null;return{type:"user",name:e.name,argTypes:r,retType:n}}var xr=class{constructor(){this.floatCnt=0;this.intCnt=0;this.strCnt=0}add(t){switch(t.type){case 1:return this.floatCnt++;case 3:case 4:return this.intCnt++;case 2:return this.strCnt++}}allocMemory(t){let r=new Float64Array(this.floatCnt),n=new Int32Array(this.intCnt),i=Array.from({length:this.strCnt},()=>"");return this.newFloats=r,this.oldFloats=t?r:r.slice(),this.newInts=n,this.oldInts=t?n:n.slice(),this.newStrings=i,this.oldStrings=t?i:i.slice(),this}sync(){this.oldFloats.set(this.newFloats),this.oldInts.set(this.newInts);let{newStrings:t,oldStrings:r}=this;for(let n=0;n<t.length;++n)r[n]=t[n]}},Pr=class{constructor(t,r){this.v=t;this.a=r;this._index=-1;this.connected=new Set}propagateIndex(t){this._index>=0||(this._index=t,this.connected.forEach(r=>r.propagateIndex(t)))}connectWith(t){this.connected.add(t),t.connected.add(this)}getIndex(){return this._index<0&&this.propagateIndex(this.a.add(this.v)),this._index}};function _h(e,t){let{children:r}=e;t.forEach(({nodes:[n,i],vars:o,attrib:s=0})=>{if(s&1)return;let a=`\u0418\u043C\u0438\u0434\u0436 ${e.klass.name}: \u0441\u0432\u044F\u0437\u044C #${n}-#${i}: `,c=n>0?r.find(d=>d.ndata.key===n):e;if(!c){console.warn(a+`\u0414\u043E\u0447\u0435\u0440\u043D\u0438\u0439 \u0438\u043C\u0438\u0434\u0436 #${n} \u043D\u0435 \u0441\u0443\u0449\u0435\u0441\u0442\u0432\u0443\u0435\u0442`);return}let h=i>0?r.find(d=>d.ndata.key===i):e;if(!h){console.warn(a+`\u0414\u043E\u0447\u0435\u0440\u043D\u0438\u0439 \u0438\u043C\u0438\u0434\u0436 #${i} \u043D\u0435 \u0441\u0443\u0449\u0435\u0441\u0442\u0432\u0443\u0435\u0442`);return}a=`\u0418\u043C\u0438\u0434\u0436 ${e.klass.name}: \u0441\u0432\u044F\u0437\u044C #${n} (${c.klass.name}) - #${i} (${h.klass.name}): `,o.forEach(([d,g])=>{let y=c.klass.vars.get(d);if(!y){console.warn(a+`\u041F\u0435\u0440\u0435\u043C\u0435\u043D\u043D\u0430\u044F ${c.klass.name}:${d} \u043D\u0435 \u0441\u0443\u0449\u0435\u0441\u0442\u0432\u0443\u0435\u0442`);return}let E=h.klass.vars.get(g);if(!E){console.warn(a+`\u041F\u0435\u0440\u0435\u043C\u0435\u043D\u043D\u0430\u044F ${h.klass.name}:${g} \u043D\u0435 \u0441\u0443\u0449\u0435\u0441\u0442\u0432\u0443\u0435\u0442`);return}if(y.type!==E.type){console.warn(a+`\u0422\u0438\u043F\u044B \u043F\u0435\u0440\u0435\u043C\u0435\u043D\u043D\u044B\u0445 ${c.klass.name}:${d} \u0438 ${h.klass.name}:${g} \u043D\u0435 \u0441\u043E\u0432\u043F\u0430\u0434\u0430\u044E\u0442`);return}c.vars[y.id].connectWith(h.vars[E.id])})})}function Pi(e,t,r,n=null){e.compile();let i=e.vars.list.map(a=>new Pr(a,r)),o=e.children.map(a=>{let c=t.get(a.klass);if(!c)throw Error(`\u041F\u043E\u0434\u0438\u043C\u0438\u0434\u0436 ${a.klass} #${a.key} \u0438\u043C\u0438\u0434\u0436\u0430 ${e.name} \u043D\u0435 \u0441\u0443\u0449\u0435\u0441\u0442\u0432\u0443\u0435\u0442`);return Pi(c,t,r,a)}),s={klass:e,ndata:n,vars:i,children:o};return e.connections.length&&_h(s,e.connections),s}function Si(e,t,r,n){let i=e.vars.map(s=>{let a=s.getIndex();return s.v.inEquation&&n.add(a),a}),o=e.children.map(s=>Si(s,t,r,n));return t.schema(X(J({},e),{vars:{map:i,memory:r},children:o}))}var Vs=new Map([["Backspace",8],["Tab",9],["Enter",13],["ShiftLeft",16],["ControlLeft",17],["AltLeft",18],["Pause",19],["CapsLock",20],["Escape",27],["Space",32],["PageUp",33],["PageDown",34],["End",35],["Home",36],["ArrowLeft",37],["ArrowUp",38],["ArrowRight",39],["ArrowDown",40],["PrintScreen",44],["Insert",45],["Delete",46],["Digit0",48],["Digit1",49],["Digit2",50],["Digit3",51],["Digit4",52],["Digit5",53],["Digit6",54],["Digit7",55],["Digit8",56],["Digit9",57],["KeyA",65],["KeyB",66],["KeyC",67],["KeyD",68],["KeyE",69],["KeyF",70],["KeyG",71],["KeyH",72],["KeyI",73],["KeyJ",74],["KeyK",75],["KeyL",76],["KeyM",77],["KeyN",78],["KeyO",79],["KeyP",80],["KeyQ",81],["KeyR",82],["KeyS",83],["KeyT",84],["KeyU",85],["KeyV",86],["KeyW",87],["KeyX",88],["KeyY",89],["KeyZ",90],["Comma",188],["Period",190],["Slash",191]]),Cs=[37,38,39,40,45,46];var qe=class extends Error{constructor(r,n){super(r);this.original=n}};function Ks(e,t,{a:r,b:n},i,o){let{oldFloats:s,newFloats:a}=i.vars.memory,c=!1,h=e(i,i.vars,o),d=t.map(g=>{a[g]=s[g]=1;let y=h-e(i,i.vars,o);return a[g]=s[g]=0,y&&(c=!0),y});c&&(r.push(d),n.push(h))}function Us(e,t,r){return e.newFloats[t[r]]>0}function Js(e,t,r){return e.newFloats[t[r]]<=0}var rn=class{constructor(t,{klass:r,ndata:n,vars:i,children:o}){this.prj=t;this.updateChildNodeData=t=>{t.length===this.children.length&&t.forEach((r,n)=>{let i=this.children[n],o=i.ndata;o.key!==r.key||o.klass!==r.klass||(o.name&&this.resolveMap.delete(o.name),r.name&&this.resolveMap.set(r.name.toUpperCase(),i),i.ndata=r)})};this.klass=r,this.ndata=n,this.vars=i,this.children=o;let{_disable:s,_enable:a}=r.vars;s&&(!a||s.id<a.id)?this.isDisabled=Us.bind(null,i.memory,i.map,s.id):a&&(!s||a.id<s.id)&&(this.isDisabled=Js.bind(null,i.memory,i.map,a.id)),this.resolveMap=new Map([["",this]]),o.forEach(c=>{c.resolveMap.set("..",this);let{key:h,name:d}=c.ndata;this.resolveMap.set("#"+h,c),d&&this.resolveMap.set(d.toUpperCase(),c)}),r.on("childrenChanged",this.updateChildNodeData)}isDisabled(){return!1}resolve(t){if(t.length===0)return this;let r=t.toUpperCase().split("\\"),n=t[0]==="\\"?this.prj.root:this;for(let i of r){let o=n.resolveMap.get(i);if(!o)return null;n=o}return n}resolveMany(t,r){if(t){let n=this.resolve(t);return!n||r&&n.klass!==r?[]:[n]}return r?this.prj.classSchemas(r):[]}initValues(t){this.children.forEach(n=>n.initValues());let{vars:r}=this.klass;return r.list.forEach(n=>{var o,s,a,c,h,d,g,y;let i;if(n.parsed!==null)i=n.parsed;else switch(n){case r.orgx:i=(s=(o=this.ndata)==null?void 0:o.x)!=null?s:0;break;case r.orgy:i=(c=(a=this.ndata)==null?void 0:a.y)!=null?c:0;break;case r._hobject:i=(d=(h=this.ndata)==null?void 0:h.key)!=null?d:0;break;case r._objname:i=(y=(g=this.ndata)==null?void 0:g.name)!=null?y:"";break;case r._classname:i=this.klass.name;break;default:if(!t)return;i=n.type===2?"":0;break}ue(this.vars,n,i)}),this}applyValues({values:t,klass:r,klassID:n,children:i}){let o=this.klass.uniqid;if(o&&o===n||r.toUpperCase()===this.klass.name.toUpperCase()){let{vars:s}=this.klass;t==null||t.forEach(({name:a,value:c})=>{let h=s.get(a);if(!h)return;let d=Kt(h.type,c);d!==null&&ue(this.vars,h,d)})}else console.warn(`\u041D\u0435 \u0443\u0434\u0430\u043B\u043E\u0441\u044C \u043F\u0440\u0438\u043C\u0435\u043D\u0438\u0442\u044C \u0441\u043E\u0441\u0442\u043E\u044F\u043D\u0438\u0435 \u043A ${this.path()}: ${n}/${o}, ${r}/${this.klass.name}`);return i==null||i.forEach(s=>{var a;return(a=this.children.find(c=>c.ndata.key===s.key))==null?void 0:a.applyValues(s)}),this}getValues(){var s;let{klass:t,vars:r,ndata:n}=this,i=this.children.map(a=>a.getValues()),o=t.vars.list.map(a=>{let c=bs(a.type,dr(r,a));return{name:a.name,value:c}});return{key:(s=n==null?void 0:n.key)!=null?s:0,klass:t.name,klassID:t.uniqid,values:o,children:i}}computeEquationVectors(t,r,n){this.children.forEach(i=>i.computeEquationVectors(t,r,n)),this.klass.equations.forEach(i=>Ks(i,t,r,this,n))}computeSchemaDefers(t){this.children.forEach(r=>!r.isDisabled()&&r.computeSchemaDefers(t)),this.klass.defers.forEach(r=>r(this,this.vars,t))}computeSchema(t){var r,n;this.children.forEach(i=>!i.isDisabled()&&i.computeSchema(t)),pe.debugExecution&&console.log(`\u0412\u044B\u043F\u043E\u043B\u043D\u044F\u0435\u0442\u0441\u044F ${this.path()}`);try{(n=(r=this.klass).main)==null||n.call(r,this,this.vars,t)}catch(i){throw i instanceof Error?new qe(`${this.path()}: ${i.message}`,i):i}return this}compute(t,r){if(!r&&this.isDisabled())return this;this.computeSchema(t);let{equationVars:n}=this.prj;return n.length&&t.solveEquationsFor(this,n),this.computeSchemaDefers(t),this.vars.memory.sync(),this}createLinearSystem(t,r){let{oldFloats:n,newFloats:i}=this.vars.memory,o=r.map(a=>{let c=n[a];return i[a]=n[a]=0,c}),s={a:[],b:[]};return this.computeEquationVectors(r,s,t),r.forEach((a,c)=>n[a]=o[c]),s}path(){if(this===this.prj.root)return this.klass.name;let t=[this];for(;;){let r=t[0].resolveMap.get("..");if(r===this.prj.root)break;t.unshift(r)}return t.map(r=>`${r.klass.name} (#${r.ndata.key})`).join(" - ")}};var tn=class{constructor({id:t,dir:r,klass:n,state:i},o){this.classTypes=new WeakMap;this.id=t,this.dir=r;let s=new Set,a=new xr,c=Pi(n,o,a),h=this.root=Si(c,this,a,s);a.allocMemory(),h.initValues(),i&&h.applyValues(i),this.equationVars=Array.from(s)}schema(t){let r=new rn(this,t),n=this.classTypes.get(r.klass);return n?n.push(r):this.classTypes.set(r.klass,[r]),r}classSchemas(t){var r;return(r=this.classTypes.get(t))!=null?r:[]}};var nn=class{constructor(t){this.kernel=t}userFunc(t,r,n){var h;let i=this.kernel.classes.get(r);if(!i)throw Error(`\u0424\u0443\u043D\u043A\u0446\u0438\u044F \u043D\u0435 \u0441\u0443\u0449\u0435\u0441\u0442\u0432\u0443\u0435\u0442: ${r}`);if(!i.isFunction)throw Error(`\u0418\u043C\u0438\u0434\u0436 ${r} \u0441\u0443\u0449\u0435\u0441\u0442\u0432\u0443\u0435\u0442, \u043D\u043E \u043D\u0435 \u044F\u0432\u043B\u044F\u0435\u0442\u0441\u044F \u0444\u0443\u043D\u043A\u0446\u0438\u0435\u0439`);i.compile();let o=i.vars.list;if(n.length>o.length)throw Error(`${r}: ${n.length} \u0430\u0440\u0433\u0443\u043C\u0435\u043D\u0442\u043E\u0432, \u043D\u043E \u0444\u0443\u043D\u043A\u0446\u0438\u044F \u0438\u043C\u0435\u0435\u0442 ${o.length} \u043F\u0435\u0440\u0435\u043C\u0435\u043D\u043D\u044B\u0445`);let s=new xr,a={map:o.map(d=>new Pr(d,s).getIndex()),memory:s.allocMemory(!0)};n.forEach((d,g)=>{let y=o[g];if(!ue(a,y,d))throw Error(`\u0410\u0440\u0433\u0443\u043C\u0435\u043D\u0442 ${g} \u0438\u043C\u0435\u0435\u0442 \u0442\u0438\u043F ${typeof d}; \u043E\u0436\u0438\u0434\u0430\u043B\u043E\u0441\u044C ${y.type}`)}),(h=i.main)==null||h.call(i,t,a,this);let c=o.find(d=>d.attrib&1024);if(c)return dr(a,c)}solveEquationsFor({prj:{root:t}},r){let n=t.createLinearSystem(this,r),i;try{i=zo(n)}catch(s){i=new Array(r.length).fill(0)}let o=t.vars.memory.newFloats;r.forEach((s,a)=>o[s]=i[a])}};var on=class{constructor(t){this.projectLoader=t;this.handlers={closed:new Set,error:new Set,shell:new Set,write:new Set};this.ctx=new nn(this);this.classes=new en;this.projects=[];this.prevProjects=[];this.compiler=new Yt;this.plugins=[];this.showed=new Set}loadPlugin(t,r){var n,i;(n=t.deps)==null||n.forEach(o=>{if(!this.plugins.some(({name:s})=>o===s))throw Error(`\u041F\u043B\u0430\u0433\u0438\u043D '${t.name}' \u0437\u0430\u0432\u0438\u0441\u0438\u0442 \u043E\u0442 '${o}'`)}),this.compiler.addPlugin(t,this.ctx),(i=t.init)==null||i.call(t,this,r),this.plugins.push(t)}project({filepath:t,searchDirs:r,nonRecursive:n,rootClass:i,dir:o,stt:s},a){pe.debugProject&&console.log(`\u041E\u0442\u043A\u0440\u044B\u0432\u0430\u0435\u0442\u0441\u044F ${t}`);let c=Symbol(t.toString()),h;try{r.forEach(g=>{let y=!n||g===this.projectLoader.stdlibDir;g.forEach(E=>{if(!E.cls||this.classes.hasFile(E))return;let v=new Zt(c,E.cls,E,this.compiler);v.isFunction&&this.compiler.addUserFunc(Bs(v)),this.classes.add(v)},y)});let d=this.classes.get(i);if(!d)throw Error(`${t}: \u041A\u043E\u0440\u043D\u0435\u0432\u043E\u0439 \u0438\u043C\u0438\u0434\u0436 ${i} \u043D\u0435 \u0441\u0443\u0449\u0435\u0441\u0442\u0432\u0443\u0435\u0442.`);h=new tn({id:c,filepath:t,dir:o,klass:d,state:s},this.classes)}catch(d){throw this.classes.unload(c),d}return a||this.set({projects:this.projects.concat(h)}),this.plugins.forEach(d=>{var g;return(g=d.onProjectOpened)==null?void 0:g.call(d,this,h)}),h}compute(){if(this.prevProjects!==this.projects){let r=this.prevProjects.filter(n=>!this.projects.includes(n));this.prevProjects=this.projects,r.forEach(n=>{pe.debugProject&&console.log(`\u0417\u0430\u043A\u0440\u044B\u0432\u0430\u0435\u0442\u0441\u044F ${n.id.description}`),this.classes.unload(n.id),this.plugins.forEach(i=>{var o;return(o=i.onProjectClosed)==null?void 0:o.call(i,this,n)})})}if(!this.projects.length)return!1;let t=this.projects[this.projects.length-1];try{t.root.compute(this.ctx),this.plugins.forEach(r=>{var n;return(n=r.afterCompute)==null?void 0:n.call(r,this)})}catch(r){throw r instanceof qe?new qe(`\u041F\u0440\u043E\u0435\u043A\u0442 ${t.id.description}, ${r.message}`,r.original):r}return!0}set({projects:t=this.projects}){return this.projects=t,this}log(t,r){pe.logMessage&&console.info(r?`${r.path()}: ${t}`:t)}handleExe(t,r){let n=t.lastIndexOf(".exe"),i=n<0?t:t.substring(0,n);return this.handlers.shell.forEach(o=>o(i,"","",r!=null?r:0)),!0}handleShell(t,r,n,i){return this.handlers.shell.forEach(o=>o(t,r,n,i)),!0}handleWrite(t,r){this.handlers.write.forEach(n=>n(t.path.toString(),r))}_functionNotImplemented(t,r){if(this.showed.size===this.showed.add(t.toUpperCase()).size)return;let n=`${t} \u043D\u0435 \u0440\u0435\u0430\u043B\u0438\u0437\u043E\u0432\u0430\u043D\u0430`;console.warn(r?`${r.path()}: ${n}`:n)}};var m=1,_=2,u=3,ie=4,N=Ve.FLOAT_REF,Ee=Ve.STRING_REF,pN=Ve.HANDLE_REF,gN=Ve.COLORREF_REF,js=.752812499999996,$s=1.3283520132835271,Hs=Date.now(),tr=new Date(88005553535),Ti=13.204656862745098;function sn(e,t){let r=e.toUpperCase(),n=r.includes("WS_CHILD"),i=r.includes("WS_BYSPACE"),o=r.includes("WS_POPUP"),s=r.includes("WS_NORESIZE"),a=r.includes("WS_AUTOORG"),c=r.includes("WS_SPACESIZE"),h=r.includes("WS_VSCROLL"),d=r.includes("WS_HSCROLL"),g=i?J({},t):{};return n&&(g.child=!0),d&&(g.hscroll=!0),h&&(g.vscroll=!0),c&&(g.size={type:"content"}),s&&(g.fixed=!0),o&&(g.popup=!0),a&&(g.autoorg=!0),g}function Mi(e){var r;let t=(r=e.file())==null?void 0:r.base64;return t?me.decode(mt(t)):""}var an=class{constructor(t,r){this.key=t;this.fields=r!=null?r:[]}insert(t){if(t==="FLOAT")return this.fields.push({type:t,value:0}),1;if(t==="HANDLE")return this.fields.push({type:t,value:0}),1;if(t==="STRING")return this.fields.push({type:t,value:""}),1;throw Error(`\u041D\u0435\u0438\u0437\u0432\u0435\u0441\u0442\u043D\u044B\u0439 \u0442\u0438\u043F \u044D\u043B\u0435\u043C\u0435\u043D\u0442\u0430: ${t}`)}insertClass(t,r){let n=r.map(i=>{let o=i[0].toUpperCase();switch(i[1]){case 1:return[o,{type:"FLOAT",value:0}];case 2:return[o,{type:"STRING",value:""}];default:return[o,{type:"HANDLE",value:0}]}});return this.fields.push({type:"STRUCT",realType:t,value:new Map(n)}),1}set(t,r,n){if(t<0||t>this.fields.length-1)return;let i=this.fields[t];if(i.type==="STRUCT"){let o=i.value.get(r.toUpperCase());if(!o)return;i=o}if(typeof n=="string"){if(i.type!=="STRING")return;i.value=n}else{if(i.type==="STRING")return;i.value=n}}remove(t){return this.fields.splice(t,1).length?1:0}count(){return this.fields.length}type(t){if(t<0||t>this.fields.length-1)return"";let r=this.fields[t];return r.type==="STRUCT"?r.realType:r.type}getFloat(t,r){if(t<0||t>this.fields.length-1)return 0;let n=this.fields[t];if(n.type==="STRUCT"){let i=n.value.get(r.toUpperCase());if(!i)return 0;n=i}return n.type==="FLOAT"?n.value:0}getHandle(t,r){if(t<0||t>this.fields.length-1)return 0;let n=this.fields[t];if(n.type==="STRUCT"){let i=n.value.get(r.toUpperCase());if(!i)return 0;n=i}return n.type==="HANDLE"?n.value:0}getString(t,r){if(t<0||t>this.fields.length-1)return"";let n=this.fields[t];if(n.type==="STRUCT"){let i=n.value.get(r.toUpperCase());if(!i)return"";n=i}return n.type==="STRING"?n.value:""}sort(t){if(!(t!=null&&t.length))return this.fields.sort((r,n)=>r.value-n.value),1;if(t.length===1)return t[0].desc?this.fields.sort((r,n)=>n.value-r.value):this.fields.sort((r,n)=>r.value-n.value),1;throw console.log(t),Error("VSort: \u0441\u043E\u0440\u0442\u0438\u0440\u043E\u0432\u043A\u0430 \u043F\u043E \u043D\u0435\u0441\u043A\u043E\u043B\u044C\u043A\u0438\u043C \u043F\u043E\u043B\u044F\u043C \u043D\u0435 \u0440\u0435\u0430\u043B\u0438\u0437\u043E\u0432\u0430\u043D\u0430")}};function wh(e,t){let r=ge.freeKey(e),n=new an(r,t);return e.set(r,n),n}function xh(e){return e.createArray().key}function Ph(e,t){e.arrays.delete(t)}function Sh(e,t){var r,n;return(n=(r=e.arrays.get(t))==null?void 0:r.count())!=null?n:0}function Th(e,t,r){var n,i;return(i=(n=e.arrays.get(t))==null?void 0:n.type(r))!=null?i:""}function Mh(e,t,r){let n=e.arrays.get(t);if(!n)return 0;let i=r.toUpperCase();if(i==="STRING"||i==="FLOAT"||i==="HANDLE")return n.insert(i);let o=e.classes.get(r);if(!o)return 0;let s=o.vars.list.map(a=>[a.name,a.type]);return n.insertClass(o.name,s)}function Oh(e,t,r){var n,i;return(i=(n=e.arrays.get(t))==null?void 0:n.remove(r))!=null?i:0}function Wh(e){return e.arrays.clear(),1}function Ah(e,t,r,n){var i,o;return(o=(i=e.arrays.get(t))==null?void 0:i.getString(Math.floor(r),n))!=null?o:""}function Nh(e,t,r,n){var i,o;return(o=(i=e.arrays.get(t))==null?void 0:i.getHandle(Math.floor(r),n))!=null?o:0}function Rh(e,t,r,n){var i,o;return(o=(i=e.arrays.get(t))==null?void 0:i.getFloat(Math.floor(r),n))!=null?o:0}function Oi(e,t,r,n,i){var o;(o=e.arrays.get(t))==null||o.set(r,n,i)}function Ih(e,t,...r){let n=e.arrays.get(t);return n?n.sort(r.map(i=>({desc:!1,field:i}))):0}function Fh(e,t,r,...n){let i=e.arrays.get(t);if(!i)return 0;let o=!!r;return i.sort(n.map(s=>({desc:o,field:s})))}function Dh(e,t,...r){let n=e.arrays.get(t);if(!n)return 0;let i=[];for(let o=0;o<r.length;o+=2){let s=r[o],a=!!r[o+1];i.push({desc:a,field:s})}return n.sort(i)}function kh(e){e("new",{r:u},xh),e("delete",{a:[u]},Ph),e("vGetCount",{a:[u],r:m},Sh),e("vGetType",{a:[u,m],r:_},Th),e("vInsert",{a:[u,_],r:m},Mh),e("vDelete",{a:[u,m],r:m},Oh),e("vClearAll",{},Wh),e("vGetS",{a:[u,m,_],r:_},Ah),e("vGetH",{a:[u,m,_],r:u},Nh),e("vGetF",{a:[u,m,_],r:m},Rh),e("vSet",{a:[u,m,_,m]},Oi),e("vSet",{a:[u,m,_,_]},Oi),e("vSet",{a:[u,m,_,u]},Oi),e("vSort",{a:[u],rest:[_],r:m},Ih),e("vSort",{a:[u,m],rest:[_],r:m},Fh),e("vSort",{a:[u],rest:[_,m],r:m},Dh)}var zs={register:kh,init:function(e){let t=new Map;e.arrays=t,e.createArray=wh.bind(null,t)},name:"arrays"};var qs=new Set;function Ne(...e){qs.size!==qs.add(e[0]).size&&console.warn(...e)}function Gh(e,t){throw Ne("AudioGetBalance",t),Error("Not implemented")}function Lh(e,t){throw Ne("AudioGetLength",t),Error("Not implemented")}function Bh(e,t){throw Ne("AudioGetPosition",t),Error("Not implemented")}function Vh(e,t){throw Ne("AudioGetRepeat",t),Error("Not implemented")}function Ch(e,t){throw Ne("AudioGetTone",t),Error("Not implemented")}function Kh(e,t){throw Ne("AudioGetVolume",t),Error("Not implemented")}function Uh(e,t){var r,n;return(n=(r=e.audios.get(t))!=null&&r.paused?0:1)!=null?n:0}function Jh(e,t){throw Ne("AudioIsSeekable",t),Error("Not implemented")}function jh(e,t){var o;let r=(o=this.prj.dir.resolve(t).file())==null?void 0:o.audio;if(!r)return 0;let n=new Audio(Te(r.src)),i=ge.freeKey(e.audios);return e.audios.set(i,n),i}function $h(e,t){var r;(r=e.audios.get(t))==null||r.play()}function Hh(e,t){Ne("AudioReset",t)}function zh(e,t,r){Ne("AudioSetBalance",t,r)}function qh(e,t,r){Ne("AudioSetPosition",t,r)}function Yh(e,t,r){Ne("AudioSetRepeat",t,r)}function Xh(e,t,r){Ne("AudioSetTone",t,r)}function Qh(e,t,r){Ne("AudioSetVolume",t,r)}function Zh(e,t){var r;(r=e.audios.get(t))==null||r.pause()}function ed(e){e("audioGetBalance",{a:[u],r:m},Gh),e("audioGetLength",{a:[u],r:m},Lh),e("audioGetPosition",{a:[u],r:m},Bh),e("audioGetRepeat",{a:[u],r:m},Vh),e("audioGetTone",{a:[u],r:m},Ch),e("audioGetVolume",{a:[u],r:m},Kh),e("audioIsPlaying",{a:[u],r:m},Uh),e("audioIsSeekable",{a:[u],r:m},Jh),e("audioOpenSound",{a:[_],r:u},jh),e("audioPlay",{a:[u]},$h),e("audioReset",{a:[u]},Hh),e("audioSetBalance",{a:[u,m]},zh),e("audioSetPosition",{a:[u,m]},qh),e("audioSetRepeat",{a:[u,m]},Yh),e("audioSetTone",{a:[u,m]},Xh),e("audioSetVolume",{a:[u,m]},Qh),e("audioStop",{a:[u]},Zh)}var Ys={register:ed,init:function(e){e.audios=new Map}};function rd(e,t){var r,n;return(n=(r=this.resolve(t))==null?void 0:r.klass.name)!=null?n:""}function Xs(e,...t){throw console.warn("createLink",...t),Error("Not implemented")}function td(e,...t){throw console.warn("createObject",...t),Error("Not implemented")}function nd(e){throw Error("Not implemented")}function id(e,...t){throw console.warn("setLinkVars",...t),Error("Not implemented")}function od(e,t){var r,n;return(n=(r=e.classes.get(t))==null?void 0:r.children.length)!=null?n:0}function sd(e){var t,r;return(r=(t=this.ndata)==null?void 0:t.key)!=null?r:0}function ad(e,t){var r,n,i;return(i=(n=(r=this.resolve(t))==null?void 0:r.ndata)==null?void 0:n.key)!=null?i:0}function ld(e,t,r){var i;if(r<0)return 0;let n=(i=e.classes.get(t))==null?void 0:i.children;return n&&r<n.length?n[r].key:0}function cd(e,t,r){var n,i,o;return(o=(i=(n=e.classes.get(t))==null?void 0:n.children.find(s=>s.key===r))==null?void 0:i.klass)!=null?o:""}function ud(e,t,r,n){var i,o,s;return(s=(o=(i=e.classes.get(t))==null?void 0:i.connections.find(({nodes:[a,c]})=>a===r&&c===n||a===n&&c===r))==null?void 0:o.key)!=null?s:0}function md(e,t,r){var s;let n=(s=e.classes.get(t))==null?void 0:s.modelText;if(!n)return 0;let i=e.streams.get(r);if(!i)return 0;let o=me.encode(n);return i.write(o),o.length}function Qs(e,t,r){var a;let n=e.classes.get(t);if(!n)return 0;let i=(a=e.streams.get(r))==null?void 0:a.buffer();if(!i)return 0;let o=me.decode(new Uint8Array(i)),s=n.modelText;n.set({modelText:o});try{n.compile()}catch(c){if(!(c instanceof Error))throw c;return console.warn(c.message),n.set({modelText:s}),0}return 1}function hd(e,t,r){var o;let n=this.resolve(t);if(!n)return"";let i=n.klass.vars.get(r);return i&&(o=Gs(n.vars,i))!=null?o:""}function Wi(e,t,r){var o;let n=e.resolve(t);if(!n)return 0;let i=n.klass.vars.get(r);return i&&(o=ks(n.vars,i))!=null?o:0}function dd(e,t,r){return Wi(this,t,r)}function pd(e,t,r){return Wi(this,t,r)}function gd(e,t,r){return Wi(this,t,r)}function ln(e,t,r,n){let i=this.resolve(t);if(!i)return;let o=i.klass.vars.get(r);o&&ue(i.vars,o,n)}function Zs(e,t,r,n,i,o,s,a,c,h,d,g,y){var P,w,O;let E=(P=e.classes.get(t))==null?void 0:P.vars.list;if(r<0||!E||r>=E.length)return n[i]="",o[s]="",a[c]="",h[d]="",g&&(g[y]=0),0;let v=E[r];return n[i]=v.name,o[s]=ce[v.type],a[c]=(w=v.defaultValue)!=null?w:"",h[d]=(O=v.description)!=null?O:"",g&&(g[y]=v.attrib),1}function bd(e,t){var r,n;return(n=(r=e.classes.get(t))==null?void 0:r.vars.list.length)!=null?n:0}function fd(e,t,r,n){let i=e.classes.get(t);if(!i)return 0;let o=i.children.findIndex(a=>a.key===r);if(o<0)return 0;let s=i.children.slice();return s[o]=X(J({},s[o]),{name:n}),i.set({children:s}),1}function yd(e,t,r){var n,i,o;return(o=(i=(n=e.classes.get(t))==null?void 0:n.children.find(s=>s.key===r))==null?void 0:i.name)!=null?o:""}function Ed(e,t,r){let n=this.resolve(t);if(!n)return 0;let i=this.prj.dir.resolve(r).file();if(!i)return 0;let o=n.getValues();return i.set({stt:o}),1}function vd(e,t,r){var o;let n=this.resolve(t);if(!n)return 0;let i=(o=this.prj.dir.resolve(r).file())==null?void 0:o.stt;return i?(n.applyValues(i),1):0}function _d(e,t){var r;return(r=this.resolve(t))!=null&&r.initValues(!0)?1:0}function wd(e){e._functionNotImplemented("Stop",this)}function xd(e,t){t<=0||e.set({projects:[]})}function Pd(e){e.set({projects:e.projects.filter(t=>t!==this.prj)})}function Sd(e){e("getClassName",{a:[_],r:_},rd),e("createLink",{a:[_,u,u],r:u},Xs),e("createLink",{a:[_,_,_],r:u},Xs),e("createObject",{a:[_,_,_,m,m],r:u},td),e("deleteObject",{a:[_,u,m],r:m},nd),e("setLinkVars",{a:[_,u,_],r:m},id),e("getObjectCount",{a:[_],r:m},od),e("getHObject",{r:u},sd),e("getHObjectByName",{a:[_],r:u},ad),e("getHObjectByNum",{a:[_,m],r:u},ld),e("getObjectClass",{a:[_,u],r:_},cd),e("getLink",{a:[_,u,u],r:u},ud),e("getModelText",{a:[_,u],r:m},md),e("setModelText",{a:[_,u],r:m},Qs),e("setModelText",{a:[_,u,m],r:m},Qs),e("getVarS",{a:[_,_],r:_},hd),e("getVarF",{a:[_,_],r:m},dd),e("getVarH",{a:[_,_],r:u},pd),e("getVarC",{a:[_,_],r:ie},gd),e("setVar",{a:[_,_,m]},ln),e("setVar",{a:[_,_,_]},ln),e("setVar",{a:[_,_,u]},ln),e("setVar",{a:[_,_,ie]},ln),e("getVarInfo",{a:[_,m,Ee,Ee,Ee,Ee],r:m},Zs),e("getVarInfo",{a:[_,m,Ee,Ee,Ee,Ee,N],r:m},Zs),e("getVarCount",{a:[_],r:m},bd),e("setObjectName",{a:[_,u,_],r:m},fd),e("getNameByHandle",{a:[_,u],r:_},yd),e("saveObjectState",{a:[_,_],r:m},Ed),e("loadObjectState",{a:[_,_],r:m},vd),e("setVarsToDefault",{a:[_],r:m},_d),e("stop",{a:[m]},wd),e("quit",{a:[m]},xd),e("closeAll",{},Pd)}var ea={register:Sd,deps:["streams"]};function Td(e,t){return this.prj.dir.resolve(t).create("folder")?1:0}function Md(e,t){let r=this.prj.dir.resolve(t);return r.file()||e.projectLoader.exists(r)?1:0}function Od(e,t){let r=e.classes.get(t);return r?r.file.path.resolve("..").toString()+"\\":""}function Wd(){return this.prj.dir.toString()}function Ad(){return"C:\\Windows"}function Nd(e,t){let r=this.prj.dir.resolve(t).resolveMany();if(!r.length)return 0;let n=r.map(i=>{let o=[["NAME",{type:"STRING",value:i.name}],["SIZE",{type:"FLOAT",value:i.size}],["ATTR",{type:"FLOAT",value:0}],["YEAR",{type:"FLOAT",value:tr.getFullYear()}],["MONTH",{type:"FLOAT",value:tr.getMonth()+1}],["DAY",{type:"FLOAT",value:tr.getDate()}],["DAYOFWEEK",{type:"FLOAT",value:tr.getDay()}],["HOUR",{type:"FLOAT",value:tr.getHours()}],["MINUTE",{type:"FLOAT",value:tr.getMinutes()}],["SECOND",{type:"FLOAT",value:tr.getSeconds()}]];return{type:"STRUCT",realType:"FILE_ATTRIBUTE",value:new Map(o)}});return e.createArray(n).key}function Rd(e,t){return t.length===0||t[t.length-1]==="\\"?t:t+"\\"}function Id(e){e("createDir",{a:[_],r:m},Td),e("fileExist",{a:[_],r:m},Md),e("getClassDirectory",{a:[_],r:_},Od),e("getProjectDirectory",{r:_},Wd),e("getWindowsDirectory",{r:_},Ad),e("getFileList",{a:[_,m],r:u},Nd),e("addSlash",{a:[_],r:_},Rd)}var ra={register:Id,deps:["arrays"]};function Fd(e,t){let r=e.scenes.get(t);return r?r.window.scrollX?r.window.view.scrollLeft:r.scene.x:0}function Dd(e,t){let r=e.scenes.get(t);return r?r.window.scrollY?r.window.view.scrollTop:r.scene.y:0}function kd(e,t,r,n){let i=e.scenes.get(t);if(!i)return 0;let o=i.window.scrollX?0:r,s=i.window.scrollY?0:n,a=i.window.scrollX?r:0,c=i.window.scrollY?n:0;return i.scene.set({x:o,y:s}),i.window.scrollTo(a,c),1}function Gd(e,t){var r,n;return(n=(r=e.scenes.get(t))==null?void 0:r.window.scale)!=null?n:0}function Ld(e,t,r){var n;return(n=e.scenes.get(t))!=null&&n.window.set({scale:r})?1:0}function Bd(e,t,r,n,i,o,s,a){var g;let c=(g=e.scenes.get(t))==null?void 0:g.scene.toBlob({x:i,y:o,w:s,h:a});if(!c)return 0;let h=r.match(/(?:.*[\\/])?(.+?)(\..*)?$/),d=h&&h.length>1?h[1]:"Screenshot";return c.then(y=>Uo(y,d)),1}function Vd(e,t){var r,n,i;return(i=(n=(r=e.scenes.get(t))==null?void 0:r.scene.background)==null?void 0:n.key)!=null?i:0}function Cd(e,t,r){var i,o;let n=(i=e.scenes.get(t))==null?void 0:i.scene;return n!=null&&n.set({background:(o=n.brushes.get(r))!=null?o:null})?1:0}function Kd(){return 0}function Ud(e,t){var r,n;return(n=(r=e.scenes.get(t))==null?void 0:r.scene.hiddenLayers)!=null?n:0}function Jd(e,t,r){var n;return(n=e.scenes.get(t))!=null&&n.scene.set({hiddenLayers:r})?1:0}function jd(){return 1}function $d(e,t,r,n,i,o){var s,a;return(a=(s=e.scenes.get(t))==null?void 0:s.scene.pen({color:i,rop:o,style:r,width:n}).key)!=null?a:0}function Hd(e,t,r){var n,i,o;return(o=(i=(n=e.scenes.get(t))==null?void 0:n.scene.pens.get(r))==null?void 0:i.color)!=null?o:0}function zd(e,t,r){var n,i,o;return(o=(i=(n=e.scenes.get(t))==null?void 0:n.scene.pens.get(r))==null?void 0:i.rop)!=null?o:0}function qd(e,t,r){var n,i,o;return(o=(i=(n=e.scenes.get(t))==null?void 0:n.scene.pens.get(r))==null?void 0:i.style)!=null?o:0}function Yd(e,t,r){var n,i,o;return(o=(i=(n=e.scenes.get(t))==null?void 0:n.scene.pens.get(r))==null?void 0:i.width)!=null?o:0}function Xd(e,t,r,n){var i,o;return(o=(i=e.scenes.get(t))==null?void 0:i.scene.pens.get(r))!=null&&o.set({color:n})?1:0}function Qd(e,t,r,n){var i,o;return(o=(i=e.scenes.get(t))==null?void 0:i.scene.pens.get(r))!=null&&o.set({rop:n})?1:0}function Zd(e,t,r,n){var i,o;return(o=(i=e.scenes.get(t))==null?void 0:i.scene.pens.get(r))!=null&&o.set({style:n})?1:0}function ep(e,t,r,n){var i,o;return(o=(i=e.scenes.get(t))==null?void 0:i.scene.pens.get(r))!=null&&o.set({width:n})?1:0}function rp(e,t,r,n,i,o,s){var c,h;let a=(c=e.scenes.get(t))==null?void 0:c.scene;return(h=a==null?void 0:a.brush({color:i,hatch:n,rop:s,style:r,image:a.imagesOpaque.get(o)}).key)!=null?h:0}function tp(e,t,r){var n,i,o;return(o=(i=(n=e.scenes.get(t))==null?void 0:n.scene.brushes.get(r))==null?void 0:i.color)!=null?o:0}function np(e,t,r){var n,i,o;return(o=(i=(n=e.scenes.get(t))==null?void 0:n.scene.brushes.get(r))==null?void 0:i.rop)!=null?o:0}function ip(e,t,r){var n,i,o;return(o=(i=(n=e.scenes.get(t))==null?void 0:n.scene.brushes.get(r))==null?void 0:i.style)!=null?o:0}function op(e,t,r){var n,i,o;return(o=(i=(n=e.scenes.get(t))==null?void 0:n.scene.brushes.get(r))==null?void 0:i.hatch)!=null?o:0}function sp(e,t,r){var n,i,o,s;return(s=(o=(i=(n=e.scenes.get(t))==null?void 0:n.scene.brushes.get(r))==null?void 0:i.image)==null?void 0:o.key)!=null?s:0}function ap(e,t,r,n){var i,o;return(o=(i=e.scenes.get(t))==null?void 0:i.scene.brushes.get(r))!=null&&o.set({color:n})?1:0}function lp(e,t,r,n){var i,o;return(o=(i=e.scenes.get(t))==null?void 0:i.scene.brushes.get(r))!=null&&o.set({rop:n})?1:0}function cp(e,t,r,n){var i,o;return(o=(i=e.scenes.get(t))==null?void 0:i.scene.brushes.get(r))!=null&&o.set({style:n})?1:0}function up(e,t,r,n){var i,o;return(o=(i=e.scenes.get(t))==null?void 0:i.scene.brushes.get(r))!=null&&o.set({hatch:n})?1:0}function mp(e,t,r,n){var o,s,a;let i=(o=e.scenes.get(t))==null?void 0:o.scene;return(a=i==null?void 0:i.brushes.get(r))!=null&&a.set({image:(s=i.imagesOpaque.get(n))!=null?s:null})?1:0}function sa(e,t,r,n,i){var o,s;return(s=(o=e.scenes.get(t))==null?void 0:o.scene.font({name:r,size:n,style:i}).key)!=null?s:0}function hp(e,t,r,n,i){return sa(e,t,r,n,i)}function dp(e,t,r,n,i){return sa(e,t,r,n*$s,i)}function pp(e,t,r){var n,i,o;return(o=(i=(n=e.scenes.get(t))==null?void 0:n.scene.fonts.get(r))==null?void 0:i.name)!=null?o:""}function gp(e,t,r){var n,i,o;return((o=(i=(n=e.scenes.get(t))==null?void 0:n.scene.fonts.get(r))==null?void 0:i.size)!=null?o:0)*js}function bp(e,t,r){var n,i,o;return(o=(i=(n=e.scenes.get(t))==null?void 0:n.scene.fonts.get(r))==null?void 0:i.style)!=null?o:0}function fp(e,t,r,n){var i,o;return(o=(i=e.scenes.get(t))==null?void 0:i.scene.fonts.get(r))!=null&&o.set({name:n})?1:0}function yp(e,t,r,n){var i,o;return(o=(i=e.scenes.get(t))==null?void 0:i.scene.fonts.get(r))!=null&&o.set({size:n})?1:0}function Ep(e,t,r,n){var i,o;return(o=(i=e.scenes.get(t))==null?void 0:i.scene.fonts.get(r))!=null&&o.set({style:n})?1:0}function vp(e,t,r){var n,i;return(i=(n=e.scenes.get(t))==null?void 0:n.scene.string(r).key)!=null?i:0}function _p(e,t,r){var n,i,o;return(o=(i=(n=e.scenes.get(t))==null?void 0:n.scene.strings.get(r))==null?void 0:i.text)!=null?o:""}function wp(e,t,r,n){var i,o;return(o=(i=e.scenes.get(t))==null?void 0:i.scene.strings.get(r))!=null&&o.set({text:n})?1:0}function xp(e,t,r,n,i,o){var h;let s=(h=e.scenes.get(t))==null?void 0:h.scene;if(!s)return 0;let a=s.strings.get(n);if(!a)return 0;let c=s.fonts.get(r);return c?s.text([{string:a,font:c,fgcolor:i,bgcolor:o}]).key:0}function Pp(e,t,r){var n,i,o;return(o=(i=(n=e.scenes.get(t))==null?void 0:n.scene.texts.get(r))==null?void 0:i.parts.length)!=null?o:0}function Sr(e,t,r,n){var o,s;if(n<0)return null;let i=(s=(o=e.scenes.get(t))==null?void 0:o.scene.texts.get(r))==null?void 0:s.parts;return i&&n<i.length?i[n]:null}function ta(e,t,r,n=0){var i,o;return(o=(i=Sr(e,t,r,n))==null?void 0:i.font.key)!=null?o:0}function na(e,t,r,n=0){var i,o;return(o=(i=Sr(e,t,r,n))==null?void 0:i.string.key)!=null?o:0}function ia(e,t,r,n=0){var i,o;return(o=(i=Sr(e,t,r,n))==null?void 0:i.fgcolor)!=null?o:0}function oa(e,t,r,n=0){var i,o;return(o=(i=Sr(e,t,r,n))==null?void 0:i.bgcolor)!=null?o:0}function aa(e,t,r,n,i,o,s,a){var d,g;if(n<0)return 0;let c=(d=e.scenes.get(t))==null?void 0:d.scene;if(!c)return 0;let h=(g=c.texts.get(r))==null?void 0:g.parts;return!h||n>=h.length?0:(h[n].set({string:c.strings.get(o),font:c.fonts.get(i),fgcolor:s,bgcolor:a}),1)}function Sp(e,t,r,n,i,o,s){return aa(e,t,r,0,n,i,o,s)}function Tp(e,t,r,n,i){var c,h;if(n<0)return 0;let o=(c=e.scenes.get(t))==null?void 0:c.scene;if(!o)return 0;let s=(h=o.texts.get(r))==null?void 0:h.parts;if(!s||n>=s.length)return 0;let a=o.fonts.get(i);return a?(s[n].set({font:a}),1):0}function Mp(e,t,r,n,i){var c,h;if(n<0)return 0;let o=(c=e.scenes.get(t))==null?void 0:c.scene;if(!o)return 0;let s=(h=o.texts.get(r))==null?void 0:h.parts;if(!s||n>=s.length)return 0;let a=o.strings.get(i);return a?(s[n].set({string:a}),1):0}function Op(e,t,r,n,i){var o;return(o=Sr(e,t,r,n))!=null&&o.set({fgcolor:i})?1:0}function Wp(e,t,r,n,i){var o;return(o=Sr(e,t,r,n))!=null&&o.set({bgcolor:i})?1:0}function la(e,t,r,n,i,o,s,a){var v;if(n<0)return 0;let c=(v=e.scenes.get(t))==null?void 0:v.scene;if(!c)return 0;let h=c.texts.get(r);if(!h)return 0;let d=c.fonts.get(i);if(!d)return 0;let g=c.strings.get(o);if(!g)return 0;let y=n<h.parts.length,E=h.part({font:d,string:g,fgcolor:s,bgcolor:a},y);if(y){let P=h.parts.slice();P.splice(n,0,E),h.set({parts:P})}return 1}function Ap(e,t,r,n,i,o,s){return la(e,t,r,1/0,n,i,o,s)}function Np(e,t,r,n){var a;if(n<0)return 0;let i=(a=e.scenes.get(t))==null?void 0:a.scene;if(!i)return 0;let o=i.texts.get(r);if(!o||n>=o.parts.length)return 0;let s=o.parts.slice();return s.splice(n,1),o.set({parts:s},!0),1}function ca(e,{prj:t},r,n,i){var a,c;let o=(a=e.scenes.get(r))==null?void 0:a.scene;if(!o)return 0;let s=(c=t.dir.resolve(n).file())==null?void 0:c.image;return s?o.image(s,{opaque:i}).key:0}function Rp(e,t,r){return ca(e,this,t,r,!0)}function Ip(e,t,r){return ca(e,this,t,r)}function Fp(e,t,r,n,i){var o,s,a;return(a=(s=(o=e.scenes.get(t))==null?void 0:o.scene.imagesOpaque.get(r))==null?void 0:s.pixel(n,i))!=null?a:0}function Dp(e,t,r,n,i,o){var s,a;return(a=(s=e.scenes.get(t))==null?void 0:s.scene.imagesOpaque.get(r))!=null&&a.setPixel(n,i,o)?1:0}function kp(e,t,r,n){var s,a;let i=(s=e.scenes.get(t))==null?void 0:s.scene;if(!i)return 0;let o;switch(r){case 1:o=i.pens;break;case 2:o=i.brushes;break;case 4:o=i.images;break;case 3:o=i.imagesOpaque;break;case 6:o=i.strings;break;case 5:o=i.fonts;break;case 7:o=i.texts;break;case 8:throw Error("\u041D\u0435 \u0440\u0435\u0430\u043B\u0438\u0437\u043E\u0432\u0430\u043D\u043E");default:return 0}return(a=o.get(n))!=null&&a.delete(!0)?1:0}function Gp(e,t,r,n){var a;let i=(a=e.scenes.get(t))==null?void 0:a.scene;if(!i)return 0;let o;switch(r){case 1:o=i.pens;break;case 2:o=i.brushes;break;case 4:o=i.images;break;case 3:o=i.imagesOpaque;break;case 6:o=i.strings;break;case 5:o=i.fonts;break;case 7:o=i.texts;break;case 8:throw Error("\u041D\u0435 \u0440\u0435\u0430\u043B\u0438\u0437\u043E\u0432\u0430\u043D\u043E");default:return 0}let s=1/0;for(let c of o.keys())c>n&&c<s&&(s=c);return s===1/0?0:s}function Lp(e,t,r,n){var s,a,c;let i=(s=e.scenes.get(t))==null?void 0:s.scene;if(!i)return 0;let o;switch(r){case 1:o=i.pens;break;case 2:o=i.brushes;break;case 4:o=i.images;break;case 3:o=i.imagesOpaque;break;case 6:o=i.strings;break;case 5:o=i.fonts;break;case 7:o=i.texts;break;case 8:throw Error("\u041D\u0435 \u0440\u0435\u0430\u043B\u0438\u0437\u043E\u0432\u0430\u043D\u043E");default:return 0}return(c=(a=o.get(n))==null?void 0:a.subs.size)!=null?c:0}function Bp(e,t,r,n){return si(t,r,n)}function Vp(e,t,r,n,i){return si(t,r,n,i===1?"transparent":i===2?"syscolor":"rgb")}function Cp(e,t){return t&4294967295}function Kp(e,t){return os(t)}function Up(e,t){return ss(t)}function Jp(e,t){return as(t)}function jp(e,t,r,n,i,o){var c,h,d,g;let s=e.scenes.get(t);if(!s)return 0;let a=(h=(c=this.prj.dir.resolve(r).file())==null?void 0:c.scene)==null?void 0:h.data;return a&&(g=(d=s.paste(a,n,i,o))==null?void 0:d.key)!=null?g:0}function $p(e,t,r){var n,i;return(i=(n=e.scenes.get(t))==null?void 0:n.scene.objects.get(r))!=null&&i.delete(!0)?1:0}function Hp(e,t,r){var i;let n=(i=e.scenes.get(t))==null?void 0:i.scene.objects.get(r);if(!n)return 0;switch(n.type){case"group":return 3;case"line":return 20;case"imageView":return n.opaque?21:22;case"textView":return 23;case"videoView":return 0;case"input":return 26}}function zp(e,t,r){var n,i,o,s;return(s=(o=(i=(n=e.scenes.get(t))==null?void 0:n.scene.objects.get(r))==null?void 0:i.data)==null?void 0:o.name)!=null?s:""}function qp(e,t,r,n){var o;let i=(o=e.scenes.get(t))==null?void 0:o.scene.objects.get(r);return i?(i.data.name=n,1):0}function Yp(e,t,r,n){var s,a,c;if(!n)return 0;let i=(s=e.scenes.get(t))==null?void 0:s.scene;if(!i)return 0;let o;if(r){let h=i.objects.get(r);if(!h)return 0;if(((a=h.data)==null?void 0:a.name)===n)return h.key;if(h.type!=="group")return 0;o=h.descendants()}else o=i.objects.values();for(let h of o)if(((c=h.data)==null?void 0:c.name)===n)return h.key;return 0}function Xp(e,t,r){let n=e.scenes.get(t);if(!n)return 0;let i=n.scene.objects.get(r);if(!i)return 0;let o=n.invmatrix;if(!o)return i.x;let s=i.x,a=i.y,c=s*o[2]+a*o[5]+o[8];return(s*o[0]+a*o[3]+o[6])/c}function Qp(e,t,r){let n=e.scenes.get(t);if(!n)return 0;let i=n.scene.objects.get(r);if(!i)return 0;let o=n.invmatrix;if(!o)return i.y;let s=i.x,a=i.y,c=s*o[2]+a*o[5]+o[8];return(s*o[1]+a*o[4]+o[7])/c}function Zp(e,t,r,n,i){let o=e.scenes.get(t);if(!o)return 0;let s=o.scene.objects.get(r);if(!s)return 0;let a=n,c=i,h=o.matrix;if(h){let d=n*h[2]+i*h[5]+h[8];a=(n*h[0]+i*h[3]+h[6])/d,c=(n*h[1]+i*h[4]+h[7])/d}return s.set({x:a,y:c}),1}function eg(e,t,r){var n,i,o;return(o=(i=(n=e.scenes.get(t))==null?void 0:n.scene.objects.get(r))==null?void 0:i.width)!=null?o:0}function rg(e,t,r){var n,i,o;return(o=(i=(n=e.scenes.get(t))==null?void 0:n.scene.objects.get(r))==null?void 0:i.height)!=null?o:0}function tg(e,t,r,n,i){var o,s;return(s=(o=e.scenes.get(t))==null?void 0:o.scene.objects.get(r))!=null&&s.set({width:n,height:i})?1:0}function ng(e,t,r){var i;let n=(i=e.scenes.get(t))==null?void 0:i.scene.objects.get(r);if(!n)return 0;switch(n.type){case"group":case"line":case"input":return n.width;case"imageView":return n.image.width;case"textView":return n.text.width;case"videoView":return n.video.width}}function ig(e,t,r){var i;let n=(i=e.scenes.get(t))==null?void 0:i.scene.objects.get(r);if(!n)return 0;switch(n.type){case"group":case"line":case"input":return n.height;case"imageView":return n.image.height;case"textView":return n.text.height;case"videoView":return n.video.height}}function og(e,t,r,n,i,o,s){var c;let a=(c=e.scenes.get(t))==null?void 0:c.scene.objects.get(r);if(!a)return n[i]=0,o[s]=0,0;switch(a.type){case"group":case"line":case"input":return n[i]=a.width,o[s]=a.height,1;case"imageView":return n[i]=a.image.width,o[s]=a.image.height,1;case"textView":return n[i]=a.text.width,o[s]=a.text.height,1;case"videoView":return n[i]=a.video.width,o[s]=a.video.height,1}}function sg(e,t,r){var i;let n=(i=e.scenes.get(t))==null?void 0:i.scene.objects.get(r);return n&&n.type==="textView"?n.angle:0}function ag(e,t,r,n,i,o){let s=e.scenes.get(t);if(!s)return 0;let a=s.scene.objects.get(r);if(!a)return 0;let c=n,h=i,d=s.matrix;if(d){let g=n*d[2]+i*d[5]+d[8];c=(n*d[0]+i*d[3]+d[6])/g,h=(n*d[1]+i*d[4]+d[7])/g}return a.rotate(o,{x:c,y:h}),1}function Ai(e,t,r,n){var s;let i=(s=e.scenes.get(t))==null?void 0:s.scene.objects.get(r);if(!i)return 0;let o=n?i.attrib&-2:i.attrib|1;return i.set({attrib:o}),1}function lg(e,t,r,n){return Ai(e,t,r,!!n)}function cg(e,t,r){Ai(e,t,r,!0)}function ug(e,t,r){Ai(e,t,r,!1)}function mg(e,t,r,n){var i,o,s;return(s=(o=(i=e.scenes.get(t))==null?void 0:i.pick(r,n,!0))==null?void 0:o.key)!=null?s:0}function hg(e){return e.windowSystem.lastPickedPrimaryKey}function dg(e,t,r){var i;let n=(i=e.scenes.get(t))==null?void 0:i.scene.objects.get(r);return n?(e.windowSystem.clipboard=ns(n),1):0}function pg(e,t,r,n,i){var s,a,c;let o=e.windowSystem.clipboard;return o&&(c=(a=(s=e.scenes.get(t))==null?void 0:s.paste(o,r,n,i))==null?void 0:a.key)!=null?c:0}function gg(e,t,r,n){var s;let i=(s=e.scenes.get(t))==null?void 0:s.scene.objects.get(r);if(!i)return 0;let o=i.attrib;switch(n){case 0:o&=-13;break;case 1:o&=-5,o|=8;break;case 2:o&=-9,o|=4;break;default:return 0}return i.set({attrib:o}),1}function bg(e,t,r){var n,i,o;return(o=(i=(n=e.scenes.get(t))==null?void 0:n.scene.objects.get(r))==null?void 0:i.attrib)!=null?o:0}function fg(e,t,r,n,i){var a;let o=(a=e.scenes.get(t))==null?void 0:a.scene.objects.get(r);if(!o)return 0;let{attrib:s}=o;switch(i){case 1:s|=n;break;case 2:s&=~n;break;case 3:s=n;break;default:return 0}return o.set({attrib:s}),1}function yg(e,t,r){var o;let n=(o=e.scenes.get(t))==null?void 0:o.scene;if(!n)return 0;let i=1/0;for(let s of n.objects.keys())s>r&&s<i&&(i=s);return i===1/0?0:i}function Eg(e,t,r,n){var a;let i=(a=e.scenes.get(t))==null?void 0:a.scene;if(!i)return 0;let o=i.objects.get(r);if(!o)return 0;let s=i.objects.get(n);return s&&o.x+o.width>=s.x&&s.x+s.width>=o.x&&o.y+o.height>=s.y&&s.y+s.height>=o.y?1:0}function vg(e,t){var n;let r=(n=e.scenes.get(t))==null?void 0:n.scene.order;return r&&r.length>0?r[0].key:0}function _g(e,t){var n;let r=(n=e.scenes.get(t))==null?void 0:n.scene.order;return r&&r.length>0?r[r.length-1].key:0}function wg(e,t,r){var a;let n=(a=e.scenes.get(t))==null?void 0:a.scene;if(!n)return 0;let i=n.objects.get(r);if(!i||i.type==="group")return 0;let o=n.order,s=o.indexOf(i);return s<1?0:o[s-1].key}function xg(e,t,r){var a;let n=(a=e.scenes.get(t))==null?void 0:a.scene;if(!n)return 0;let i=n.objects.get(r);if(!i||i.type==="group")return 0;let o=n.order,s=o.indexOf(i);return s>-1&&s<o.length-1?o[s+1].key:0}function Pg(e,t,r){var o;let n=r-1;if(n<0)return 0;let i=(o=e.scenes.get(t))==null?void 0:o.scene.order;return i&&n<i.length?i[n].key:0}function Sg(e,t,r){var a;let n=(a=e.scenes.get(t))==null?void 0:a.scene;if(!n)return 0;let i=n.objects.get(r);if(!i||i.type==="group")return 0;let s=n.order.indexOf(i);return s<0?0:s+1}function Tg(e,t,r,n){var h;let i=n-1;if(i<0)return 0;let o=(h=e.scenes.get(t))==null?void 0:h.scene;if(!o)return 0;let s=o.objects.get(r);if(!s||s.type==="group")return 0;let a=o.order,c=[];for(let d=0;d<a.length;++d){let g=a[d];g!==s&&c.push(g),i===d&&c.push(s)}return i>=a.length&&c.push(s),o.set({order:c}),1}function Mg(e,t,r){var s;let n=(s=e.scenes.get(t))==null?void 0:s.scene;if(!n)return 0;let i=n.objects.get(r);if(!i||i.type==="group")return 0;let o=n.order.filter(a=>a!==i);return o.unshift(i),n.set({order:o}),1}function Og(e,t,r){var s;let n=(s=e.scenes.get(t))==null?void 0:s.scene;if(!n)return 0;let i=n.objects.get(r);if(!i||i.type==="group")return 0;let o=n.order.filter(a=>a!==i);return o.push(i),n.set({order:o}),1}function Wg(e,t,r,n){var g;let i=(g=e.scenes.get(t))==null?void 0:g.scene;if(!i)return 0;let o=i.objects.get(r);if(!o||o.type==="group")return 0;let s=i.objects.get(n);if(!s||s.type==="group")return 0;let a=i.order.slice(),c=a.indexOf(o);if(c<0)return 0;let h=a.indexOf(s);if(h<0)return 0;let d=a[c];return a[c]=a[h],a[h]=d,i.set({order:a}),1}function ua(e,t,r,n,i){let o=e.scenes.get(t);if(!o)return 0;let{matrix:s,scene:a}=o;if(s)for(let h=0;h<i.length;h+=2){let d=i[h+0],g=i[h+1],y=d*s[2]+g*s[5]+s[8];i[h+0]=(d*s[0]+g*s[3]+s[6])/y,i[h+1]=(d*s[1]+g*s[4]+s[7])/y}let c=a.line(i,{pen:a.pens.get(r),brush:a.brushes.get(n)});return a.set({order:a.order.concat(c)}),c.key}function Ag(e,t,r,n,...i){return ua(e,t,r,n,i)}function Ng(e,t,r,n,i,o){return ua(e,t,r,n,[i,o])}function Rg(e,t,r,n,i,o){let s=e.scenes.get(t);if(!s)return 0;let a=s.scene.objects.get(r);if((a==null?void 0:a.type)!=="line")return 0;let c=i,h=o,d=s.matrix;if(d){let g=i*d[2]+o*d[5]+d[8];c=(i*d[0]+o*d[3]+d[6])/g,h=(i*d[1]+o*d[4]+d[7])/g}return a.addPoint({x:c,y:h},n)?1:0}function Ig(e,t,r,n,i,o){let s=e.scenes.get(t);if(!s)return 0;let a=s.scene.objects.get(r);if((a==null?void 0:a.type)!=="line")return 0;let c=i,h=o,d=s.matrix;if(d){let g=i*d[2]+o*d[5]+d[8];c=(i*d[0]+o*d[3]+d[6])/g,h=(i*d[1]+o*d[4]+d[7])/g}return a.setPoint(n,{x:c,y:h})?1:0}function Fg(e,t,r,n){var o;let i=(o=e.scenes.get(t))==null?void 0:o.scene.objects.get(r);return(i==null?void 0:i.type)==="line"&&i.delPoint(n)?1:0}function Dg(e,t,r){var i,o;let n=(i=e.scenes.get(t))==null?void 0:i.scene.objects.get(r);return(n==null?void 0:n.type)==="line"&&((o=n.pen)==null?void 0:o.key)||0}function kg(e,t,r){var i,o;let n=(i=e.scenes.get(t))==null?void 0:i.scene.objects.get(r);return(n==null?void 0:n.type)==="line"&&((o=n.brush)==null?void 0:o.key)||0}function Gg(e,t,r){var i;let n=(i=e.scenes.get(t))==null?void 0:i.scene.objects.get(r);return(n==null?void 0:n.type)==="line"?n.length:0}function Lg(e,t,r,n){let i=e.scenes.get(t);if(!i)return 0;let o=i.scene.objects.get(r),s=(o==null?void 0:o.type)==="line"&&o.point(n);if(!s)return 0;let{x:a,y:c}=s,h=i.invmatrix;if(!h)return a;let d=a*h[2]+c*h[5]+h[8];return(a*h[0]+c*h[3]+h[6])/d}function Bg(e,t,r,n){let i=e.scenes.get(t);if(!i)return 0;let o=i.scene.objects.get(r),s=(o==null?void 0:o.type)==="line"&&o.point(n);if(!s)return 0;let{x:a,y:c}=s,h=i.invmatrix;if(!h)return c;let d=a*h[2]+c*h[5]+h[8];return(a*h[1]+c*h[4]+h[7])/d}function Vg(e,t,r,n){var s,a;let i=(s=e.scenes.get(t))==null?void 0:s.scene;if(!i)return 0;let o=i.objects.get(r);return(o==null?void 0:o.type)==="line"&&o.set({brush:(a=i.brushes.get(n))!=null?a:null})?1:0}function Cg(e,t,r,n){var s,a;let i=(s=e.scenes.get(t))==null?void 0:s.scene;if(!i)return 0;let o=i.objects.get(r);return(o==null?void 0:o.type)==="line"&&o.set({pen:(a=i.pens.get(n))!=null?a:null})?1:0}function Kg(e,t,r,n,i,o,s,a,c){var y;let h=(y=e.scenes.get(t))==null?void 0:y.scene.objects.get(r);if((h==null?void 0:h.type)!=="line")return 0;let d={angle:n,length:i,fill:!!o},g={angle:s,length:a,fill:!!c};return h.set({start:d,end:g}),1}function Ug(e,t,...r){var s;let n=(s=e.scenes.get(t))==null?void 0:s.scene;if(!n)return 0;let i=!0,o=r.map(a=>{let c=n.objects.get(a);return(!c||c.parent)&&(i=!1),c});return i?n.group(o).key:0}function Jg(e,t,r){var i;let n=(i=e.scenes.get(t))==null?void 0:i.scene.objects.get(r);return(n==null?void 0:n.type)!=="group"?0:(n.set({children:[]}).delete(),1)}function jg(e,t,r,n){var a;if(r===n)return 0;let i=(a=e.scenes.get(t))==null?void 0:a.scene;if(!i)return 0;let o=i.objects.get(r);if((o==null?void 0:o.type)!=="group")return 0;let s=i.objects.get(n);if(!s||s.parent)return 0;if(s.type==="group"){let c=o;for(;c=c.parent;)if(c===s)return 0}return o.set({children:o.children.concat(s)}),1}function $g(e,t,r,n){var a;let i=(a=e.scenes.get(t))==null?void 0:a.scene;if(!i)return 0;let o=i.objects.get(r);if((o==null?void 0:o.type)!=="group")return 0;let s=i.objects.get(n);return(s==null?void 0:s.parent)!==o?0:(o.set({children:o.children.filter(c=>c!==s)}),1)}function Hg(e,t,r){var i;let n=(i=e.scenes.get(t))==null?void 0:i.scene.objects.get(r);return(n==null?void 0:n.type)==="group"?n.children.length:0}function zg(e,t,r,n){var s;if(n<0)return 0;let i=(s=e.scenes.get(t))==null?void 0:s.scene.objects.get(r);if((i==null?void 0:i.type)!=="group")return 0;let o=i.children;return n<o.length?o[n].key:0}function qg(e,t,r){var n,i,o,s;return(s=(o=(i=(n=e.scenes.get(t))==null?void 0:n.scene.objects.get(r))==null?void 0:i.parent)==null?void 0:o.key)!=null?s:0}function Yg(e,t,r,n){var s;let i=(s=e.scenes.get(t))==null?void 0:s.scene;if(!i)return 0;let o=i.objects.get(r);if((o==null?void 0:o.type)!=="group")return 0;for(let a=0;a<o.children.length;++a){let c=o.children[a];if(c.key===n)return a+1;if(c.type==="group"){for(let h of c.descendants())if(h.key===n)return a+1}}return 0}function ma(e,t,r,n,i,o){let s=e.scenes.get(t);if(!s)return 0;let a=s.scene,c=(o?a.imagesOpaque:a.images).get(r);if(!c)return 0;let h=n,d=i,g=s.matrix;if(g){let E=n*g[2]+i*g[5]+g[8];h=(n*g[0]+i*g[3]+g[6])/E,d=(n*g[1]+i*g[4]+g[7])/E}let y=a.imageView(c,{x:h,y:d,opaque:o});return a.set({order:a.order.concat(y)}),y.key}function Xg(e,t,r,n,i){return ma(e,t,r,n,i,!0)}function Qg(e,t,r,n,i){return ma(e,t,r,n,i)}function Zg(e,t,r,n,i,o,s,a,c,h,d){var E,v,P,w,O;let g=(E=e.scenes.get(t))==null?void 0:E.scene.objects.get(r);if((g==null?void 0:g.type)!=="imageView")return n[i]=0,o[s]=0,a[c]=0,h[d]=0,0;let y=g.area;return n[i]=(v=y==null?void 0:y.x)!=null?v:0,o[s]=(P=y==null?void 0:y.y)!=null?P:0,a[c]=(w=y==null?void 0:y.w)!=null?w:g.image.width,h[d]=(O=y==null?void 0:y.h)!=null?O:g.image.height,1}function eb(e,t,r,n,i,o,s){var c;let a=(c=e.scenes.get(t))==null?void 0:c.scene.objects.get(r);return(a==null?void 0:a.type)==="imageView"&&a.set({area:{x:n,y:i,w:o,h:s}})?1:0}function rb(e,t,r){var i;let n=(i=e.scenes.get(t))==null?void 0:i.scene.objects.get(r);return(n==null?void 0:n.type)==="imageView"&&n.opaque&&n.image.key||0}function tb(e,t,r){var i;let n=(i=e.scenes.get(t))==null?void 0:i.scene.objects.get(r);return(n==null?void 0:n.type)==="imageView"&&!n.opaque&&n.image.key||0}function nb(e,t,r,n){var a;let i=(a=e.scenes.get(t))==null?void 0:a.scene;if(!i)return 0;let o=i.imagesOpaque.get(n);if(!o)return 0;let s=i.objects.get(r);return(s==null?void 0:s.type)==="imageView"&&s.opaque&&s.set({image:o})?1:0}function ib(e,t,r,n){var a;let i=(a=e.scenes.get(t))==null?void 0:a.scene;if(!i)return 0;let o=i.images.get(n);if(!o)return 0;let s=i.objects.get(r);return(s==null?void 0:s.type)==="imageView"&&!s.opaque&&s.set({image:o})?1:0}function ob(e,t,r,n,i,o){let s=e.scenes.get(t);if(!s)return 0;let a=s.scene,c=a.texts.get(r);if(!c)return 0;let h=n,d=i,g=s.matrix;if(g){let E=n*g[2]+i*g[5]+g[8];h=(n*g[0]+i*g[3]+g[6])/E,d=(n*g[1]+i*g[4]+g[7])/E}let y=a.textView(c,{x:h,y:d,angle:o});return a.set({order:a.order.concat(y)}),y.key}function sb(e,t,r){var i;let n=(i=e.scenes.get(t))==null?void 0:i.scene.objects.get(r);return(n==null?void 0:n.type)==="textView"&&n.text.key||0}function ab(e){e("getSpaceOrg2dx",{a:[u],r:m},Fd),e("getSpaceOrg2dy",{a:[u],r:m},Dd),e("setSpaceOrg2d",{a:[u,m,m],r:m},kd),e("getScaleSpace2d",{a:[u],r:m},Gd),e("setScaleSpace2d",{a:[u,m],r:m},Ld),e("saveRectArea2d",{a:[u,_,m,m,m,m,m],r:m},Bd),e("getBkBrush2d",{a:[u],r:u},Vd),e("setBkBrush2d",{a:[u,u],r:m},Cd),e("lockSpace2d",{a:[u,m],r:m},Kd),e("getSpaceLayers2d",{a:[u],r:m},Ud),e("setSpaceLayers2d",{a:[u,m],r:m},Jd),e("setSpaceRenderEngine2d",{a:[u,m],r:m},jd),e("createPen2d",{a:[u,m,m,ie,m],r:u},$d),e("getPenColor2d",{a:[u,u],r:ie},Hd),e("getPenRop2d",{a:[u,u],r:m},zd),e("getPenStyle2d",{a:[u,u],r:m},qd),e("getPenWidth2d",{a:[u,u],r:m},Yd),e("setPenColor2d",{a:[u,u,ie],r:m},Xd),e("setPenRop2d",{a:[u,u,m],r:m},Qd),e("setPenStyle2d",{a:[u,u,m],r:m},Zd),e("setPenWidth2d",{a:[u,u,m],r:m},ep),e("createBrush2d",{a:[u,m,m,ie,u,m],r:u},rp),e("getBrushColor2d",{a:[u,u],r:ie},tp),e("getBrushRop2d",{a:[u,u],r:m},np),e("getBrushStyle2d",{a:[u,u],r:m},ip),e("getBrushHatch2d",{a:[u,u],r:m},op),e("getBrushDib2d",{a:[u,u],r:u},sp),e("setBrushColor2d",{a:[u,u,ie],r:m},ap),e("setBrushRop2d",{a:[u,u,m],r:m},lp),e("setBrushStyle2d",{a:[u,u,m],r:m},cp),e("setBrushHatch2d",{a:[u,u,m],r:m},up),e("setBrushDib2d",{a:[u,u,u],r:m},mp),e("createFont2d",{a:[u,_,m,m],r:u},hp),e("createFont2dpt",{a:[u,_,m,m],r:u},dp),e("getFontName2d",{a:[u,u],r:_},pp),e("getFontSize2d",{a:[u,u],r:m},gp),e("getFontStyle2d",{a:[u,u],r:m},bp),e("setFontName2d",{a:[u,u,_],r:m},fp),e("setFontSize2d",{a:[u,u,m],r:m},yp),e("setFontStyle2d",{a:[u,u,m],r:m},Ep),e("createString2d",{a:[u,_],r:u},vp),e("getString2d",{a:[u,u],r:_},_p),e("setString2d",{a:[u,u,_],r:m},wp),e("createText2d",{a:[u,u,u,ie,ie],r:u},xp),e("getTextCount2d",{a:[u,u],r:m},Pp),e("getTextFont2d",{a:[u,u],r:u},ta),e("getTextFont2d",{a:[u,u,m],r:u},ta),e("getTextString2d",{a:[u,u],r:u},na),e("getTextString2d",{a:[u,u,m],r:u},na),e("getTextFgColor2d",{a:[u,u],r:ie},ia),e("getTextFgColor2d",{a:[u,u,m],r:ie},ia),e("getTextBkColor2d",{a:[u,u],r:ie},oa),e("getTextBkColor2d",{a:[u,u,m],r:ie},oa),e("setText2d",{a:[u,u,u,u,ie,ie],r:m},Sp),e("setText2d",{a:[u,u,m,u,u,ie,ie],r:m},aa),e("setTextFont2d",{a:[u,u,m,u],r:m},Tp),e("setTextString2d",{a:[u,u,m,u],r:m},Mp),e("setTextFgColor2d",{a:[u,u,m,ie],r:m},Op),e("setTextBkColor2d",{a:[u,u,m,ie],r:m},Wp),e("addText2d",{a:[u,u,u,u,ie,ie],r:m},Ap),e("addText2d",{a:[u,u,m,u,u,ie,ie],r:m},la),e("removeText2d",{a:[u,u,m],r:m},Np),e("createDIB2d",{a:[u,_],r:u},Rp),e("createDoubleDIB2d",{a:[u,_],r:u},Ip),e("getDibPixel2d",{a:[u,u,m,m],r:ie},Fp),e("setDibPixel2d",{a:[u,u,m,m,ie],r:m},Dp),e("deleteTool2d",{a:[u,m,u],r:m},kp),e("getNextTool2d",{a:[u,m,u],r:u},Gp),e("getToolRef2d",{a:[u,m,u],r:m},Lp),e("rgb",{a:[m,m,m],r:ie},Bp),e("rgbEx",{a:[m,m,m,m],r:ie},Vp),e("rgbf",{a:[m],r:ie},Cp),e("getRValue",{a:[ie],r:m},Kp),e("getGValue",{a:[ie],r:m},Up),e("getBValue",{a:[ie],r:m},Jp),e("createObjectFromFile2d",{a:[u,_,m,m,m],r:u},jp),e("deleteObject2d",{a:[u,u],r:m},$p),e("getObjectType2d",{a:[u,u],r:m},Hp),e("getObjectName2d",{a:[u,u],r:_},zp),e("setObjectName2d",{a:[u,u,_],r:m},qp),e("getObject2dByName",{a:[u,u,_],r:u},Yp),e("getObjectOrg2dx",{a:[u,u],r:m},Xp),e("getObjectOrg2dy",{a:[u,u],r:m},Qp),e("setObjectOrg2d",{a:[u,u,m,m],r:m},Zp),e("getObjectWidth2d",{a:[u,u],r:m},eg),e("getObjectHeight2d",{a:[u,u],r:m},rg),e("setObjectSize2d",{a:[u,u,m,m],r:m},tg),e("getActualWidth2d",{a:[u,u],r:m},ng),e("getActualHeight2d",{a:[u,u],r:m},ig),e("getActualSize2d",{a:[u,u,N,N],r:m},og),e("getObjectAngle2d",{a:[u,u],r:m},sg),e("rotateObject2d",{a:[u,u,m,m,m],r:m},ag),e("setShowObject2d",{a:[u,u,m],r:m},lg),e("showObject2d",{a:[u,u]},cg),e("hideObject2d",{a:[u,u]},ug),e("getObjectFromPoint2d",{a:[u,m,m],r:u},mg),e("getLastPrimary2d",{r:u},hg),e("copyToClipboard2d",{a:[u,u],r:m},dg),e("pasteFromClipboard2d",{a:[u,m,m,m],r:u},pg),e("lockObject2d",{a:[u,u,m],r:m},gg),e("getObjectAttribute2d",{a:[u,u],r:m},bg),e("setObjectAttribute2d",{a:[u,u,m,m],r:m},fg),e("getNextObject2d",{a:[u,u],r:u},yg),e("isObjectsIntersect2d",{a:[u,u,u,m],r:m},Eg),e("getBottomObject2d",{a:[u],r:u},vg),e("getTopObject2d",{a:[u],r:u},_g),e("getLowerObject2d",{a:[u,u],r:u},wg),e("getUpperObject2d",{a:[u,u],r:u},xg),e("getObjectFromZOrder2d",{a:[u,m],r:u},Pg),e("getZOrder2d",{a:[u,u],r:m},Sg),e("setZOrder2d",{a:[u,u,m],r:m},Tg),e("objectToBottom2d",{a:[u,u],r:m},Mg),e("objectToTop2d",{a:[u,u],r:m},Og),e("swapObject2d",{a:[u,u,u],r:m},Wg),e("createPolyLine2d",{a:[u,u,u],rest:[m,m],r:u},Ag),e("createLine2d",{a:[u,u,u,m,m],r:u},Ng),e("addPoint2d",{a:[u,u,m,m,m],r:m},Rg),e("setVectorPoint2d",{a:[u,u,m,m,m],r:m},Ig),e("delPoint2d",{a:[u,u,m],r:m},Fg),e("getPenObject2d",{a:[u,u],r:u},Dg),e("getBrushObject2d",{a:[u,u],r:u},kg),e("getVectorNumPoints2d",{a:[u,u],r:m},Gg),e("getVectorPoint2dx",{a:[u,u,m],r:m},Lg),e("getVectorPoint2dy",{a:[u,u,m],r:m},Bg),e("setBrushObject2d",{a:[u,u,u],r:u},Vg),e("setPenObject2d",{a:[u,u,u],r:u},Cg),e("setLineArrows2d",{a:[u,u,m,m,m,m,m,m],r:m},Kg),e("createGroup2d",{a:[u],rest:[u],r:u},Ug),e("deleteGroup2d",{a:[u,u],r:m},Jg),e("addGroupItem2d",{a:[u,u,u],r:m},jg),e("delGroupItem2d",{a:[u,u,u],r:m},$g),e("getGroupItemsNum2d",{a:[u,u],r:m},Hg),e("getGroupItem2d",{a:[u,u,m],r:u},zg),e("getObjectParent2d",{a:[u,u],r:u},qg),e("isGroupContainObject2d",{a:[u,u,u],r:m},Yg),e("createBitmap2d",{a:[u,u,m,m],r:u},Xg),e("createDoubleBitmap2d",{a:[u,u,m,m],r:u},Qg),e("getBitmapSrcRect2d",{a:[u,u,N,N,N,N],r:m},Zg),e("setBitmapSrcRect2d",{a:[u,u,m,m,m,m],r:m},eb),e("getDibObject2d",{a:[u,u],r:u},rb),e("getDDibObject2d",{a:[u,u],r:u},tb),e("setDibObject2d",{a:[u,u,u],r:m},nb),e("setDDibObject2d",{a:[u,u,u],r:m},ib),e("createRasterText2d",{a:[u,u,m,m,m],r:u},ob),e("getTextObject2d",{a:[u,u],r:u},sb)}var ha={register:ab,deps:["windows"]};function lb(e,t,r,n,i,o,s,a,c){let h;switch(r.toUpperCase()){case"EDIT":h="Edit";break;case"BUTTON":h="Button";break;case"COMBOBOX":h="ComboBox";break;case"LISTBOX":h="ListBox";break;default:return 0}let d=e.scenes.get(t);if(!d)return 0;let g=d.scene,y=o,E=s,v=d.matrix;if(v){let w=o*v[2]+s*v[5]+v[8];y=(o*v[0]+s*v[3]+v[6])/w,E=(o*v[1]+s*v[4]+v[7])/w}let P=g.input(h,{x:y,y:E,width:a,height:c,value:n,style:i});return g.set({order:g.order.concat(P)}),P.key}function da(e,t,r,n,i){var a;let o=(a=e.scenes.get(t))==null?void 0:a.scene.objects.get(r);if((o==null?void 0:o.type)!=="input")return"";let{value:s}=o;return typeof n=="undefined"?s:s.slice(n,n+i)}function cb(e,t,r,n){var o;let i=(o=e.scenes.get(t))==null?void 0:o.scene.objects.get(r);return(i==null?void 0:i.type)==="input"&&i.set({value:n})?1:0}function ub(e,t,r,n){var s,a;let i=(s=e.scenes.get(t))==null?void 0:s.scene;if(!i)return 0;let o=i.objects.get(r);return(o==null?void 0:o.type)==="input"&&o.set({font:(a=i.fonts.get(n))!=null?a:null})?1:0}function mb(e){return e._functionNotImplemented("EnableControl2d"),0}function hb(e,t,r){var o;let n=(o=e.scenes.get(t))==null?void 0:o.scene;if(!n)return;let i=n.objects.get(r);(i==null?void 0:i.type)==="input"&&i._html.focus()}function db(e){return e._functionNotImplemented("IsDlgButtonChecked"),0}function pb(e){return e._functionNotImplemented("CheckDlgButton2d"),1}function gb(e){e("createControlObject2d",{a:[u,_,_,m,m,m,m,m,m],r:u},lb),e("getControlText2d",{a:[u,u],r:_},da),e("getControlText2d",{a:[u,u,m,m],r:_},da),e("setControlText2d",{a:[u,u,_],r:m},cb),e("setControlFont2d",{a:[u,u,u],r:m},ub),e("enableControl2d",{a:[u,u,m],r:m},mb),e("setControlFocus2d",{a:[u,u]},hb),e("isDlgButtonChecked2d",{a:[u,u],r:m},db),e("checkDlgButton2d",{a:[u,u,m],r:m},pb)}var pa={register:gb,deps:["windows"]};var Tr=class e{constructor(t){this.minV=Math.floor(t.minV),this.minH=Math.floor(t.minH),this.rows=t.rows,this.cols=t.cols,this.m=t.data?new Float64Array(t.data):new Float64Array(this.rows*this.cols)}isSquare(){return this.cols===this.rows}get(t,r){let n=Math.floor(t)-this.minV,i=Math.floor(r)-this.minH;return n<0||i<0||n>=this.rows||i>=this.cols?0:this.m[n*this.cols+i]}set(t,r,n){let i=Math.floor(t)-this.minV,o=Math.floor(r)-this.minH;return i<0||o<0||i>=this.rows||o>=this.cols?0:(this.m[i*this.cols+o]=n,n)}sum(){return this.m.reduce((t,r)=>t+r,0)}glue(t,r,n){let i=this,o=Math.min(i.minH,t.minH+n),s=Math.min(i.minV,t.minV+r),a=Math.max(i.cols+i.minH,t.cols+t.minH+n),c=Math.max(i.rows+i.minV,t.rows+t.minV+r),h=new e({cols:a-o,rows:c-s,minH:o,minV:s});for(let d=t.minV;d<t.rows+t.minV;d++)for(let g=t.minH;g<t.cols+t.minH;g++)h.set(d+r,g+n,t.get(d,g));for(let d=i.minV;d<i.rows+i.minV;d++)for(let g=i.minH;g<i.cols+i.minH;g++)h.set(d,g,i.get(d,g));return h}mul(t){let r=this;if(r.cols!==t.rows)return null;let n=t.cols,i=r.rows,o=new e({cols:n,rows:i,minH:r.minH,minV:r.minV});for(let s=0;s<r.rows;s++)for(let a=0;a<t.cols;a++){let c=0;for(let h=0;h<r.rows;h++)c+=r.m[s*r.cols+h]*t.m[h*t.cols+a];o.m[s*r.rows+a]=c}return o}det(){if(!this.isSquare())throw Error("Not a square matrix");if(this.rows===1)return this.m[0];if(this.rows===2)return this.m[0]*this.m[3]-this.m[1]*this.m[2];let t=Array.from(this.m),r=this.rows,n=1;for(let i=0;i<r;i++){let o=0,s=0;for(let a=i;a<r;a++){let c=t[a*r+i];c>o&&(o=c,s=a)}if(o===0)return 0;if(s!==i){n=-n;for(let a=i;a<r;a++){let c=t[s*r+a];t[s*r+a]=t[i*r+a],t[i*r+a]=c}}for(let a=i+1;a<r;a++){let c=t[a*r+i]/o;for(let h=i+1;h<r;h++)t[a*r+h]=t[a*r+h]-c*t[i*r+h]}n=n*t[i*r+i]}return n}obr(){if(!this.isSquare()||this.det()===0)return null;let t=this.rows,r=new e({cols:this.cols,rows:this.rows,minH:0,minV:0,data:Array.from(this.m)}),n=new e({cols:this.cols,rows:this.rows,minH:0,minV:0});for(let i=0;i<t;i++)for(let o=0;o<t;o++)n.set(i,o,0),i===o&&n.set(i,o,1);for(let i=0;i<t;i++){let o=r.get(i,i);for(let s=0;s<t;s++)r.set(i,s,r.get(i,s)/o),n.set(i,s,n.get(i,s)/o);for(let s=i+1;s<t;s++){o=r.get(s,i);for(let a=0;a<t;a++)r.set(s,a,r.get(s,a)-r.get(i,a)*o),n.set(s,a,n.get(s,a)-n.get(i,a)*o)}}for(let i=t-1;i>0;i--)for(let o=i-1;o>=0;o--){let s=r.get(o,i);for(let a=0;a<t;a++)r.set(o,a,r.get(o,a)-r.get(i,a)*s),n.set(o,a,n.get(o,a)-n.get(i,a)*s)}return n.minH=this.minH,n.minV=this.minV,n}diag(t){this.fill(0);let r=Math.min(this.rows,this.cols);for(let n=0;n<r;n++)this.set(n,n,t);return 1}fill(t){return this.m.fill(t),1}sortByRow(t,r){let n=t-this.minV;if(n<0||n>=this.rows)return 0;let i=Array.from({length:this.cols},(s,a)=>Array.from({length:this.rows},(c,h)=>this.m[h*this.cols+a])),o=r?(s,a)=>a[n]-s[n]:(s,a)=>s[n]-a[n];return i.sort(o),i.forEach((s,a)=>{s.forEach((c,h)=>{this.m[h*this.cols+a]=c})}),1}sortByColumn(t,r){let n=t-this.minH;if(n<0||n>=this.cols)return 0;let i=Array.from({length:this.rows},(s,a)=>{let c=a*this.cols,h=c+this.cols;return Array.from(this.m.subarray(c,h))}),o=r?(s,a)=>a[n]-s[n]:(s,a)=>s[n]-a[n];return i.sort(o),this.m=new Float64Array(ht(i)),1}data(){let{minH:t,minV:r,cols:n,rows:i,m:o}=this;return{minV:r,minH:t,cols:n,rows:i,data:[...o]}}};function bb(e,t,r,n,i,o,s){if(s<=0)return 0;let a=Math.floor(n)-Math.floor(r)+1,c=Math.floor(o)-Math.floor(i)+1;if(a<=0||c<=0)return 0;let h=t||ge.freeNegativeKey(e.matrices);return e.matrices.set(h,new Tr({rows:a,cols:c,minV:r,minH:i})),h}function fb(e,t,r){return r<=0?0:e.matrices.delete(t)?1:0}function yb(e,t,r,n){var i,o;return n<=0?0:(o=(i=e.matrices.get(t))==null?void 0:i.fill(r))!=null?o:0}function Eb(e,t,r,n,i){var o,s;return i<=0?0:(s=(o=e.matrices.get(t))==null?void 0:o.get(r,n))!=null?s:0}function vb(e,t,r,n,i,o){var s,a;return o<=0?0:(a=(s=e.matrices.get(t))==null?void 0:s.set(r,n,i))!=null?a:0}function _b(e,t,r){if(r<=0)return 0;throw Error("MEditor: \u0440\u0435\u0434\u0430\u043A\u0442\u043E\u0440 \u043C\u0430\u0442\u0440\u0438\u0446 \u043D\u0435 \u0440\u0435\u0430\u043B\u0438\u0437\u043E\u0432\u0430\u043D")}function wb(e,t,r,n){var i,o;return n<=0?0:(o=(i=e.matrices.get(t))==null?void 0:i.diag(r))!=null?o:0}function xb(e,t,r){if(r<=0)return 0;let n=e.matrices.get(t);return!n||!n.isSquare()?0:n.det()}function Pb(e,t,r){var n,i;return r<=0?0:(i=(n=e.matrices.get(t))==null?void 0:n.sum())!=null?i:0}function Sb(e,t,r,n,i){if(i<=0)return 0;let o=e.matrices.get(t),s=e.matrices.get(r);if(!o||!s)return 0;let a=o.mul(s);if(!a)return 0;let c=n||ge.freeNegativeKey(e.matrices);return e.matrices.set(c,a),c}function Tb(e,t,r,n,i,o,s){if(s<=0)return 0;let a=e.matrices.get(t),c=e.matrices.get(r);if(!a||!c)return 0;let h=n||ge.freeNegativeKey(e.matrices);return e.matrices.set(h,a.glue(c,Math.floor(i),Math.floor(o))),h}function Mb(e,t,r,n){if(n<=0)return 0;let i=e.matrices.get(t);if(!i)return 0;let o=i.obr();if(!o)return 0;let s=r||ge.freeNegativeKey(e.matrices);return e.matrices.set(s,o),s}function Ob(e,t,r,n){if(n<=0)return 0;let i=e.matrices.get(t);if(!i)return 0;let o=this.prj.dir.resolve(r).create("file");return o?(o.set({mat:i.data()}),1):0}function Wb(e,t,r,n){var s;if(n<=0)return 0;let i=(s=this.prj.dir.resolve(r).file())==null?void 0:s.mat;if(!i)return 0;let o=t||ge.freeNegativeKey(e.matrices);return e.matrices.set(o,new Tr(i)),o}function Ab(e,t,r,n,i){if(i<=0)return 0;let o=e.matrices.get(t);if(!o)return 0;switch(n){case 1:return o.sortByColumn(r,!1);case 2:return o.sortByColumn(r,!0);case 3:return o.sortByRow(r,!1);case 4:return o.sortByRow(r,!0);default:return 0}}function Nb(e){e("mCreate",{a:[m,m,m,m,m,m],r:m},bb),e("mDelete",{a:[m,m],r:m},fb),e("mFill",{a:[m,m,m],r:m},yb),e("mGet",{a:[m,m,m,m],r:m},Eb),e("mPut",{a:[m,m,m,m,m],r:m},vb),e("mEditor",{a:[m,m]},_b),e("mDiag",{a:[m,m,m],r:m},wb),e("mDet",{a:[m,m],r:m},xb),e("mSum",{a:[m,m],r:m},Pb),e("mMul",{a:[m,m,m,m],r:m},Sb),e("mGlue",{a:[m,m,m,m,m,m],r:m},Tb),e("mObr",{a:[m,m,m],r:m},Mb),e("mSaveAs",{a:[m,_,m],r:m},Ob),e("mLoad",{a:[m,_,m],r:m},Wb),e("mSort",{a:[m,m,m,m],r:m},Ab)}var ga={register:Nb,init:function(e){e.matrices=new Map},onProjectOpened:function(e,t){t.dir.forEach(r=>{if(!r.mat)return;let n=r.path.basename(),i=parseInt(n.substring(0,n.length-5));isNaN(i)||!i||e.matrices.has(i)||e.matrices.set(i,new Tr(r.mat))},!1)}};function ba(e,t,r,n,i,o){let s=typeof t=="number"?e.scenes.get(t):e.windows.get(t);if(!s)return;let a=this.resolve(n);a!=null&&a.klass.vars.msg&&s.subscribe(a,i,r,o)}function fa(e,t,r,n){let i=typeof t=="number"?e.scenes.get(t):e.windows.get(t);if(!i)return;let o=this.resolve(r);o!=null&&o.klass.vars.msg&&i.unsubscribe(o,n)}function Rb(e,t,r){let n=e.scenes.get(t);if(!n)return;let i=this.resolve(r);i!=null&&i.klass.vars.msg&&n.setCapture(i)}function Ib(e){e.windowSystem.releaseCapture()}function Fb(e,t,r,...n){if(e.recursionLvl>58)return;let i=null;if(r&&(i=e.classes.get(r),!i))return;/[\*\?]/.test(t)&&e._functionNotImplemented("SendMessage \u0441 path \u0441\u043E\u0434\u0435\u0440\u0436\u0430\u0449\u0438\u043C '*'/'?'",this);let o=this.resolveMany(t,i);if(!o.length)return;let s=new Array(n.length),a=this.klass.vars,c=o[0].klass.vars;for(let h=0;h<n.length;h+=2){let d=a.get(n[h+0]);if(!d)continue;let g=c.get(n[h+1]);g&&(s[h+0]=d,s[h+1]=g)}o.forEach(h=>{if(h!==this){for(let d=0;d<s.length;d+=2){let g=s[d+0];if(!g)continue;let y=s[d+1];ue(h.vars,y,dr(this.vars,g))}++e.recursionLvl,h.computeSchema(e.ctx),--e.recursionLvl;{let{map:d,memory:{newFloats:g,oldFloats:y,newInts:E,oldInts:v,newStrings:P,oldStrings:w}}=h.vars;for(let O=0;O<d.length;++O){let R=d[O];y[R]=g[R],v[R]=E[R],w[R]=P[R]}}for(let d=0;d<s.length;d+=2){let g=s[d+0];if(!g)continue;let y=s[d+1];Ls(this.vars,g,dr(h.vars,y))}}})}function Db(e){e("registerObject",{s:!0,a:[u,u,_,m,m]},ba),e("registerObject",{s:!0,a:[_,u,_,m,m]},ba),e("unregisterObject",{s:!0,a:[u,_,m]},fa),e("unregisterObject",{s:!0,a:[_,_,m]},fa),e("setCapture",{s:!0,a:[u,_,m]},Rb),e("releaseCapture",{},Ib),e("sendMessage",{s:!0,a:[_,_],rest:[_,_]},Fb)}var ya={register:Db,init:function(e){e.recursionLvl=0},deps:["windows"]};function kb(e,t){if(!t)return 0;let r=me.table.indexOf(t[0]);return r<0?0:r}function Gb(e,t){return t<0||t>255?"":me.table[t]}function Lb(e){return e._functionNotImplemented("MessageBox"),1}function Bb(e){return e._functionNotImplemented("FileSaveDialog"),""}function Ea(e,t,r,n=1){t[r]+=n}function va(e,t,r,n=1){t[r]-=n}function Vb(){}function Cb(e){e("ascii",{a:[_],r:m},kb),e("chr",{a:[m],r:_},Gb),e("messageBox",{a:[_,_,m],r:m},Lb),e("fileSaveDialog",{a:[_,_,_],r:_},Bb),e("inc",{a:[N]},Ea),e("inc",{a:[N,m]},Ea),e("dec",{a:[N]},va),e("dec",{a:[N,m]},va),e("randomize",{a:[m]},Vb)}var _a={register:Cb};function Kb(e,t){var i;let r=(i=this.prj.dir.resolve(t).file())==null?void 0:i.video;if(!r)return 0;let n=ge.freeKey(e.videos);return e.videos.set(n,r),n}function Ub(e,t,r,n,i,o,s){let a=e.videos.get(r);if(!a)return 0;let c=e.scenes.get(t);if(!c)return 0;let h=c.scene,d=n,g=i,y=c.matrix;if(y){let P=n*y[2]+i*y[5]+y[8];d=(n*y[0]+i*y[3]+y[6])/P,g=(n*y[1]+i*y[4]+y[7])/P}let E=o>=0||s>=0,v=h.video(Te(a.src),{x:d,y:g,width:Math.max(0,o),height:Math.max(0,s),fixed:E});return h.set({order:h.order.concat(v)}),v.key}function Jb(e){throw Error("videoSetPos2d: Not implemented")}function jb(e,t,r){var i;let n=(i=e.scenes.get(t))==null?void 0:i.scene.objects.get(r);return(n==null?void 0:n.type)==="videoView"?n.getPosition()*Ti:0}function $b(e,t,r,n){var o;let i=(o=e.scenes.get(t))==null?void 0:o.scene.objects.get(r);return(i==null?void 0:i.type)==="videoView"&&i.setPosition(n/Ti)?1:0}function Hb(e,t,r){var i;let n=(i=e.scenes.get(t))==null?void 0:i.scene.objects.get(r);return(n==null?void 0:n.type)==="videoView"&&n.play()?1:0}function zb(e,t,r){var i;let n=(i=e.scenes.get(t))==null?void 0:i.scene.objects.get(r);return(n==null?void 0:n.type)==="videoView"&&n.pause()?1:0}function qb(e,t,r){var i;let n=(i=e.scenes.get(t))==null?void 0:i.scene.objects.get(r);return(n==null?void 0:n.type)==="videoView"&&n.play()?1:0}function Yb(e,t,r){var i;let n=(i=e.scenes.get(t))==null?void 0:i.scene.objects.get(r);return(n==null?void 0:n.type)==="videoView"&&n.stop()?1:0}function Xb(){return 263}function Qb(){return""}function Zb(){return 0}function ef(e){e("openVideo",{a:[_,m],r:u},Kb),e("createVideoFrame2d",{a:[u,u,m,m,m,m,m],r:u},Ub),e("videoSetPos2d",{a:[u,m],r:m},Jb),e("frameGetPos2d",{a:[u,u],r:m},jb),e("frameSetPos2d",{a:[u,u,m],r:m},$b),e("videoPlay2d",{a:[u,u,m,m,m,m],r:m},Hb),e("videoPause2d",{a:[u,u],r:m},zb),e("videoResume2d",{a:[u,u],r:m},qb),e("videoStop2d",{a:[u,u],r:m},Yb),e("mciSendString",{a:[_],r:m},Xb),e("mciSendStringStr",{a:[_],r:_},Qb),e("sndPlaySound",{a:[_,m],r:m},Zb)}var wa={register:ef,init:function(e){e.videos=new Map},deps:["windows"]};var te=1e-6,he=typeof Float32Array!="undefined"?Float32Array:Array,ke=Math.random;var _R=Math.PI/180;Math.hypot||(Math.hypot=function(){for(var e=0,t=arguments.length;t--;)e+=arguments[t]*arguments[t];return Math.sqrt(e)});var nr={};ur(nr,{add:()=>Pf,adjoint:()=>uf,clone:()=>tf,copy:()=>nf,create:()=>Ni,determinant:()=>mf,equals:()=>Of,exactEquals:()=>Mf,frob:()=>xf,fromMat2d:()=>yf,fromMat4:()=>rf,fromQuat:()=>Ef,fromRotation:()=>bf,fromScaling:()=>ff,fromTranslation:()=>gf,fromValues:()=>of,identity:()=>af,invert:()=>cf,mul:()=>Wf,multiply:()=>xa,multiplyScalar:()=>Sf,multiplyScalarAndAdd:()=>Tf,normalFromMat4:()=>vf,projection:()=>_f,rotate:()=>df,scale:()=>pf,set:()=>sf,str:()=>wf,sub:()=>Af,subtract:()=>Pa,translate:()=>hf,transpose:()=>lf});function Ni(){var e=new he(9);return he!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[5]=0,e[6]=0,e[7]=0),e[0]=1,e[4]=1,e[8]=1,e}function rf(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[4],e[4]=t[5],e[5]=t[6],e[6]=t[8],e[7]=t[9],e[8]=t[10],e}function tf(e){var t=new he(9);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t}function nf(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e}function of(e,t,r,n,i,o,s,a,c){var h=new he(9);return h[0]=e,h[1]=t,h[2]=r,h[3]=n,h[4]=i,h[5]=o,h[6]=s,h[7]=a,h[8]=c,h}function sf(e,t,r,n,i,o,s,a,c,h){return e[0]=t,e[1]=r,e[2]=n,e[3]=i,e[4]=o,e[5]=s,e[6]=a,e[7]=c,e[8]=h,e}function af(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=1,e[5]=0,e[6]=0,e[7]=0,e[8]=1,e}function lf(e,t){if(e===t){var r=t[1],n=t[2],i=t[5];e[1]=t[3],e[2]=t[6],e[3]=r,e[5]=t[7],e[6]=n,e[7]=i}else e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8];return e}function cf(e,t){var r=t[0],n=t[1],i=t[2],o=t[3],s=t[4],a=t[5],c=t[6],h=t[7],d=t[8],g=d*s-a*h,y=-d*o+a*c,E=h*o-s*c,v=r*g+n*y+i*E;return v?(v=1/v,e[0]=g*v,e[1]=(-d*n+i*h)*v,e[2]=(a*n-i*s)*v,e[3]=y*v,e[4]=(d*r-i*c)*v,e[5]=(-a*r+i*o)*v,e[6]=E*v,e[7]=(-h*r+n*c)*v,e[8]=(s*r-n*o)*v,e):null}function uf(e,t){var r=t[0],n=t[1],i=t[2],o=t[3],s=t[4],a=t[5],c=t[6],h=t[7],d=t[8];return e[0]=s*d-a*h,e[1]=i*h-n*d,e[2]=n*a-i*s,e[3]=a*c-o*d,e[4]=r*d-i*c,e[5]=i*o-r*a,e[6]=o*h-s*c,e[7]=n*c-r*h,e[8]=r*s-n*o,e}function mf(e){var t=e[0],r=e[1],n=e[2],i=e[3],o=e[4],s=e[5],a=e[6],c=e[7],h=e[8];return t*(h*o-s*c)+r*(-h*i+s*a)+n*(c*i-o*a)}function xa(e,t,r){var n=t[0],i=t[1],o=t[2],s=t[3],a=t[4],c=t[5],h=t[6],d=t[7],g=t[8],y=r[0],E=r[1],v=r[2],P=r[3],w=r[4],O=r[5],R=r[6],D=r[7],B=r[8];return e[0]=y*n+E*s+v*h,e[1]=y*i+E*a+v*d,e[2]=y*o+E*c+v*g,e[3]=P*n+w*s+O*h,e[4]=P*i+w*a+O*d,e[5]=P*o+w*c+O*g,e[6]=R*n+D*s+B*h,e[7]=R*i+D*a+B*d,e[8]=R*o+D*c+B*g,e}function hf(e,t,r){var n=t[0],i=t[1],o=t[2],s=t[3],a=t[4],c=t[5],h=t[6],d=t[7],g=t[8],y=r[0],E=r[1];return e[0]=n,e[1]=i,e[2]=o,e[3]=s,e[4]=a,e[5]=c,e[6]=y*n+E*s+h,e[7]=y*i+E*a+d,e[8]=y*o+E*c+g,e}function df(e,t,r){var n=t[0],i=t[1],o=t[2],s=t[3],a=t[4],c=t[5],h=t[6],d=t[7],g=t[8],y=Math.sin(r),E=Math.cos(r);return e[0]=E*n+y*s,e[1]=E*i+y*a,e[2]=E*o+y*c,e[3]=E*s-y*n,e[4]=E*a-y*i,e[5]=E*c-y*o,e[6]=h,e[7]=d,e[8]=g,e}function pf(e,t,r){var n=r[0],i=r[1];return e[0]=n*t[0],e[1]=n*t[1],e[2]=n*t[2],e[3]=i*t[3],e[4]=i*t[4],e[5]=i*t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e}function gf(e,t){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=1,e[5]=0,e[6]=t[0],e[7]=t[1],e[8]=1,e}function bf(e,t){var r=Math.sin(t),n=Math.cos(t);return e[0]=n,e[1]=r,e[2]=0,e[3]=-r,e[4]=n,e[5]=0,e[6]=0,e[7]=0,e[8]=1,e}function ff(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=0,e[4]=t[1],e[5]=0,e[6]=0,e[7]=0,e[8]=1,e}function yf(e,t){return e[0]=t[0],e[1]=t[1],e[2]=0,e[3]=t[2],e[4]=t[3],e[5]=0,e[6]=t[4],e[7]=t[5],e[8]=1,e}function Ef(e,t){var r=t[0],n=t[1],i=t[2],o=t[3],s=r+r,a=n+n,c=i+i,h=r*s,d=n*s,g=n*a,y=i*s,E=i*a,v=i*c,P=o*s,w=o*a,O=o*c;return e[0]=1-g-v,e[3]=d-O,e[6]=y+w,e[1]=d+O,e[4]=1-h-v,e[7]=E-P,e[2]=y-w,e[5]=E+P,e[8]=1-h-g,e}function vf(e,t){var r=t[0],n=t[1],i=t[2],o=t[3],s=t[4],a=t[5],c=t[6],h=t[7],d=t[8],g=t[9],y=t[10],E=t[11],v=t[12],P=t[13],w=t[14],O=t[15],R=r*a-n*s,D=r*c-i*s,B=r*h-o*s,V=n*c-i*a,F=n*h-o*a,Y=i*h-o*c,K=d*P-g*v,z=d*w-y*v,k=d*O-E*v,Q=g*w-y*P,Z=g*O-E*P,re=y*O-E*w,C=R*re-D*Z+B*Q+V*k-F*z+Y*K;return C?(C=1/C,e[0]=(a*re-c*Z+h*Q)*C,e[1]=(c*k-s*re-h*z)*C,e[2]=(s*Z-a*k+h*K)*C,e[3]=(i*Z-n*re-o*Q)*C,e[4]=(r*re-i*k+o*z)*C,e[5]=(n*k-r*Z-o*K)*C,e[6]=(P*Y-w*F+O*V)*C,e[7]=(w*B-v*Y-O*D)*C,e[8]=(v*F-P*B+O*R)*C,e):null}function _f(e,t,r){return e[0]=2/t,e[1]=0,e[2]=0,e[3]=0,e[4]=-2/r,e[5]=0,e[6]=-1,e[7]=1,e[8]=1,e}function wf(e){return"mat3("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+", "+e[6]+", "+e[7]+", "+e[8]+")"}function xf(e){return Math.hypot(e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8])}function Pf(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e[2]=t[2]+r[2],e[3]=t[3]+r[3],e[4]=t[4]+r[4],e[5]=t[5]+r[5],e[6]=t[6]+r[6],e[7]=t[7]+r[7],e[8]=t[8]+r[8],e}function Pa(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e[2]=t[2]-r[2],e[3]=t[3]-r[3],e[4]=t[4]-r[4],e[5]=t[5]-r[5],e[6]=t[6]-r[6],e[7]=t[7]-r[7],e[8]=t[8]-r[8],e}function Sf(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e[3]=t[3]*r,e[4]=t[4]*r,e[5]=t[5]*r,e[6]=t[6]*r,e[7]=t[7]*r,e[8]=t[8]*r,e}function Tf(e,t,r,n){return e[0]=t[0]+r[0]*n,e[1]=t[1]+r[1]*n,e[2]=t[2]+r[2]*n,e[3]=t[3]+r[3]*n,e[4]=t[4]+r[4]*n,e[5]=t[5]+r[5]*n,e[6]=t[6]+r[6]*n,e[7]=t[7]+r[7]*n,e[8]=t[8]+r[8]*n,e}function Mf(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&e[4]===t[4]&&e[5]===t[5]&&e[6]===t[6]&&e[7]===t[7]&&e[8]===t[8]}function Of(e,t){var r=e[0],n=e[1],i=e[2],o=e[3],s=e[4],a=e[5],c=e[6],h=e[7],d=e[8],g=t[0],y=t[1],E=t[2],v=t[3],P=t[4],w=t[5],O=t[6],R=t[7],D=t[8];return Math.abs(r-g)<=te*Math.max(1,Math.abs(r),Math.abs(g))&&Math.abs(n-y)<=te*Math.max(1,Math.abs(n),Math.abs(y))&&Math.abs(i-E)<=te*Math.max(1,Math.abs(i),Math.abs(E))&&Math.abs(o-v)<=te*Math.max(1,Math.abs(o),Math.abs(v))&&Math.abs(s-P)<=te*Math.max(1,Math.abs(s),Math.abs(P))&&Math.abs(a-w)<=te*Math.max(1,Math.abs(a),Math.abs(w))&&Math.abs(c-O)<=te*Math.max(1,Math.abs(c),Math.abs(O))&&Math.abs(h-R)<=te*Math.max(1,Math.abs(h),Math.abs(R))&&Math.abs(d-D)<=te*Math.max(1,Math.abs(d),Math.abs(D))}var Wf=xa,Af=Pa;var ne={};ur(ne,{add:()=>py,adjoint:()=>Lf,clone:()=>Rf,copy:()=>If,create:()=>Nf,determinant:()=>Bf,equals:()=>yy,exactEquals:()=>fy,frob:()=>dy,fromQuat:()=>ny,fromQuat2:()=>Qf,fromRotation:()=>zf,fromRotationTranslation:()=>Ma,fromRotationTranslationScale:()=>ry,fromRotationTranslationScaleOrigin:()=>ty,fromScaling:()=>Hf,fromTranslation:()=>$f,fromValues:()=>Ff,fromXRotation:()=>qf,fromYRotation:()=>Yf,fromZRotation:()=>Xf,frustum:()=>iy,getRotation:()=>ey,getScaling:()=>Oa,getTranslation:()=>Zf,identity:()=>Sa,invert:()=>Gf,lookAt:()=>uy,mul:()=>Ey,multiply:()=>Ta,multiplyScalar:()=>gy,multiplyScalarAndAdd:()=>by,ortho:()=>ly,orthoNO:()=>Aa,orthoZO:()=>cy,perspective:()=>oy,perspectiveFromFieldOfView:()=>ay,perspectiveNO:()=>Wa,perspectiveZO:()=>sy,rotate:()=>Kf,rotateX:()=>Uf,rotateY:()=>Jf,rotateZ:()=>jf,scale:()=>Cf,set:()=>Df,str:()=>hy,sub:()=>vy,subtract:()=>Na,targetTo:()=>my,translate:()=>Vf,transpose:()=>kf});function Nf(){var e=new he(16);return he!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0),e[0]=1,e[5]=1,e[10]=1,e[15]=1,e}function Rf(e){var t=new he(16);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function If(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e}function Ff(e,t,r,n,i,o,s,a,c,h,d,g,y,E,v,P){var w=new he(16);return w[0]=e,w[1]=t,w[2]=r,w[3]=n,w[4]=i,w[5]=o,w[6]=s,w[7]=a,w[8]=c,w[9]=h,w[10]=d,w[11]=g,w[12]=y,w[13]=E,w[14]=v,w[15]=P,w}function Df(e,t,r,n,i,o,s,a,c,h,d,g,y,E,v,P,w){return e[0]=t,e[1]=r,e[2]=n,e[3]=i,e[4]=o,e[5]=s,e[6]=a,e[7]=c,e[8]=h,e[9]=d,e[10]=g,e[11]=y,e[12]=E,e[13]=v,e[14]=P,e[15]=w,e}function Sa(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function kf(e,t){if(e===t){var r=t[1],n=t[2],i=t[3],o=t[6],s=t[7],a=t[11];e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=r,e[6]=t[9],e[7]=t[13],e[8]=n,e[9]=o,e[11]=t[14],e[12]=i,e[13]=s,e[14]=a}else e[0]=t[0],e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=t[1],e[5]=t[5],e[6]=t[9],e[7]=t[13],e[8]=t[2],e[9]=t[6],e[10]=t[10],e[11]=t[14],e[12]=t[3],e[13]=t[7],e[14]=t[11],e[15]=t[15];return e}function Gf(e,t){var r=t[0],n=t[1],i=t[2],o=t[3],s=t[4],a=t[5],c=t[6],h=t[7],d=t[8],g=t[9],y=t[10],E=t[11],v=t[12],P=t[13],w=t[14],O=t[15],R=r*a-n*s,D=r*c-i*s,B=r*h-o*s,V=n*c-i*a,F=n*h-o*a,Y=i*h-o*c,K=d*P-g*v,z=d*w-y*v,k=d*O-E*v,Q=g*w-y*P,Z=g*O-E*P,re=y*O-E*w,C=R*re-D*Z+B*Q+V*k-F*z+Y*K;return C?(C=1/C,e[0]=(a*re-c*Z+h*Q)*C,e[1]=(i*Z-n*re-o*Q)*C,e[2]=(P*Y-w*F+O*V)*C,e[3]=(y*F-g*Y-E*V)*C,e[4]=(c*k-s*re-h*z)*C,e[5]=(r*re-i*k+o*z)*C,e[6]=(w*B-v*Y-O*D)*C,e[7]=(d*Y-y*B+E*D)*C,e[8]=(s*Z-a*k+h*K)*C,e[9]=(n*k-r*Z-o*K)*C,e[10]=(v*F-P*B+O*R)*C,e[11]=(g*B-d*F-E*R)*C,e[12]=(a*z-s*Q-c*K)*C,e[13]=(r*Q-n*z+i*K)*C,e[14]=(P*D-v*V-w*R)*C,e[15]=(d*V-g*D+y*R)*C,e):null}function Lf(e,t){var r=t[0],n=t[1],i=t[2],o=t[3],s=t[4],a=t[5],c=t[6],h=t[7],d=t[8],g=t[9],y=t[10],E=t[11],v=t[12],P=t[13],w=t[14],O=t[15];return e[0]=a*(y*O-E*w)-g*(c*O-h*w)+P*(c*E-h*y),e[1]=-(n*(y*O-E*w)-g*(i*O-o*w)+P*(i*E-o*y)),e[2]=n*(c*O-h*w)-a*(i*O-o*w)+P*(i*h-o*c),e[3]=-(n*(c*E-h*y)-a*(i*E-o*y)+g*(i*h-o*c)),e[4]=-(s*(y*O-E*w)-d*(c*O-h*w)+v*(c*E-h*y)),e[5]=r*(y*O-E*w)-d*(i*O-o*w)+v*(i*E-o*y),e[6]=-(r*(c*O-h*w)-s*(i*O-o*w)+v*(i*h-o*c)),e[7]=r*(c*E-h*y)-s*(i*E-o*y)+d*(i*h-o*c),e[8]=s*(g*O-E*P)-d*(a*O-h*P)+v*(a*E-h*g),e[9]=-(r*(g*O-E*P)-d*(n*O-o*P)+v*(n*E-o*g)),e[10]=r*(a*O-h*P)-s*(n*O-o*P)+v*(n*h-o*a),e[11]=-(r*(a*E-h*g)-s*(n*E-o*g)+d*(n*h-o*a)),e[12]=-(s*(g*w-y*P)-d*(a*w-c*P)+v*(a*y-c*g)),e[13]=r*(g*w-y*P)-d*(n*w-i*P)+v*(n*y-i*g),e[14]=-(r*(a*w-c*P)-s*(n*w-i*P)+v*(n*c-i*a)),e[15]=r*(a*y-c*g)-s*(n*y-i*g)+d*(n*c-i*a),e}function Bf(e){var t=e[0],r=e[1],n=e[2],i=e[3],o=e[4],s=e[5],a=e[6],c=e[7],h=e[8],d=e[9],g=e[10],y=e[11],E=e[12],v=e[13],P=e[14],w=e[15],O=t*s-r*o,R=t*a-n*o,D=t*c-i*o,B=r*a-n*s,V=r*c-i*s,F=n*c-i*a,Y=h*v-d*E,K=h*P-g*E,z=h*w-y*E,k=d*P-g*v,Q=d*w-y*v,Z=g*w-y*P;return O*Z-R*Q+D*k+B*z-V*K+F*Y}function Ta(e,t,r){var n=t[0],i=t[1],o=t[2],s=t[3],a=t[4],c=t[5],h=t[6],d=t[7],g=t[8],y=t[9],E=t[10],v=t[11],P=t[12],w=t[13],O=t[14],R=t[15],D=r[0],B=r[1],V=r[2],F=r[3];return e[0]=D*n+B*a+V*g+F*P,e[1]=D*i+B*c+V*y+F*w,e[2]=D*o+B*h+V*E+F*O,e[3]=D*s+B*d+V*v+F*R,D=r[4],B=r[5],V=r[6],F=r[7],e[4]=D*n+B*a+V*g+F*P,e[5]=D*i+B*c+V*y+F*w,e[6]=D*o+B*h+V*E+F*O,e[7]=D*s+B*d+V*v+F*R,D=r[8],B=r[9],V=r[10],F=r[11],e[8]=D*n+B*a+V*g+F*P,e[9]=D*i+B*c+V*y+F*w,e[10]=D*o+B*h+V*E+F*O,e[11]=D*s+B*d+V*v+F*R,D=r[12],B=r[13],V=r[14],F=r[15],e[12]=D*n+B*a+V*g+F*P,e[13]=D*i+B*c+V*y+F*w,e[14]=D*o+B*h+V*E+F*O,e[15]=D*s+B*d+V*v+F*R,e}function Vf(e,t,r){var n=r[0],i=r[1],o=r[2],s,a,c,h,d,g,y,E,v,P,w,O;return t===e?(e[12]=t[0]*n+t[4]*i+t[8]*o+t[12],e[13]=t[1]*n+t[5]*i+t[9]*o+t[13],e[14]=t[2]*n+t[6]*i+t[10]*o+t[14],e[15]=t[3]*n+t[7]*i+t[11]*o+t[15]):(s=t[0],a=t[1],c=t[2],h=t[3],d=t[4],g=t[5],y=t[6],E=t[7],v=t[8],P=t[9],w=t[10],O=t[11],e[0]=s,e[1]=a,e[2]=c,e[3]=h,e[4]=d,e[5]=g,e[6]=y,e[7]=E,e[8]=v,e[9]=P,e[10]=w,e[11]=O,e[12]=s*n+d*i+v*o+t[12],e[13]=a*n+g*i+P*o+t[13],e[14]=c*n+y*i+w*o+t[14],e[15]=h*n+E*i+O*o+t[15]),e}function Cf(e,t,r){var n=r[0],i=r[1],o=r[2];return e[0]=t[0]*n,e[1]=t[1]*n,e[2]=t[2]*n,e[3]=t[3]*n,e[4]=t[4]*i,e[5]=t[5]*i,e[6]=t[6]*i,e[7]=t[7]*i,e[8]=t[8]*o,e[9]=t[9]*o,e[10]=t[10]*o,e[11]=t[11]*o,e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e}function Kf(e,t,r,n){var i=n[0],o=n[1],s=n[2],a=Math.hypot(i,o,s),c,h,d,g,y,E,v,P,w,O,R,D,B,V,F,Y,K,z,k,Q,Z,re,C,se;return a<te?null:(a=1/a,i*=a,o*=a,s*=a,c=Math.sin(r),h=Math.cos(r),d=1-h,g=t[0],y=t[1],E=t[2],v=t[3],P=t[4],w=t[5],O=t[6],R=t[7],D=t[8],B=t[9],V=t[10],F=t[11],Y=i*i*d+h,K=o*i*d+s*c,z=s*i*d-o*c,k=i*o*d-s*c,Q=o*o*d+h,Z=s*o*d+i*c,re=i*s*d+o*c,C=o*s*d-i*c,se=s*s*d+h,e[0]=g*Y+P*K+D*z,e[1]=y*Y+w*K+B*z,e[2]=E*Y+O*K+V*z,e[3]=v*Y+R*K+F*z,e[4]=g*k+P*Q+D*Z,e[5]=y*k+w*Q+B*Z,e[6]=E*k+O*Q+V*Z,e[7]=v*k+R*Q+F*Z,e[8]=g*re+P*C+D*se,e[9]=y*re+w*C+B*se,e[10]=E*re+O*C+V*se,e[11]=v*re+R*C+F*se,t!==e&&(e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e)}function Uf(e,t,r){var n=Math.sin(r),i=Math.cos(r),o=t[4],s=t[5],a=t[6],c=t[7],h=t[8],d=t[9],g=t[10],y=t[11];return t!==e&&(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[4]=o*i+h*n,e[5]=s*i+d*n,e[6]=a*i+g*n,e[7]=c*i+y*n,e[8]=h*i-o*n,e[9]=d*i-s*n,e[10]=g*i-a*n,e[11]=y*i-c*n,e}function Jf(e,t,r){var n=Math.sin(r),i=Math.cos(r),o=t[0],s=t[1],a=t[2],c=t[3],h=t[8],d=t[9],g=t[10],y=t[11];return t!==e&&(e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=o*i-h*n,e[1]=s*i-d*n,e[2]=a*i-g*n,e[3]=c*i-y*n,e[8]=o*n+h*i,e[9]=s*n+d*i,e[10]=a*n+g*i,e[11]=c*n+y*i,e}function jf(e,t,r){var n=Math.sin(r),i=Math.cos(r),o=t[0],s=t[1],a=t[2],c=t[3],h=t[4],d=t[5],g=t[6],y=t[7];return t!==e&&(e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=o*i+h*n,e[1]=s*i+d*n,e[2]=a*i+g*n,e[3]=c*i+y*n,e[4]=h*i-o*n,e[5]=d*i-s*n,e[6]=g*i-a*n,e[7]=y*i-c*n,e}function $f(e,t){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=t[0],e[13]=t[1],e[14]=t[2],e[15]=1,e}function Hf(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=t[1],e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=t[2],e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function zf(e,t,r){var n=r[0],i=r[1],o=r[2],s=Math.hypot(n,i,o),a,c,h;return s<te?null:(s=1/s,n*=s,i*=s,o*=s,a=Math.sin(t),c=Math.cos(t),h=1-c,e[0]=n*n*h+c,e[1]=i*n*h+o*a,e[2]=o*n*h-i*a,e[3]=0,e[4]=n*i*h-o*a,e[5]=i*i*h+c,e[6]=o*i*h+n*a,e[7]=0,e[8]=n*o*h+i*a,e[9]=i*o*h-n*a,e[10]=o*o*h+c,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e)}function qf(e,t){var r=Math.sin(t),n=Math.cos(t);return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=n,e[6]=r,e[7]=0,e[8]=0,e[9]=-r,e[10]=n,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function Yf(e,t){var r=Math.sin(t),n=Math.cos(t);return e[0]=n,e[1]=0,e[2]=-r,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=r,e[9]=0,e[10]=n,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function Xf(e,t){var r=Math.sin(t),n=Math.cos(t);return e[0]=n,e[1]=r,e[2]=0,e[3]=0,e[4]=-r,e[5]=n,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function Ma(e,t,r){var n=t[0],i=t[1],o=t[2],s=t[3],a=n+n,c=i+i,h=o+o,d=n*a,g=n*c,y=n*h,E=i*c,v=i*h,P=o*h,w=s*a,O=s*c,R=s*h;return e[0]=1-(E+P),e[1]=g+R,e[2]=y-O,e[3]=0,e[4]=g-R,e[5]=1-(d+P),e[6]=v+w,e[7]=0,e[8]=y+O,e[9]=v-w,e[10]=1-(d+E),e[11]=0,e[12]=r[0],e[13]=r[1],e[14]=r[2],e[15]=1,e}function Qf(e,t){var r=new he(3),n=-t[0],i=-t[1],o=-t[2],s=t[3],a=t[4],c=t[5],h=t[6],d=t[7],g=n*n+i*i+o*o+s*s;return g>0?(r[0]=(a*s+d*n+c*o-h*i)*2/g,r[1]=(c*s+d*i+h*n-a*o)*2/g,r[2]=(h*s+d*o+a*i-c*n)*2/g):(r[0]=(a*s+d*n+c*o-h*i)*2,r[1]=(c*s+d*i+h*n-a*o)*2,r[2]=(h*s+d*o+a*i-c*n)*2),Ma(e,t,r),e}function Zf(e,t){return e[0]=t[12],e[1]=t[13],e[2]=t[14],e}function Oa(e,t){var r=t[0],n=t[1],i=t[2],o=t[4],s=t[5],a=t[6],c=t[8],h=t[9],d=t[10];return e[0]=Math.hypot(r,n,i),e[1]=Math.hypot(o,s,a),e[2]=Math.hypot(c,h,d),e}function ey(e,t){var r=new he(3);Oa(r,t);var n=1/r[0],i=1/r[1],o=1/r[2],s=t[0]*n,a=t[1]*i,c=t[2]*o,h=t[4]*n,d=t[5]*i,g=t[6]*o,y=t[8]*n,E=t[9]*i,v=t[10]*o,P=s+d+v,w=0;return P>0?(w=Math.sqrt(P+1)*2,e[3]=.25*w,e[0]=(g-E)/w,e[1]=(y-c)/w,e[2]=(a-h)/w):s>d&&s>v?(w=Math.sqrt(1+s-d-v)*2,e[3]=(g-E)/w,e[0]=.25*w,e[1]=(a+h)/w,e[2]=(y+c)/w):d>v?(w=Math.sqrt(1+d-s-v)*2,e[3]=(y-c)/w,e[0]=(a+h)/w,e[1]=.25*w,e[2]=(g+E)/w):(w=Math.sqrt(1+v-s-d)*2,e[3]=(a-h)/w,e[0]=(y+c)/w,e[1]=(g+E)/w,e[2]=.25*w),e}function ry(e,t,r,n){var i=t[0],o=t[1],s=t[2],a=t[3],c=i+i,h=o+o,d=s+s,g=i*c,y=i*h,E=i*d,v=o*h,P=o*d,w=s*d,O=a*c,R=a*h,D=a*d,B=n[0],V=n[1],F=n[2];return e[0]=(1-(v+w))*B,e[1]=(y+D)*B,e[2]=(E-R)*B,e[3]=0,e[4]=(y-D)*V,e[5]=(1-(g+w))*V,e[6]=(P+O)*V,e[7]=0,e[8]=(E+R)*F,e[9]=(P-O)*F,e[10]=(1-(g+v))*F,e[11]=0,e[12]=r[0],e[13]=r[1],e[14]=r[2],e[15]=1,e}function ty(e,t,r,n,i){var o=t[0],s=t[1],a=t[2],c=t[3],h=o+o,d=s+s,g=a+a,y=o*h,E=o*d,v=o*g,P=s*d,w=s*g,O=a*g,R=c*h,D=c*d,B=c*g,V=n[0],F=n[1],Y=n[2],K=i[0],z=i[1],k=i[2],Q=(1-(P+O))*V,Z=(E+B)*V,re=(v-D)*V,C=(E-B)*F,se=(1-(y+O))*F,ye=(w+R)*F,L=(v+D)*Y,ae=(w-R)*Y,be=(1-(y+P))*Y;return e[0]=Q,e[1]=Z,e[2]=re,e[3]=0,e[4]=C,e[5]=se,e[6]=ye,e[7]=0,e[8]=L,e[9]=ae,e[10]=be,e[11]=0,e[12]=r[0]+K-(Q*K+C*z+L*k),e[13]=r[1]+z-(Z*K+se*z+ae*k),e[14]=r[2]+k-(re*K+ye*z+be*k),e[15]=1,e}function ny(e,t){var r=t[0],n=t[1],i=t[2],o=t[3],s=r+r,a=n+n,c=i+i,h=r*s,d=n*s,g=n*a,y=i*s,E=i*a,v=i*c,P=o*s,w=o*a,O=o*c;return e[0]=1-g-v,e[1]=d+O,e[2]=y-w,e[3]=0,e[4]=d-O,e[5]=1-h-v,e[6]=E+P,e[7]=0,e[8]=y+w,e[9]=E-P,e[10]=1-h-g,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function iy(e,t,r,n,i,o,s){var a=1/(r-t),c=1/(i-n),h=1/(o-s);return e[0]=o*2*a,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=o*2*c,e[6]=0,e[7]=0,e[8]=(r+t)*a,e[9]=(i+n)*c,e[10]=(s+o)*h,e[11]=-1,e[12]=0,e[13]=0,e[14]=s*o*2*h,e[15]=0,e}function Wa(e,t,r,n,i){var o=1/Math.tan(t/2),s;return e[0]=o/r,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=o,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=-1,e[12]=0,e[13]=0,e[15]=0,i!=null&&i!==1/0?(s=1/(n-i),e[10]=(i+n)*s,e[14]=2*i*n*s):(e[10]=-1,e[14]=-2*n),e}var oy=Wa;function sy(e,t,r,n,i){var o=1/Math.tan(t/2),s;return e[0]=o/r,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=o,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=-1,e[12]=0,e[13]=0,e[15]=0,i!=null&&i!==1/0?(s=1/(n-i),e[10]=i*s,e[14]=i*n*s):(e[10]=-1,e[14]=-n),e}function ay(e,t,r,n){var i=Math.tan(t.upDegrees*Math.PI/180),o=Math.tan(t.downDegrees*Math.PI/180),s=Math.tan(t.leftDegrees*Math.PI/180),a=Math.tan(t.rightDegrees*Math.PI/180),c=2/(s+a),h=2/(i+o);return e[0]=c,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=h,e[6]=0,e[7]=0,e[8]=-((s-a)*c*.5),e[9]=(i-o)*h*.5,e[10]=n/(r-n),e[11]=-1,e[12]=0,e[13]=0,e[14]=n*r/(r-n),e[15]=0,e}function Aa(e,t,r,n,i,o,s){var a=1/(t-r),c=1/(n-i),h=1/(o-s);return e[0]=-2*a,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=-2*c,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=2*h,e[11]=0,e[12]=(t+r)*a,e[13]=(i+n)*c,e[14]=(s+o)*h,e[15]=1,e}var ly=Aa;function cy(e,t,r,n,i,o,s){var a=1/(t-r),c=1/(n-i),h=1/(o-s);return e[0]=-2*a,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=-2*c,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=h,e[11]=0,e[12]=(t+r)*a,e[13]=(i+n)*c,e[14]=o*h,e[15]=1,e}function uy(e,t,r,n){var i,o,s,a,c,h,d,g,y,E,v=t[0],P=t[1],w=t[2],O=n[0],R=n[1],D=n[2],B=r[0],V=r[1],F=r[2];return Math.abs(v-B)<te&&Math.abs(P-V)<te&&Math.abs(w-F)<te?Sa(e):(d=v-B,g=P-V,y=w-F,E=1/Math.hypot(d,g,y),d*=E,g*=E,y*=E,i=R*y-D*g,o=D*d-O*y,s=O*g-R*d,E=Math.hypot(i,o,s),E?(E=1/E,i*=E,o*=E,s*=E):(i=0,o=0,s=0),a=g*s-y*o,c=y*i-d*s,h=d*o-g*i,E=Math.hypot(a,c,h),E?(E=1/E,a*=E,c*=E,h*=E):(a=0,c=0,h=0),e[0]=i,e[1]=a,e[2]=d,e[3]=0,e[4]=o,e[5]=c,e[6]=g,e[7]=0,e[8]=s,e[9]=h,e[10]=y,e[11]=0,e[12]=-(i*v+o*P+s*w),e[13]=-(a*v+c*P+h*w),e[14]=-(d*v+g*P+y*w),e[15]=1,e)}function my(e,t,r,n){var i=t[0],o=t[1],s=t[2],a=n[0],c=n[1],h=n[2],d=i-r[0],g=o-r[1],y=s-r[2],E=d*d+g*g+y*y;E>0&&(E=1/Math.sqrt(E),d*=E,g*=E,y*=E);var v=c*y-h*g,P=h*d-a*y,w=a*g-c*d;return E=v*v+P*P+w*w,E>0&&(E=1/Math.sqrt(E),v*=E,P*=E,w*=E),e[0]=v,e[1]=P,e[2]=w,e[3]=0,e[4]=g*w-y*P,e[5]=y*v-d*w,e[6]=d*P-g*v,e[7]=0,e[8]=d,e[9]=g,e[10]=y,e[11]=0,e[12]=i,e[13]=o,e[14]=s,e[15]=1,e}function hy(e){return"mat4("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+", "+e[6]+", "+e[7]+", "+e[8]+", "+e[9]+", "+e[10]+", "+e[11]+", "+e[12]+", "+e[13]+", "+e[14]+", "+e[15]+")"}function dy(e){return Math.hypot(e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8],e[9],e[10],e[11],e[12],e[13],e[14],e[15])}function py(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e[2]=t[2]+r[2],e[3]=t[3]+r[3],e[4]=t[4]+r[4],e[5]=t[5]+r[5],e[6]=t[6]+r[6],e[7]=t[7]+r[7],e[8]=t[8]+r[8],e[9]=t[9]+r[9],e[10]=t[10]+r[10],e[11]=t[11]+r[11],e[12]=t[12]+r[12],e[13]=t[13]+r[13],e[14]=t[14]+r[14],e[15]=t[15]+r[15],e}function Na(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e[2]=t[2]-r[2],e[3]=t[3]-r[3],e[4]=t[4]-r[4],e[5]=t[5]-r[5],e[6]=t[6]-r[6],e[7]=t[7]-r[7],e[8]=t[8]-r[8],e[9]=t[9]-r[9],e[10]=t[10]-r[10],e[11]=t[11]-r[11],e[12]=t[12]-r[12],e[13]=t[13]-r[13],e[14]=t[14]-r[14],e[15]=t[15]-r[15],e}function gy(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e[3]=t[3]*r,e[4]=t[4]*r,e[5]=t[5]*r,e[6]=t[6]*r,e[7]=t[7]*r,e[8]=t[8]*r,e[9]=t[9]*r,e[10]=t[10]*r,e[11]=t[11]*r,e[12]=t[12]*r,e[13]=t[13]*r,e[14]=t[14]*r,e[15]=t[15]*r,e}function by(e,t,r,n){return e[0]=t[0]+r[0]*n,e[1]=t[1]+r[1]*n,e[2]=t[2]+r[2]*n,e[3]=t[3]+r[3]*n,e[4]=t[4]+r[4]*n,e[5]=t[5]+r[5]*n,e[6]=t[6]+r[6]*n,e[7]=t[7]+r[7]*n,e[8]=t[8]+r[8]*n,e[9]=t[9]+r[9]*n,e[10]=t[10]+r[10]*n,e[11]=t[11]+r[11]*n,e[12]=t[12]+r[12]*n,e[13]=t[13]+r[13]*n,e[14]=t[14]+r[14]*n,e[15]=t[15]+r[15]*n,e}function fy(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&e[4]===t[4]&&e[5]===t[5]&&e[6]===t[6]&&e[7]===t[7]&&e[8]===t[8]&&e[9]===t[9]&&e[10]===t[10]&&e[11]===t[11]&&e[12]===t[12]&&e[13]===t[13]&&e[14]===t[14]&&e[15]===t[15]}function yy(e,t){var r=e[0],n=e[1],i=e[2],o=e[3],s=e[4],a=e[5],c=e[6],h=e[7],d=e[8],g=e[9],y=e[10],E=e[11],v=e[12],P=e[13],w=e[14],O=e[15],R=t[0],D=t[1],B=t[2],V=t[3],F=t[4],Y=t[5],K=t[6],z=t[7],k=t[8],Q=t[9],Z=t[10],re=t[11],C=t[12],se=t[13],ye=t[14],L=t[15];return Math.abs(r-R)<=te*Math.max(1,Math.abs(r),Math.abs(R))&&Math.abs(n-D)<=te*Math.max(1,Math.abs(n),Math.abs(D))&&Math.abs(i-B)<=te*Math.max(1,Math.abs(i),Math.abs(B))&&Math.abs(o-V)<=te*Math.max(1,Math.abs(o),Math.abs(V))&&Math.abs(s-F)<=te*Math.max(1,Math.abs(s),Math.abs(F))&&Math.abs(a-Y)<=te*Math.max(1,Math.abs(a),Math.abs(Y))&&Math.abs(c-K)<=te*Math.max(1,Math.abs(c),Math.abs(K))&&Math.abs(h-z)<=te*Math.max(1,Math.abs(h),Math.abs(z))&&Math.abs(d-k)<=te*Math.max(1,Math.abs(d),Math.abs(k))&&Math.abs(g-Q)<=te*Math.max(1,Math.abs(g),Math.abs(Q))&&Math.abs(y-Z)<=te*Math.max(1,Math.abs(y),Math.abs(Z))&&Math.abs(E-re)<=te*Math.max(1,Math.abs(E),Math.abs(re))&&Math.abs(v-C)<=te*Math.max(1,Math.abs(v),Math.abs(C))&&Math.abs(P-se)<=te*Math.max(1,Math.abs(P),Math.abs(se))&&Math.abs(w-ye)<=te*Math.max(1,Math.abs(w),Math.abs(ye))&&Math.abs(O-L)<=te*Math.max(1,Math.abs(O),Math.abs(L))}var Ey=Ta,vy=Na;var Re={};ur(Re,{add:()=>CE,calculateW:()=>AE,clone:()=>GE,conjugate:()=>FE,copy:()=>BE,create:()=>ji,dot:()=>Xa,equals:()=>HE,exactEquals:()=>$E,exp:()=>Ha,fromEuler:()=>DE,fromMat3:()=>qa,fromValues:()=>LE,getAngle:()=>TE,getAxisAngle:()=>SE,identity:()=>PE,invert:()=>IE,len:()=>JE,length:()=>Qa,lerp:()=>UE,ln:()=>za,mul:()=>KE,multiply:()=>$a,normalize:()=>$i,pow:()=>NE,random:()=>RE,rotateX:()=>ME,rotateY:()=>OE,rotateZ:()=>WE,rotationTo:()=>zE,scale:()=>Ya,set:()=>VE,setAxes:()=>YE,setAxisAngle:()=>ja,slerp:()=>pn,sqlerp:()=>qE,sqrLen:()=>jE,squaredLength:()=>Za,str:()=>kE});var le={};ur(le,{add:()=>Py,angle:()=>Jy,bezier:()=>ky,ceil:()=>Sy,clone:()=>_y,copy:()=>wy,create:()=>cn,cross:()=>Cr,dist:()=>Qy,distance:()=>ka,div:()=>Xy,divide:()=>Da,dot:()=>mn,equals:()=>zy,exactEquals:()=>Hy,floor:()=>Ty,forEach:()=>rE,fromValues:()=>un,hermite:()=>Dy,inverse:()=>Iy,len:()=>Ii,length:()=>Ra,lerp:()=>Fy,max:()=>Oy,min:()=>My,mul:()=>Yy,multiply:()=>Fa,negate:()=>Ry,normalize:()=>Ri,random:()=>Gy,rotateX:()=>Cy,rotateY:()=>Ky,rotateZ:()=>Uy,round:()=>Wy,scale:()=>Ay,scaleAndAdd:()=>Ny,set:()=>xy,sqrDist:()=>Zy,sqrLen:()=>eE,squaredDistance:()=>Ga,squaredLength:()=>La,str:()=>$y,sub:()=>qy,subtract:()=>Ia,transformMat3:()=>By,transformMat4:()=>Ly,transformQuat:()=>Vy,zero:()=>jy});function cn(){var e=new he(3);return he!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0),e}function _y(e){var t=new he(3);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t}function Ra(e){var t=e[0],r=e[1],n=e[2];return Math.hypot(t,r,n)}function un(e,t,r){var n=new he(3);return n[0]=e,n[1]=t,n[2]=r,n}function wy(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e}function xy(e,t,r,n){return e[0]=t,e[1]=r,e[2]=n,e}function Py(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e[2]=t[2]+r[2],e}function Ia(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e[2]=t[2]-r[2],e}function Fa(e,t,r){return e[0]=t[0]*r[0],e[1]=t[1]*r[1],e[2]=t[2]*r[2],e}function Da(e,t,r){return e[0]=t[0]/r[0],e[1]=t[1]/r[1],e[2]=t[2]/r[2],e}function Sy(e,t){return e[0]=Math.ceil(t[0]),e[1]=Math.ceil(t[1]),e[2]=Math.ceil(t[2]),e}function Ty(e,t){return e[0]=Math.floor(t[0]),e[1]=Math.floor(t[1]),e[2]=Math.floor(t[2]),e}function My(e,t,r){return e[0]=Math.min(t[0],r[0]),e[1]=Math.min(t[1],r[1]),e[2]=Math.min(t[2],r[2]),e}function Oy(e,t,r){return e[0]=Math.max(t[0],r[0]),e[1]=Math.max(t[1],r[1]),e[2]=Math.max(t[2],r[2]),e}function Wy(e,t){return e[0]=Math.round(t[0]),e[1]=Math.round(t[1]),e[2]=Math.round(t[2]),e}function Ay(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e}function Ny(e,t,r,n){return e[0]=t[0]+r[0]*n,e[1]=t[1]+r[1]*n,e[2]=t[2]+r[2]*n,e}function ka(e,t){var r=t[0]-e[0],n=t[1]-e[1],i=t[2]-e[2];return Math.hypot(r,n,i)}function Ga(e,t){var r=t[0]-e[0],n=t[1]-e[1],i=t[2]-e[2];return r*r+n*n+i*i}function La(e){var t=e[0],r=e[1],n=e[2];return t*t+r*r+n*n}function Ry(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e}function Iy(e,t){return e[0]=1/t[0],e[1]=1/t[1],e[2]=1/t[2],e}function Ri(e,t){var r=t[0],n=t[1],i=t[2],o=r*r+n*n+i*i;return o>0&&(o=1/Math.sqrt(o)),e[0]=t[0]*o,e[1]=t[1]*o,e[2]=t[2]*o,e}function mn(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]}function Cr(e,t,r){var n=t[0],i=t[1],o=t[2],s=r[0],a=r[1],c=r[2];return e[0]=i*c-o*a,e[1]=o*s-n*c,e[2]=n*a-i*s,e}function Fy(e,t,r,n){var i=t[0],o=t[1],s=t[2];return e[0]=i+n*(r[0]-i),e[1]=o+n*(r[1]-o),e[2]=s+n*(r[2]-s),e}function Dy(e,t,r,n,i,o){var s=o*o,a=s*(2*o-3)+1,c=s*(o-2)+o,h=s*(o-1),d=s*(3-2*o);return e[0]=t[0]*a+r[0]*c+n[0]*h+i[0]*d,e[1]=t[1]*a+r[1]*c+n[1]*h+i[1]*d,e[2]=t[2]*a+r[2]*c+n[2]*h+i[2]*d,e}function ky(e,t,r,n,i,o){var s=1-o,a=s*s,c=o*o,h=a*s,d=3*o*a,g=3*c*s,y=c*o;return e[0]=t[0]*h+r[0]*d+n[0]*g+i[0]*y,e[1]=t[1]*h+r[1]*d+n[1]*g+i[1]*y,e[2]=t[2]*h+r[2]*d+n[2]*g+i[2]*y,e}function Gy(e,t){t=t||1;var r=ke()*2*Math.PI,n=ke()*2-1,i=Math.sqrt(1-n*n)*t;return e[0]=Math.cos(r)*i,e[1]=Math.sin(r)*i,e[2]=n*t,e}function Ly(e,t,r){var n=t[0],i=t[1],o=t[2],s=r[3]*n+r[7]*i+r[11]*o+r[15];return s=s||1,e[0]=(r[0]*n+r[4]*i+r[8]*o+r[12])/s,e[1]=(r[1]*n+r[5]*i+r[9]*o+r[13])/s,e[2]=(r[2]*n+r[6]*i+r[10]*o+r[14])/s,e}function By(e,t,r){var n=t[0],i=t[1],o=t[2];return e[0]=n*r[0]+i*r[3]+o*r[6],e[1]=n*r[1]+i*r[4]+o*r[7],e[2]=n*r[2]+i*r[5]+o*r[8],e}function Vy(e,t,r){var n=r[0],i=r[1],o=r[2],s=r[3],a=t[0],c=t[1],h=t[2],d=i*h-o*c,g=o*a-n*h,y=n*c-i*a,E=i*y-o*g,v=o*d-n*y,P=n*g-i*d,w=s*2;return d*=w,g*=w,y*=w,E*=2,v*=2,P*=2,e[0]=a+d+E,e[1]=c+g+v,e[2]=h+y+P,e}function Cy(e,t,r,n){var i=[],o=[];return i[0]=t[0]-r[0],i[1]=t[1]-r[1],i[2]=t[2]-r[2],o[0]=i[0],o[1]=i[1]*Math.cos(n)-i[2]*Math.sin(n),o[2]=i[1]*Math.sin(n)+i[2]*Math.cos(n),e[0]=o[0]+r[0],e[1]=o[1]+r[1],e[2]=o[2]+r[2],e}function Ky(e,t,r,n){var i=[],o=[];return i[0]=t[0]-r[0],i[1]=t[1]-r[1],i[2]=t[2]-r[2],o[0]=i[2]*Math.sin(n)+i[0]*Math.cos(n),o[1]=i[1],o[2]=i[2]*Math.cos(n)-i[0]*Math.sin(n),e[0]=o[0]+r[0],e[1]=o[1]+r[1],e[2]=o[2]+r[2],e}function Uy(e,t,r,n){var i=[],o=[];return i[0]=t[0]-r[0],i[1]=t[1]-r[1],i[2]=t[2]-r[2],o[0]=i[0]*Math.cos(n)-i[1]*Math.sin(n),o[1]=i[0]*Math.sin(n)+i[1]*Math.cos(n),o[2]=i[2],e[0]=o[0]+r[0],e[1]=o[1]+r[1],e[2]=o[2]+r[2],e}function Jy(e,t){var r=e[0],n=e[1],i=e[2],o=t[0],s=t[1],a=t[2],c=Math.sqrt(r*r+n*n+i*i),h=Math.sqrt(o*o+s*s+a*a),d=c*h,g=d&&mn(e,t)/d;return Math.acos(Math.min(Math.max(g,-1),1))}function jy(e){return e[0]=0,e[1]=0,e[2]=0,e}function $y(e){return"vec3("+e[0]+", "+e[1]+", "+e[2]+")"}function Hy(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]}function zy(e,t){var r=e[0],n=e[1],i=e[2],o=t[0],s=t[1],a=t[2];return Math.abs(r-o)<=te*Math.max(1,Math.abs(r),Math.abs(o))&&Math.abs(n-s)<=te*Math.max(1,Math.abs(n),Math.abs(s))&&Math.abs(i-a)<=te*Math.max(1,Math.abs(i),Math.abs(a))}var qy=Ia,Yy=Fa,Xy=Da,Qy=ka,Zy=Ga,Ii=Ra,eE=La,rE=function(){var e=cn();return function(t,r,n,i,o,s){var a,c;for(r||(r=3),n||(n=0),i?c=Math.min(i*r+n,t.length):c=t.length,a=n;a<c;a+=r)e[0]=t[a],e[1]=t[a+1],e[2]=t[a+2],o(e,e,s),t[a]=e[0],t[a+1]=e[1],t[a+2]=e[2];return t}}();var ir={};ur(ir,{add:()=>Li,ceil:()=>tE,clone:()=>Fi,copy:()=>ki,create:()=>Ba,cross:()=>uE,dist:()=>EE,distance:()=>Ua,div:()=>yE,divide:()=>Ka,dot:()=>Ci,equals:()=>Ji,exactEquals:()=>Ui,floor:()=>nE,forEach:()=>xE,fromValues:()=>Di,inverse:()=>cE,len:()=>_E,length:()=>hn,lerp:()=>Ki,max:()=>oE,min:()=>iE,mul:()=>fE,multiply:()=>Ca,negate:()=>lE,normalize:()=>Vi,random:()=>mE,round:()=>sE,scale:()=>Bi,scaleAndAdd:()=>aE,set:()=>Gi,sqrDist:()=>vE,sqrLen:()=>wE,squaredDistance:()=>Ja,squaredLength:()=>dn,str:()=>gE,sub:()=>bE,subtract:()=>Va,transformMat4:()=>hE,transformQuat:()=>dE,zero:()=>pE});function Ba(){var e=new he(4);return he!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0,e[3]=0),e}function Fi(e){var t=new he(4);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t}function Di(e,t,r,n){var i=new he(4);return i[0]=e,i[1]=t,i[2]=r,i[3]=n,i}function ki(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e}function Gi(e,t,r,n,i){return e[0]=t,e[1]=r,e[2]=n,e[3]=i,e}function Li(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e[2]=t[2]+r[2],e[3]=t[3]+r[3],e}function Va(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e[2]=t[2]-r[2],e[3]=t[3]-r[3],e}function Ca(e,t,r){return e[0]=t[0]*r[0],e[1]=t[1]*r[1],e[2]=t[2]*r[2],e[3]=t[3]*r[3],e}function Ka(e,t,r){return e[0]=t[0]/r[0],e[1]=t[1]/r[1],e[2]=t[2]/r[2],e[3]=t[3]/r[3],e}function tE(e,t){return e[0]=Math.ceil(t[0]),e[1]=Math.ceil(t[1]),e[2]=Math.ceil(t[2]),e[3]=Math.ceil(t[3]),e}function nE(e,t){return e[0]=Math.floor(t[0]),e[1]=Math.floor(t[1]),e[2]=Math.floor(t[2]),e[3]=Math.floor(t[3]),e}function iE(e,t,r){return e[0]=Math.min(t[0],r[0]),e[1]=Math.min(t[1],r[1]),e[2]=Math.min(t[2],r[2]),e[3]=Math.min(t[3],r[3]),e}function oE(e,t,r){return e[0]=Math.max(t[0],r[0]),e[1]=Math.max(t[1],r[1]),e[2]=Math.max(t[2],r[2]),e[3]=Math.max(t[3],r[3]),e}function sE(e,t){return e[0]=Math.round(t[0]),e[1]=Math.round(t[1]),e[2]=Math.round(t[2]),e[3]=Math.round(t[3]),e}function Bi(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e[3]=t[3]*r,e}function aE(e,t,r,n){return e[0]=t[0]+r[0]*n,e[1]=t[1]+r[1]*n,e[2]=t[2]+r[2]*n,e[3]=t[3]+r[3]*n,e}function Ua(e,t){var r=t[0]-e[0],n=t[1]-e[1],i=t[2]-e[2],o=t[3]-e[3];return Math.hypot(r,n,i,o)}function Ja(e,t){var r=t[0]-e[0],n=t[1]-e[1],i=t[2]-e[2],o=t[3]-e[3];return r*r+n*n+i*i+o*o}function hn(e){var t=e[0],r=e[1],n=e[2],i=e[3];return Math.hypot(t,r,n,i)}function dn(e){var t=e[0],r=e[1],n=e[2],i=e[3];return t*t+r*r+n*n+i*i}function lE(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e[3]=-t[3],e}function cE(e,t){return e[0]=1/t[0],e[1]=1/t[1],e[2]=1/t[2],e[3]=1/t[3],e}function Vi(e,t){var r=t[0],n=t[1],i=t[2],o=t[3],s=r*r+n*n+i*i+o*o;return s>0&&(s=1/Math.sqrt(s)),e[0]=r*s,e[1]=n*s,e[2]=i*s,e[3]=o*s,e}function Ci(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]+e[3]*t[3]}function uE(e,t,r,n){var i=r[0]*n[1]-r[1]*n[0],o=r[0]*n[2]-r[2]*n[0],s=r[0]*n[3]-r[3]*n[0],a=r[1]*n[2]-r[2]*n[1],c=r[1]*n[3]-r[3]*n[1],h=r[2]*n[3]-r[3]*n[2],d=t[0],g=t[1],y=t[2],E=t[3];return e[0]=g*h-y*c+E*a,e[1]=-(d*h)+y*s-E*o,e[2]=d*c-g*s+E*i,e[3]=-(d*a)+g*o-y*i,e}function Ki(e,t,r,n){var i=t[0],o=t[1],s=t[2],a=t[3];return e[0]=i+n*(r[0]-i),e[1]=o+n*(r[1]-o),e[2]=s+n*(r[2]-s),e[3]=a+n*(r[3]-a),e}function mE(e,t){t=t||1;var r,n,i,o,s,a;do r=ke()*2-1,n=ke()*2-1,s=r*r+n*n;while(s>=1);do i=ke()*2-1,o=ke()*2-1,a=i*i+o*o;while(a>=1);var c=Math.sqrt((1-s)/a);return e[0]=t*r,e[1]=t*n,e[2]=t*i*c,e[3]=t*o*c,e}function hE(e,t,r){var n=t[0],i=t[1],o=t[2],s=t[3];return e[0]=r[0]*n+r[4]*i+r[8]*o+r[12]*s,e[1]=r[1]*n+r[5]*i+r[9]*o+r[13]*s,e[2]=r[2]*n+r[6]*i+r[10]*o+r[14]*s,e[3]=r[3]*n+r[7]*i+r[11]*o+r[15]*s,e}function dE(e,t,r){var n=t[0],i=t[1],o=t[2],s=r[0],a=r[1],c=r[2],h=r[3],d=h*n+a*o-c*i,g=h*i+c*n-s*o,y=h*o+s*i-a*n,E=-s*n-a*i-c*o;return e[0]=d*h+E*-s+g*-c-y*-a,e[1]=g*h+E*-a+y*-s-d*-c,e[2]=y*h+E*-c+d*-a-g*-s,e[3]=t[3],e}function pE(e){return e[0]=0,e[1]=0,e[2]=0,e[3]=0,e}function gE(e){return"vec4("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+")"}function Ui(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]}function Ji(e,t){var r=e[0],n=e[1],i=e[2],o=e[3],s=t[0],a=t[1],c=t[2],h=t[3];return Math.abs(r-s)<=te*Math.max(1,Math.abs(r),Math.abs(s))&&Math.abs(n-a)<=te*Math.max(1,Math.abs(n),Math.abs(a))&&Math.abs(i-c)<=te*Math.max(1,Math.abs(i),Math.abs(c))&&Math.abs(o-h)<=te*Math.max(1,Math.abs(o),Math.abs(h))}var bE=Va,fE=Ca,yE=Ka,EE=Ua,vE=Ja,_E=hn,wE=dn,xE=function(){var e=Ba();return function(t,r,n,i,o,s){var a,c;for(r||(r=4),n||(n=0),i?c=Math.min(i*r+n,t.length):c=t.length,a=n;a<c;a+=r)e[0]=t[a],e[1]=t[a+1],e[2]=t[a+2],e[3]=t[a+3],o(e,e,s),t[a]=e[0],t[a+1]=e[1],t[a+2]=e[2],t[a+3]=e[3];return t}}();function ji(){var e=new he(4);return he!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0),e[3]=1,e}function PE(e){return e[0]=0,e[1]=0,e[2]=0,e[3]=1,e}function ja(e,t,r){r=r*.5;var n=Math.sin(r);return e[0]=n*t[0],e[1]=n*t[1],e[2]=n*t[2],e[3]=Math.cos(r),e}function SE(e,t){var r=Math.acos(t[3])*2,n=Math.sin(r/2);return n>te?(e[0]=t[0]/n,e[1]=t[1]/n,e[2]=t[2]/n):(e[0]=1,e[1]=0,e[2]=0),r}function TE(e,t){var r=Xa(e,t);return Math.acos(2*r*r-1)}function $a(e,t,r){var n=t[0],i=t[1],o=t[2],s=t[3],a=r[0],c=r[1],h=r[2],d=r[3];return e[0]=n*d+s*a+i*h-o*c,e[1]=i*d+s*c+o*a-n*h,e[2]=o*d+s*h+n*c-i*a,e[3]=s*d-n*a-i*c-o*h,e}function ME(e,t,r){r*=.5;var n=t[0],i=t[1],o=t[2],s=t[3],a=Math.sin(r),c=Math.cos(r);return e[0]=n*c+s*a,e[1]=i*c+o*a,e[2]=o*c-i*a,e[3]=s*c-n*a,e}function OE(e,t,r){r*=.5;var n=t[0],i=t[1],o=t[2],s=t[3],a=Math.sin(r),c=Math.cos(r);return e[0]=n*c-o*a,e[1]=i*c+s*a,e[2]=o*c+n*a,e[3]=s*c-i*a,e}function WE(e,t,r){r*=.5;var n=t[0],i=t[1],o=t[2],s=t[3],a=Math.sin(r),c=Math.cos(r);return e[0]=n*c+i*a,e[1]=i*c-n*a,e[2]=o*c+s*a,e[3]=s*c-o*a,e}function AE(e,t){var r=t[0],n=t[1],i=t[2];return e[0]=r,e[1]=n,e[2]=i,e[3]=Math.sqrt(Math.abs(1-r*r-n*n-i*i)),e}function Ha(e,t){var r=t[0],n=t[1],i=t[2],o=t[3],s=Math.sqrt(r*r+n*n+i*i),a=Math.exp(o),c=s>0?a*Math.sin(s)/s:0;return e[0]=r*c,e[1]=n*c,e[2]=i*c,e[3]=a*Math.cos(s),e}function za(e,t){var r=t[0],n=t[1],i=t[2],o=t[3],s=Math.sqrt(r*r+n*n+i*i),a=s>0?Math.atan2(s,o)/s:0;return e[0]=r*a,e[1]=n*a,e[2]=i*a,e[3]=.5*Math.log(r*r+n*n+i*i+o*o),e}function NE(e,t,r){return za(e,t),Ya(e,e,r),Ha(e,e),e}function pn(e,t,r,n){var i=t[0],o=t[1],s=t[2],a=t[3],c=r[0],h=r[1],d=r[2],g=r[3],y,E,v,P,w;return E=i*c+o*h+s*d+a*g,E<0&&(E=-E,c=-c,h=-h,d=-d,g=-g),1-E>te?(y=Math.acos(E),v=Math.sin(y),P=Math.sin((1-n)*y)/v,w=Math.sin(n*y)/v):(P=1-n,w=n),e[0]=P*i+w*c,e[1]=P*o+w*h,e[2]=P*s+w*d,e[3]=P*a+w*g,e}function RE(e){var t=ke(),r=ke(),n=ke(),i=Math.sqrt(1-t),o=Math.sqrt(t);return e[0]=i*Math.sin(2*Math.PI*r),e[1]=i*Math.cos(2*Math.PI*r),e[2]=o*Math.sin(2*Math.PI*n),e[3]=o*Math.cos(2*Math.PI*n),e}function IE(e,t){var r=t[0],n=t[1],i=t[2],o=t[3],s=r*r+n*n+i*i+o*o,a=s?1/s:0;return e[0]=-r*a,e[1]=-n*a,e[2]=-i*a,e[3]=o*a,e}function FE(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e[3]=t[3],e}function qa(e,t){var r=t[0]+t[4]+t[8],n;if(r>0)n=Math.sqrt(r+1),e[3]=.5*n,n=.5/n,e[0]=(t[5]-t[7])*n,e[1]=(t[6]-t[2])*n,e[2]=(t[1]-t[3])*n;else{var i=0;t[4]>t[0]&&(i=1),t[8]>t[i*3+i]&&(i=2);var o=(i+1)%3,s=(i+2)%3;n=Math.sqrt(t[i*3+i]-t[o*3+o]-t[s*3+s]+1),e[i]=.5*n,n=.5/n,e[3]=(t[o*3+s]-t[s*3+o])*n,e[o]=(t[o*3+i]+t[i*3+o])*n,e[s]=(t[s*3+i]+t[i*3+s])*n}return e}function DE(e,t,r,n){var i=.5*Math.PI/180;t*=i,r*=i,n*=i;var o=Math.sin(t),s=Math.cos(t),a=Math.sin(r),c=Math.cos(r),h=Math.sin(n),d=Math.cos(n);return e[0]=o*c*d-s*a*h,e[1]=s*a*d+o*c*h,e[2]=s*c*h-o*a*d,e[3]=s*c*d+o*a*h,e}function kE(e){return"quat("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+")"}var GE=Fi,LE=Di,BE=ki,VE=Gi,CE=Li,KE=$a,Ya=Bi,Xa=Ci,UE=Ki,Qa=hn,JE=Qa,Za=dn,jE=Za,$i=Vi,$E=Ui,HE=Ji,zE=function(){var e=cn(),t=un(1,0,0),r=un(0,1,0);return function(n,i,o){var s=mn(i,o);return s<-.999999?(Cr(e,t,i),Ii(e)<1e-6&&Cr(e,r,i),Ri(e,e),ja(n,e,Math.PI),n):s>.999999?(n[0]=0,n[1]=0,n[2]=0,n[3]=1,n):(Cr(e,i,o),n[0]=e[0],n[1]=e[1],n[2]=e[2],n[3]=1+s,$i(n,n))}}(),qE=function(){var e=ji(),t=ji();return function(r,n,i,o,s,a){return pn(e,n,s,a),pn(t,i,o,a),pn(r,e,t,2*a*(1-a)),r}}(),YE=function(){var e=Ni();return function(t,r,n,i){return e[0]=n[0],e[3]=n[1],e[6]=n[2],e[1]=i[0],e[4]=i[1],e[7]=i[2],e[2]=-r[0],e[5]=-r[1],e[8]=-r[2],$i(t,qa(t,e))}}();var Ge=ne.create(),gn=nr.create(),OR=Re.create(),el=le.create(),WR=le.fromValues(1,1,1);function Hi(e,t){let r=t[12]-e[12],n=t[13]-e[13],i=t[14]-e[14];return r*r+n*n+i*i}var fe={programSwitch:0,textureSwitch:0,materialSwitch:0,faceSwitch:0,vaoSwitch:0,drawsTransp:0,drawsTotal:0,clear:()=>{Object.assign(fe,{programSwitch:0,textureSwitch:0,materialSwitch:0,faceSwitch:0,vaoSwitch:0,drawsTransp:0,drawsTotal:0})}};Object.defineProperty(window,"s",{get(){return fe}});var or=class{constructor(t){this.objectsGenerator=t;this.list=new WeakMap;this.cur=null}get(t){let{cur:r}=this;if(r&&r.ctx===t)return r;let n=this.list.get(t);if(n)return this.cur=n;let i=this.objectsGenerator(t);return this.list.set(t,this.cur=i),i}};function pr(e,t,r){let n=e.createShader(t);if(e.shaderSource(n,r),e.compileShader(n),!e.getShaderParameter(n,e.COMPILE_STATUS)){console.log(r.split(`
`).map((s,a)=>`${a+1}: ${s}`).join(`
`));let o=e.getShaderInfoLog(n);throw Error(`\u041E\u0448\u0438\u0431\u043A\u0430 \u043A\u043E\u043C\u043F\u0438\u043B\u044F\u0446\u0438\u0438 \u0448\u0435\u0439\u0434\u0435\u0440\u0430 (${t===e.VERTEX_SHADER?"vertex":"fragment"}): ${o}`)}return n}var rl=2;var Mr=1,tl=2;var nl=0,bn=1;var Or=0,sr=1,gr=2,il=0,ol=1,sl=2;var ar=0,br=1,Ye=2,Kr=-1,Ce=[{uv:!1,lighting:null,index:++Kr},{uv:!1,lighting:Mr,index:++Kr},{uv:!0,lighting:null,index:++Kr},{uv:!0,lighting:Mr,index:++Kr}],Wr={uv:!0,lighting:null,index:++Kr};var al=Ce.map(e=>{let t=[];return e.uv&&t.push("UV"),e.lighting&&t.push(e.lighting===tl?"PHONG":"GOURAUD"),t.map(r=>`#define ${r}
`).join("")}),XE=`
    attribute vec4 pos;
    uniform mat4 mat;

    #ifdef UV
        attribute vec2 uv;
        varying vec2 tCoord;
    #endif

    #if defined GOURAUD || defined PHONG
        attribute vec3 normal;
        uniform vec3 globalAmbient;
        uniform vec3 lightPosition;
        uniform mat4 worldMat;
        uniform mat3 worldNormalMat;
        uniform vec3 passAmbient;
        uniform vec4 passDiffuse;
            #ifdef GOURAUD
                varying vec4 passBase;
            #else
                // varying vec3 avgNormal;
                // varying vec3 avgLightDirection;
            #endif
    #endif

    void main() {
        gl_Position = mat * pos;

        #ifdef UV
            tCoord = uv;
        #endif

        #if defined GOURAUD || defined PHONG
            vec3 vertexPosition = (worldMat * pos).xyz;
            
            #ifdef GOURAUD
                vec3 lightDiffuseConst = vec3(1, 1, 1);
                float lightPowerScale = 1.;
                vec3 surfaceNormal = normalize(worldNormalMat * normal);
                vec3 lightDir = normalize(lightPosition - vertexPosition);

                vec3 lightDiffuse = lightDiffuseConst * lightPowerScale * max(0., dot(surfaceNormal, lightDir));

                vec3 passEmissive = vec3(0, 0, 0);
                
                vec3 passBaseColor = globalAmbient * passAmbient + (passDiffuse.xyz * lightDiffuse) + passEmissive;
                passBase = vec4(passBaseColor, passDiffuse.a);
            #else
                // avgNormal = worldNormalMat * normal;
                // avgLightDirection = lightPosition - vertexPosition;
            #endif
        #endif
    }
`,QE=`
    precision mediump float;

    #ifdef UV
        uniform sampler2D tex;
        varying vec2 tCoord;
    #endif

    #ifdef GOURAUD
        varying vec4 passBase;
    #endif

    #ifdef PHONG
        varying vec3 avgNormal;
        varying vec3 avgLightDirection;
    #endif

    void main() {
        #if !defined GOURAUD && !defined PHONG
            vec4 passBase = vec4(1, 1, 1, 1);
        #endif

        #ifdef UV
            gl_FragColor = texture2D(tex, tCoord) * passBase;
        #else
            gl_FragColor = passBase;
        #endif
    }
`,ll=al.map(e=>e+XE),cl=al.map(e=>e+QE),ul=`
    precision mediump float;

    varying vec2 tCoord;

    uniform sampler2D tex;
    uniform vec4 passDiffuse;

    void main() {
        gl_FragColor = vec4(passDiffuse.rgb, texture2D(tex, tCoord).a * passDiffuse.a);
    }
`,Ur=class{constructor(t,r,n,i){this.ctx=t;this.id=i;this.supportsNormals=!1;this.uDiffuse=null;this.uAmbient=null;this.uGlobalAmbient=null;this.uLightPosition=null;this.uWorldMat=null;this.uWorldNormalMat=null;let o=this.gl=t.gl,s=this.shaderProgram=o.createProgram();if(o.attachShader(s,r),o.attachShader(s,n),o.bindAttribLocation(s,ar,"pos"),o.bindAttribLocation(s,br,"normal"),o.bindAttribLocation(s,Ye,"uv"),o.linkProgram(s),!o.getProgramParameter(s,o.LINK_STATUS)){let c=o.getProgramInfoLog(s);throw Error(`\u041E\u0448\u0438\u0431\u043A\u0430 Link Program: ${c}`)}let a=c=>{let h=o.getUniformLocation(s,c);if(!h)throw Error(`\u041F\u0440\u043E\u0433\u0440\u0430\u043C\u043C\u0430 \u043D\u0435 \u0441\u043E\u0434\u0435\u0440\u0436\u0438\u0442 Uniform '${c}'`);return h};this.uMat=a("mat"),this.supportsUV=i.uv,(i.lighting||i===Wr)&&(this.uDiffuse=a("passDiffuse")),i.lighting&&(this.supportsNormals=!0,this.uAmbient=a("passAmbient"),this.uGlobalAmbient=a("globalAmbient"),this.uLightPosition=a("lightPosition"),this.uWorldMat=a("worldMat"),this.uWorldNormalMat=a("worldNormalMat"))}use(){let{ctx:t}=this;t.currentProgram!==this&&(t.currentProgram=this,++fe.programSwitch,this.gl.useProgram(this.shaderProgram),this.applyGlobals())}applyGlobals(){if(!this.supportsNormals)return;let{uLightPosition:t,uGlobalAmbient:r,ctx:n}=this,{gl:i}=n;i.uniform3fv(t,n.lightPos),i.uniform3fv(r,n.ambientLight)}setMatrix(t){let{gl:r,uMat:n}=this;r.uniformMatrix4fv(n,!1,t)}setWorldMatrix(t,r){let{gl:n,uWorldMat:i,uWorldNormalMat:o}=this;n.uniformMatrix4fv(i,!1,t),n.uniformMatrix3fv(o,!1,r)}setDiffuse(t){let{gl:r,uDiffuse:n}=this;r.uniform4fv(n,t)}setAmbient(t){let{gl:r,uAmbient:n}=this;r.uniform3fv(n,t)}useTexture(){}};var fn=class{constructor(t){this.ctx=t;this.id=null;this.supportsUV=!0;this.supportsNormals=!1;this.textureInUse=!1;let r=this.gl=t.gl,n=`
            attribute vec2 v;
            attribute vec2 uv;

            uniform vec4 p;
            uniform vec4 uvRect;

            varying vec2 tCoord;

            void main() {
                gl_Position = vec4((p.x + p.z * v.x) * 2. - 1., (-p.y + p.w * v.y) * 2. + 1., 0, 1);
                tCoord = vec2(uvRect.x + uvRect.z * uv.x, uvRect.y + uvRect.w * uv.y);
            }
        `,i=`
            precision mediump float;

            varying vec2 tCoord;

            uniform vec4 color;
            uniform bool useTexture;

            uniform sampler2D tex;

            void main() {
                gl_FragColor = useTexture ? texture2D(tex, tCoord) * color : color;
            }
        `,o=pr(r,r.VERTEX_SHADER,n),s=pr(r,r.FRAGMENT_SHADER,i),a=this.program=r.createProgram();if(r.attachShader(a,o),r.attachShader(a,s),r.bindAttribLocation(a,ar,"v"),r.bindAttribLocation(a,Ye,"uv"),r.linkProgram(a),!r.getProgramParameter(a,r.LINK_STATUS)){let h=r.getProgramInfoLog(a);throw Error(`\u041E\u0448\u0438\u0431\u043A\u0430 Link Program: ${h}`)}let c=h=>{let d=r.getUniformLocation(a,h);if(!d)throw Error(`\u041F\u0440\u043E\u0433\u0440\u0430\u043C\u043C\u0430 \u043D\u0435 \u0441\u043E\u0434\u0435\u0440\u0436\u0438\u0442 Uniform '${h}'`);return d};this.uPos=c("p"),this.uUVRect=c("uvRect"),this.uColor=c("color"),this.uUseTexture=c("useTexture")}use(){let{ctx:t}=this;t.currentProgram!==this&&(t.currentProgram=this,++fe.programSwitch,this.gl.useProgram(this.program))}setPos(t,r,n,i){let{gl:o,uPos:s}=this;o.uniform4f(s,t,r,n,i)}setUVRect(t){let{gl:r,uUVRect:n}=this;r.uniform4fv(n,t)}setDiffuse(t){let{gl:r,uColor:n}=this;r.uniform4fv(n,t)}useTexture(t){this.textureInUse!==t&&this.gl.uniform1f(this.uUseTexture,+(this.textureInUse=t))}setAmbient(){}applyGlobals(){}};var yn=class{constructor(t){this.gl=t;this.currentTexture=null;this.currentTech=null;this.currentVAO=null;this.uvEnabled=!1;this.normalsEnabled=!1;this.backFacesInUse=!1;this.lightPos=le.create();this.ambientLight=el;t.enable(t.CULL_FACE),t.blendFunc(t.SRC_ALPHA,t.ONE_MINUS_SRC_ALPHA),t.enableVertexAttribArray(ar),this.has32Support=!!t.getExtension("OES_element_index_uint");let r=ll.map(i=>pr(t,t.VERTEX_SHADER,i));this.programs=Ce.map((i,o)=>{let s=pr(t,t.FRAGMENT_SHADER,cl[o]);return new Ur(this,r[o],s,i)});let n=r[Ce.findIndex(i=>i.uv&&!i.lighting)];this.textProgram=new Ur(this,n,pr(t,t.FRAGMENT_SHADER,ul),Wr),this.overlayProgram=new fn(this),this.textProgram.use()}enableUV(){this.uvEnabled||(this.uvEnabled=!0,this.gl.enableVertexAttribArray(Ye))}disableUV(){this.uvEnabled&&(this.uvEnabled=!1,this.gl.disableVertexAttribArray(Ye))}enableNormals(){this.normalsEnabled||(this.normalsEnabled=!0,this.gl.enableVertexAttribArray(br))}disableNormals(){this.normalsEnabled&&(this.normalsEnabled=!1,this.gl.disableVertexAttribArray(br))}useBackFaces(t){if(this.backFacesInUse===t)return;this.backFacesInUse=t,++fe.faceSwitch;let{gl:r}=this;r.frontFace(t?r.CW:r.CCW)}setTexture(t){if(this.currentTexture===t)return;++fe.textureSwitch;let{gl:r}=this;r.bindTexture(r.TEXTURE_2D,this.currentTexture=t)}};var Ke=class{constructor(t){this.data=t;this.cache=new or(this.genBuffers.bind(this));this.indicesType=0;this.gl=null;var o;let{iData:r,vData:n,numPerVertex:i}=t;this.use32=r instanceof Uint32Array,this.count=(o=r==null?void 0:r.length)!=null?o:n.length/i,this.numPerVertex=i}genBuffers(t){let{gl:r}=t,{iData:n,vData:i,uvData:o,normalData:s}=this.data,a=r.createBuffer();r.bindBuffer(r.ARRAY_BUFFER,a),r.bufferData(r.ARRAY_BUFFER,i,r.STATIC_DRAW);let c;o?(c=r.createBuffer(),r.bindBuffer(r.ARRAY_BUFFER,c),r.bufferData(r.ARRAY_BUFFER,o,r.STATIC_DRAW)):c=null;let h;s?(h=r.createBuffer(),r.bindBuffer(r.ARRAY_BUFFER,h),r.bufferData(r.ARRAY_BUFFER,s,r.STATIC_DRAW)):h=null;let d;return n?(d=r.createBuffer(),r.bindBuffer(r.ELEMENT_ARRAY_BUFFER,d),r.bufferData(r.ELEMENT_ARRAY_BUFFER,n,r.STATIC_DRAW),this.indicesType=this.use32?r.UNSIGNED_INT:r.UNSIGNED_SHORT,this.use32&&!t.has32Support&&(console.warn("WebGL: \u041D\u0435 \u043F\u043E\u0434\u0434\u0435\u0440\u0436\u0438\u0432\u0430\u044E\u0442\u0441\u044F 32-\u0431\u0438\u0442\u043D\u044B\u0435 \u0438\u043D\u0434\u0435\u043A\u0441\u044B"),this.count=0,this.indicesType=r.UNSIGNED_SHORT)):d=null,{ctx:t,iBuffer:d,vBuffer:a,uvBuffer:c,normalBuffer:h}}use(t){let{ctx:r}=t;if(r.currentVAO===this)return;r.currentVAO=this,++fe.vaoSwitch;let{gl:n}=r;this.gl=n;let{vBuffer:i,uvBuffer:o,normalBuffer:s,iBuffer:a}=this.cache.get(r);n.bindBuffer(n.ARRAY_BUFFER,i),n.vertexAttribPointer(ar,this.numPerVertex,n.FLOAT,!1,0,0),o&&t.supportsUV?(n.bindBuffer(n.ARRAY_BUFFER,o),n.vertexAttribPointer(Ye,2,n.FLOAT,!1,0,0),r.enableUV()):r.disableUV(),s&&t.supportsNormals?(n.bindBuffer(n.ARRAY_BUFFER,s),n.vertexAttribPointer(br,3,n.FLOAT,!1,0,0),r.enableNormals()):r.disableNormals(),a&&n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,a)}drawElements(){++fe.drawsTotal;let{gl:t,count:r,indicesType:n}=this;t.drawElements(t.TRIANGLES,r,n,0)}drawElementsRange(t,r){++fe.drawsTotal;let{gl:n,indicesType:i}=this;n.drawElements(n.TRIANGLES,r,i,t)}drawArraysFan(){++fe.drawsTotal;let{gl:t,count:r}=this;t.drawArrays(t.TRIANGLE_FAN,0,r)}},En=class{constructor(t,r,n){this.vao=t;this.indexCount=n;this.byteOffset=r*(t.use32?4:2)}use(t){this.vao.use(t)}drawElements(){this.vao.drawElementsRange(this.byteOffset,this.indexCount)}};var ZE=new Ke({numPerVertex:2,vData:new Float32Array([-.5,-.5,-.5,.5,.5,.5,.5,-.5]),uvData:new Float32Array([0,0,0,1,1,1,1,0]),iData:new Uint16Array([0,2,1,0,3,2,0,1,2,0,2,3])}),vn=class{constructor(t,r,n){this.s=t;this.position=r;this.scale=n;this.rotation=Re.create();this._localMatrix=ne.create();this.currentVAO=ZE;this.worldMatrix=ne.create();this.worldCenter=this.worldMatrix;this.normalWorldMatrix=gn;this.mirrored=!1;this._renderQueue=null;this._setupCounter=0;this._matrixNeedsUpdate=!0;this.key=t.o.key(),this.currentTech=t.material}updateMatrix(t){let{worldMatrix:r,_localMatrix:n,position:i,rotation:o,scale:s}=this;this._matrixNeedsUpdate&&(ne.fromRotationTranslationScale(n,o,i,s),this._matrixNeedsUpdate=!1),ne.mul(r,t,n)}calcMVP(t,{_pvMatrix:r}){ne.mul(t,r,this.worldMatrix)}};var Le=class{constructor(t,r){this.o=t;this.node=null;this.visible=!0;var n;t.movables.set(this.key=t.key(),this),this.name=(n=r==null?void 0:r.name)!=null?n:""}destroy(){this.detach(),this.o.movables.delete(this.key)}setVisible(t){return this.visible=t,this}detach(){let t=this.node;return t?(t.movables=t.movables.filter(r=>r!==this),this.node=null,this):this}};var e0=0,r0=1,_n=class extends Le{constructor(r,n){super(r,n);this.type=e0;this.billboards=[];this.material=null;this._renderQueue=null;this.vao=null;this.scale=le.fromValues(1,1,1);this._matrixVersion=0;r.billboardSets.set(this.key,this)}destroy(){super.destroy(),this.o.billboardSets.delete(this.key)}createBillboard(r,n,i){let o=new vn(this,le.fromValues(r,n,i),this.scale);return this.billboards.push(o),o}setCommonDirection(r,n,i){return this}setCommonUpVector(r,n,i){return this}setDimensions(r,n){let i=this.scale;return i[0]=r,i[1]=n,this}setType(r){if(r!==r0)throw Error(`billboardSet_SetBillboardType: \u0442\u0438\u043F ${r} \u043D\u0435 \u0440\u0435\u0430\u043B\u0438\u0437\u043E\u0432\u0430\u043D`);return this.type=r,this}setMaterial(r){return this.material=r,this.billboards.forEach(n=>n.currentTech=r),this}_onAttached(){this._matrixVersion=0}setup(r){var o;let n=(o=this.material)==null?void 0:o.compile(r,!1);if(!n)return;let i=this.node;if(this._matrixVersion!==i._worldMatrixVersion){this._matrixVersion=i._worldMatrixVersion;let{_worldMatrix:s}=i;this.billboards.forEach(a=>{a.updateMatrix(s),n.add(a)})}else this.billboards.forEach(s=>n.add(s))}};var wn=class extends Le{constructor(t,r){super(t,r),t.lights.set(this.key,this)}destroy(){super.destroy(),this.o.lights.delete(this.key)}_onAttached(){}setup(t){t.light=this}};function ml(e,t,r){let n=[],i=Math.ceil(r/8);e.font=t;let o=0,s=i,a=i,c=i,h=i,d=0;for(let E=0;E<16;++E){let v=0;for(let P=0;P<16;++P){let w=E*16+P,O=me.table[w],{width:R}=e.measureText(O),D=r;n.push({x:v+c,y:d+s,w:R,h:D,asc:s,desc:a,left:c,right:h}),v+=c+Math.ceil(R)+h}d+=s+r+a,o=Math.max(o,v)}return{font:t,fontSize:r,glyphRects:n,width:o,height:d}}function hl(e,{font:t,glyphRects:r,height:n,width:i}){e.canvas.width=i,e.canvas.height=n,e.font=t,e.fillStyle="white",e.textAlign="left",e.textBaseline="top",e.fontKerning="none",r.forEach(({x:o,y:s},a)=>{e.fillText(me.table[a],o,s)})}var zi=class{constructor(t,r=""){this.pass=t;this.name=r;this.image=null;this.imageNameUC=null;this.imageFound=!1;t.tech.mat.o.texUnits.set(this.key=t.tech.mat.o.key(),this)}setTexture(t,r){if(r!==rl)throw Error("textureUnitState_SetTexture: \u0418\u0441\u043F\u043E\u043B\u044C\u0437\u0443\u0435\u043C\u044B\u0439 \u0442\u0438\u043F \u0442\u0435\u043A\u0441\u0442\u0443\u0440\u044B \u043D\u0435 \u043F\u043E\u0434\u0434\u0435\u0440\u0436\u0438\u0432\u0430\u0435\u0442\u0441\u044F");return this.image=t,this}setTextureName(t){return this.imageNameUC=t.toUpperCase(),this}getImage(){var t;return this.imageFound||this.image?this.image:(this.imageFound=!0,this.imageNameUC?this.image=(t=this.pass.tech.mat.o.imageResByNameUC.get(this.imageNameUC))!=null?t:null:null)}},qi=class{constructor(t){this.tech=t;this.textures=[];this.ambient=le.fromValues(1,1,1);this.diffuse=ir.fromValues(1,1,1,1);this.specular=ir.fromValues(0,0,0,0);this.emissive=le.fromValues(0,0,0);this.shininess=0;this.lightingEnabled=!0;this.shadingMode=Mr;t.mat.o.passes.set(this.key=t.mat.o.key(),this)}createTextureUnit(t){let r=new zi(this,t);return this.textures.push(r),r}setLightingEnabled(t){return this.lightingEnabled=t,this}setAmbient(t,r,n){return le.set(this.ambient,t,r,n),this}setDiffuse(t,r,n,i){return ir.set(this.diffuse,t,r,n,i),this}setSpecular(t,r,n,i){return ir.set(this.specular,t,r,n,i),this}setEmissive(t,r,n){return le.set(this.emissive,t,r,n),this}setShininess(t){return this.shininess=t,this}setShadingMode(t){return t===Mr&&(this.shadingMode=t),this}setDepthCheckEnabled(t){return this}},Yi=class{constructor(t){this.mat=t;t.o.techniques.set(this.key=t.o.key(),this),this.passes=[new qi(this)]}pass(t){return t>=0&&t<this.passes.length?this.passes[t]:null}},xn=class{constructor(t,r){this.o=t;this.name=r;this.id=Ce[0];t.materialByKey.set(this.key=t.key(),this),t.materialByName.set(r,this),this.techs=[new Yi(this)]}tech(t){return t>=0&&t<this.techs.length?this.techs[t]:null}compile(t,r){var c;let n=this.techs[0].passes[0],i=n.diffuse[3]<1||n.specular[3]<1,o=!!((c=n.textures[0])!=null&&c.getImage()),s=n.lightingEnabled?n.shadingMode:null,a=this.id=Ce.find(h=>h.uv===o&&h.lighting===s);return i?t.transp:(r?t.opaqueMirrored:t.opaque)[a.index]}use(t){var o;let{ctx:r}=t;if(r.currentTech===this)return;r.currentTech=this,++fe.materialSwitch;let n=this.techs[0].passes[0],i=(o=n.textures[0])==null?void 0:o.getImage();i?(i.use(r),t.useTexture(!0)):t.useTexture(!1),t.setDiffuse(n.diffuse),t.setAmbient(n.ambient)}},pl=document.createElement("canvas"),dl=pl.getContext("2d",{alpha:!0}),Pn=class{constructor(t,r){this.o=t;this.fontName=r;this.cache=new or(this.genFontTexture.bind(this));this.id=Wr;this.color=[1,1,1,1];let n=Math.round(41.66666666666667),i=this.rects=ml(dl,`${n}px ${this.fontName}`,n);this.texWidth=i.width,this.texHeight=i.height}genFontTexture(t){hl(dl,this.rects);let{gl:r}=t,n=r.createTexture();return t.setTexture(n),r.texImage2D(r.TEXTURE_2D,0,r.RGBA,r.RGBA,r.UNSIGNED_BYTE,pl),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MIN_FILTER,r.LINEAR),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_S,r.CLAMP_TO_EDGE),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_T,r.CLAMP_TO_EDGE),{ctx:t,texture:n}}use(t,r=!0){let{ctx:n}=t;n.currentTech!==this&&(n.currentTech=this,++fe.materialSwitch,n.setTexture(this.cache.get(n).texture),r&&t.setDiffuse(this.color))}};function Sn(e,t,r=Or,n=0){let{glyphRects:i,fontSize:o,height:s,width:a}=e,c=[...t],h=(n||i[me.SPACE_CHAR].w)/o,d=0,g=[],y=0,E=0;{let R={glyphs:[],width:0},D=0;c.forEach(B=>{let V=me.table.indexOf(B),F=V>-1?V:me.SPACE_CHAR;if(F===me.NEWLINE_CHAR){g.push(R),y=Math.max(y,R.width),E+=1,R={glyphs:[],width:0},D=0,R.width=0;return}let Y=i[F];if(F===me.SPACE_CHAR)(r!==sr||!g.length||R.glyphs.length)&&(R.width+=h,R.glyphs.push(null));else{let K=Y.w/o,z=Y.h/o;R.width+=K,D=Math.max(D,z),R.glyphs.push(Y),++d}}),g.push(R),y=Math.max(y,R.width),E+=D}if(!d)return{caption:t,width:y,height:E,vao:null,align:r};let v=new Float32Array(d*8),P=new Float32Array(d*8),w=new Uint16Array(d*6);{let R=0,D=0;g.forEach(B=>{let V=r===sr?(y-B.width)/2:r===gr?y-B.width:0;B.glyphs.forEach(F=>{if(!F){V+=h;return}let Y=F.w/o,K=F.x-F.left,z=F.y-F.asc,k=F.left+F.w+F.right,Q=F.asc+F.h+F.desc,Z=k/o,re=Q/o,C=R*8,se=R*6,ye=R*4;++R;{let L=V-F.left/o,ae=D+F.asc/o;V+=Y;let be=L,Be=L,He=L+Z,Qe=He,fr=ae,lr=ae-re,qn=lr,Yn=fr;v[C+0]=be,v[C+1]=fr,v[C+2]=Be,v[C+3]=lr,v[C+4]=He,v[C+5]=qn,v[C+6]=Qe,v[C+7]=Yn}{let L=K/a,ae=L,be=(K+k)/a,Be=be,He=z/s,Qe=(z+Q)/s,fr=Qe,lr=He;P[C+0]=L,P[C+1]=He,P[C+2]=ae,P[C+3]=Qe,P[C+4]=be,P[C+5]=fr,P[C+6]=Be,P[C+7]=lr}w[se+0]=ye+0,w[se+1]=ye+1,w[se+2]=ye+3,w[se+3]=ye+1,w[se+4]=ye+2,w[se+5]=ye+3}),D-=1})}let O=new Ke({numPerVertex:2,vData:v,uvData:P,iData:w});return{caption:t,width:y,height:E,vao:O,align:r}}var Ar=ne.create(),Tn=class extends Le{constructor(r,n,i){super(r,i);this.caption=n;this.charHeight=1;this.worldMatrix=Ge;this.normalWorldMatrix=gn;this.worldCenter=Ge;this.mirrored=!1;this._renderQueue=null;this._setupCounter=0;r.movableTexts.set(this.key,this);let o=this.currentTech=r._getTextTechnique(i==null?void 0:i.fontName),s=this.mesh=Sn(o.rects,n);this.currentVAO=s.vao}destroy(){super.destroy(),this.o.movableTexts.delete(this.key)}setCharHeight(r){return this.charHeight=r,this}_onAttached(r){this.worldMatrix=this.worldCenter=r._worldMatrix}setup(r){this.currentVAO&&r.text.add(this)}calcMVP(r,{_viewMatrix:n,_projMatrix:i}){ne.mul(r,n,this.worldMatrix);let o=Math.hypot(r[0],r[1],r[2])*this.charHeight,s=Math.hypot(r[4],r[5],r[6])*this.charHeight;Ar[0]=o,Ar[5]=s;let a=-this.mesh.width*o,c=this.mesh.height*s;Ar[12]=r[12]+a,Ar[13]=r[13]+c,Ar[14]=r[14],ne.mul(r,i,Ar)}};var Mn=class{constructor(t,r=""){this.o=t;this.name=r;this.children=[];this.visible=!1;this.scaleX=1;this.scaleY=1;this.z=0;t.overlays.set(this.key=t.key(),this)}setChildren(t){return this.children.forEach(r=>r.overlay=null),this.children=Array.from(new Set(t)),this.children.forEach(r=>{r.overlay=this,r.parent&&(console.warn("OverlayElement has parent"),r.parent=null)}),this}setZ(t){return this.z=t,this.o.overlayQueue=null,this}setScale(t,r){return this.scaleX=t,this.scaleY=r,this}setVisible(t){return this.visible=t,this.o.overlayQueue=null,this}render(t){let{ctx:r}=t.w,{drawingBufferWidth:n,drawingBufferHeight:i}=r.gl;this.children.forEach(o=>o.drawAt(r,0,0,1,1,n,i))}};function Xe(e){let t=e.split(" ").map(r=>parseFloat(r));return t.length===4&&!t.some(isNaN)?[t[0],t[1],t[2]-t[0],t[3]-t[1]]:null}function t0(e){let t=e.split(" ").slice(0,3).map(r=>parseFloat(r));return t.some(isNaN)?null:[...t,1]}var Nr=class{constructor(t,r,n){this.o=t;this.type=r;this.overlay=null;this.parent=null;this.children=[];this.visible=!0;this.x=0;this.y=0;this.width=0;this.height=0;this.metricsMode=nl;this.horAlign=Or;this.horTextAlign=Or;this.vertAlign=il;this.caption="";this.charHeight=12;this.spaceWidth=0;this.color=[1,1,1,1];this.mat=null;this.uv=[0,0,1,1];this.uvTL=[0,0,1,1];this.uvTR=[0,0,1,1];this.uvBL=[0,0,1,1];this.uvBR=[0,0,1,1];this.uvL=[0,0,1,1];this.uvR=[0,0,1,1];this.uvT=[0,0,1,1];this.uvB=[0,0,1,1];this.borders=[0,0,0,0];this.needCalcTextMesh=!1;var i;t.overlayElements.set(this.key=t.key(),this),this.name=(i=n==null?void 0:n.name)!=null?i:""}drawAt(t,r,n,i,o,s,a){let{visible:c,vertAlign:h,horAlign:d,metricsMode:g,x:y,y:E,width:v,height:P}=this;if(!c)return;let w=g===bn,O=(w?y/s:y)+(d===gr?i:d===sr?i/2:0)+r,R=(w?E/a:E)+(h===sl?o:h===ol?o/2:0)+n,D=w?v/s:v,B=w?P/a:P;this.draw(t,O,R,D,B,s,a),this.children.forEach(V=>V.drawAt(t,O,R,D,B,s,a))}setMetricsMode(t){return this.metricsMode=t,this}setChildren(t){return this.children.forEach(r=>r.parent=null),this.children=Array.from(new Set(t)),this.children.forEach(r=>r.parent=this),this}setVisible(t){return this.visible=t,this}setPosition(t,r){return this.x=t,this.y=r,this}setSize(t,r){return this.width=t,this.height=r,this}setAlignment(t,r){return this.horAlign=t,this.vertAlign=r,this}setCaption(t){return this.caption!==t&&(this.caption=t,this.needCalcTextMesh=!0),this}setColor(t,r,n,i){return this.color=[t,r,n,i],this}setMaterial(t){return this.mat=t,this}setParam(t,r){switch(t){case"uv_coords":{let i=Xe(r);i&&(this.uv=i);break}case"border_material":break;case"border_size":{let i=r.split(" ").map(o=>Math.max(parseInt(o),2));i.length===4&&!i.some(isNaN)&&(this.borders=i);break}case"border_topleft_uv":{let i=Xe(r);i&&(this.uvTL=i);break}case"border_topright_uv":{let i=Xe(r);i&&(this.uvTR=i);break}case"border_bottomleft_uv":{let i=Xe(r);i&&(this.uvBL=i);break}case"border_bottomright_uv":{let i=Xe(r);i&&(this.uvBR=i);break}case"border_left_uv":{let i=Xe(r);i&&(this.uvL=i);break}case"border_right_uv":{let i=Xe(r);i&&(this.uvR=i);break}case"border_top_uv":{let i=Xe(r);i&&(this.uvT=i);break}case"border_bottom_uv":{let i=Xe(r);i&&(this.uvB=i);break}case"font_name":break;case"alignment":this.horTextAlign=r==="center"?sr:r==="right"?gr:Or;break;case"colour":let n=t0(r);n&&(this.color=n);break;case"char_height":{let i=parseInt(r)||12;this.charHeight!==i&&(this.charHeight=i,this.needCalcTextMesh=!0);break}case"space_width":{let i=parseInt(r)||12;this.spaceWidth!==i&&(this.spaceWidth=i,this.needCalcTextMesh=!0);break}default:console.warn(`\u041D\u0435\u0438\u0437\u0432\u0435\u0441\u0442\u043D\u044B\u0439 \u043F\u0430\u0440\u0430\u043C\u0435\u0442\u0440 StringInterface: '${t}'`);break}}};var On=new Ke({vData:new Float32Array([0,0,0,-1,1,-1,1,0]),uvData:new Float32Array([0,0,0,1,1,1,1,0]),numPerVertex:2}),Wn=class extends Nr{constructor(r,n){super(r,"Panel",n);this.vao=On;this.vao=On}draw(r,n,i,o,s){let{mat:a,uv:c,vao:h}=this;if(!a)return;let d=r.overlayProgram;a.use(d),h.use(d),d.setUVRect(c),d.setPos(n,i,o,s),h.drawArraysFan()}},An=class extends Nr{constructor(r,n){super(r,"BorderPanel",n);this.vao=On;this.vao=On}draw(r,n,i,o,s,a,c){let{mat:h,uv:d,vao:g,borders:y,uvTL:E,uvT:v,uvTR:P,uvR:w,uvBR:O,uvB:R,uvBL:D,uvL:B,metricsMode:V}=this;if(!h)return;let F=r.overlayProgram;h.use(F),g.use(F);let Y=V===bn,K=Y?y[0]/a:y[0],z=Y?y[1]/a:y[1],k=Y?y[2]/c:y[2],Q=Y?y[3]/c:y[3],Z=o-K-z,re=s-k-Q;[[[K,k,Z,re],d],[[0,0,K,k],E],[[K,0,Z,k],v],[[K+Z,0,z,k],P],[[K+Z,k,z,re],w],[[K+Z,k+re,z,Q],O],[[K,k+re,Z,Q],R],[[0,k+re,K,Q],D],[[0,k,K,re],B]].forEach(([se,ye])=>{F.setUVRect(ye),F.setPos(n+se[0],i+se[1],se[2],se[3]),g.drawArraysFan()})}},Nn=class extends Nr{constructor(r,n){super(r,"TextArea",n);this.mesh=null;this.tech=r._getTextTechnique()}draw(r,n,i,o,s,a,c){let{caption:h,tech:d,horTextAlign:g,spaceWidth:y}=this;if(!h)return;this.needCalcTextMesh&&(this.needCalcTextMesh=!1,this.mesh=Sn(this.tech.rects,h,g,y));let{vao:E,width:v}=this.mesh;if(!E)return;let P=r.overlayProgram;d.use(P,!1),E.use(P),P.setUVRect([0,0,1,1]);let w=this.charHeight*.75,O=w/a,R=w/c,D=n-(g===gr?v*O:g===sr?v*O/2:0);P.setPos(D,i,O,R),P.setDiffuse(this.color),E.drawElements()}};var Rn=class{constructor(t,r){this.w=t;this.bg=le.fromValues(.2,.2,.2);this.overlaysEnabled=!0;t.o.viewports.set(this.key=t.o.key(),this),this.camera=r,r._setViewport(this)}setCamera(t){return this.camera!==t&&(this.camera._setViewport(null),this.camera=t._setViewport(this)),this}enableOverlays(t){return this.overlaysEnabled=t,this}setBackground(t,r,n){return le.set(this.bg,t,r,n),this}};var In=class{constructor(t,r,n,i){this.o=t;this.mouseSource=i;this.viewports=new Set;this.x=0;this.y=0;this.width=0;this.height=0;this.wheelPosition=0;this.buttonsPressed=[!1,!1,!1,!1];this.mainViewport=null;t.windows.set(this.key=t.key(),this);let o=this.view=document.createElement("canvas");this.width=o.width=r,this.height=o.height=n,o.style.pointerEvents="none";let s=o.getContext("webgl",{alpha:!1,depth:!0,antialias:!0,desynchronized:!1});this.ctx=new yn(s)}createViewport(t,r){let n=new Rn(this,t);if(this.viewports.size)throw Error("\u0421\u043E\u0437\u0434\u0430\u043D\u0438\u0435 \u043D\u0435\u0441\u043A\u043E\u043B\u044C\u043A\u0438\u0445 Viewport \u043D\u0435 \u0440\u0435\u0430\u043B\u0438\u0437\u043E\u0432\u0430\u043D\u043E");return this.mainViewport=n,this.viewports.add(n),n}keyPressed(t){if(t===0)return!1;throw console.log(`\u041D\u0430\u0436\u0430\u0442\u0430 \u043B\u0438 \u043A\u043B\u0430\u0432\u0438\u0448\u0430: ${t}`),Error()}buttonPressed(t){return this.mouseSource.keyPressed(t==="left"?1:t==="right"?2:4)}mouse(){let t=this.mouseSource.mouse,r=this.mouseSource.scene;return{x:t.x-r.x,y:t.y-r.y}}render(t){fe.clear();let{ctx:r}=this,{gl:n}=r;this.viewports.forEach(i=>{var a,c;n.clearColor(...i.bg,1),n.clear(n.COLOR_BUFFER_BIT|n.DEPTH_BUFFER_BIT),n.enable(n.DEPTH_TEST);let o=i.camera,s=o.scene.setupRenderQueue(t);o._setupMatrix(),ne.getTranslation(r.lightPos,(c=(a=s.light)==null?void 0:a.node._worldMatrix)!=null?c:Ge),r.ambientLight=o.scene.ambient,r.currentProgram.applyGlobals(),s.opaque.forEach((h,d)=>{if(!h.hasItems())return;let g=r.programs[d];g.use(),h.render(g,o)}),s.opaqueMirrored.forEach((h,d)=>{if(!h.hasItems())return;r.useBackFaces(!0);let g=r.programs[d];g.use(),h.render(g,o)}),n.enable(n.BLEND);{let h=s.transp;h.hasItems()&&h.render(r,o)}n.depthMask(!1),r.useBackFaces(!1),n.disable(n.DEPTH_TEST);{let h=s.text;h.hasItems()&&(r.textProgram.use(),h.render(r,o))}if(i.overlaysEnabled){let h;(h=this.o.overlayQueue)||(h=this.o.overlayQueue=[...this.o.overlays.values()].filter(d=>d.visible).sort((d,g)=>d.z-g.z)),h.length&&(r.overlayProgram.use(),h.forEach(d=>d.render(i)))}n.depthMask(!0),n.disable(n.BLEND)})}};var Fn=class extends Le{constructor(r,n){super(r.o,n);this.scene=r;this.viewport=null;this.nearDist=1;this.farDist=1e3;this.fov=Math.PI/4;this.aspect=12/9;this.autoAspect=!0;this._worldMatrix=Ge;this._pvMatrix=ne.create();this._projMatrix=ne.create();this._viewMatrix=ne.create();this._matrixVersion=0;r.o.cameras.set(this.key,this),n&&this.set(n)}destroy(){super.destroy(),this.o.cameras.delete(this.key)}_setViewport(r){return this.viewport=r,this}set({farDist:r=this.farDist,fov:n=this.fov,nearDist:i=this.nearDist,aspect:o=this.aspect}){return this.farDist=r,this.fov=n,this.nearDist=i,this.aspect=o,this._matrixVersion=0,this}_setupMatrix(){var g;let{_pvMatrix:r,_projMatrix:n,_viewMatrix:i}=this;if(this.autoAspect){let y=this.viewport.w.view,E=y.width/y.height;this.aspect!==E&&(this.aspect=E,this._matrixVersion=0)}let o=this.node&&this.node._visitedDuringSetup()?this.node:null,s=(g=o==null?void 0:o._worldMatrixVersion)!=null?g:1;if(this._matrixVersion===s)return r;this._matrixVersion=s;let{fov:a,aspect:c,nearDist:h,farDist:d}=this;return ne.perspective(n,a,c,h,d),o?(this._worldMatrix=o._worldMatrix,ne.invert(i,o._worldMatrix),ne.mul(r,n,i)):(this._worldMatrix=Ge,ne.identity(this._viewMatrix),ne.copy(r,n))}_onAttached(){this._matrixVersion=0}setup(){}};var Dn=class{constructor(t,r,n){this.entity=t;this.submesh=r;this.normalWorldMatrix=n;this.currentTech=null;this.worldMatrix=Ge;this.worldCenter=ne.create();this.mirrored=!1;this._renderQueue=null;this._setupCounter=0;this.vertexCount=r.vBufferData.vertexCount,this.currentTech=r.getMaterial(),this.currentVAO=r.getVAO()}setMaterial(t){return this.currentTech=t,this}calcMVP(t,{_pvMatrix:r}){ne.mul(t,r,this.worldMatrix)}};var kn=ne.create(),Gn=class extends Le{constructor(r,n,i){super(r.o,i);this.scene=r;this.sharedMesh=n;this.matrixVersion=0;this.normalMat=nr.create();this.mirrored=!1;r.o.entities.set(this.key,this),this.subEntities=n.submeshes.map(o=>new Dn(this,o,this.normalMat))}destroy(){super.destroy(),this.o.entities.delete(this.key)}subEntity(r){return r>=0&&r<this.subEntities.length?this.subEntities[r]:null}_onAttached(r){this.matrixVersion=0;let{_worldMatrix:n}=r;this.subEntities.forEach(i=>i.worldMatrix=n)}setup(r){let n=this.node;if(this.matrixVersion!==n._worldMatrixVersion){this.matrixVersion=n._worldMatrixVersion,ne.invert(kn,n._worldMatrix),ne.transpose(kn,kn),nr.fromMat4(this.normalMat,kn);let i=this.mirrored=n.xScaleFactor*n.yScaleFactor*n.zScaleFactor<0;this.subEntities.forEach(o=>{o.mirrored=i,ne.mul(o.worldCenter,n._worldMatrix,o.submesh.center)})}this.subEntities.forEach(i=>{var o,s;(s=(o=i.currentTech)==null?void 0:o.compile(r,this.mirrored))==null||s.add(i)})}};var Ln=ne.create(),Jr=class{constructor(t){this.s=t;this.renderables=new Map;this._hasItems=!1}hasItems(){return this._hasItems}add(t){if(t._setupCounter=this.s._setupCounter,t._renderQueue===this)return;t._renderQueue=this,this._hasItems=!0;let r=t.currentTech,n=this.renderables.get(r);n||this.renderables.set(r,n=new Map);let i=t.currentVAO,o=n.get(i);o?o.push(t):n.set(i,o=[t])}removeUnvisited(){this.renderables.forEach((t,r)=>{t.forEach((n,i)=>{let o=n.filter(s=>s._renderQueue===this);o.length?t.set(i,o):t.delete(i)}),t.size||this.renderables.delete(r)}),this._hasItems=this.renderables.size>0}render(t,r){let{_setupCounter:n}=this.s,{supportsNormals:i}=t,o=!1;this.renderables.forEach((s,a)=>{a.use(t),s.forEach((c,h)=>{h.use(t),c.forEach(d=>{if(d._setupCounter!==n||d._renderQueue!==this){d._renderQueue===this&&(d._renderQueue=null),o=!0;return}i&&t.setWorldMatrix(d.worldMatrix,d.normalWorldMatrix),d.calcMVP(Ln,r),t.setMatrix(Ln),h.drawElements()})})}),o&&this.removeUnvisited()}},jr=class{constructor(t){this.s=t;this.renderables=[];this._hasItems=!1}hasItems(){return this._hasItems}add(t){t._setupCounter=this.s._setupCounter,t._renderQueue!==this&&(t._renderQueue=this,this._hasItems=!0,this.renderables.push(t))}removeUnvisited(){this.renderables=this.renderables.filter(t=>t._renderQueue===this),this._hasItems=this.renderables.length>0}render(t,r){let{_setupCounter:n}=this.s,i=r._worldMatrix,o=!1,s=t.currentProgram;this.renderables.sort((a,c)=>Hi(i,c.worldCenter)-Hi(i,a.worldCenter)).forEach(a=>{if(a._setupCounter!==n||a._renderQueue!==this){a._renderQueue===this&&(a._renderQueue=null),o=!0;return}t.useBackFaces(a.mirrored);let c=a.currentTech;t.currentTech!==c&&(s.id!==c.id&&(s=t.programs[c.id.index],s.use()),c.use(s));let h=a.currentVAO;h.use(s),s.supportsNormals&&s.setWorldMatrix(a.worldMatrix,a.normalWorldMatrix),a.calcMVP(Ln,r),s.setMatrix(Ln),h.drawElements(),++fe.drawsTransp}),o&&this.removeUnvisited()}};var Bn=class{constructor(t,r){this.scene=t;this.children=[];this.parent=null;this.position=le.create();this.scale=le.fromValues(1,1,1);this.rotation=Re.create();this._localMatrix=ne.create();this._worldMatrix=ne.create();this.xScaleFactor=1;this.yScaleFactor=1;this.zScaleFactor=1;this._worldMatrixVersion=2;this._matrixNeedsUpdate=!1;var n;t.o.nodes.set(this.key=t.o.key(),this),this.name=(n=r==null?void 0:r.name)!=null?n:""}destroy(){this.children.forEach(t=>{t.parent=null,t._matrixNeedsUpdate=!0}),this.removeParent(),this.scene.o.nodes.delete(this.key)}addChild(t){let r=t.parent;if(r){if(r===this)return this;let n=this.parent;for(;n;){if(n===t)throw Error("SceneNode.addChild: child \u044F\u0432\u043B\u044F\u0435\u0442\u0441\u044F \u0440\u043E\u0434\u0438\u0442\u0435\u043B\u044C\u0441\u043A\u0438\u043C \u0443\u0437\u043B\u043E\u043C \u0442\u0435\u043A\u0443\u0449\u0435\u0433\u043E \u0443\u0437\u043B\u0430");n=n.parent}}if(t===this)throw Error("SceneNode.addChild: child \u044F\u0432\u043B\u044F\u0435\u0442\u0441\u044F \u0442\u0435\u043A\u0443\u0449\u0438\u043C \u0443\u0437\u043B\u043E\u043C");if(t.scene!==this.scene)throw Error("SceneNode.addChild: child \u043F\u0440\u0438\u043D\u0430\u0434\u043B\u0435\u0436\u0438\u0442 \u0434\u0440\u0443\u0433\u043E\u0439 \u0441\u0446\u0435\u043D\u0435");return t.removeParent(),this.children.push(t),t.parent=this,t._matrixNeedsUpdate=!0,this}removeParent(){let t=this.parent;return t?(t.children=t.children.filter(r=>r!==this),this.parent=null,this):this}setPosition(t,r,n){return le.set(this.position,t,r,n),this._matrixNeedsUpdate=!0,this}setRotation(t,r,n,i){return Re.set(this.rotation,t,r,n,i),this._matrixNeedsUpdate=!0,this}resetRotation(){return Re.identity(this.rotation),this._matrixNeedsUpdate=!0,this}rotateX(t){return Re.rotateX(this.rotation,this.rotation,t),this._matrixNeedsUpdate=!0,this}rotateY(t){return Re.rotateY(this.rotation,this.rotation,t),this._matrixNeedsUpdate=!0,this}rotateZ(t){return Re.rotateZ(this.rotation,this.rotation,t),this._matrixNeedsUpdate=!0,this}setScale(t,r,n){return le.set(this.scale,t,r,n),this._matrixNeedsUpdate=!0,this}};var $r=class extends Bn{constructor(r,n){super(r,n);this.tracking=null;this.trackedBy=new Set;this.movables=[];this._sceneSetupVisitCount=0;r.o.sceneNodes.set(this.key,this)}destroy(){var r;super.destroy(),(r=this.tracking)==null||r.target.trackedBy.delete(this),this.movables.forEach(n=>n.node=null),this.scene.o.sceneNodes.delete(this.key)}attach(r){let n=r.node;if(n){if(n===this)return this;r.detach()}return this.movables.push(r),r.node=this,r._onAttached(this),this}setTracking(r,n,i,o){var s;if(r)throw Error("sceneNode_SetAutoTracking: \u043D\u0435 \u0440\u0435\u0430\u043B\u0438\u0437\u043E\u0432\u0430\u043D\u043E");return(s=this.tracking)==null||s.target.trackedBy.delete(this),this.tracking=r?{target:r,up:le.fromValues(n,i,o)}:null,r==null||r.trackedBy.add(this),this._matrixNeedsUpdate=!0,this}setupRecursive(r,n,i){this._sceneSetupVisitCount=this.scene._setupCounter;let{_worldMatrix:o}=this,s=n||this._matrixNeedsUpdate;if(s){let{_localMatrix:a,scale:c}=this;this._matrixNeedsUpdate&&(ne.fromRotationTranslationScale(a,this.rotation,this.position,c),this._matrixNeedsUpdate=!1),ne.mul(o,i._worldMatrix,a),this.xScaleFactor=i.xScaleFactor*Math.sign(c[0]),this.yScaleFactor=i.yScaleFactor*Math.sign(c[1]),this.zScaleFactor=i.zScaleFactor*Math.sign(c[2]),++this._worldMatrixVersion}this.movables.forEach(a=>a.visible&&a.setup(r)),this.children.forEach(a=>a.setupRecursive(r,s,this))}_visitedDuringSetup(){return this._sceneSetupVisitCount===this.scene._setupCounter}};var n0={_worldMatrix:Ge,xScaleFactor:1,yScaleFactor:1,zScaleFactor:1},Vn=class{constructor(t){this.o=t;this.light=null;this._setupCounter=0;this.ambient=le.create();this.root=new $r(this),t.scenes.set(this.key=t.key(),this),this.opaque=Ce.map(()=>new Jr(this)),this.opaqueMirrored=Ce.map(()=>new Jr(this)),this.transp=new jr(this),this.text=new jr(this)}setAmbient(t,r,n){return le.set(this.ambient,t,r,n),this}createSceneNode(t){return new $r(this,t)}createCamera(t){return new Fn(this,t)}createEntity(t,r){return new Gn(this,t,r)}setupRenderQueue(t){return this._setupCounter===t?this:(this._setupCounter=t,this.light=null,this.root.setupRecursive(this,!1,n0),this)}};var gl=new Map,Cn=class{constructor(t){this.info=t;this.cache=new or(this.genTexture.bind(this));let r=Te(t.src),n=gl.get(r);if(n)this.image=n;else{let i=this.image=new Image;gl.set(r,i),i.crossOrigin="",i.src=r}}genTexture(t){let{gl:r}=t,n=r.createTexture();function i(s){t.setTexture(n),r.texImage2D(r.TEXTURE_2D,0,r.RGBA,r.RGBA,r.UNSIGNED_BYTE,s),ii(s.width)&&ii(s.height)?r.generateMipmap(r.TEXTURE_2D):(r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MIN_FILTER,r.LINEAR),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_S,r.CLAMP_TO_EDGE),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_T,r.CLAMP_TO_EDGE))}let{image:o}=this;return o.complete&&o.naturalHeight?i(o):(t.setTexture(n),r.texImage2D(r.TEXTURE_2D,0,r.RGBA,1,1,0,r.RGBA,r.UNSIGNED_BYTE,new Uint8Array([211,211,211,64])),o.complete||o.addEventListener("load",()=>i(o))),{ctx:t,texture:n}}use(t){t.setTexture(this.cache.get(t).texture)}};var i0=le.create(),Xi=class{constructor(t,r,n){this.par=t;this.data=r;this.sharedIndexOffset=n;this._material=null;this._vao=null;this.materialFound=!1;var P,w;this.materialName=(P=r.material)!=null?P:"",this.shared=(w=r.useSharedGeometry)!=null?w:!1;let i=r.useSharedGeometry?t.data.sharedGeometry:r.geometry;if(!i)throw Error("Mesh \u043D\u0435 \u0438\u043C\u0435\u0435\u0442 \u0433\u0435\u043E\u043C\u0435\u0442\u0440\u0438\u0438");if(i.length>1)throw Error("Mesh \u0441 \u043D\u0435\u0441\u043A\u043E\u043B\u044C\u043A\u0438\u043C\u0438 VertexBuffer \u043D\u0435 \u0440\u0435\u0430\u043B\u0438\u0437\u043E\u0432\u0430\u043D\u044B");let[o]=i;if(!o.positions)throw Error("Mesh \u0431\u0435\u0437 Positions \u043D\u0435 \u043F\u043E\u0434\u0434\u0435\u0440\u0436\u0438\u0432\u0430\u0435\u0442\u0441\u044F");this.vBufferData=o;let{maxX:s,maxY:a,maxZ:c,minX:h,minY:d,minZ:g}=o.positions.extrema,y=(s+h)/2,E=(a+d)/2,v=(c+g)/2;this.center=ne.fromTranslation(ne.create(),le.set(i0,y,E,v))}getMaterial(){var r;if(this.materialFound)return this._material;if(this.materialFound=!0,!this.materialName)return null;let t=(r=this.par.o.materialByName.get(this.materialName))!=null?r:null;return t||console.warn(`Ogre: ${this.par.meta}: \u043C\u0430\u0442\u0435\u0440\u0438\u0430\u043B '${this.materialName}' \u043D\u0435 \u0441\u0443\u0449\u0435\u0441\u0442\u0432\u0443\u0435\u0442`),this._material=t}getVAO(){var c,h;if(this._vao)return this._vao;if(this.shared){let d=this.sharedIndexOffset,g=this.data.indices.length;return this._vao=new En(this.par.getSharedVAO(),d,g)}let{vBufferData:t}=this,{indices:r,useIndices32:n}=this.data,i=new Float32Array(t.positions.coords),o=(c=t.normals)!=null&&c.length?new Float32Array(t.normals):null,s=(h=t.uvs)!=null&&h.length?new Float32Array(t.uvs[0]):null,a=new(n?Uint32Array:Uint16Array)(r);return this._vao=new Ke({vData:i,uvData:s,normalData:o,iData:a,numPerVertex:3})}},Kn=class{constructor(t,r){this.o=t;this.data=r;this.sharedVAO=null;let n=0;this.submeshes=r.submeshes.map(i=>{let o=new Xi(this,i,n);return n+=i.indices.length,o})}getSharedVAO(){if(this.sharedVAO)return this.sharedVAO;let[{positions:t,normals:r,uvs:n}]=this.data.sharedGeometry,i=!1,o=0;this.data.submeshes.forEach(g=>{g.useIndices32&&(i=!0),o+=g.indices.length});let s=new(i?Uint32Array:Uint16Array)(o),a=0;this.data.submeshes.forEach(g=>{s.set(g.indices,a),a+=g.indices.length});let c=new Float32Array(t.coords),h=r!=null&&r.length?new Float32Array(r):null,d=n!=null&&n.length?new Float32Array(n[0]):null;return this.sharedVAO=new Ke({vData:c,uvData:d,normalData:h,iData:s,numPerVertex:3})}};var Hr=class{constructor(){this.windows=new Map;this.scenes=new Map;this.viewports=new Map;this.overlays=new Map;this.overlayElements=new Map;this.entities=new Map;this.nodes=new Map;this.sceneNodes=new Map;this.movables=new Map;this.cameras=new Map;this.billboardSets=new Map;this.lights=new Map;this.movableTexts=new Map;this.materialByKey=new Map;this.materialByName=new Map;this.techniques=new Map;this.passes=new Map;this.texUnits=new Map;this.imageResByNameUC=new Map;this.meshResByNameUC=new Map;this.primaryWindow=null;this.overlayQueue=null;this.fontMap=new Map;this.globalKey=1e3;this.drawNumber=0;console.log(this)}_getTextTechnique(t="sans-serif"){let r=t.toUpperCase(),n=this.fontMap.get(r);if(n)return n;let i=new Pn(this,t);return this.fontMap.set(r,i),i}key(){return++this.globalKey}createRenderWindow(t,r,n){let i=new In(this,t,r,n);return this.primaryWindow||(this.primaryWindow=i),i}createScene(){return new Vn(this)}createMovableText(t,r){return new Tn(this,t,r)}createLight(t){return new wn(this,t)}createBillboardSet(t){return new _n(this,t)}createMaterial(t){return new xn(this,t)}createOverlayElement(t,r){switch(t){case"Panel":return new Wn(this,r);case"BorderPanel":return new An(this,r);case"TextArea":return new Nn(this,r);default:throw Error(`createOverlayElement: \u0442\u0438\u043F '${t}' \u043D\u0435 \u0440\u0435\u0430\u043B\u0438\u0437\u043E\u0432\u0430\u043D`)}}createOverlay(t){return new Mn(this,t)}createMesh(t,r,n){let i=new Kn(this,t);return i.meta=n,this.meshResByNameUC.set(r.toUpperCase(),i),i}createImage(t,r,n){let i=new Cn(t);return i.meta=n,this.imageResByNameUC.set(r.toUpperCase(),i),i}renderAll(){let t=++this.drawNumber;this.windows.forEach(r=>r.render(t))}};var o0=0,s0=0,a0=0,l0=0,c0=0,u0=0,m0=0,bl=new Set;function T(...e){bl.size!==bl.add(e[0]).size&&console.warn(...e)}function h0(e,t,r){T("AnimationState_AddTime",t,r)}function d0(e,t){throw T("AnimationState_GetEnabled",t),Error("Not implemented")}function p0(e,t){throw T("AnimationState_GetLength",t),Error("Not implemented")}function g0(e,t){throw T("AnimationState_GetLoop",t),Error("Not implemented")}function b0(e,t){throw T("AnimationState_GetTimePosition",t),Error("Not implemented")}function f0(e,t){throw T("AnimationState_GetWeight",t),Error("Not implemented")}function y0(e,t,r){T("AnimationState_SetEnabled",t,r)}function E0(e,t,r){T("AnimationState_SetLength",t,r)}function v0(e,t,r){T("AnimationState_SetLoop",t,r)}function _0(e,t,r){T("AnimationState_SetTimePosition",t,r)}function w0(e,t,r){T("AnimationState_SetWeight",t,r)}function x0(e,t,r,n,i,o){throw T("Billboard_GetColour",t,r,n,i,o),Error("Not implemented")}function P0(e,t,r,n,i){throw T("Billboard_GetPosition",t),Error("Not implemented")}function S0(e,t){throw T("Billboard_GetRotation",t),Error("Not implemented")}function T0(e,t,r,n,i,o){T("Billboard_SetColour",t,r,n,i,o)}function M0(e,t,r,n,i){T("Billboard_SetPosition",t,r,n,i)}function O0(e,t,r){T("Billboard_SetRotation",t,r)}function W0(e,t,r,n){var i;return(i=e.egor.createBillboardSet({name:r||"__BillboardSet_"+o0++,poolSize:n}).key)!=null?i:0}function A0(e,t,r,n,i){var o,s;return(s=(o=e.egor.billboardSets.get(t))==null?void 0:o.createBillboard(r,n,i).key)!=null?s:0}function N0(e,t){T("BillboardSet_Destroy",t)}function R0(e,t,r){throw T("BillboardSet_GetBillboard",t,r),Error("Not implemented")}function I0(e,t){throw T("BillboardSet_GetBillboardType",t),Error("Not implemented")}function F0(e,t,r,n,i){throw T("BillboardSet_GetCommonDirection",t,r,n,i),Error("Not implemented")}function D0(e,t,r,n,i){throw T("BillboardSet_GetCommonUpVector",t,r,n,i),Error("Not implemented")}function k0(e,t,r,n){throw T("BillboardSet_GetDefaultDimensions",t,r,n),Error("Not implemented")}function G0(e,t,r){throw T("BillboardSet_GetMaterialName",t,r),Error("Not implemented")}function L0(e,t){throw T("BillboardSet_GetNumBillboards",t),Error("Not implemented")}function B0(e,t,r){T("BillboardSet_RemoveBillboard",t,r)}function V0(e,t,r){var n;(n=e.egor.billboardSets.get(t))==null||n.setType(r)}function C0(e,t,r,n,i){var o;(o=e.egor.billboardSets.get(t))==null||o.setCommonDirection(r,n,i)}function K0(e,t,r,n,i){var o;(o=e.egor.billboardSets.get(t))==null||o.setCommonUpVector(r,n,i)}function U0(e,t,r,n){var i;(i=e.egor.billboardSets.get(t))==null||i.setDimensions(r,n)}function J0(e,t,r){var n,i;(i=e.egor.billboardSets.get(t))==null||i.setMaterial((n=e.egor.materialByName.get(r))!=null?n:null)}function j0(e,t){throw T("Bone_GetManuallyControlled",t),Error("Not implemented")}function $0(e,t){T("Bone_Reset",t)}function H0(e,t,r){T("Bone_SetManuallyControlled",t,r)}function z0(e,t,r){var n,i;return(i=(n=e.egor.scenes.get(t))==null?void 0:n.createCamera({name:r||"__Camera_"+s0++}).key)!=null?i:0}function q0(e,t){T("Camera_Destroy",t)}function Y0(e,t){throw T("Camera_GetAspectRatio",t),Error("Not implemented")}function X0(e,t){throw T("Camera_GetFarClipDistance",t),Error("Not implemented")}function Q0(e,t){throw T("Camera_GetFOV",t),Error("Not implemented")}function Z0(e,t){throw T("Camera_GetNearClipDistance",t),Error("Not implemented")}function ev(e,t){throw T("Camera_GetPolygonMode",t),Error("Not implemented")}function rv(e,t){throw T("Camera_GetProjectionType",t),Error("Not implemented")}function tv(e,t,r){T("Camera_SetAspectRatio",t,r)}function nv(e,t,r){var n;(n=e.egor.cameras.get(t))==null||n.set({farDist:r})}function iv(e,t,r){T("Camera_SetFocalLength",t,r)}function ov(e,t,r){var n;(n=e.egor.cameras.get(t))==null||n.set({fov:r})}function sv(e,t,r,n){T("Camera_SetFrustumOffset",t,r,n)}function av(e,t,r){var n;(n=e.egor.cameras.get(t))==null||n.set({nearDist:r})}function lv(e,t,r){T("Camera_SetPolygonMode",t,r)}function cv(e,t,r){T("Camera_SetProjectionType",t,r)}function uv(e,t){throw T("Collision_GetDistance",t),Error("Not implemented")}function mv(e,t){throw T("Collision_GetObject",t),Error("Not implemented")}function hv(e){throw T("Collision_GetResultCount"),Error("Not implemented")}function dv(e,t,r,n,i,o,s,a){T("Collision_RayCast",t,r,n,i,o,s,a)}function pv(e){T("Collision_Sort")}function gv(e,t){throw T("Compositor_GetEnabled",t),Error("Not implemented")}function bv(e,t,r){T("Compositor_SetEnabled",t,r)}function fv(e,t,r,n){var s;if(!n)return 0;let i=e.egor.scenes.get(t);if(!i)return 0;let o=e.egor.meshResByNameUC.get(n.toUpperCase());if(!o)throw Error(`Mesh \u043D\u0435 \u0441\u0443\u0449\u0435\u0441\u0442\u0432\u0443\u0435\u0442: '${n}'`);return(s=i.createEntity(o,{name:r||"__Entity_"+a0++}).key)!=null?s:0}function yv(e,t){var r;(r=e.egor.entities.get(t))==null||r.destroy()}function Ev(e,t,r){throw T("Entity_GetAnimationState",t,r),Error("Not implemented")}function vv(e,t,r){throw T("Entity_GetBone",t,r),Error("Not implemented")}function _v(e,t,r){throw T("Entity_GetIndexCount",t,r),Error("Not implemented")}function wv(e,t,r,n){throw T("Entity_GetMaterial",t,r,n),Error("Not implemented")}function xv(e,t){var r,n;return(n=(r=e.egor.entities.get(t))==null?void 0:r.subEntities.length)!=null?n:0}function fl(e,t,r=0){var i,o;let n=e.egor.entities.get(t);return n?r>=0?(o=(i=n.subEntity(r))==null?void 0:i.vertexCount)!=null?o:0:n.subEntities.reduce((s,a)=>s+a.vertexCount,0):0}function Pv(e,t,r,n){var s;let i=e.egor.entities.get(t);if(!i)return;let o=e.egor.materialByName.get(n);o&&((s=i.subEntity(r))==null||s.setMaterial(o))}function Sv(e,t,r){var n;return(n=e.egor.createLight({name:r||"__Light_"+l0++}).key)!=null?n:0}function Tv(e,t){T("Light_Destroy",t)}function Mv(e,t){throw T("Light_GetPowerScale",t),Error("Not implemented")}function Ov(e,t,r,n,i,o){T("Light_SetAttenuation",t,r,n,i,o)}function Wv(e,t,r,n,i){T("Light_SetDiffuseColour",t,r,n,i)}function Av(e,t,r){T("Light_SetPowerScale",t,r)}function Nv(e,t,r,n,i){T("Light_SetSpecularColour",t,r,n,i)}function Rv(e,t,r,n,i){T("Light_SetSpotlightRange",t,r,n,i)}function Iv(e,t,r){T("Light_SetType",t,r)}function Fv(e,t,r,n){T("ManualObject_Begin",t,r,n)}function Dv(e,t){T("ManualObject_Clear",t)}function kv(e,t,r,n,i,o){T("ManualObject_Colour",t,r,n,i,o)}function Gv(e,t,r){T("ManualObject_ConvertToMesh",t,r)}function Lv(e,t,r){throw T("ManualObject_Create",t,r),Error("Not implemented")}function Bv(e,t){T("ManualObject_Destroy",t)}function Vv(e,t){T("ManualObject_End",t)}function Cv(e,t,r){T("ManualObject_EstimateIndexCount",t,r)}function Kv(e,t,r){T("ManualObject_EstimateVertexCount",t,r)}function Uv(e,t){throw T("ManualObject_GetDynamic",t),Error("Not implemented")}function Jv(e,t,r){T("ManualObject_Index",t,r)}function jv(e,t,r,n,i){T("ManualObject_Normal",t,r,n,i)}function $v(e,t,r,n,i){T("ManualObject_Position",t,r,n,i)}function Hv(e,t,r){T("ManualObject_SetDynamic",t,r)}function zv(e,t,r,n){T("ManualObject_TextureCoord",t,r,n)}function qv(e,t){return e.egor.createMaterial(t||"__Material_"+c0++).key}function Yv(e,t){var r;return t&&((r=e.egor.materialByName.get(t))==null?void 0:r.key)||0}function Xv(e,t){throw T("Material_GetBestTechnique",t),Error("Not implemented")}function Qv(e,t,r){throw T("Material_GetName",t,r),Error("Not implemented")}function Zv(e,t,r){var n,i,o;return(o=(i=(n=e.egor.materialByKey.get(t))==null?void 0:n.tech(r))==null?void 0:i.key)!=null?o:0}function e_(e,t,r){throw T("Material_GetTechniqueByName",t,r),Error("Not implemented")}function r_(e,t,r,n,i,o,s,a){throw T("Movable_GetBoundingBox",t,r,n,i,o,s,a),Error("Not implemented")}function t_(e,t){throw T("Movable_GetCastShadows",t),Error("Not implemented")}function n_(e,t,r,n){var i,o;r[n]=(o=(i=e.egor.movables.get(t))==null?void 0:i.name)!=null?o:""}function i_(e,t){var r,n,i;return(i=(n=(r=e.egor.movables.get(t))==null?void 0:r.node)==null?void 0:n.key)!=null?i:0}function o_(e,t){throw T("Movable_GetVisible",t),Error("Not implemented")}function s_(e,t,r){T("Movable_SetCastShadows",t,r)}function a_(e,t,r){var i;let n=e.egor.movables.get(t);n&&((i=e.egor.sceneNodes.get(r))==null||i.attach(n))}function l_(e,t,r){var n;(n=e.egor.movables.get(t))==null||n.setVisible(!!r)}function c_(e,t,r,n){return e.egor.createMovableText(r,{name:t||"__MovableText_"+u0++,fontName:n}).key}function u_(e,t){T("MovableText_Destroy",t)}function m_(e,t,r){throw T("MovableText_GetCaption",t,r),Error("Not implemented")}function h_(e,t){throw T("MovableText_GetCharacterHeight",t),Error("Not implemented")}function d_(e,t,r,n,i,o){throw T("MovableText_GetColor",t,r,n,i,o),Error("Not implemented")}function p_(e,t,r){throw T("MovableText_GetFontName",t,r),Error("Not implemented")}function g_(e,t,r,n,i){throw T("MovableText_GetGlobalTranslation",t,r,n,i),Error("Not implemented")}function b_(e,t,r,n,i){throw T("MovableText_GetLocalTranslation",t,r,n,i),Error("Not implemented")}function f_(e,t){throw T("MovableText_GetSpaceWidth",t),Error("Not implemented")}function y_(e,t,r,n){throw T("MovableText_GetTextAlignment",t,r,n),Error("Not implemented")}function E_(e,t,r){T("MovableText_SetCaption",t,r)}function v_(e,t,r){var n;(n=e.egor.movableTexts.get(t))==null||n.setCharHeight(r)}function __(e,t,r,n,i,o){T("MovableText_SetColor",t,r,n,i,o)}function w_(e,t,r){T("MovableText_SetFontName",t,r)}function x_(e,t,r,n,i){T("MovableText_SetGlobalTranslation",t,r,n,i)}function P_(e,t,r,n,i){T("MovableText_SetLocalTranslation",t,r,n,i)}function S_(e,t,r){T("MovableText_SetSpaceWidth",t,r)}function T_(e,t,r,n){T("MovableText_SetTextAlignment",t,r,n)}function M_(e,t,r){T("Node_AddChild",t,r)}function O_(e,t,r){throw T("Node_GetChild",t,r),Error("Not implemented")}function W_(e,t,r,n,i){throw T("Node_GetDerivedPosition",t,r,n,i),Error("Not implemented")}function A_(e,t,r,n,i,o){throw T("Node_GetDerivedRotationQuaternion",t,r,n,i,o),Error("Not implemented")}function N_(e,t,r,n,i){throw T("Node_GetDerivedScale",t,r,n,i),Error("Not implemented")}function R_(e,t,r,n){var i,o;r[n]=(o=(i=e.egor.nodes.get(t))==null?void 0:i.name)!=null?o:""}function I_(e,t){throw T("Node_GetNumChildren",t),Error("Not implemented")}function F_(e,t){throw T("Node_GetParent",t),Error("Not implemented")}function D_(e,t,r,n,i,o,s,a){var h,d,g;let c=e.egor.nodes.get(t);r[n]=(h=c==null?void 0:c.position[0])!=null?h:0,i[o]=(d=c==null?void 0:c.position[1])!=null?d:0,s[a]=(g=c==null?void 0:c.position[2])!=null?g:0}function k_(e,t,r,n,i,o,s,a,c,h){var g,y,E,v;let d=e.egor.nodes.get(t);i[o]=(g=d==null?void 0:d.rotation[0])!=null?g:0,s[a]=(y=d==null?void 0:d.rotation[1])!=null?y:0,c[h]=(E=d==null?void 0:d.rotation[2])!=null?E:0,r[n]=(v=d==null?void 0:d.rotation[3])!=null?v:0}function G_(e,t,r,n,i,o,s,a){var h,d,g;let c=e.egor.nodes.get(t);r[n]=(h=c==null?void 0:c.scale[0])!=null?h:0,i[o]=(d=c==null?void 0:c.scale[1])!=null?d:0,s[a]=(g=c==null?void 0:c.scale[2])!=null?g:0}function L_(e,t,r){T("Node_RemoveChild",t,r)}function B_(e,t,r){let n=e.egor.nodes.get(r);if(!n)return;let i=e.egor.nodes.get(t);i&&n.addChild(i)}function V_(e,t,r,n,i){var o;(o=e.egor.nodes.get(t))==null||o.setPosition(r,n,i)}function C_(e,t,r,n,i,o){throw T("Node_SetRotationAxis",t,r,n,i,o),Error("Node_SetRotationAxis")}function K_(e,t,r,n,i){var o;(o=e.egor.nodes.get(t))==null||o.resetRotation().rotateX(r).rotateY(n).rotateZ(i)}function U_(e,t,r,n,i){var o;throw Error()}function J_(e,t,r,n,i){var o;(o=e.egor.nodes.get(t))==null||o.resetRotation().rotateY(r).rotateX(n).rotateZ(i)}function j_(e,t,r,n,i){var o;throw Error()}function $_(e,t,r,n,i){var o;throw Error()}function H_(e,t,r,n,i){var o;(o=e.egor.nodes.get(t))==null||o.resetRotation().rotateZ(r).rotateY(n).rotateX(i)}function z_(e,t,r,n,i,o){var s;(s=e.egor.nodes.get(t))==null||s.setRotation(n,i,o,r)}function q_(e,t,r,n,i){var o;(o=e.egor.nodes.get(t))==null||o.setScale(r,n,i)}function Y_(e,t,r){let n=e.egor.overlays.get(t);if(!n)return;let i=e.egor.overlayElements.get(r);i&&n.setChildren(n.children.concat(i))}function X_(e,t){return e.egor.createOverlay(t).key}function Q_(e,t,r,n){throw T("Overlay_FindElementAt",t,r,n),Error("Not implemented")}function Z_(e,t){if(!t)return 0;for(let r of e.egor.overlays.values())if(r.name===t)return r.key;return 0}function ew(e,t,r){throw T("Overlay_GetName",t,r),Error("Not implemented")}function rw(e,t){throw T("Overlay_GetRotate",t),Error("Not implemented")}function tw(e,t,r,n){throw T("Overlay_GetScale",t,r,n),Error("Not implemented")}function nw(e,t,r,n){throw T("Overlay_GetScroll",t,r,n),Error("Not implemented")}function iw(e,t){throw T("Overlay_GetVisible",t),Error("Not implemented")}function ow(e,t){throw T("Overlay_GetZOrder",t),Error("Not implemented")}function sw(e,t,r){T("Overlay_RemoveChild",t,r)}function aw(e,t,r){T("Overlay_SetRotate",t,r)}function lw(e,t,r,n){var i;(i=e.egor.overlays.get(t))==null||i.setScale(r,n)}function cw(e,t,r,n){T("Overlay_SetScroll",t,r,n)}function uw(e,t,r){var n;(n=e.egor.overlays.get(t))==null||n.setVisible(!!r)}function mw(e,t,r){var n;(n=e.egor.overlays.get(t))==null||n.setZ(r)}function hw(e,t,r){let n=e.egor.overlayElements.get(t);if(!n)return;let i=e.egor.overlayElements.get(r);i&&n.setChildren(n.children.concat(i))}function dw(e,t,r){throw T("OverlayContainer_GetChild",t,r),Error("Not implemented")}function pw(e,t){throw T("OverlayContainer_GetChildCount",t),Error("Not implemented")}function gw(e,t,r){T("OverlayContainer_RemoveChild",t,r)}function bw(e,t,r){if(t!=="BorderPanel"&&t!=="Panel"&&t!=="TextArea")throw Error(`\u041D\u0435\u0438\u0437\u0432\u0435\u0441\u0442\u043D\u044B\u0439 \u0442\u0438\u043F OverlayElement: '${t}'`);return e.egor.createOverlayElement(t,{name:r}).key}function fw(e,t){if(!t)return 0;for(let r of e.egor.overlayElements.values())if(r.name===t)return r.key;return 0}function yw(e,t,r,n,i,o){var a,c;let s=e.egor.overlayElements.get(t);r[n]=(a=s==null?void 0:s.horAlign)!=null?a:0,i[o]=(c=s==null?void 0:s.vertAlign)!=null?c:0}function Ew(e,t,r,n){var i,o;r[n]=(o=(i=e.egor.overlayElements.get(t))==null?void 0:i.caption)!=null?o:""}function vw(e,t,r,n,i,o){throw T("OverlayElement_GetColour",t,r,n,i,o),Error("Not implemented")}function _w(e,t,r,n){var i,o,s;r[n]=(s=(o=(i=e.egor.overlayElements.get(t))==null?void 0:i.mat)==null?void 0:o.name)!=null?s:""}function ww(e,t){var r,n;return(n=(r=e.egor.overlayElements.get(t))==null?void 0:r.metricsMode)!=null?n:0}function xw(e,t){var r,n,i;return(i=(n=(r=e.egor.overlayElements.get(t))==null?void 0:r.parent)==null?void 0:n.key)!=null?i:0}function Pw(e,t,r,n,i,o){var a,c;let s=e.egor.overlayElements.get(t);r[n]=(a=s==null?void 0:s.x)!=null?a:0,i[o]=(c=s==null?void 0:s.y)!=null?c:0}function Sw(e,t,r,n,i,o){var a,c;let s=e.egor.overlayElements.get(t);r[n]=(a=s==null?void 0:s.width)!=null?a:0,i[o]=(c=s==null?void 0:s.height)!=null?c:0}function Tw(e,t){let r=e.egor.overlayElements.get(t);return r?r.visible?1:0:-1}function Mw(e,t){throw T("OverlayElement_IsContainer",t),Error("Not implemented")}function Ow(e,t,r,n){var i;(i=e.egor.overlayElements.get(t))==null||i.setAlignment(r,n)}function Ww(e,t,r){var n;(n=e.egor.overlayElements.get(t))==null||n.setCaption(r)}function Aw(e,t,r,n,i,o){var s;(s=e.egor.overlayElements.get(t))==null||s.setColor(r,n,i,o)}function Nw(e,t,r){var n,i;(i=e.egor.overlayElements.get(t))==null||i.setMaterial((n=e.egor.materialByName.get(r))!=null?n:null)}function Rw(e,t,r){var n;(n=e.egor.overlayElements.get(t))==null||n.setMetricsMode(r)}function Iw(e,t,r,n){var i;(i=e.egor.overlayElements.get(t))==null||i.setPosition(r,n)}function Fw(e,t,r,n){var i;(i=e.egor.overlayElements.get(t))==null||i.setSize(r,n)}function Dw(e,t,r){var n;(n=e.egor.overlayElements.get(t))==null||n.setVisible(!!r)}function kw(e,t,r,n){throw T("ParticleSystem_Create",t,r,n),Error("Not implemented")}function Gw(e,t,r,n){throw T("ParticleSystem_CreateEx",t,r,n),Error("Not implemented")}function Lw(e,t){T("ParticleSystem_Destroy",t)}function Bw(e,t,r){T("ParticleSystem_GetName",t,r)}function Vw(e,t){throw T("ParticleSystem_GetParent",t),Error("Not implemented")}function Cw(e,t){throw T("ParticleSystem_GetVisible",t),Error("Not implemented")}function Kw(e,t,r){T("ParticleSystem_SetParent",t,r)}function Uw(e,t,r){T("ParticleSystem_SetVisible",t,r)}function Jw(e,t,r){throw T("Pass_Create",t,r),Error("Not implemented")}function jw(e,t,r,n){throw T("Pass_GetAlphaRejectSettings",t,r,n),Error("Not implemented")}function $w(e,t,r,n,i,o){throw T("Pass_GetAmbient",t,r,n,i,o),Error("Not implemented")}function Hw(e,t){throw T("Pass_GetColourWriteEnabled",t),Error("Not implemented")}function zw(e,t){throw T("Pass_GetCullingMode",t),Error("Not implemented")}function qw(e,t){throw T("Pass_GetDepthCheckEnabled",t),Error("Not implemented")}function Yw(e,t){throw T("Pass_GetDepthFunction",t),Error("Not implemented")}function Xw(e,t){throw T("Pass_GetDepthWriteEnabled",t),Error("Not implemented")}function Qw(e,t,r,n,i,o){throw T("Pass_GetDiffuse",t,r,n,i,o),Error("Not implemented")}function Zw(e,t){throw T("Pass_GetLightingEnabled",t),Error("Not implemented")}function ex(e,t){throw T("Pass_GetPolygonMode",t),Error("Not implemented")}function rx(e,t,r,n){throw T("Pass_GetSceneBlending",t,r,n),Error("Not implemented")}function tx(e,t,r,n,i,o){throw T("Pass_GetSelfIllumination",t,r,n,i,o),Error("Not implemented")}function nx(e,t){throw T("Pass_GetShadingMode",t),Error("Not implemented")}function ix(e,t){throw T("Pass_GetShininess",t),Error("Not implemented")}function ox(e,t,r,n,i,o){throw T("Pass_GetSpecular",t,r,n,i,o),Error("Not implemented")}function sx(e,t,r){throw T("Pass_GetTextureUnitStateByIndex",t,r),Error("Not implemented")}function ax(e,t,r){throw T("Pass_GetTextureUnitStateByName",t,r),Error("Not implemented")}function lx(e,t,r,n){T("Pass_SetAlphaRejectSettings",t,r,n)}function cx(e,t,r,n,i){var o;(o=e.egor.passes.get(t))==null||o.setAmbient(r,n,i)}function ux(e,t,r){T("Pass_SetColourWriteEnabled",t,r)}function mx(e,t,r){T("Pass_SetCullingMode",t,r)}function hx(e,t,r){e.egor.passes.get(t).setDepthCheckEnabled(!!r)}function dx(e,t,r){T("Pass_SetDepthFunction",t,r)}function px(e,t,r){T("Pass_SetDepthWriteEnabled",t,r)}function gx(e,t,r,n,i,o){var s;(s=e.egor.passes.get(t))==null||s.setDiffuse(r,n,i,o)}function bx(e,t,r){var n;(n=e.egor.passes.get(t))==null||n.setLightingEnabled(!!r)}function fx(e,t,r){T("Pass_SetPolygonMode",t,r)}function yx(e,t,r,n){T("Pass_SetSceneBlending",t,r,n)}function Ex(e,t,r,n,i){var o;(o=e.egor.passes.get(t))==null||o.setEmissive(r,n,i)}function vx(e,t,r){var n;(n=e.egor.passes.get(t))==null||n.setShadingMode(r)}function _x(e,t,r){var n;(n=e.egor.passes.get(t))==null||n.setShininess(r)}function wx(e,t,r,n,i,o){var s;(s=e.egor.passes.get(t))==null||s.setSpecular(r,n,i,o)}function xx(e,t,r,n){throw T("RenderTexture_Create",t,r,n),Error("Not implemented")}function Px(e,t){T("RenderTexture_Destroy",t)}function Sx(e,t){let r=e.scenes.get(t);if(!r)throw Error("\u0412\u043D\u0435\u0448\u043D\u0438\u0435 3D \u043E\u043A\u043D\u0430 \u043D\u0435 \u043F\u043E\u0434\u0434\u0435\u0440\u0436\u0438\u0432\u0430\u044E\u0442\u0441\u044F");let n=r.window.width,i=r.window.height,o=e.egor.createRenderWindow(n,i,r);return r.insertFrame(o.view,{title:"",width:n,height:i}),o.key}function Tx(e,t,r,n,i){let o=e.scenes.get(t);if(!o)throw Error("\u0412\u043D\u0435\u0448\u043D\u0438\u0435 3D \u043E\u043A\u043D\u0430 \u043D\u0435 \u043F\u043E\u0434\u0434\u0435\u0440\u0436\u0438\u0432\u0430\u044E\u0442\u0441\u044F");let s=e.egor.createRenderWindow(n,i,o);return o.insertFrame(s.view,{title:r,width:n,height:i}),s.key}function Mx(e,t,r,n,i){throw T("RenderWindow_CreateEx",t,r,n,i),Error("Not implemented")}function Ox(e,t){T("RenderWindow_Destroy",t)}function Wx(e,t){throw T("RenderWindow_Get",t),Error("Not implemented")}function Ax(e){throw T("RenderWindow_GetCount"),Error("Not implemented")}function Nx(e,t){throw T("RenderWindow_GetCursorHovered",t),Error("Not implemented")}function Rx(e,t,r,n,i,o){var a,c,h;let s=(a=e.egor.windows.get(t))==null?void 0:a.mouse();r[n]=(c=s==null?void 0:s.x)!=null?c:0,i[o]=(h=s==null?void 0:s.y)!=null?h:0}function Ix(e,t,r){var n;return(n=e.egor.windows.get(t))!=null&&n.keyPressed(r)?1:0}function Fx(e,t,r){var i;let n=r===0?"left":r===1?"right":r===2?"middle":null;return n&&((i=e.egor.windows.get(t))!=null&&i.buttonPressed(n))?1:0}function Dx(e,t,r,n,i,o){var a,c;let s=e.egor.windows.get(t);r[n]=(a=s==null?void 0:s.x)!=null?a:0,i[o]=(c=s==null?void 0:s.y)!=null?c:0}function kx(e){var t,r;return(r=(t=e.egor.primaryWindow)==null?void 0:t.key)!=null?r:0}function Gx(e,t,r,n,i,o){var a,c;let s=e.egor.windows.get(t);r[n]=(a=s==null?void 0:s.width)!=null?a:0,i[o]=(c=s==null?void 0:s.height)!=null?c:0}function Lx(e,t,r){throw T("RenderWindow_GetViewport",t,r),Error("Not implemented")}function Bx(e,t){var r,n;return(n=(r=e.egor.windows.get(t))==null?void 0:r.viewports.size)!=null?n:0}function Vx(e,t){var r,n;return(n=(r=e.egor.windows.get(t))==null?void 0:r.wheelPosition)!=null?n:0}function Cx(e,t,r,n){T("RenderWindow_SetPosition",t,r,n)}function Kx(e,t,r,n){T("RenderWindow_SetSize",t,r,n)}function Ux(e,t){throw T("RenderWindow_ToggleFullscreen",t),Error("Not implemented")}function Jx(e,t,r,n,i){T("Root_AddResourceLocation",t,r,n,i)}function jx(e,t){let r=Mi(this.prj.dir.resolve(t));r==null||r.split(`\r
`).forEach(n=>{let i=n.trim().toUpperCase();if(!i.startsWith("FILESYSTEM")&&!i.startsWith("ZIP"))return;let o=i.split("=")[1].trim();this.prj.dir.resolve(o).forEach(a=>{if(a.image){let c=a.path.basename();e.egor.createImage(a.image,c,a.path.toString());return}if(a.mesh){let c=a.path.basename();e.egor.createMesh(a.mesh,c,a.path.toString());return}if(a.base64){let c=a.path.basename().toUpperCase(),h=Mi(a.path);if(c.endsWith(".MATERIAL")){let d=h.split(`
`).map(g=>g.trim());for(let g=0;g<d.length;g++){let y=d[g],E=y.startsWith("material ")&&y.replace("material ","").split('"').join("");if(!E)continue;let P=e.egor.createMaterial(E).techs[0].passes[0];for(let w=g+1;w<d.length;w++){let O=d[w];if(O==="}")break;let R=O.startsWith("shading ")&&O.replace("shading ","");if(R){let K=R.toLowerCase()==="phong"?2:1;P.setShadingMode(K);continue}let D=O.startsWith("ambient ")&&O.replace("ambient ","");if(D){let K=D.split(" ").map(parseFloat);if(K.length<3||K.some(isNaN))continue;P.setAmbient(...K);continue}let B=O.startsWith("diffuse ")&&O.replace("diffuse ","");if(B){let K=B.split(" ").map(parseFloat);if(K.length<4||K.some(isNaN))continue;P.setDiffuse(...K);continue}let V=O.startsWith("specular ")&&O.replace("specular ","");if(V){let K=V.split(" ").map(parseFloat);if(K.length<4||K.some(isNaN))continue;P.setSpecular(...K),K.length>4&&P.setShininess(K[4]);continue}let F=O.startsWith("emissive ")&&O.replace("emissive ","");if(F){let K=F.split(" ").map(parseFloat);if(K.length<3||K.some(isNaN))continue;P.setEmissive(...K),K.length>4&&P.setShininess(K[4]);continue}if(O.startsWith("texture_unit"))for(let K=w+1;K<d.length;K++){let z=d[K];if(z==="}")break;let k=z.startsWith("texture ")&&z.replace("texture ","");if(k){let Q=k.toUpperCase();P.createTextureUnit().setTextureName(Q);continue}}}}}}},!1)})}function $x(e){}function Hx(e){T("Root_Destroy")}function zx(e){throw T("Root_GetTime"),Error("Not implemented")}function qx(e){}function Yx(e){}function Xx(e){return 1}function Qx(e){return e.shouldRender=!0,1}function Zx(e){return 1}function eP(e){T("Root_SaveConfig")}function rP(e){return 1}function tP(e,t){T("Scene_Clear",t)}function nP(e,t){if(t!=="OctreeSceneManager"&&t!=="BSPSceneManager"&&t!=="TerrainSceneManager")throw Error(`\u041D\u0435\u043F\u043E\u0434\u0434\u0435\u0440\u0436\u0438\u0432\u0430\u0435\u043C\u044B\u0439 \u0442\u0438\u043F \u0441\u0446\u0435\u043D\u044B: ${t}`);return e.egor.createScene().key}function iP(e,t){T("Scene_Destroy",t)}function oP(e,t,r){throw T("Scene_GetCamera",t,r),Error("Not implemented")}function sP(e,t,r){if(!r)return 0;let n=e.egor.scenes.get(t);if(!n)return 0;for(let i of e.egor.entities.values())if(i.scene===n&&i.name===r)return i.key;return 0}function aP(e,t,r){throw T("Scene_GetLight",t,r),Error("Not implemented")}function lP(e,t,r){throw T("Scene_GetParticleSystem",t,r),Error("Not implemented")}function cP(e,t){var r,n;return(n=(r=e.egor.scenes.get(t))==null?void 0:r.root.key)!=null?n:0}function uP(e,t,r){throw T("Scene_GetSceneNode",t,r),Error("Not implemented")}function mP(e,t){throw T("Scene_GetShadowTechnique",t),Error("Not implemented")}function hP(e,t,r){T("Scene_Load",t,r)}function dP(e,t,r,n,i){var o;(o=e.egor.scenes.get(t))==null||o.setAmbient(r,n,i)}function pP(e,t,r,n,i,o,s,a,c){T("Scene_SetFog",t,r,n,i,o,s,a,c)}function gP(e,t,r){T("Scene_SetShadowTechnique",t,r)}function bP(e,t,r,n,i){t&&T("Scene_SetSkyBox",t,r,n,i)}function fP(e,t,r){T("Scene_SetWorldGeometry",t,r)}function yP(e,t,r){T("SceneNode_AttachObject",t,r)}function EP(e,t,r){var n,i;return(i=(n=e.egor.scenes.get(t))==null?void 0:n.createSceneNode({name:r||"__SceneNode_"+m0++}).key)!=null?i:0}function vP(e,t){var r;(r=e.egor.sceneNodes.get(t))==null||r.destroy()}function _P(e,t,r){T("SceneNode_DetachObject",t,r)}function wP(e,t){var r,n;return(n=(r=e.egor.sceneNodes.get(t))==null?void 0:r.children.length)!=null?n:-1}function xP(e,t,r){throw T("SceneNode_GetObject",t,r),Error("Not implemented")}function PP(e,t){throw T("SceneNode_GetScene",t),Error("Not implemented")}function SP(e,t,r,n,i,o){var s,a;(a=e.egor.sceneNodes.get(t))==null||a.setTracking((s=e.egor.sceneNodes.get(r))!=null?s:null,n,i,o)}function TP(e,t,r,n){let i=e.egor.sceneNodes.get(t);if(!i)return;let o=!!r;if(!n){i.movables.forEach(s=>s.setVisible(o));return}(function s(a){a.movables.forEach(c=>c.setVisible(o)),a.children.forEach(c=>s(c))})(i)}function MP(e,t,r,n){T("StringInterface_GetParameter",t,r,n)}function OP(e,t){throw T("StringInterface_GetParameterCount",t),Error("Not implemented")}function WP(e,t,r,n){T("StringInterface_GetParameterDescription",t,r,n)}function AP(e,t,r,n){T("StringInterface_GetParameterName",t,r,n)}function NP(e,t,r){throw T("StringInterface_GetParameterType",t,r),Error("Not implemented")}function RP(e,t,r,n){let i=e.egor.overlayElements.get(t);i&&i.setParam(r,n)}function IP(e,t,r){throw T("Technique_Create",t,r),Error("Not implemented")}function FP(e,t,r){var n,i,o;return(o=(i=(n=e.egor.techniques.get(t))==null?void 0:n.pass(r))==null?void 0:i.key)!=null?o:0}function DP(e,t,r){throw T("Technique_GetPassByName",t,r),Error("Not implemented")}function kP(e,t,r){var n,i;return(i=(n=e.egor.passes.get(t))==null?void 0:n.createTextureUnit(r).key)!=null?i:0}function GP(e,t,r,n){T("TextureUnitState_GetTexture",t,r,n)}function LP(e,t,r,n){var i,o;(o=e.egor.texUnits.get(t))==null||o.setTexture((i=e.egor.imageResByNameUC.get(r.toUpperCase()))!=null?i:null,n)}function BP(e,t,r,n){throw T("Viewport_AddCompositor",t,r,n),Error("Not implemented")}function VP(e,t,r,n){var s;let i=e.egor.cameras.get(r);if(!i)return 0;let o=e.egor.windows.get(t);return(s=o==null?void 0:o.createViewport(i,n).key)!=null?s:0}function CP(e,t){T("Viewport_Destroy",t)}function KP(e,t,r,n,i){throw T("Viewport_GetBackgroundColour",t,r,n,i),Error("Not implemented")}function UP(e,t){throw T("Viewport_GetCamera",t),Error("Not implemented")}function JP(e,t,r){throw T("Viewport_GetCompositor",t,r),Error("Not implemented")}function jP(e,t,r,n,i,o){throw T("Viewport_GetDimensions",t,r,n,i,o),Error("Not implemented")}function $P(e,t){throw T("Viewport_GetNumCompositors",t),Error("Not implemented")}function HP(e,t){throw T("Viewport_GetOverlaysEnabled",t),Error("Not implemented")}function zP(e,t,r,n,i,o,s,a,c,h){throw T("Viewport_GetRay",t,r,n,i,o,s,a,c,h),Error("Not implemented")}function qP(e,t,r){T("Viewport_RemoveCompositor",t,r)}function YP(e,t,r,n,i){var o;(o=e.egor.viewports.get(t))==null||o.setBackground(r,n,i)}function XP(e,t,r){var i;let n=e.egor.cameras.get(r);n&&((i=e.egor.viewports.get(t))==null||i.setCamera(n))}function QP(e,t,r,n,i,o){T("Viewport_SetDimensions",t,r,n,i,o)}function ZP(e,t,r){var n;(n=e.egor.viewports.get(t))==null||n.enableOverlays(!!r)}function e1(e){e("animationState_AddTime",{a:[u,m]},h0),e("animationState_GetEnabled",{a:[u],r:m},d0),e("animationState_GetLength",{a:[u],r:m},p0),e("animationState_GetLoop",{a:[u],r:m},g0),e("animationState_GetTimePosition",{a:[u],r:m},b0),e("animationState_GetWeight",{a:[u],r:m},f0),e("animationState_SetEnabled",{a:[u,m]},y0),e("animationState_SetLength",{a:[u,m]},E0),e("animationState_SetLoop",{a:[u,m]},v0),e("animationState_SetTimePosition",{a:[u,m]},_0),e("animationState_SetWeight",{a:[u,m]},w0),e("billboard_GetColour",{a:[u,N,N,N,N]},x0),e("billboard_GetPosition",{a:[u,N,N,N]},P0),e("billboard_GetRotation",{a:[u],r:m},S0),e("billboard_SetColour",{a:[u,m,m,m,m]},T0),e("billboard_SetPosition",{a:[u,m,m,m]},M0),e("billboard_SetRotation",{a:[u,m]},O0),e("billboardSet_Create",{a:[u,_,m],r:u},W0),e("billboardSet_CreateBillboard",{a:[u,m,m,m],r:u},A0),e("billboardSet_Destroy",{a:[u]},N0),e("billboardSet_GetBillboard",{a:[u,m],r:u},R0),e("billboardSet_GetBillboardType",{a:[u],r:m},I0),e("billboardSet_GetCommonDirection",{a:[u,N,N,N]},F0),e("billboardSet_GetCommonUpVector",{a:[u,N,N,N]},D0),e("billboardSet_GetDefaultDimensions",{a:[u,N,N]},k0),e("billboardSet_GetMaterialName",{a:[u,Ee]},G0),e("billboardSet_GetNumBillboards",{a:[u],r:m},L0),e("billboardSet_RemoveBillboard",{a:[u,u]},B0),e("billboardSet_SetBillboardType",{a:[u,m]},V0),e("billboardSet_SetCommonDirection",{a:[u,m,m,m]},C0),e("billboardSet_SetCommonUpVector",{a:[u,m,m,m]},K0),e("billboardSet_SetDefaultDimensions",{a:[u,m,m]},U0),e("billboardSet_SetMaterialName",{a:[u,_]},J0),e("bone_GetManuallyControlled",{a:[u],r:m},j0),e("bone_Reset",{a:[u]},$0),e("bone_SetManuallyControlled",{a:[u,m]},H0),e("camera_Create",{a:[u,_],r:u},z0),e("camera_Destroy",{a:[u]},q0),e("camera_GetAspectRatio",{a:[u],r:m},Y0),e("camera_GetFarClipDistance",{a:[u],r:m},X0),e("camera_GetFOV",{a:[u],r:m},Q0),e("camera_GetNearClipDistance",{a:[u],r:m},Z0),e("camera_GetPolygonMode",{a:[u],r:m},ev),e("camera_GetProjectionType",{a:[u],r:m},rv),e("camera_SetAspectRatio",{a:[u,m]},tv),e("camera_SetFarClipDistance",{a:[u,m]},nv),e("camera_SetFocalLength",{a:[u,m]},iv),e("camera_SetFOV",{a:[u,m]},ov),e("camera_SetFrustumOffset",{a:[u,m,m]},sv),e("camera_SetNearClipDistance",{a:[u,m]},av),e("camera_SetPolygonMode",{a:[u,m]},lv),e("camera_SetProjectionType",{a:[u,m]},cv),e("collision_GetDistance",{a:[m],r:m},uv),e("collision_GetObject",{a:[m],r:u},mv),e("collision_GetResultCount",{r:m},hv),e("collision_RayCast",{a:[u,m,m,m,m,m,m]},dv),e("collision_Sort",{},pv),e("compositor_GetEnabled",{a:[u],r:m},gv),e("compositor_SetEnabled",{a:[u,m]},bv),e("entity_Create",{a:[u,_,_],r:u},fv),e("entity_Destroy",{a:[u]},yv),e("entity_GetAnimationState",{a:[u,_],r:u},Ev),e("entity_GetBone",{a:[u,_],r:u},vv),e("entity_GetIndexCount",{a:[u,m],r:m},_v),e("entity_GetMaterial",{a:[u,m,Ee]},wv),e("entity_GetSubEntityCount",{a:[u],r:m},xv),e("entity_GetVertexCount",{a:[u],r:m},fl),e("entity_GetVertexCount",{a:[u,m],r:m},fl),e("entity_SetMaterial",{a:[u,m,_]},Pv),e("light_Create",{a:[u,_],r:u},Sv),e("light_Destroy",{a:[u]},Tv),e("light_GetPowerScale",{a:[u],r:m},Mv),e("light_SetAttenuation",{a:[u,m,m,m,m]},Ov),e("light_SetDiffuseColour",{a:[u,m,m,m]},Wv),e("light_SetPowerScale",{a:[u,m]},Av),e("light_SetSpecularColour",{a:[u,m,m,m]},Nv),e("light_SetSpotlightRange",{a:[u,m,m,m]},Rv),e("light_SetType",{a:[u,m]},Iv),e("manualObject_Begin",{a:[u,_,m]},Fv),e("manualObject_Clear",{a:[u]},Dv),e("manualObject_Colour",{a:[u,m,m,m,m]},kv),e("manualObject_ConvertToMesh",{a:[u,_]},Gv),e("manualObject_Create",{a:[u,_],r:u},Lv),e("manualObject_Destroy",{a:[u]},Bv),e("manualObject_End",{a:[u]},Vv),e("manualObject_EstimateIndexCount",{a:[u,m]},Cv),e("manualObject_EstimateVertexCount",{a:[u,m]},Kv),e("manualObject_GetDynamic",{a:[u],r:m},Uv),e("manualObject_Index",{a:[u,m]},Jv),e("manualObject_Normal",{a:[u,m,m,m]},jv),e("manualObject_Position",{a:[u,m,m,m]},$v),e("manualObject_SetDynamic",{a:[u,m]},Hv),e("manualObject_TextureCoord",{a:[u,m,m]},zv),e("material_Create",{a:[_],r:u},qv),e("material_Get",{a:[_],r:u},Yv),e("material_GetBestTechnique",{a:[u],r:u},Xv),e("material_GetName",{a:[u,Ee]},Qv),e("material_GetTechniqueByIndex",{a:[u,m],r:u},Zv),e("material_GetTechniqueByName",{a:[u,_],r:u},e_),e("movable_GetBoundingBox",{a:[u,N,N,N,N,N,N]},r_),e("movable_GetCastShadows",{a:[u],r:m},t_),e("movable_GetName",{a:[u,Ee]},n_),e("movable_GetParent",{a:[u],r:u},i_),e("movable_GetVisible",{a:[u],r:m},o_),e("movable_SetCastShadows",{a:[u,m]},s_),e("movable_SetParent",{a:[u,u]},a_),e("movable_SetVisible",{a:[u,m]},l_),e("movableText_Create",{a:[_,_,_],r:u},c_),e("movableText_Destroy",{a:[u]},u_),e("movableText_GetCaption",{a:[u,Ee]},m_),e("movableText_GetCharacterHeight",{a:[u],r:m},h_),e("movableText_GetColor",{a:[u,N,N,N,N]},d_),e("movableText_GetFontName",{a:[u,Ee]},p_),e("movableText_GetGlobalTranslation",{a:[u,N,N,N]},g_),e("movableText_GetLocalTranslation",{a:[u,N,N,N]},b_),e("movableText_GetSpaceWidth",{a:[u],r:m},f_),e("movableText_GetTextAlignment",{a:[u,N,N]},y_),e("movableText_SetCaption",{a:[u,_]},E_),e("movableText_SetCharacterHeight",{a:[u,m]},v_),e("movableText_SetColor",{a:[u,m,m,m,m]},__),e("movableText_SetFontName",{a:[u,_]},w_),e("movableText_SetGlobalTranslation",{a:[u,m,m,m]},x_),e("movableText_SetLocalTranslation",{a:[u,m,m,m]},P_),e("movableText_SetSpaceWidth",{a:[u,m]},S_),e("movableText_SetTextAlignment",{a:[u,m,m]},T_),e("node_AddChild",{a:[u,u]},M_),e("node_GetChild",{a:[u,m],r:u},O_),e("node_GetDerivedPosition",{a:[u,N,N,N]},W_),e("node_GetDerivedRotationQuaternion",{a:[u,N,N,N,N]},A_),e("node_GetDerivedScale",{a:[u,N,N,N]},N_),e("node_GetName",{a:[u,Ee]},R_),e("node_GetNumChildren",{a:[u],r:m},I_),e("node_GetParent",{a:[u],r:u},F_),e("node_GetPosition",{a:[u,N,N,N]},D_),e("node_GetRotationQuaternion",{a:[u,N,N,N,N]},k_),e("node_GetScale",{a:[u,N,N,N]},G_),e("node_RemoveChild",{a:[u,u]},L_),e("node_SetParent",{a:[u,u]},B_),e("node_SetPosition",{a:[u,m,m,m]},V_),e("node_SetRotationAxis",{a:[u,m,m,m,m]},C_),e("node_SetRotationEulerXYZ",{a:[u,m,m,m]},K_),e("node_SetRotationEulerXZY",{a:[u,m,m,m]},U_),e("node_SetRotationEulerYXZ",{a:[u,m,m,m]},J_),e("node_SetRotationEulerYZX",{a:[u,m,m,m]},j_),e("node_SetRotationEulerZXY",{a:[u,m,m,m]},$_),e("node_SetRotationEulerZYX",{a:[u,m,m,m]},H_),e("node_SetRotationQuaternion",{a:[u,m,m,m,m]},z_),e("node_SetScale",{a:[u,m,m,m]},q_),e("overlay_AddChild",{a:[u,u]},Y_),e("overlay_Create",{a:[_],r:u},X_),e("overlay_FindElementAt",{a:[u,m,m],r:u},Q_),e("overlay_Get",{a:[_],r:u},Z_),e("overlay_GetName",{a:[u,Ee]},ew),e("overlay_GetRotate",{a:[u],r:m},rw),e("overlay_GetScale",{a:[u,N,N]},tw),e("overlay_GetScroll",{a:[u,N,N]},nw),e("overlay_GetVisible",{a:[u],r:m},iw),e("overlay_GetZOrder",{a:[u],r:m},ow),e("overlay_RemoveChild",{a:[u,u]},sw),e("overlay_SetRotate",{a:[u,m]},aw),e("overlay_SetScale",{a:[u,m,m]},lw),e("overlay_SetScroll",{a:[u,m,m]},cw),e("overlay_SetVisible",{a:[u,m]},uw),e("overlay_SetZOrder",{a:[u,m]},mw),e("overlayContainer_AddChild",{a:[u,u]},hw),e("overlayContainer_GetChild",{a:[u,m],r:u},dw),e("overlayContainer_GetChildCount",{a:[u],r:m},pw),e("overlayContainer_RemoveChild",{a:[u,u]},gw),e("overlayElement_Create",{a:[_,_],r:u},bw),e("overlayElement_Get",{a:[_],r:u},fw),e("overlayElement_GetAlignment",{a:[u,N,N]},yw),e("overlayElement_GetCaption",{a:[u,Ee]},Ew),e("overlayElement_GetColour",{a:[u,N,N,N,N]},vw),e("overlayElement_GetMaterialName",{a:[u,Ee]},_w),e("overlayElement_GetMetricsMode",{a:[u],r:m},ww),e("overlayElement_GetParent",{a:[u],r:u},xw),e("overlayElement_GetPosition",{a:[u,N,N]},Pw),e("overlayElement_GetSize",{a:[u,N,N]},Sw),e("overlayElement_GetVisible",{a:[u],r:m},Tw),e("overlayElement_IsContainer",{a:[u],r:m},Mw),e("overlayElement_SetAlignment",{a:[u,m,m]},Ow),e("overlayElement_SetCaption",{a:[u,_]},Ww),e("overlayElement_SetColour",{a:[u,m,m,m,m]},Aw),e("overlayElement_SetMaterialName",{a:[u,_]},Nw),e("overlayElement_SetMetricsMode",{a:[u,m]},Rw),e("overlayElement_SetPosition",{a:[u,m,m]},Iw),e("overlayElement_SetSize",{a:[u,m,m]},Fw),e("overlayElement_SetVisible",{a:[u,m]},Dw),e("particleSystem_Create",{a:[u,_,_],r:u},kw),e("particleSystem_CreateEx",{a:[u,_,_],r:u},Gw),e("particleSystem_Destroy",{a:[u]},Lw),e("particleSystem_GetName",{a:[u,_]},Bw),e("particleSystem_GetParent",{a:[u],r:u},Vw),e("particleSystem_GetVisible",{a:[u],r:m},Cw),e("particleSystem_SetParent",{a:[u,u]},Kw),e("particleSystem_SetVisible",{a:[u,m]},Uw),e("pass_Create",{a:[u,_],r:u},Jw),e("pass_GetAlphaRejectSettings",{a:[u,N,N]},jw),e("pass_GetAmbient",{a:[u,N,N,N,N]},$w),e("pass_GetColourWriteEnabled",{a:[u],r:m},Hw),e("pass_GetCullingMode",{a:[u],r:m},zw),e("pass_GetDepthCheckEnabled",{a:[u],r:m},qw),e("pass_GetDepthFunction",{a:[u],r:m},Yw),e("pass_GetDepthWriteEnabled",{a:[u],r:m},Xw),e("pass_GetDiffuse",{a:[u,N,N,N,N]},Qw),e("pass_GetLightingEnabled",{a:[u],r:m},Zw),e("pass_GetPolygonMode",{a:[u],r:m},ex),e("pass_GetSceneBlending",{a:[u,N,N]},rx),e("pass_GetSelfIllumination",{a:[u,N,N,N,N]},tx),e("pass_GetShadingMode",{a:[u],r:m},nx),e("pass_GetShininess",{a:[u],r:m},ix),e("pass_GetSpecular",{a:[u,N,N,N,N]},ox),e("pass_GetTextureUnitStateByIndex",{a:[u,m],r:u},sx),e("pass_GetTextureUnitStateByName",{a:[u,_],r:u},ax),e("pass_SetAlphaRejectSettings",{a:[u,m,m]},lx),e("pass_SetAmbient",{a:[u,m,m,m,m]},cx),e("pass_SetColourWriteEnabled",{a:[u,m]},ux),e("pass_SetCullingMode",{a:[u,m]},mx),e("pass_SetDepthCheckEnabled",{a:[u,m]},hx),e("pass_SetDepthFunction",{a:[u,m]},dx),e("pass_SetDepthWriteEnabled",{a:[u,m]},px),e("pass_SetDiffuse",{a:[u,m,m,m,m]},gx),e("pass_SetLightingEnabled",{a:[u,m]},bx),e("pass_SetPolygonMode",{a:[u,m]},fx),e("pass_SetSceneBlending",{a:[u,m,m]},yx),e("pass_SetSelfIllumination",{a:[u,m,m,m,m]},Ex),e("pass_SetShadingMode",{a:[u,m]},vx),e("pass_SetShininess",{a:[u,m]},_x),e("pass_SetSpecular",{a:[u,m,m,m,m]},wx),e("renderTexture_Create",{a:[_,m,m],r:u},xx),e("renderTexture_Destroy",{a:[u]},Px),e("renderWindow_Create",{a:[u,m,m],r:u},Sx),e("renderWindow_Create2",{a:[u,_,m,m,m,m,m,m],r:u},Tx),e("renderWindow_CreateEx",{a:[u,m,m,m],r:u},Mx),e("renderWindow_Destroy",{a:[u]},Ox),e("renderWindow_Get",{a:[m],r:u},Wx),e("renderWindow_GetCount",{r:m},Ax),e("renderWindow_GetCursorHovered",{a:[u],r:m},Nx),e("renderWindow_GetCursorPosition",{a:[u,N,N]},Rx),e("renderWindow_GetKeyboardButtonPressed",{a:[u,m],r:m},Ix),e("renderWindow_GetMouseButtonPressed",{a:[u,m],r:m},Fx),e("renderWindow_GetPosition",{a:[u,N,N]},Dx),e("renderWindow_GetPrimary",{r:u},kx),e("renderWindow_GetSize",{a:[u,N,N]},Gx),e("renderWindow_GetViewport",{a:[u,m],r:u},Lx),e("renderWindow_GetViewportCount",{a:[u],r:m},Bx),e("renderWindow_GetWheelPosition",{a:[u],r:m},Vx),e("renderWindow_SetPosition",{a:[u,m,m]},Cx),e("renderWindow_SetSize",{a:[u,m,m]},Kx),e("renderWindow_ToggleFullscreen",{a:[u],r:m},Ux),e("root_AddResourceLocation",{a:[_,_,_,m]},Jx),e("root_AddResourceLocationFromConfigFile",{a:[_]},jx),e("root_Create",{a:[_,_,_]},$x),e("root_Destroy",{},Hx),e("root_GetTime",{r:m},zx),e("root_Initialise",{},qx),e("root_InitialiseAllResourceGroups",{},Yx),e("root_IsInitialised",{r:m},Xx),e("root_RenderOneFrame",{r:m},Qx),e("root_RestoreConfig",{r:m},Zx),e("root_SaveConfig",{},eP),e("root_ShowConfigDialog",{r:m},rP),e("scene_Clear",{a:[u]},tP),e("scene_Create",{a:[_],r:u},nP),e("scene_Destroy",{a:[u]},iP),e("scene_GetCamera",{a:[u,_],r:u},oP),e("scene_GetEntity",{a:[u,_],r:u},sP),e("scene_GetLight",{a:[u,_],r:u},aP),e("scene_GetParticleSystem",{a:[u,_],r:u},lP),e("scene_GetRootSceneNode",{a:[u],r:u},cP),e("scene_GetSceneNode",{a:[u,_],r:u},uP),e("scene_GetShadowTechnique",{a:[u],r:m},mP),e("scene_Load",{a:[u,_]},hP),e("scene_SetAmbientLight",{a:[u,m,m,m]},dP),e("scene_SetFog",{a:[u,m,m,m,m,m,m,m]},pP),e("scene_SetShadowTechnique",{a:[u,m]},gP),e("scene_SetSkyBox",{a:[u,m,_,m]},bP),e("scene_SetWorldGeometry",{a:[u,_]},fP),e("sceneNode_AttachObject",{a:[u,u]},yP),e("sceneNode_Create",{a:[u,_],r:u},EP),e("sceneNode_Destroy",{a:[u]},vP),e("sceneNode_DetachObject",{a:[u,u]},_P),e("sceneNode_GetNumObjects",{a:[u],r:m},wP),e("sceneNode_GetObject",{a:[u,m],r:u},xP),e("sceneNode_GetScene",{a:[u],r:u},PP),e("sceneNode_SetAutoTracking",{a:[u,u,m,m,m]},SP),e("sceneNode_SetVisible",{a:[u,m,m]},TP),e("stringInterface_GetParameter",{a:[u,_,_]},MP),e("stringInterface_GetParameterCount",{a:[u],r:m},OP),e("stringInterface_GetParameterDescription",{a:[u,m,_]},WP),e("stringInterface_GetParameterName",{a:[u,m,_]},AP),e("stringInterface_GetParameterType",{a:[u,m],r:m},NP),e("stringInterface_SetParameter",{a:[u,_,_]},RP),e("technique_Create",{a:[u,_],r:u},IP),e("technique_GetPassByIndex",{a:[u,m],r:u},FP),e("technique_GetPassByName",{a:[u,_],r:u},DP),e("textureUnitState_Create",{a:[u,_],r:u},kP),e("textureUnitState_GetTexture",{a:[u,_,u]},GP),e("textureUnitState_SetTexture",{a:[u,_,m]},LP),e("viewport_AddCompositor",{a:[u,_,m],r:u},BP),e("viewport_Create",{a:[u,u,m],r:u},VP),e("viewport_Destroy",{a:[u]},CP),e("viewport_GetBackgroundColour",{a:[u,N,N,N]},KP),e("viewport_GetCamera",{a:[u],r:u},UP),e("viewport_GetCompositor",{a:[u,m],r:u},JP),e("viewport_GetDimensions",{a:[u,N,N,N,N]},jP),e("viewport_GetNumCompositors",{a:[u],r:m},$P),e("viewport_GetOverlaysEnabled",{a:[u],r:m},HP),e("viewport_GetRay",{a:[u,m,m,N,N,N,N,N,N]},zP),e("viewport_RemoveCompositor",{a:[u,u]},qP),e("viewport_SetBackgroundColour",{a:[u,m,m,m]},YP),e("viewport_SetCamera",{a:[u,u]},XP),e("viewport_SetDimensions",{a:[u,m,m,m,m]},QP),e("viewport_SetOverlaysEnabled",{a:[u,m]},ZP)}var yl={register:e1,init:function(e){e.egor=new Hr,e.shouldRender=!1},afterCompute:function(e){e.shouldRender&&(e.shouldRender=!1,e.egor.renderAll())},deps:["windows"]};var $e=class $e{constructor(t,r=null){this.file=r;if(t){let n=mt(t);this.v=new DataView(n.buffer)}else this.v=new DataView(new ArrayBuffer(0));this.p=0,this.width=8}static widthToSize(t){return t<0||t>9?0:$e.widthTable[t]}copyTo(t,r,n){return r<0||r+n>this.v.byteLength?0:(t.v.byteLength<n?t.v=new DataView(this.v.buffer.slice(r,n)):new Uint8Array(t.v.buffer).set(new Uint8Array(this.v.buffer,r,n)),1)}seek(t){return this.p=t}eof(){return this.p>=this.size()?1:0}pos(){return this.p}size(){return this.v.byteLength}setWidth(t){return this.width=t,1}widthNumber(){let t=$e.widthToSize(this.width);if(t===0)return 0;let r=this.p,n=r+t;if(n>this.size())return 0;switch(this.p=n,this.width){case 0:return this.v.getUint8(r);case 1:return this.v.getInt8(r);case 2:return this.v.getUint16(r,!0);case 3:return this.v.getInt16(r,!0);case 4:return this.v.getUint32(r,!0);case 5:return this.v.getInt32(r,!0);case 6:return this.v.getFloat32(r,!0);case 7:throw Error("\u0427\u0442\u0435\u043D\u0438\u0435 FLOAT40 \u043D\u0435 \u043F\u043E\u0434\u0434\u0435\u0440\u0436\u0438\u0432\u0430\u0435\u0442\u0441\u044F");case 8:return this.v.getFloat64(r,!0);case 9:throw Error("\u0427\u0442\u0435\u043D\u0438\u0435 FLOAT80 \u043D\u0435 \u043F\u043E\u0434\u0434\u0435\u0440\u0436\u0438\u0432\u0430\u0435\u0442\u0441\u044F");default:return 0}}resize(t){let r=new Uint8Array(new ArrayBuffer(t));r.set(new Uint8Array(this.v.buffer)),this.v=new DataView(r.buffer)}writeWidthNumber(t){let r=$e.widthToSize(this.width);if(r===0)return 0;let n=this.p,i=n+r;switch(i>this.size()&&this.resize(i),this.p=i,this.width){case 0:return this.v.setUint8(n,t),1;case 1:return this.v.setInt8(n,t),1;case 2:return this.v.setUint16(n,t,!0),2;case 3:return this.v.setInt16(n,t,!0),2;case 4:return this.v.setUint32(n,t,!0),4;case 5:return this.v.setInt32(n,t,!0),4;case 6:return this.v.setFloat32(n,t,!0),4;case 7:throw Error("FLOAT40 \u043D\u0435 \u043F\u043E\u0434\u0434\u0435\u0440\u0436\u0438\u0432\u0430\u0435\u0442\u0441\u044F");case 8:return this.v.setFloat64(n,t,!0),8;case 9:throw Error("FLOAT80 \u043D\u0435 \u043F\u043E\u0434\u0434\u0435\u0440\u0436\u0438\u0432\u0430\u0435\u0442\u0441\u044F");default:return 0}}getLine(t,r){let n=this.p,i=Math.min(t,this.size()-n);if(i<=0)return"";let o=0,s="";for(;o<i;){let a=this.v.getUint8(n+o);o++;let c=me.table[a];if(s+=c,c===r)break}return this.p+=o,s}line(){let t=this.p,r=this.size()-t;if(r<=0)return"";let n=0,i=0;for(;n<r;){let s=this.v.getUint8(t+n);if(s===0){i=1;break}if(s===$e.slashR&&n+1<r&&this.v.getUint8(t+n+1)===$e.slashN){i=2;break}n+=1}let o=me.decode(new Uint8Array(this.v.buffer,t,n));return this.p=t+n+i,o}writeLine(t){let r=t+`\r
`,n=this.p,i=n+r.length;return i>this.size()&&this.resize(i),this.p=i,me.encode(r).forEach((s,a)=>this.v.setUint8(n+a,s)),r.length}write(t){let r=this.p,n=r+t.length;n>this.size()&&this.resize(n),this.p=n,t.forEach((i,o)=>this.v.setUint8(r+o,i))}buffer(){return this.v.buffer}};$e.slashR=13,$e.slashN=10,$e.widthTable=[1,1,2,2,4,4,4,5,8,10];var zr=$e;function r1(e,t,r,n){let i=t.toUpperCase(),o=n.toUpperCase(),s=o.includes("CREATE"),a=o.includes("READONLY"),c=ge.freeKey(e.streams);if(i==="FILE"){let h=this.prj.dir.resolve(r),d,g;if(s){if(!(d=h.create("file")))return 0;d.set({base64:g=""})}else if(!(d=h.file())||(g=d.base64)===null)return 0;return e.streams.set(c,new zr(g,a?null:d)),c}return i==="MEMORY"?(e.streams.set(c,new zr),c):(console.warn(`\u041F\u043E\u0442\u043E\u043A \u0442\u0438\u043F\u0430 ${i} \u043D\u0435 \u043F\u043E\u0434\u0434\u0435\u0440\u0436\u0438\u0432\u0430\u0435\u0442\u0441\u044F`),0)}function t1(e,t){let r=e.streams.get(t);if(!r)return 0;if(e.streams.delete(t),!r.file)return 1;let n=new Uint8Array(r.buffer());return r.file.set({base64:jo(n)}),e.handleWrite(r.file,n),1}function n1(e,t,r){var n,i;return(i=(n=e.streams.get(t))==null?void 0:n.seek(r))!=null?i:0}function i1(e,t){var r,n;return(n=(r=e.streams.get(t))==null?void 0:r.eof())!=null?n:0}function o1(e,t){var r,n;return(n=(r=e.streams.get(t))==null?void 0:r.pos())!=null?n:0}function s1(e,t){var r,n;return(n=(r=e.streams.get(t))==null?void 0:r.size())!=null?n:0}function a1(e,t,r){var n,i;return(i=(n=e.streams.get(t))==null?void 0:n.setWidth(r))!=null?i:0}function l1(e,t){var r,n;return(n=(r=e.streams.get(t))==null?void 0:r.widthNumber())!=null?n:0}function c1(e,t){var r,n;return(n=(r=e.streams.get(t))==null?void 0:r.line())!=null?n:""}function u1(e,t,r){var n,i;return(i=(n=e.streams.get(t))==null?void 0:n.writeWidthNumber(r))!=null?i:0}function m1(e,t,r){var n,i;return(i=(n=e.streams.get(t))==null?void 0:n.writeLine(r))!=null?i:0}function h1(e,t,r,n){var i,o;return(o=(i=e.streams.get(t))==null?void 0:i.getLine(r,n))!=null?o:""}function d1(e,t,r,n,i){let o=e.streams.get(t);if(!o)return 0;let s=e.streams.get(r);return s?o.copyTo(s,n,i):0}function p1(e){e("createStream",{a:[_,_,_],r:u},r1),e("closeStream",{a:[u],r:m},t1),e("seek",{a:[u,m],r:m},n1),e("eof",{a:[u],r:m},i1),e("getPos",{a:[u],r:m},o1),e("getSize",{a:[u],r:m},s1),e("setWidth",{a:[u,m],r:m},a1),e("read",{a:[u],r:m},l1),e("readLn",{a:[u],r:_},c1),e("write",{a:[u,m],r:m},u1),e("writeLn",{a:[u,_],r:m},m1),e("getLine",{a:[u,m,_],r:_},h1),e("copyBlock",{a:[u,u,m,m],r:m},d1)}var El={register:p1,init:function(e){e.streams=new Map},name:"streams"};var Rr=new Uint8Array(256);function Un(e){return e>=0&&e<256?!!Rr[e]:!1}function g1(e){return e._functionNotImplemented("System"),0}function b1(e,t){return Un(t)?1:0}function f1(e,t,r,n,i,o){let s=e.windows.get(t);if(!s)return r[n]=0,i[o]=0,0;let{x:a,y:c}=s.mouse,h=s.invmatrix;if(!h)return r[n]=a,i[o]=c,1;let d=a*h[2]+c*h[5]+h[8];return r[n]=(a*h[0]+c*h[3]+h[6])/d,i[o]=(a*h[1]+c*h[4]+h[7])/d,1}function y1(e,t){e.windowSystem.showCursor(t>0)}function vl(e,t,r){var o;let n=typeof t=="number"?e.scenes.get(t):e.windows.get(t);if(!n)return;let i=(o=this.prj.dir.resolve(r).file())==null?void 0:o.cursor;n.setCursor(i?`url(${Te(i.src)}), auto`:"default")}function E1(){return Date.now()-Hs}function v1(e,t,r,n,i,o,s,a,c){let h=new Date;t[r]=h.getHours(),n[i]=h.getMinutes(),o[s]=h.getSeconds(),a[c]=h.getMilliseconds()*.1}function _1(e,t,r,n,i,o,s){let a=new Date;t[r]=a.getFullYear(),n[i]=a.getMonth()+1,o[s]=a.getDate()}function w1(e,t,r,n,...[i,o,s,a,c]){var d;if(n>4)return 0;let h=(d=e.scenes.get(t))==null?void 0:d.scene.objects.get(r);return h?(n<0?delete h.data.hyper:h.data.hyper={mode:n,target:i,object:o,effect:s,window:a,params:c},1):0}function x1(e,t,r,n,i){var a,c,h;let o=e.scenes.get(t);if(!o)return;let s=(h=(c=(a=o.scene.objects.get(i))!=null?a:o.pick(r,n))==null?void 0:c.data)==null?void 0:h.hyper;s&&o.hyperClick(s,{x:r,y:n})}function P1(e){return e.windowSystem.windowFactory.screenWidth}function S1(e){return e.windowSystem.windowFactory.screenHeight}function T1(){return 0}function M1(){return 0}function O1(e){return e.windowSystem.windowFactory.screenWidth}function W1(e){return e.windowSystem.windowFactory.screenHeight}function A1(){return 0}function N1(){return 0}function R1(){return 0}function I1(){return 0}function F1(){return 0}function D1(){return 0}function k1(e,t,r){return e.handleExe(t,r)?1:0}function G1(e,t,r,n,i){return e.handleShell(t,r,n,i)?1:0}function L1(e,t){e.log(t,this)}function B1(e){e("system",{a:[m],rest:[m],r:m},g1),e("getAsyncKeyState",{a:[m],r:m},b1),e("getMousePos",{a:[_,N,N],r:m},f1),e("showCursor",{a:[m]},y1),e("loadCursor",{a:[u,_]},vl),e("loadCursor",{a:[_,_]},vl),e("getTickCount",{r:m},E1),e("getTime",{a:[N,N,N,N]},v1),e("getDate",{a:[N,N,N]},_1),e("setHyperJump2d",{a:[u,u,m],rest:[_],r:m},w1),e("stdHyperJump",{a:[u,m,m,u,m]},x1),e("getScreenWidth",{r:m},P1),e("getScreenHeight",{r:m},S1),e("getWorkAreaX",{r:m},T1),e("getWorkAreaY",{r:m},M1),e("getWorkAreaWidth",{r:m},O1),e("getWorkAreaHeight",{r:m},W1),e("getTitleHeight",{r:m},A1),e("getSmallTitleHeight",{r:m},N1),e("getFixedFrameWidth",{r:m},R1),e("getFixedFrameHeight",{r:m},I1),e("getSizeFrameWidth",{r:m},F1),e("getSizeFrameHeight",{r:m},D1),e("winExecute",{a:[_,m],r:m},k1),e("shell",{a:[_,_,_,m],r:m},G1),e("logMessage",{a:[_]},L1)}var _l={register:B1,deps:["windows"]};var qr=class{constructor(t,r,n){this.parent=t;this.sceneView=r;this.realX=NaN;this.realY=NaN;this.x=0;this.y=0;this.width=0;this.height=0;this.title="";this.visible=!0;this.scrollX=null;this.scrollY=null;this.scale=1;this.lastScrollTime=0;this.manuallyScrolled=!1;let i=this.view=document.createElement("div");i.setAttribute("class","stratum-subwindow"),i.style.setProperty("position","absolute"),i.style.setProperty("transform-origin","top left"),this.set(n),i.appendChild(r),t.scene.view.appendChild(i),i.addEventListener("scroll",()=>{if(this.manuallyScrolled){this.manuallyScrolled=!1;return}this.lastScrollTime=Date.now()})}scrollTo(t,r){Date.now()-this.lastScrollTime<50||(this.view.scrollTo({left:t,top:r}),this.manuallyScrolled=!0)}set({x:t=this.x,y:r=this.y,width:n=this.width,height:i=this.height,title:o=this.title,visible:s=this.visible,scrollX:a=this.scrollX,scrollY:c=this.scrollY,scale:h=this.scale}){var w,O;let{parent:d,view:g}=this,{style:y}=g,E=(t-d.scene.x)*d.window.scale,v=(r-d.scene.y)*d.window.scale,P=1/h;return this.scale!==h&&(h===1?y.removeProperty("transform"):y.setProperty("transform",`scale(${h})`)),this.realX!==E&&y.setProperty("left",E+"px"),this.realY!==v&&y.setProperty("top",v+"px"),(this.width!==n||this.scale!==h)&&y.setProperty("width",n*P+"px"),(this.height!==i||this.scale!==h)&&y.setProperty("height",i*P+"px"),(this.scrollX!==a||this.scale!==h)&&(a&&a.max>n?(a.max!==((w=this.scrollX)==null?void 0:w.max)&&(y.setProperty("overflow-x","scroll"),this.sceneView.style.setProperty("width",a.max*P+"px")),this.scrollX=a):(y.setProperty("overflow-x","hidden"),this.sceneView.style.setProperty("width","100%"),this.scrollX=null)),(this.scrollY!==c||this.scale!==h)&&(c&&c.max>i?(c.max!==((O=this.scrollY)==null?void 0:O.max)&&(y.setProperty("overflow-y","scroll"),this.sceneView.style.setProperty("height",c.max*P+"px")),this.scrollY=c):(y.setProperty("overflow-y","hidden"),this.sceneView.style.setProperty("height","100%"),this.scrollY=null)),this.visible!==s&&y.setProperty("display",s?"block":"none"),this.realX=E,this.realY=v,this.x=t,this.y=r,this.width=n,this.height=i,this.title=o,this.visible=s,this.scale=h,this}close(){this.view.remove()}};var Jn=class e{constructor(t,r,{key:n,matrix:i,name:o,prj:s,scene:a,window:c,parent:h,source:d}){this.k=t;this.c=r;this.currentCursor="default";this.cursorOverHyp=!1;this.all=new Set([this]);this.mouseMoveSubs=new Ae;this.leftButtonUpSubs=new Ae;this.leftButtonDownSubs=new Ae;this.rightButtonUpSubs=new Ae;this.rightButtonDownSubs=new Ae;this.middleButtonUpSubs=new Ae;this.middleButtonDownSubs=new Ae;this.keyDownSubs=new Set;this.keyUpSubs=new Set;this.keyCharSubs=new Set;this.controlNotifySubs=new Ae;this.windowMoveSubs=new Set;this.spaceDoneSubs=new Set;this.sizeSubs=new Set;this.hiddenBy=null;this.mouse={x:0,y:0};this.scene=a,this.window=c,this.key=n,this.name=o,this.prj=s,this.matrix=i!=null?i:null,this.invmatrix=i?Qo(i):null,this.parent=h!=null?h:null,this.source=d!=null?d:null,a.view.style.pointerEvents="auto",a.view.tabIndex=0,a.view.style.outline="none",a.view.style.touchAction="none";let g=this.handleKeyboard.bind(this);a.view.addEventListener("keydown",g),a.view.addEventListener("keyup",g);let y=this.handlePointer.bind(this);a.view.addEventListener("pointerdown",y),a.view.addEventListener("pointermove",y),a.view.addEventListener("pointerup",y),a.view.addEventListener("pointercancel",y),a.oninputchanged=this.handleInput.bind(this)}keyPressed(t){return Un(t)}setMouseCoordsRecursive(t,r){if(this.mouse.x=t,this.mouse.y=r,this.parent){let n=this.window.x-this.parent.scene.x+t,i=this.window.y-this.parent.scene.y+r;this.parent.setMouseCoordsRecursive(n,i)}}handlePointer(t){var B,V;let r=!!(t.buttons&1),n=!!(t.buttons&2),i=!!(t.buttons&4);if(Rr[1]=+r,Rr[2]=+n,Rr[4]=+i,!t.isPrimary||t.target!==t.currentTarget)return;(B=this.c.captureTarget)==null||B.w.scene.view.setPointerCapture(t.pointerId);let{scene:o}=this,s=Math.round(t.offsetX+o.x),a=Math.round(t.offsetY+o.y);this.setMouseCoordsRecursive(s,a);let c=o.pick(s,a);for(;c;){let F=c.parent;if(!F)break;c=F}let h=(V=c==null?void 0:c.data)==null?void 0:V.hyper,d,g;switch(t.type){case"pointerdown":{switch(this.c.closePopups(this),t.button){case 0:h&&!h.disabled&&this.hyperClick(h,{x:s,y:a}),d=this.leftButtonDownSubs,g=513;break;case 1:d=this.middleButtonDownSubs,g=519;break;case 2:d=this.rightButtonDownSubs,g=516;break;default:return}break}case"pointerup":case"pointercancel":{switch(t.button){case 0:d=this.leftButtonUpSubs,g=514;break;case 1:d=this.middleButtonUpSubs,g=520;break;case 2:d=this.rightButtonUpSubs,g=517;break;default:return}break}case"pointermove":this.cursorOverHyp=!!h&&!h.disabled,this.updateCursor(),d=this.mouseMoveSubs,g=512;break}let y=s,E=a,v=this.invmatrix;if(v){let F=s*v[2]+a*v[5]+v[8];y=(s*v[0]+a*v[3]+v[6])/F,E=(s*v[1]+a*v[4]+v[7])/F}let{captureTarget:P}=this.c,w=r?1:0,O=n?2:0,R=i?16:0,D=w|O|R;d.forEach((F,Y)=>{if(!(P&&P.w===this&&P.s===Y||F.has(c)||F.has(null)))return;let{msg:z,xpos:k,ypos:Q,fwkeys:Z}=Y.klass.vars;ue(Y.vars,z,g),k&&ue(Y.vars,k,y),Q&&ue(Y.vars,Q,E),Z&&ue(Y.vars,Z,D),Y.compute(this.k.ctx,!0)})}updateCursor(){this.scene.set({cursor:this.c.cursorVisible?this.cursorOverHyp?"pointer":this.currentCursor:"none"})}handleKeyboard(t){var c;if(t.target!==t.currentTarget)return;let r=t.type,n=(c=Vs.get(t.code))!=null?c:0;!n&&t.code&&console.warn(`\u041D\u0435\u0438\u0437\u0432\u0435\u0441\u0442\u043D\u0430\u044F \u043A\u043B\u0430\u0432\u0438\u0448\u0430: ${t.code}`),Rr[n]=+(r==="keydown");let i=1,o=0,s,a;switch(r){case"keydown":s=this.keyDownSubs,a=256;break;case"keyup":s=this.keyUpSubs,a=257;break}if(s.forEach(h=>{let{msg:d,wvkey:g,repeat:y,scancode:E}=h.klass.vars;ue(h.vars,d,a),g&&ue(h.vars,g,n),y&&ue(h.vars,y,i),E&&ue(h.vars,E,o),h.compute(this.k.ctx,!0)}),r==="keydown"&&!Cs.includes(n)){let h=me.table.indexOf(t.key),d=h<0?n:h;this.keyCharSubs.forEach(g=>{let{msg:y,wvkey:E,repeat:v,scancode:P}=g.klass.vars;ue(g.vars,y,258),E&&ue(g.vars,E,d),v&&ue(g.vars,v,i),P&&ue(g.vars,P,o),g.compute(this.k.ctx,!0)})}}handleInput(t){let r=this.controlNotifySubs,n=1544,i;switch(t.type){case"input":i=768;break;case"focus":i=256;break;case"blur":i=512;break;case"click":i=0;break;default:return}r.forEach((o,s)=>{if(!(o.has(t.target)||o.has(null)))return;let{msg:c,_hobject:h,iditem:d,wnotifycode:g}=s.klass.vars;ue(s.vars,c,n),h&&ue(s.vars,h,t.target.key),d&&ue(s.vars,d,0),g&&ue(s.vars,g,i),s.compute(this.k.ctx,!0)})}setCapture(t){this.c.captureTarget={w:this,s:t}}releaseCapture(){}subscribe(t,r,n,i){var a;let o=i&1,s=(a=this.scene.objects.get(n))!=null?a:null;switch(r){case 3:this.windowMoveSubs.add(t);break;case 1539:this.spaceDoneSubs.add(t);break;case 5:this.sizeSubs.add(t);break;case 1544:(s||n===0)&&this.controlNotifySubs.set(t,s);break;case 512:(s||!o)&&this.mouseMoveSubs.set(t,o?s:null);break;case 513:(s||!o)&&this.leftButtonDownSubs.set(t,o?s:null);break;case 514:(s||!o)&&this.leftButtonUpSubs.set(t,o?s:null);break;case 516:(s||!o)&&this.rightButtonDownSubs.set(t,o?s:null);break;case 517:(s||!o)&&this.rightButtonUpSubs.set(t,o?s:null);break;case 519:(s||!o)&&this.middleButtonDownSubs.set(t,o?s:null);break;case 520:(s||!o)&&this.middleButtonUpSubs.set(t,o?s:null);break;case 1536:if(!s&&o)break;let c=o?s:null;this.mouseMoveSubs.set(t,c),this.leftButtonDownSubs.set(t,c),this.leftButtonUpSubs.set(t,c),this.rightButtonDownSubs.set(t,c),this.rightButtonUpSubs.set(t,c),this.middleButtonDownSubs.set(t,c),this.middleButtonUpSubs.set(t,c);break;case 256:this.keyDownSubs.add(t);break;case 257:this.keyUpSubs.add(t);break;case 258:this.keyCharSubs.add(t);break;case 1537:this.keyDownSubs.add(t),this.keyUpSubs.add(t),this.keyCharSubs.add(t);break;default:this.k._functionNotImplemented(`\u041F\u043E\u0434\u043F\u0438\u0441\u043A\u0430 \u043D\u0430 ${Se[r]}`,t);break}}unsubscribe(t,r){switch(r){case 3:this.windowMoveSubs.delete(t);break;case 1539:this.spaceDoneSubs.delete(t);break;case 5:this.sizeSubs.delete(t);break;case 1544:this.controlNotifySubs.delete(t);break;case 512:this.mouseMoveSubs.delete(t);break;case 513:this.leftButtonDownSubs.delete(t);break;case 514:this.leftButtonUpSubs.delete(t);break;case 516:this.rightButtonDownSubs.delete(t);break;case 517:this.rightButtonUpSubs.delete(t);break;case 519:this.middleButtonDownSubs.delete(t);break;case 520:this.middleButtonUpSubs.delete(t);break;case 1536:this.mouseMoveSubs.delete(t),this.leftButtonDownSubs.delete(t),this.leftButtonUpSubs.delete(t),this.rightButtonDownSubs.delete(t),this.rightButtonUpSubs.delete(t),this.middleButtonDownSubs.delete(t),this.middleButtonUpSubs.delete(t);break;case 256:this.keyDownSubs.delete(t);break;case 257:this.keyUpSubs.delete(t);break;case 258:this.keyCharSubs.delete(t);break;case 1537:this.keyDownSubs.delete(t),this.keyUpSubs.delete(t),this.keyCharSubs.delete(t);break}}setCursor(t){this.currentCursor=t,this.updateCursor()}insertFrame(t,r){let n=new qr(this,t,{x:this.scene.x,y:this.scene.y});n.view.style.pointerEvents="none"}subwindow({data:{data:t,matrix:r,options:n},prj:i,wname:o,coords:s,source:a}){let c=new this.c.sceneCtor(t),h=X(J({},s),{title:o}),d=n==null?void 0:n.size;if((d==null?void 0:d.type)==="fixed")h.width=d.width,h.height=d.height;else if(c.objects.size){let v=pt(c.objects.values());n!=null&&n.autoorg&&c.set({x:v.x,y:v.y}),h.width=v.w,h.height=v.h}let g=new qr(this,c.view,h),y=ge.freeKey(this.c.scenes),E=new e(this.k,this.c,{key:y,name:o,prj:i,scene:c,window:g,matrix:r,source:a,parent:this});return this.c.scenes.set(y,E),this.c.windows.set(o,E),this.all.add(E),E}pick(t,r,n){var c;let i=t,o=r,s=this.matrix;if(s){let h=t*s[2]+r*s[5]+s[8];i=(t*s[0]+r*s[3]+s[6])/h,o=(t*s[1]+r*s[4]+s[7])/h}let a=this.scene.pick(i,o);if(n&&(this.c.lastPickedPrimaryKey=(c=a==null?void 0:a.key)!=null?c:0),!a)return null;for(;a.parent;)a=a.parent;return a}paste(t,r,n,i){var d;if(!((d=t.objects)!=null&&d.length))return null;let o=t;if(i&255){let g=J({},t);i&1&&delete g.pens,i&2&&delete g.brushes,i&8&&delete g.images,i&4&&delete g.imagesOpaque,i&16&&delete g.strings,i&32&&delete g.fonts,i&64&&delete g.texts,o=g}let s=dt(this.scene,o);if(!(i&32768))return s;let a=r,c=n,h=this.matrix;if(h){let g=r*h[2]+n*h[5]+h[8];a=(r*h[0]+n*h[3]+h[6])/g,c=(r*h[1]+n*h[4]+h[7])/g}return s.set({x:a,y:c})}hyperClick(t,r){var i,o,s;let{prj:n}=this;switch(t.object&&console.warn("\u041F\u043E\u0441\u044B\u043B\u043A\u0430 WM_HYPERJUMP \u043D\u0435 \u0440\u0435\u0430\u043B\u0438\u0437\u043E\u0432\u0430\u043D\u0430"),t.mode){case 0:{let a=t.target;if(!a)break;let c=this.k.classes.get(a);if(!c)break;let{scene:h}=c,d=t.window||((i=h==null?void 0:h.options)!=null&&i.popup?"PopupWindow":"MainWindow");if(this.c.windows.has(d))return;let g={x:r.x-this.scene.x+this.window.view.offsetLeft,y:r.y-this.scene.y+this.window.view.offsetTop},y=this.c.window({wname:d,data:h!=null?h:{},prj:n,source:{type:"classname",data:c.name},coords:g});h&&Br(y.scene,c.children,this.k.classes);break}case 1:{let a=t.target;if(!a)break;this.k.handleExe(a);break}case 2:{let a=t.target;if(!a)break;let c=(o=t.params)==null?void 0:o.toUpperCase().includes("/HIDEWINDOWS"),h=n.dir.resolve(a);this.k.projectLoader.open(h).then(d=>{if(!d){console.warn(`${h} \u043D\u0435 \u0441\u0443\u0449\u0435\u0441\u0442\u0432\u0443\u0435\u0442`);return}let g=this.k.project(d);c&&this.c.hideProjectWindows(n,g)}).catch(d=>{if(!(d instanceof Error))throw d;console.warn(`\u041D\u0435 \u0443\u0434\u0430\u043B\u043E\u0441\u044C \u043E\u0442\u043A\u0440\u044B\u0442\u044C ${h}: ${d.message}`)});break}case 3:break;case 4:{let a=(s=t.target)==null?void 0:s.toUpperCase();if(!a)break;a==="CM_CLEARALL"?this.k.set({projects:[]}):a==="CM_PREVPAGE"?this.k.set({projects:this.k.projects.filter(c=>c!==n)}):console.warn(`\u041A\u043E\u043C\u0430\u043D\u0434\u0430 ${a} \u043D\u0435 \u0440\u0435\u0430\u043B\u0438\u0437\u043E\u0432\u0430\u043D\u0430.`);break}default:console.warn("\u041D\u0435\u0438\u0437\u0432\u0435\u0441\u0442\u043D\u044B\u0439 \u0442\u0438\u043F \u0433\u0438\u043F\u0435\u0440\u043F\u0435\u0440\u0435\u0445\u043E\u0434\u0430"),console.log(t)}}remove(){this.c._closeWindows(this.all)}};var jn=class{constructor(t,{sceneCtor:r,windowFactory:n}){this.k=t;this.scenes=new Map;this.windows=new Map;this.cursorVisible=!0;this.captureTarget=null;this.lastPickedPrimaryKey=0;this.clipboard=null;this.openedPopups=new Set;this.sceneCtor=r,this.windowFactory=n}window({data:{data:t,matrix:r,options:n},prj:i,wname:o,coords:s,source:a}){let c=new this.sceneCtor(t),h=X(J({},s),{title:o,popup:n==null?void 0:n.popup}),d=n==null?void 0:n.size;if((d==null?void 0:d.type)==="fixed")h.width=d.width,h.height=d.height;else{let v=pt(c.objects.values());h.width=v.w,h.height=v.h,c.set({x:v.x,y:v.y})}let g=this.windowFactory.window(c.view,h),y=ge.freeKey(this.scenes),E=new Jn(this.k,this,{key:y,name:o,prj:i,scene:c,window:g,matrix:r,source:a});return n!=null&&n.popup&&this.openedPopups.add(E),this.scenes.set(y,E),this.windows.set(o,E),E}releaseCapture(){var t;(t=this.captureTarget)==null||t.w.releaseCapture(),this.captureTarget=null}showCursor(t){this.cursorVisible=t,this.windows.forEach(r=>r.updateCursor())}_closeWindows(t){this.scenes.forEach(r=>{var o;if(!t.has(r))return;r===((o=this.captureTarget)==null?void 0:o.w)&&(this.captureTarget=null);let{key:n,name:i}=r;setTimeout(()=>{let s=1539;r.spaceDoneSubs.forEach(a=>{let{msg:c,_hspace:h,_windowName:d}=a.klass.vars;ue(a.vars,c,s),h&&ue(a.vars,h,n),d&&ue(a.vars,d,i),a.compute(this.k.ctx,!0)})}),r.scene.dispose(),r.window.close(),this.scenes.delete(r.key),this.windows.delete(r.name),this.openedPopups.delete(r)})}closePopups(t){let r=new Set;this.openedPopups.forEach(n=>{n!==t&&n.all.forEach(i=>r.add(i))}),this._closeWindows(r)}clearAll(){this.scenes.clear(),this.windows.clear(),this.cursorVisible=!0,this.lastPickedPrimaryKey=0}hideProjectWindows(t,r){this.windows.forEach(n=>{n.prj===t&&(n.window.set({visible:!1}),n.hiddenBy=r)})}closeProjectWindows(t){let r=new Set([...this.windows.values()].filter(n=>n.prj===t));this._closeWindows(r),this.windows.forEach(n=>{n.hiddenBy===t&&(n.window.set({visible:!0}),n.hiddenBy=null)})}};function V1(e,t,r,n,i,o,s,a,c){var R;let{prj:h}=this,d=e.windows.get(t);if(d)return d.key;let g=null,y=null,E=null;if(n){let D=e.classes.get(n),B=D==null?void 0:D.scene;if(B)g=B,y={type:"classname",data:D.name},E=D.children;else{let V=h.dir.resolve(n),F=(R=V.file())==null?void 0:R.scene;F&&(g=F,y={type:"filename",data:V.toString()})}}let v=sn(c,g==null?void 0:g.options);!v.size&&s&&a&&(v.size={type:"fixed",width:s,height:a});let P={coords:{x:i,y:o},wname:t,data:X(J({},g),{options:v}),prj:h,source:y},w=v.child&&e.windows.get(r),O=w?w.subwindow(P):e.windowSystem.window(P);return E&&Br(O.scene,E,e.classes),O.key}function C1(e,t){var r,n;return(n=(r=e.windows.get(t))==null?void 0:r.window.width)!=null?n:0}function K1(e,t){var r,n;return(n=(r=e.windows.get(t))==null?void 0:r.window.height)!=null?n:0}function U1(e,t){var r,n;return(n=(r=e.scenes.get(t))==null?void 0:r.name)!=null?n:""}function J1(e,t){var r,n;return(n=(r=e.windows.get(t))==null?void 0:r.window.x)!=null?n:0}function j1(e,t){var r,n;return(n=(r=e.windows.get(t))==null?void 0:r.window.y)!=null?n:0}function $1(e,t){var r,n;return(n=(r=e.windows.get(t))==null?void 0:r.key)!=null?n:0}function H1(e,t){var r,n;return(n=(r=e.windows.get(t))==null?void 0:r.window.width)!=null?n:0}function z1(e,t){var r,n;return(n=(r=e.windows.get(t))==null?void 0:r.window.height)!=null?n:0}function q1(e,t){var r,n;return(n=(r=e.windows.get(t))==null?void 0:r.window.title)!=null?n:""}function Y1(e,t,r,n){var i;return(i=e.windows.get(t))!=null&&i.window.set({width:r,height:n})?1:0}function X1(e,t,r,n,i){let o=e.windows.get(t);if(!o)return 0;let s={min:n,max:i};return r>0?o.window.set({scrollX:s}):o.window.set({scrollY:s}),1}function Q1(e,t,r,n){var i;return(i=e.windows.get(t))!=null&&i.window.set({x:r,y:n})?1:0}function Z1(e,t,r,n,i,o){var s;return(s=e.windows.get(t))!=null&&s.window.set({x:r,y:n,width:i,height:o})?1:0}function eS(e,t,r,n){var i;return(i=e.windows.get(t))!=null&&i.window.set({width:r,height:n})?1:0}function rS(e,t,r){var n;return(n=e.windows.get(t))!=null&&n.window.set({title:r})?1:0}function wl(e){return e._functionNotImplemented("SetWindowTransparent"),1}function xl(e){return e._functionNotImplemented("SetWindowTransparentColor"),1}function Pl(e,t,r){return r?(e._functionNotImplemented("SetWindowRegion"),1):0}function tS(e){return e._functionNotImplemented("SetWindowOwner"),1}function nS(e,t,r){var i;let n=(i=e.windows.get(t))==null?void 0:i.window;if(!n)return 0;switch(r){case 0:n.set({visible:!1});break;case 5:case 1:n.set({visible:!0});break}return 1}function iS(e){return e._functionNotImplemented("BringWindowToTop"),1}function oS(e,t){var r;return(r=e.windows.get(t))!=null&&r.remove()?1:0}function sS(){return 0}function aS(e,t){return e.windows.has(t)?1:0}function lS(e,t){var r;return(r=e.windows.get(t))!=null&&r.window.visible?1:0}function cS(e,t,r,n){var d,g;let{prj:i}=this,o=e.windows.get(t);if(o)return o.key;let s=i.dir.resolve(r),a=(g=(d=s.file())==null?void 0:d.scene)!=null?g:null,c=sn(n,a==null?void 0:a.options);return e.windowSystem.window({wname:t,data:X(J({},a),{options:c}),prj:i,source:a?{type:"filename",data:s.toString()}:null}).key}function uS(e,t,r,n){let{prj:i}=this,o=e.windows.get(t);if(o)return o.key;let s=e.classes.get(r),a=s==null?void 0:s.scene,c=sn(n,a==null?void 0:a.options),h=e.windowSystem.window({wname:t,data:X(J({},a),{options:c}),prj:i,source:s?{type:"classname",data:s.name}:null});return a&&Br(h.scene,s.children,e.classes),h.key}function mS(e){return e._functionNotImplemented("OpenClassScheme"),1}function hS(e){return e._functionNotImplemented("CloseClassScheme"),1}function dS(){}function pS(){}function gS(){}function bS(e,t,r){var i;let n=(i=e.windows.get(t))==null?void 0:i.source;return n&&n.type===r.toLowerCase()&&n.data||""}function fS(e){e("createWindowEx",{a:[_,_,_,m,m,m,m,_],r:u},V1),e("getClientWidth",{a:[_],r:m},C1),e("getClientHeight",{a:[_],r:m},K1),e("getWindowName",{a:[u],r:_},U1),e("getWindowOrgX",{a:[_],r:m},J1),e("getWindowOrgY",{a:[_],r:m},j1),e("getWindowSpace",{a:[_],r:u},$1),e("getWindowWidth",{a:[_],r:m},H1),e("getWindowHeight",{a:[_],r:m},z1),e("getWindowTitle",{a:[_],r:_},q1),e("setClientSize",{a:[_,m,m],r:m},Y1),e("setScrollRange",{a:[_,m,m,m],r:m},X1),e("setWindowOrg",{a:[_,m,m],r:m},Q1),e("setWindowPos",{a:[_,m,m,m,m],r:m},Z1),e("setWindowSize",{a:[_,m,m],r:m},eS),e("setWindowTitle",{a:[_,_],r:m},rS),e("setWindowTransparent",{a:[_,m],r:m},wl),e("setWindowTransparent",{a:[u,m],r:m},wl),e("setWindowTransparentColor",{a:[_,ie],r:m},xl),e("setWindowTransparentColor",{a:[u,ie],r:m},xl),e("setWindowRegion",{a:[_,u],r:m},Pl),e("setWindowRegion",{a:[u,u],r:m},Pl),e("setWindowOwner",{a:[u,u],r:m},tS),e("showWindow",{a:[_,m],r:m},nS),e("bringWindowToTop",{a:[_],r:m},iS),e("closeWindow",{a:[_],r:m},oS),e("isIconic",{a:[_],r:m},sS),e("isWindowExist",{a:[_],r:m},aS),e("isWindowVisible",{a:[_],r:m},lS),e("loadSpaceWindow",{a:[_,_,_],r:u},cS),e("openSchemeWindow",{a:[_,_,_],r:u},uS),e("openClassScheme",{a:[_,m],r:u},mS),e("closeClassScheme",{a:[_],r:m},hS),e("cascadeWindows",{},dS),e("tile",{a:[m]},pS),e("arrangeIcons",{},gS),e("getWindowProp",{a:[_,_],r:_},bS)}var Sl={register:fS,init:function(e,t){if(!t)throw Error("\u041F\u043B\u0430\u0433\u0438\u043D 'windows': \u043D\u0435 \u0443\u043A\u0430\u0437\u0430\u043D\u044B \u0437\u0430\u0432\u0438\u0441\u0438\u043C\u043E\u0441\u0442\u0438");let r=e.windowSystem=new jn(e,t);e.windows=r.windows,e.scenes=r.scenes},onProjectClosed:function(e,t){e.windowSystem.closeProjectWindows(t)},name:"windows"};function yS(e,t){return t.toString()}function ES(e,t){return t<0||t>255?"":me.table[t]}function vS(e){e("floatToString",{a:[m],r:_},yS),e("convertToAscii",{a:[m,m],r:_},ES)}var Zi={register:vS,name:"vrtkbd"};var Tl=[Sl,El,zs,Ys,ea,ra,ha,pa,ga,ya,_a,wa,yl,_l];var Ir=class{constructor(t=""){this.name=t;this.type="folder";this.items=new Map}},$n=class{constructor(t,r={}){this.path=t;this.type="file";this.size=null;this.cls=null;this.image=null;this.scene=null;this.video=null;this.audio=null;this.ttf=null;this.cursor=null;this.stt=null;this.mat=null;this.base64=null;this.mesh=null;this.set(r)}set({size:t=this.size,cls:r=this.cls,image:n=this.image,scene:i=this.scene,video:o=this.video,audio:s=this.audio,ttf:a=this.ttf,cursor:c=this.cursor,stt:h=this.stt,mat:d=this.mat,mesh:g=this.mesh,base64:y=this.base64}){return this.size=t,this.cls=r,this.image=n,this.scene=i,this.video=o,this.audio=s,this.ttf=a,this.cursor=c,this.stt=h,this.mat=d,this.mesh=g,this.base64=y,this}},Yr=class e{constructor(t,r,n){this.fs=t;this.parts=r;this.str=null;if(r[0].length!==2&&r[0][1]!==":")throw Error("\u041D\u0435\u043F\u0440\u0430\u0432\u0438\u043B\u044C\u043D\u043E\u0435 \u0438\u043C\u044F \u0442\u043E\u043C\u0430 \u0434\u0438\u0441\u043A\u0430");this.partsUC=n!=null?n:r.map(i=>i.toUpperCase())}static splitPath(t){return t.split(/[/\\]/).map(r=>r.trim()).filter(r=>r.length>0)}resolve(t){let r=e.splitPath(t);if(!r.length)return this;let n=r[0].length===2&&r[0][1]===":",i=n?[r[0]]:this.parts.slice(),o=n?[r[0].toUpperCase()]:this.partsUC.slice();for(let s=n?1:0;s<r.length;++s){let a=r[s];a===".."?i.length>1&&(i.pop(),o.pop()):a!=="."&&(i.push(a),o.push(a.toUpperCase()))}return new e(this.fs,i,o)}toString(){return this.str?this.str:this.str=this.parts.join("\\")}basename(){return this.parts[this.parts.length-1]}equals(t){let r=this.partsUC,n=t.partsUC;if(r.length!==n.length)return!1;for(let i=0;i<r.length;++i)if(r[i]!==n[i])return!1;return!0}startsWith(t){let r=this.partsUC,n=t.partsUC;if(r.length<n.length)return!1;for(let i=0;i<n.length;++i)if(r[i]!==n[i])return!1;return!0}static getFolder(t,r,n){let i=t;for(let o=0;o<r.length-(n?0:1);++o){let s=i.items.get(r[o]);if(!s||s.type!=="folder")return null;i=s}return i}create(t,r){let{partsUC:n}=this,i=e.getFolder(this.fs,n);if(!i)return null;let o=n[n.length-1],s=i.items.has(o);if(t==="folder")return s||i.items.set(o,new Ir),this;if(s)return null;let a=new $n(this,r);return i.items.set(o,a),a}createWithDirs(t){let{parts:r,partsUC:n}=this,i=this.fs;for(let c=0;c<r.length-1;++c){let h=i.items.get(n[c]);if(!h)h=new Ir(r[c]),i.items.set(n[c],h);else if(h.type==="file")throw Error(`\u041D\u0435\u0432\u043E\u0437\u043C\u043E\u0436\u043D\u043E \u0441\u043E\u0437\u0434\u0430\u0442\u044C \u0434\u0438\u0440\u0435\u043A\u0442\u043E\u0440\u0438\u044E ${this}: \u0444\u0430\u0439\u043B ${h.path} \u0443\u0436\u0435 \u0441\u0443\u0449\u0435\u0441\u0442\u0432\u0443\u0435\u0442.`);i=h}let o=n[n.length-1];if(i.items.has(o))throw Error(`\u041D\u0435\u0432\u043E\u0437\u043C\u043E\u0436\u043D\u043E \u0441\u043E\u0437\u0434\u0430\u0442\u044C \u0434\u0438\u0440\u0435\u043A\u0442\u043E\u0440\u0438\u044E ${this}: \u0444\u0430\u0439\u043B \u0443\u0436\u0435 \u0441\u0443\u0449\u0435\u0441\u0442\u0432\u0443\u0435\u0442.`);let a=new $n(this,t);return i.items.set(o,a),a}file(){let{partsUC:t}=this,r=e.getFolder(this.fs,t);if(!r)return pe.debugFile&&console.warn(`${this.toString()} \u043D\u0435 \u0441\u0443\u0449\u0435\u0441\u0442\u0432\u0443\u0435\u0442`),null;let n=t[t.length-1],i=r.items.get(n);return i?i.type!=="file"?(pe.debugFile&&console.warn(`${this.toString()} \u044F\u0432\u043B\u044F\u0435\u0442\u0441\u044F \u0434\u0438\u0440\u0435\u043A\u0442\u043E\u0440\u0438\u0435\u0439`),null):i:(pe.debugFile&&console.warn(`${this.toString()} \u043D\u0435 \u0441\u0443\u0449\u0435\u0441\u0442\u0432\u0443\u0435\u0442`),null)}forEach(t,r){let{partsUC:n}=this,i=e.getFolder(this.fs,n,!0);i&&i.items.forEach(function o(s){s.type==="folder"?r&&s.items.forEach(o):t(s)})}resolveMany(){var s;let{partsUC:t}=this,r=e.getFolder(this.fs,t);if(!r)return[];let n=t[t.length-1];if(n.includes("*")){let[a,c]=n.split("*"),h;return!a&&!c?h=[".","..",...r.items]:h=[...r.items].filter(([d])=>d.startsWith(a)&&d.endsWith(c)),h.map(d=>{var y;if(typeof d=="string")return{name:d,size:0};let g=d[1];return g.type==="folder"?{name:g.name,size:0}:{name:g.path.basename(),size:(y=g.size)!=null?y:0}})}let i=r.items.get(n);return i?[i.type==="folder"?{name:i.name,size:0}:{name:i.path.basename(),size:(s=i.size)!=null?s:0}]:[]}};var Hn=class{constructor(t){this.loadedLibs=new Set;this.fs=new Ir;this.stdlibDir=new Yr(this.fs,["D:",Xt.mount]);this.projects=t.map(r=>[this.path(r.filepath||"project.spj"),r])}path(t,r="C:"){return new Yr(this.fs,[r].concat(t.split("/")))}exists(t){return this.projects.some(([r])=>r.equals(t))}open(t){return mr(this,null,function*(){var P,w;let r=this.projects.find(([O])=>O.equals(t));if(!r)return null;let[n,{data:i,libs:o}]=r,s=o.concat(Xt).map(O=>mr(this,null,function*(){if(this.loadedLibs.size===this.loadedLibs.add(O.id).size)return;let R=O.id===Xt.id?"D:":"C:",{files:D}=O.data||(yield Ds(O,{cache:pe.cache}));D.forEach(B=>this.path(O.mount?`${O.mount}/${B.path}`:B.path,R).createWithDirs(B))}));yield Promise.all(s);let v=i,{searchDirs:a,stt:c}=v,h=we(v,["searchDirs","stt"]),d=n.resolve(".."),g=[this.stdlibDir,d].concat((P=a==null?void 0:a.map(O=>this.path(O)))!=null?P:[]),y=c?this.path(c):d.resolve("_preload.stt"),E=(w=y.file())==null?void 0:w.stt;return E||console.warn(`\u0424\u0430\u0439\u043B \u0441\u043E\u0441\u0442\u043E\u044F\u043D\u0438\u044F ${y} \u043D\u0435 \u0441\u0443\u0449\u0435\u0441\u0442\u0432\u0443\u0435\u0442`),J({filepath:n,dir:d,searchDirs:g,stt:E},h)})}};function Ml(e){e.style.transformOrigin="top left",e.insertAdjacentHTML("afterend",`
<div id="mobzoom-icons-container">
    <img draggable="false" id="mobzoom-in-btn" src="images/zoom-in-icon.svg" />
    <img draggable="false" id="mobzoom-out-btn" src="images/zoom-out-icon.svg" />
</div>`);let r=document.getElementById("mobzoom-in-btn");r.oncontextmenu=k=>k.preventDefault();let n=document.getElementById("mobzoom-out-btn");n.oncontextmenu=k=>k.preventDefault();let i=new We,o=1,s=()=>{if(!isNaN(a))o*=1.05;else if(!isNaN(c))o*=.95;else return!1;return o=Math.min(Math.max(o,.1),1),e.style.transform=`scale(${o})`,e.style.width=`${100/o}%`,e.style.height=`${100/o}%`,!0},a=NaN;r.onpointerdown=k=>{isNaN(a)&&(i.run(s),r.setPointerCapture(a=k.pointerId))},r.onpointerup=k=>{a===k.pointerId&&(a=NaN)},r.onpointercancel=k=>{a===k.pointerId&&(a=NaN)};let c=NaN;n.onpointerdown=k=>{isNaN(c)&&(i.run(s),n.setPointerCapture(c=k.pointerId))},n.onpointerup=k=>{c===k.pointerId&&(c=NaN)},n.onpointercancel=k=>{c===k.pointerId&&(c=NaN)};let h=new We,d=null,g=0,y=1,E=new Map,v=0,P=0,w=1;function O(k){if(!(E.size>2)){if(E.size<2){d=null,(Math.abs(v)>1||Math.abs(P)>1)&&h.run(()=>(v-=Math.sign(v)*.4,P-=Math.sign(P)*.4,e.scrollLeft-=v,e.scrollTop-=P,Math.abs(v)>1||Math.abs(P)>1));return}k.stopPropagation();{d=[...E.values()];let[Q,Z]=d,re=Q.x-Z.x,C=Q.y-Z.y;g=Math.hypot(re,C),y=w}}}let R=null;function D(k){E.set(k.pointerId,{id:k.pointerId,x:k.screenX,y:k.screenY}),h.stop(),k.isPrimary&&(R=[k.clientX,k.clientY]),O(k)}function B(k){E.delete(k.pointerId),k.isPrimary&&(R=null,V.stop()),O(k)}let V=new We,F=100,Y=[0,0];function K(){let[k,Q]=Y;if(R){let C=k-R[0],se=Q-R[1];if(Dr(C,2)+Dr(se,2)<100)return!1}let Z=0,re=0;if(k<F)Z=k-F;else{let C=window.innerWidth-k;C<F&&(Z=F-C)}if(Z/=40,Q<F)re=Q-F;else{let C=window.innerHeight-Q;C<F&&(re=F-C)}return re/=40,Z&&(e.scrollLeft+=Dr(Math.E,Math.abs(Z))*Math.sign(Z)),re&&(e.scrollTop+=Dr(Math.E,Math.abs(re))*Math.sign(re)),!0}function z(k){if(!d&&k.isPrimary?(Y[0]=k.clientX,Y[1]=k.clientY,V.run(K)):V.stop(),!d)return;let Q=E.get(k.pointerId);if(Q){k.isPrimary||(k.stopPropagation(),v=k.screenX-Q.x,P=k.screenY-Q.y,e.scrollLeft-=v,e.scrollTop-=P);{let[Z,re]=d,C=Z.x-re.x,se=Z.y-re.y,L=Math.hypot(C,se)/g;(L>1.25||L<.75)&&(w=y*L,w=Math.min(Math.max(w,.1),1))}Q.x=k.screenX,Q.y=k.screenY}}e.addEventListener("pointerdown",D,{capture:!0}),e.addEventListener("pointerup",B),e.addEventListener("pointercancel",B),e.addEventListener("pointermove",z,{capture:!0})}var _S=window.devicePixelRatio,eo=class{constructor(t,r,s){this.root=t;this.view=r;this.x=0;this.y=0;this.width=0;this.height=0;this.visible=!0;this.scrollX=null;this.scrollY=null;this.scale=1;this.sizeWatcher=new We;this.scaleFactor=NaN;this.hideTimeout=0;var a=s,{popup:n,title:i}=a,o=we(a,["popup","title"]);this.origTitle=t.ownerDocument.title,!n&&i&&(t.ownerDocument.title=this.origTitle?`${this.origTitle} - ${i}`:i),this.title=i!=null?i:"",this.popup=n||!1,this.set(o),t.appendChild(r),this.width=o.width||r.clientWidth,this.height=o.height||r.clientHeight,n||(pe.adaptiveScaling?this.sizeWatcher.run(this.rescale.bind(this)):(r.style.left="0px",r.style.top="0px"))}scrollTo(){}rescale(){let{root:t,view:r,width:n,height:i}=this,o=window.devicePixelRatio/_S,s=t.clientWidth*o,a=t.clientHeight*o,c=s/(n||s),h=a/(i||a),d=Math.min(c,h,1);if(this.scaleFactor!==d){this.scaleFactor=d;let g=r.style;d<1?(g.left="0px",g.top="0px",g.transform=`scale(${d})`):(g.left="auto",g.top="auto",g.transform="none")}return!0}set({x:t=this.x,y:r=this.y,width:n=this.width,height:i=this.height,title:o=this.title,visible:s=this.visible}){return this.popup&&(this.x!==t&&this.view.style.setProperty("left",t+"px"),this.y!==r&&this.view.style.setProperty("top",r+"px")),this.width!==n&&this.view.style.setProperty("width",n+"px"),this.height!==i&&this.view.style.setProperty("height",i+"px"),this.title!==o&&(this.root.ownerDocument.title=o),this.visible!==s&&(this.view.style.opacity=s?"1":"0",this.hideTimeout&&window.clearTimeout(this.hideTimeout),this.hideTimeout=window.setTimeout(()=>this.view.style.setProperty("display",s?"block":"none"),s?0:250)),this.x=t,this.y=r,this.width=n,this.height=i,this.title=o,this.visible=s,this}remove(){this.view.style.opacity="0",setTimeout(()=>this.view.remove(),250)}close(){this.sizeWatcher.stop(),this.popup?this.remove():(setTimeout(()=>this.remove(),250),this.root.ownerDocument.title=this.origTitle)}},zn=class{constructor(t){this.root=(typeof t=="string"?document.getElementById(t):t)||document.body,pe.mobileScaling&&Ml(this.root)}get screenWidth(){return this.root.clientWidth}get screenHeight(){return this.root.clientHeight}window(t,r){let{x:n,y:i}=r;return t.style.setProperty("position","absolute"),r.popup?(n=Math.max(r.x||0,0),i=Math.max(r.y||0,0),r.height&&(i=Math.min(i,this.screenHeight-r.height-11)),t.style.left=n+"px",t.style.top=i+"px",t.style.boxShadow="13px 11px 6px 0px rgb(0 0 0 / 50%)",t.setAttribute("class","stratum-popup")):(t.style.transformOrigin="top left",t.setAttribute("class","stratum-window")),t.style.setProperty("opacity","0"),t.style.setProperty("transition","opacity 250ms linear"),setTimeout(()=>t.style.setProperty("opacity","1")),t.style.setProperty("width",r.width?r.width+"px":"100%"),t.style.setProperty("height",r.height?r.height+"px":"100%"),new eo(this.root,t,X(J({},r),{x:n,y:i}))}};var ro=class e{constructor(t,r){this.kernel=t;this.initial=r;this.diag={iterations:0,missingCommands:[]};this._status="closed";this.computer=new We;this.loop=null;this.speed="smooth"}static create(t,r){return mr(this,null,function*(){var c;if(t=Array.isArray(t)?t:[t],!t.length)throw Error("\u0421\u043F\u0438\u0441\u043E\u043A \u043F\u0440\u043E\u0435\u043A\u0442\u043E\u0432 \u043F\u0443\u0441\u0442");let n=new Hn(t),i=n.path(r||t[0].filepath||"project.spj"),o=yield n.open(i);if(!o)throw Error(`\u041F\u0440\u043E\u0435\u043A\u0442 ${i} \u043D\u0435 \u0441\u0443\u0449\u0435\u0441\u0442\u0432\u0443\u0435\u0442`);let s=new on(n),a={sceneCtor:ps,windowFactory:(c=pe.windowFactory)!=null?c:new zn(pe.root)};return Tl.forEach(h=>s.loadPlugin(h,a)),new e(s,o)})}loadPlugin(t,r){return this.kernel.loadPlugin(t,r),this}set({speed:t=this.speed}){if(this.speed!==t){let r=t==="smooth"?new We:new st(typeof t=="number"?t:void 0);this.computer.running&&(this.computer.stop(),this.loop&&r.run(this.loop)),this.computer=r}return this.speed=t,this}get status(){return this._status}play(){return this.loop?this:(this.kernel.project(this.initial),this.diag.iterations=0,this.loop=()=>{let t;try{t=this.kernel.compute()}catch(r){if(!(r instanceof qe))throw r;console.error(r.message),console.error(r.original);let n=r.message;return this._status="error",this.kernel.handlers.error.forEach(i=>i(n)),!1}return t?++this.diag.iterations:(this.loop=null,this._status="closed",this.kernel.handlers.closed.forEach(r=>r())),t},this.computer.run(this.loop),this._status="playing",this)}close(){return this._status==="error"?(this.kernel.set({projects:[]}).compute(),this.loop=null,this._status="closed",this):(this.kernel.set({projects:[]}),this.step())}pause(){return this.computer.running&&(this.computer.stop(),this._status="paused"),this}continue(){return!this.computer.running&&this.loop&&(this.computer.run(this.loop),this._status="playing"),this}step(){return!this.computer.running&&this.loop&&this.loop(),this}on(t,r){return this.kernel.handlers[t].add(r),this}off(t,r){return r?this.kernel.handlers[t].delete(r):this.kernel.handlers[t].clear(),this}},Ol=ro.create;var to=Ol;to.options=pe;to.plugins={vrtkbd:Zi};(window.stratum||(window.stratum={})).player=to;})();
/**
Copyright (c) 2020 Egor Nepomnyaschih @license (MIT)
*/
/**
 * Gauss-Jordan elimination by lovasoa (https://github.com/lovasoa) @license (MIT)
 */
;stratum.info = { commit: 'bc8c7d4 Merge be55d71c598e76468b51e72132a5426a2e9e02f0 into a242443ef2f98b68d72bf11b33618e83bbe312a1', title: 'Feat/add enable mobile gestures', url: 'https://github.com/Stratum-IIT/stratum-iit/pull/17' };
